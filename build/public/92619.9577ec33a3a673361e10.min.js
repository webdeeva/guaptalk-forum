"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[33069,92619,97650],{14063:(E,x,s)=>{E=s.nmd(E);var y,v;y=[s(17459),s(91749)],v=function(H,p){const a={};let g=!1;a.init=function(){if(a.taskbar=$('[component="taskbar"]'),a.tasklist=a.taskbar.find("ul"),!a.taskbar.length||!a.tasklist.length){g=!0;return}a.taskbar.on("click","li",async function(){const e=$(this),r=e.attr("data-module"),u=e.attr("data-uuid"),l=await app.require(r);return e.hasClass("active")?l.minimize(u):(A(),l.load(u),a.toggleNew(u,!1),a.tasklist.removeClass("active"),e.addClass("active")),!1}),$(window).on("action:app.loggedOut",function(){a.closeAll()})},a.close=async function(e,r){if(g)return;if(a.tasklist.find('[data-module="'+E+'"][data-uuid="'+r+'"]').length){const l=await app.require(e);l&&typeof l.close=="function"&&l.close(r)}},a.closeAll=function(e){if(g)return;let r="[data-uuid]";e&&(r='[data-module="'+e+'"]'+r),a.tasklist.find(r).each(function(u,l){a.close(e||l.getAttribute("data-module"),l.getAttribute("data-uuid"))})},a.discard=function(e,r){if(g)return;a.tasklist.find('[data-module="'+e+'"][data-uuid="'+r+'"]').remove(),B()},a.push=function(e,r,u,l){if(l=l||function(){},g)return l();const t=a.tasklist.find('li[data-uuid="'+r+'"]'),n={module:e,uuid:r,options:u,element:t};p.fire("filter:taskbar.push",n),!t.length&&n.module?h(n,l):l(t)},a.get=function(e){return g?[]:$('[data-module="'+e+'"]').map(function(u,l){return $(l).data()})},a.minimize=function(e,r){if(g)return;a.tasklist.find('[data-module="'+e+'"][data-uuid="'+r+'"]').toggleClass("active",!1)},a.toggleNew=function(e,r,u){if(g)return;a.tasklist.find('[data-uuid="'+e+'"]').toggleClass("new",r),u||p.fire("action:taskbar.toggleNew",e)},a.updateActive=function(e){if(g)return;const r=a.tasklist.find("li");r.removeClass("active"),r.filter('[data-uuid="'+e+'"]').addClass("active"),$("[data-uuid]:not([data-module])").toggleClass("modal-unfocused",!0),$('[data-uuid="'+e+'"]:not([data-module])').toggleClass("modal-unfocused",!1)},a.isActive=function(e){return g?!1:a.tasklist.find('li[data-uuid="'+e+'"]').hasClass("active")};function B(){if(g)return;a.tasklist.find("li").length>0?a.taskbar.attr("data-active","1"):a.taskbar.removeAttr("data-active")}function A(){g||a.tasklist.find(".active").removeClass("active")}function h(e,r){if(g)return r();H.translate(e.options.title,function(u){const l=$("<div></div>").text(u||"NodeBB Task").html(),t=$("<li></li>").addClass(e.options.className).html('<a href="#"'+(e.options.image?` style="background-image: url('`+e.options.image.replace(/&#x2F;/g,"/")+`'); background-size: cover;"`:"")+">"+(e.options.icon?'<i class="fa '+e.options.icon+'"></i> ':"")+'<span aria-label="'+l+'" component="taskbar/title">'+l+"</span></a>").attr({title:l,"data-module":e.module,"data-uuid":e.uuid}).addClass(e.options.state!==void 0?e.options.state:"active");(!e.options.state||e.options.state==="active")&&A(),a.tasklist.append(t),B(),e.element=t,t.data(e),p.fire("action:taskbar.pushed",e),r(t)})}const U=function(e,r,u){switch(r){case"title":e.find('[component="taskbar/title"]').text(u);break;case"icon":e.find("i").attr("class","fa fa-"+u);break;case"image":e.find("a").css("background-image",u?'url("'+u.replace(/&#x2F;/g,"/")+'")':"");break;case"background-color":e.find("a").css("background-color",u);break;case"color":e.find("a").css("color",u);break}};return a.update=function(e,r,u){if(g)return;const l=a.tasklist.find('[data-module="'+e+'"][data-uuid="'+r+'"]');if(!l.length)return;const t=l.data();Object.keys(u).forEach(function(n){t[n]=u[n],U(l,n,u[n])}),l.data(t)},a}.apply(x,y),v!==void 0&&(E.exports=v)},41088:(E,x,s)=>{var y;y=function(){const v={};return v.apply=function(H){$(H).on("mousewheel",function(p){const a=this.scrollTop,g=this.scrollHeight,B=Math.round(this.getBoundingClientRect().height);if(p.originalEvent.deltaY<0&&a===0||p.originalEvent.deltaY>0&&B+a>=g)return!1})},v}.call(x,s,x,E),y!==void 0&&(E.exports=y)},92619:(E,x,s)=>{var y,v;y=[s(52473),s(14063),s(17459),s(91749),s(33530),s(29930),s(49897),s(41088)],v=function(H,p,a,g,B,A,h,U){const e={};e.openChat=function(t,n){if(!app.user.uid)return A.error("[[error:not-logged-in]]");function d(i){e.load(i.attr("data-uuid")),e.center(i),e.focusInput(i)}g.fire("filter:chat.openChat",{modal:!0,roomId:t,uid:n}).then(i=>{if(!i.modal)return ajaxify.go(`/chats/${t}`);e.modalExists(t)?d(e.getModal(t)):h.get(`/chats/${t}`,{uid:n||app.user.uid}).then(c=>{c.users=c.users.filter(function(m){return m&&parseInt(m.uid,10)!==parseInt(app.user.uid,10)}),c.uid=n||app.user.uid,c.isSelf=!0,e.createModal(c,d)}).catch(A.error)})},e.newChat=function(t,n){function d(){h.post("/chats",{uids:[t]}).then(({roomId:i})=>{ajaxify.data.template.chats?ajaxify.go("chats/"+i):e.openChat(i),n(null,i)}).catch(A.error)}if(n=n||function(){},!app.user.uid)return A.error("[[error:not-logged-in]]");if(parseInt(t,10)===parseInt(app.user.uid,10))return A.error("[[error:cant-chat-with-yourself]]");if(!utils.isNumber(t))return d();h.get(`/users/${t}/status`).then(({status:i})=>{if(i!=="dnd")return d();B.confirm("[[modules:chat.confirm-chat-with-dnd-user]]",function(c){c&&d()})}).catch(A.error)},e.loadChatsDropdown=function(t){h.get("/chats",{uid:app.user.uid,after:0}).then(n=>{const d=n.rooms.map(i=>(i&&i.teaser&&(i.teaser.timeagoLong=$.timeago(new Date(parseInt(i.teaser.timestamp,10)))),i));a.toggleTimeagoShorthand(async function(){d.forEach(m=>{m&&m.teaser&&(m.teaser.timeago=$.timeago(new Date(parseInt(m.teaser.timestamp,10))),m.teaser.timeagoShort=m.teaser.timeago)}),a.toggleTimeagoShorthand();const i=await app.parseAndTranslate("partials/chats/dropdown",{rooms:d}),c=t.get(0);t.find("*").not(".navigation-link").remove(),t.prepend(i),t.off("click").on("click","[data-roomid]",function(m){if([".user-link",".mark-read"].some(f=>m.target.closest(f)))return;const o=$(this).attr("data-roomid");ajaxify.currentPage.match(/^chats\//)?ajaxify.go("user/"+app.user.userslug+"/chats/"+o):e.openChat(o)}),c.removeEventListener("click",r),c.addEventListener("click",r),$('[component="chats/mark-all-read"]').off("click").on("click",async function(){const m=document.querySelectorAll('[component="chat/list"] [data-roomid]');await Promise.all(Array.prototype.map.call(m,async o=>{const f=o.getAttribute("data-roomid");await h.del(`/chats/${f}/state`),ajaxify.data.template.chats&&e.markChatElUnread($(o),!1)}))})})}).catch(A.error)};function r(t){if(!t.target.closest(".mark-read"))return;t.stopPropagation();const d=t.target.closest("[data-roomid]");e.toggleReadState(d)}e.toggleReadState=function(t){const n=!t.classList.contains("unread"),d=t.getAttribute("data-roomid");h[n?"put":"del"](`/chats/${d}/state`,{}).catch(i=>{A.error(i),e.markChatElUnread($(t),!n)}),e.markChatElUnread($(t),n)},e.isFromBlockedUser=function(t){return app.user.blocks.includes(parseInt(t,10))},e.isLookingAtRoom=function(t){return ajaxify.data.template.chats&&parseInt(ajaxify.data.roomId,10)===parseInt(t,10)},e.markChatElUnread=function(t,n){if(t.length>0){t.toggleClass("unread",n);const d=t.find(".mark-read");d.length&&(d.find(".read").toggleClass("hidden",n),d.find(".unread").toggleClass("hidden",!n))}},e.onChatMessageReceived=function(t){if(!app.user.blocks.includes(parseInt(t.fromUid,10))&&e.modalExists(t.roomId)){const n=e.getModal(t.roomId),d=parseInt(n.attr("new-message"),10)===1;t.self=parseInt(app.user.uid,10)===parseInt(t.fromUid,10)?1:0,d||n.attr("new-message",t.self===0?1:0),t.message.self=t.self,t.message.timestamp=Math.min(Date.now(),t.message.timestamp),t.message.timestampISO=utils.toISOString(t.message.timestamp),u(t)}};function u(t){const n=e.getModal(t.roomId),d=t.message.fromUser.username,i=t.self===1;s.e(60419).then(function(){var c=[s(60419)];(function(m){n.find('[data-mid="'+t.message.messageId+'"]').length||m.appendChatMessage(n.find('[component="chat/message/content"]'),t.message),n.is(":visible")?(p.updateActive(n.attr("data-uuid")),m.isAtBottom(n.find('[component="chat/message/content"]'))&&m.scrollToBottomAfterImageLoad(n.find('[component="chat/message/content"]'))):ajaxify.data.template.chats||e.toggleNew(n.attr("data-uuid"),!0,!0),!i&&(!n.is(":visible")||!app.isFocused)&&p.push("chat",n.attr("data-uuid"),{title:"[[modules:chat.chatting-with]] "+(t.roomName||d),touid:t.message.fromUser.uid,roomId:t.roomId,isSelf:!1})}).apply(null,c)}).catch(s.oe)}e.onRoomRename=function(t){const n=e.getModal(t.roomId),d=n.find('[component="chat/room/name"]'),i=d.attr("data-icon");d.length&&d.html(t.newName?`<i class="fa ${i} text-muted"></i> ${t.newName}`:t.chatWithMessage);const c=$("<div></div>").html(t.newName).text();p.update("chat",n.attr("data-uuid"),{title:c}),g.fire("action:chat.renamed",Object.assign(t,{modal:n}))},e.onUserTyping=function(t){if(t.uid===app.user.uid||e.isFromBlockedUser(t.uid))return;const n=e.getModal(t.roomId);n.length&&e.updateTypingUserList(n,t)},e.updateTypingUserList=async function(t,{uid:n,username:d,typing:i}){const c=t.find('[component="chat/composer/typing"]'),m=c.find('[component="chat/composer/typing/users"]'),o=m.find(`[data-uid="${n}"]`);i&&!o.length?$("<div/>").attr("data-uid",n).text(d).appendTo(m):!i&&o.length&&o.remove();const f=[];m.children().each((C,I)=>{f.push($(I).text())});const R=c.find('[component="chat/composer/typing/text"]'),T=f.length>3?"n":f.length;if(T){const C=`modules:chat.user-typing-${T}`,I=a.compile.apply(null,[C,...f]);R.html(await a.translate(I))}R.toggleClass("hidden",!f.length)},e.getModal=function(t){return $("#chat-modal-"+t)},e.modalExists=function(t){return $("#chat-modal-"+t).length!==0},e.initWidget=function(t,n){Promise.all([s.e(20056),s.e(6411),s.e(60419),s.e(38636),s.e(26832)]).then(function(){var d=[s(38636),s(60419)];(function(i,c){socket.emit("modules.chats.enter",t),h.del(`/chats/${t}/state`,{}),n.find(".timeago").timeago(),n.find('[data-bs-toggle="tooltip"]').tooltip({trigger:"hover",container:"#content"}),c.wrapImagesInLinks(n.find('[component="chat/messages"] .chat-content')),U.apply(n.find('[component="chat/messages"] .chat-content')),n.on("mousemove keypress click",function(){parseInt(n.attr("new-message"),10)===1&&(h.del(`/chats/${t}/state`,{}),n.removeAttr("new-message"))}),i.addActionHandlers(n.find('[component="chat/message/window"]'),t),i.addSendHandlers(t,n.find(".chat-input"),n.find('[data-action="send"]')),i.createAutoComplete(t,n.find('[component="chat/input"]')),i.addScrollHandler(t,app.user.uid,n.find('[component="chat/message/content"]')),i.addScrollBottomHandler(t,n.find('[component="chat/message/content"]')),i.addParentHandler(n.find('[component="chat/message/content"]')),i.addCharactersLeftHandler(n),i.addTextareaResizeHandler(n),i.addTypingHandler(n,t),i.addIPHandler(n),i.addTooltipHandler(n),i.addUploadHandler({dragDropAreaEl:n.find(".modal-content"),pasteEl:n,uploadFormEl:n.find('[component="chat/upload"]'),uploadBtnEl:n.find('[component="chat/upload/button"]'),inputEl:n.find('[component="chat/input"]')}),c.addSocketListeners(),c.scrollToBottomAfterImageLoad(n.find(".chat-content")),g.fire("action:chat.loaded",n)}).apply(null,d)}).catch(s.oe)},e.createModal=function(t,n){n=n||function(){},Promise.all([s.e(20056),s.e(6411),s.e(60419),s.e(38636),s.e(26832)]).then(function(){var d=[s(38636),s(60419),s(65161)];(function(i,c,m){app.parseAndTranslate("chat",t,function(o){const f=t.roomId;if(e.modalExists(f))return n(e.getModal(t.roomId));const R=utils.generateUUID();let T=!1;o.attr("id","chat-modal-"+f),o.attr("data-roomid",f),o.attr("data-uuid",R),o.css("position","fixed"),o.appendTo($("body")),o.find(".timeago").timeago(),o.find('[data-bs-toggle="tooltip"]').tooltip({trigger:"hover",container:"#content"}),c.wrapImagesInLinks(o.find('[component="chat/messages"] .chat-content')),U.apply(o.find('[component="chat/messages"] .chat-content')),e.center(o),l(o,R),o.find("#chat-close-btn").on("click",function(){e.close(R)});function C(){const I=H.get("chat/input").val();$(window).one("action:ajaxify.end",function(){H.get("chat/input").val(I)}),ajaxify.go(`user/${app.user.userslug}/chats/${f}`),e.close(R)}o.find(".modal-header").on("dblclick",C),o.find('button[data-action="maximize"]').on("click",C),o.find('button[data-action="minimize"]').on("click",function(){const I=o.attr("data-uuid");e.minimize(I)}),o.on("mouseup",function(){p.updateActive(o.attr("data-uuid")),T&&(T=!1)}),o.on("mousemove",function(I){I.which===1&&(T=!0)}),o.on("mousemove keypress click",function(){parseInt(o.attr("new-message"),10)===1&&(h.del(`/chats/${f}/state`,{}),o.removeAttr("new-message"))}),i.addActionHandlers(o.find('[component="chat/message/window"]'),f),i.addRenameHandler(f,o.find('[data-action="rename"]')),i.addLeaveHandler(f,o.find('[data-action="leave"]')),i.addDeleteHandler(f,o.find('[data-action="delete"]')),i.addSendHandlers(f,o.find(".chat-input"),o.find('[data-action="send"]')),i.addManageHandler(f,o.find('[data-action="manage"]')),i.createAutoComplete(f,o.find('[component="chat/input"]')),i.addScrollHandler(f,t.uid,o.find('[component="chat/message/content"]')),i.addScrollBottomHandler(f,o.find('[component="chat/message/content"]')),i.addParentHandler(o.find('[component="chat/message/content"]')),i.addCharactersLeftHandler(o),i.addTextareaResizeHandler(o),i.addTypingHandler(o,f),i.addIPHandler(o),i.addTooltipHandler(o),i.addUploadHandler({dragDropAreaEl:o.find(".modal-content"),pasteEl:o,uploadFormEl:o.find('[component="chat/upload"]'),uploadBtnEl:o.find('[component="chat/upload/button"]'),inputEl:o.find('[component="chat/input"]')}),c.addSocketListeners(),m.init(f,o),i.addNotificationSettingHandler(f,o),p.push("chat",o.attr("data-uuid"),{title:"[[modules:chat.chatting-with]] "+(t.roomName||(t.users.length?t.users[0].username:"")),roomId:t.roomId,icon:"fa-comment",state:"",isSelf:t.isSelf},function(){p.toggleNew(o.attr("data-uuid"),!t.isSelf),g.fire("action:chat.loaded",o),typeof n=="function"&&n(o)})})}).apply(null,d)}).catch(s.oe)};function l(t,n){app.loadJQueryUI(function(){t.find(".modal-content").resizable({handles:"n, e, s, w, se",minHeight:250,minWidth:400}),t.find(".modal-content").on("resize",function(d,i){i.originalSize.height!==i.size.height&&t.find(".modal-body").css("height",e.calculateChatListHeight(t))}),t.draggable({start:function(){p.updateActive(n),t.css({bottom:"auto",right:"auto"})},stop:function(){e.focusInput(t)},distance:10,handle:".modal-header"})})}return e.focusInput=function(t){setTimeout(function(){t.find('[component="chat/input"]').focus()},20)},e.close=function(t){const n=$('.chat-modal[data-uuid="'+t+'"]');n.remove(),n.data("modal",null),p.discard("chat",t),n.attr("data-mobile")&&e.disableMobileBehaviour(n);const d=n.attr("data-roomid");Promise.all([s.e(20056),s.e(6411),s.e(60419),s.e(38636),s.e(26832)]).then(function(){var i=[s(38636)];(function(c){c.destroyAutoComplete(d)}).apply(null,i)}).catch(s.oe),socket.emit("modules.chats.leave",d),g.fire("action:chat.closed",{uuid:t,modal:n})},e.center=function(t){const n=t.attr("data-center");if(!n||n==="false")return;let d=!1;return t.hasClass("hide")&&(t.removeClass("hide"),d=!0),t.css("left",Math.max(0,($(window).width()-$(t).outerWidth())/2+$(window).scrollLeft())+"px"),t.css("top",Math.max(0,$(window).height()/2-$(t).outerHeight()/2)+"px"),d&&t.addClass("hide"),t},e.load=function(t){s.e(60419).then(function(){var n=[s(60419)];(function(d){const i=$('.chat-modal[data-uuid="'+t+'"]');i.removeClass("hide"),p.updateActive(t),d.scrollToBottomAfterImageLoad(i.find(".chat-content")),e.focusInput(i);const c=i.attr("data-roomid");h.del(`/chats/${c}/state`,{}),socket.emit("modules.chats.enter",c);const m=utils.findBootstrapEnvironment();(m==="xs"||m==="sm")&&e.enableMobileBehaviour(i)}).apply(null,n)}).catch(s.oe)},e.enableMobileBehaviour=function(t){app.toggleNavbar(!1),t.attr("data-mobile","1");const n=t.find(".modal-body");n.css("height",e.calculateChatListHeight(t));function d(){n.css("height",e.calculateChatListHeight(t)),s.e(60419).then(function(){var i=[s(60419)];(function(c){c.scrollToBottom(t.find(".chat-content"))}).apply(null,i)}).catch(s.oe)}$(window).on("resize",d),$(window).one("action:ajaxify.start",function(){e.close(t.attr("data-uuid")),$(window).off("resize",d)})},e.disableMobileBehaviour=function(){app.toggleNavbar(!0)},e.calculateChatListHeight=function(t){return t.find(".modal-content").outerHeight()-t.find(".modal-header").outerHeight()},e.minimize=function(t){const n=$('.chat-modal[data-uuid="'+t+'"]');n.addClass("hide"),p.minimize("chat",t),g.fire("action:chat.minimized",{uuid:t,modal:n})},e.toggleNew=p.toggleNew,e}.apply(x,y),v!==void 0&&(E.exports=v)}}]);
