"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,18470,34271,49897,89379,99127],{27693:(S,P,c)=>{var y,k;y=[c(70012),c(57576),c(33530),c(81335),c(49897),c(29930)],k=function(E,D,p,h,m,f){const u={};u.init=function(){E.load("core.api",$(".core-api-settings")),$("#save").on("click",()=>{E.save("core.api",$(".core-api-settings"))});const n=document.querySelectorAll('[data-component="acp/tokens"] [data-action="copy"]');new D(n),$('[data-action="create"]').on("click",e),t()};function t(){const n=document.querySelector("#content form");n&&n.addEventListener("click",s=>{const r=s.target.closest("[data-action]");if(r)switch(r.getAttribute("data-action")){case"edit":i(r);break;case"delete":a(r);break;case"roll":o(r);break}})}async function e(){const n=await h.render("admin/partials/edit-token-modal",{}),s=async function(){const r=this,d=this.get(0).querySelector("form"),l=document.querySelector('[data-component="acp/tokens"] tbody'),g=d.reportValidity();if(d&&g){const R=new FormData(d),O=R.get("uid"),A=R.get("description");try{const v=await m.post("/admin/tokens",{uid:O,description:A});if(!l)return r.modal("hide"),ajaxify.refresh();ajaxify.data.tokens.push(v);const x=(await app.parseAndTranslate(ajaxify.data.template.name,"tokens",{tokens:[v]})).get(0);l.append(x),$(x).find(".timeago").timeago(),r.modal("hide")}catch(v){f.error(v)}}return!1};p.dialog({title:"[[admin/settings/api:create-token]]",message:n,buttons:{submit:{label:"[[modules:bootbox.submit]]",className:"btn-primary",callback:s}}})}async function i(n){const s=n.closest("[data-token]"),r=s.getAttribute("data-token"),{uid:d,description:l}=await m.get(`/admin/tokens/${r}`),g=async function(){const O=this,A=this.get(0).querySelector("form"),v=A.reportValidity();if(A&&v){const x=new FormData(A),C=x.get("uid"),j=x.get("description");try{const T=await m.put(`/admin/tokens/${r}`,{uid:C,description:j}),w=(await app.parseAndTranslate(ajaxify.data.template.name,"tokens",{tokens:[T]})).get(0);s.replaceWith(w),$(w).find(".timeago").timeago(),O.modal("hide")}catch(T){f.error(T)}}return!1},R=await h.render("admin/partials/edit-token-modal",{uid:d,description:l});p.dialog({title:"[[admin/settings/api:update-token]]",message:R,buttons:{submit:{label:"[[modules:bootbox.submit]]",className:"btn-primary",callback:g}}})}async function a(n){const s=n.closest("[data-token]"),r=s.getAttribute("data-token");p.confirm("[[admin/settings/api:delete-confirm]]",async d=>{if(d){try{await m.del(`/admin/tokens/${r}`)}catch(l){f.error(l)}s.remove()}})}async function o(n){const s=n.closest("[data-token]"),r=s.getAttribute("data-token");p.confirm("[[admin/settings/api:roll-confirm]]",async d=>{if(d)try{const l=await m.post(`/admin/tokens/${r}/roll`),g=(await app.parseAndTranslate(ajaxify.data.template.name,"tokens",{tokens:[l]})).get(0);s.replaceWith(g),$(g).find(".timeago").timeago()}catch(l){f.error(l)}})}return u}.apply(P,y),k!==void 0&&(S.exports=k)},49897:(S,P,c)=>{c.r(P),c.d(P,{del:()=>a,get:()=>f,head:()=>u,patch:()=>e,post:()=>t,put:()=>i});var y=c(91749),k=c.n(y),E=c(33530),D=c.n(E);const p=config.relative_path+"/api/v3";async function h(o,n){if(o.url=o.url.startsWith("/api")?config.relative_path+o.url:p+o.url,typeof n=="function"){m(o).then(s=>n(null,s),s=>n(s));return}try{return await m(o)}catch(s){if(s.message==="A valid login session was not found. Please log in and try again."){const{url:r}=await(0,y.fire)("filter:admin.reauth",{url:"login"});return(0,E.confirm)("[[error:api.reauth-required]]",d=>{d&&ajaxify.go(r)})}throw s}}async function m(o){const{url:n}=o;delete o.url,o.data&&!(o.data instanceof FormData)&&(o.data=JSON.stringify(o.data||{}),o.headers["content-type"]="application/json; charset=utf-8"),{options:o}=await(0,y.fire)("filter:api.options",{options:o}),o.data&&(o.body=o.data,delete o.data);const s=await fetch(n,o),{headers:r}=s;if(r.get("x-redirect"))return m({url:r.get("x-redirect"),...o});const d=r.get("content-type"),l=d&&d.startsWith("application/json");let g;if(o.method!=="HEAD"&&(l?g=await s.json():g=await s.text()),!s.ok)throw g?new Error(l?g.status.message:g):new Error(s.statusText);return l&&g&&g.hasOwnProperty("status")&&g.hasOwnProperty("response")?g.response:g}function f(o,n,s){return h({url:o+(n&&Object.keys(n).length?"?"+$.param(n):"")},s)}function u(o,n,s){return h({url:o+(n&&Object.keys(n).length?"?"+$.param(n):""),method:"HEAD"},s)}function t(o,n,s){return h({url:o,method:"POST",data:n,headers:{"x-csrf-token":config.csrf_token}},s)}function e(o,n,s){return h({url:o,method:"PATCH",data:n,headers:{"x-csrf-token":config.csrf_token}},s)}function i(o,n,s){return h({url:o,method:"PUT",data:n,headers:{"x-csrf-token":config.csrf_token}},s)}function a(o,n,s){return h({url:o,method:"DELETE",data:n,headers:{"x-csrf-token":config.csrf_token}},s)}},70012:(S,P,c)=>{var y,k;y=[c(91749),c(29930)],k=function(E,D){let p=[],h=0;function m(t,e){typeof t!="string"&&(t=$(t),t=t.data("type")||t.attr("type")||t.prop("tagName"));const i=u.plugins[t.toLowerCase()];if(i==null)return;const a=i[e];return typeof a=="function"?a:null}const f={deepClone:function(t){return typeof t=="object"?JSON.parse(JSON.stringify(t)):t},createElement:function(t,e,i){const a=document.createElement(t);for(const[o,n]of Object.entries(e))a.setAttribute(o,n);return i&&a.appendChild(document.createTextNode(i)),a},initElement:function(t){const e=m(t,"init");e?.call(u,$(t))},destructElement:function(t){const e=m(t,"destruct");e?.call(u,$(t))},createElementOfType:function(t,e,i){let a;const o=m(t,"create");return o!=null?a=$(o.call(u,t,e,i)):(i==null&&(i={}),t!=null&&(i.type=t),a=$(f.createElement(e||"input",i))),a.data("type",t),f.initElement(a),a},cleanArray:function(t,e,i){const a=[];if(!e&&i)return t;for(let o=0;o<t.length;o+=1){let n=t[o];e&&(n===!!n?n=+n:n&&typeof n.trim=="function"&&(n=n.trim())),(i||n!=null&&n.length)&&a.push(n)}return a},isTrue:function(t){return t==="true"||+t==1},isFalse:function(t){return t==="false"||+t==0},readValue:function(t){let e=!f.isFalse(t.data("empty"));const i=!f.isFalse(t.data("trim")),a=t.data("split"),o=m(t,"get");let n;if(o!=null)return o.call(u,t,i,e);if(a!=null){e=f.isTrue(t.data("empty")),n=t.val();const s=n!=null&&n.split(a||",")||[];return f.cleanArray(s,i,e)}if(n=t.val(),i&&n!=null&&typeof n.trim=="function"&&(n=n.trim()),e||n!==void 0&&(n==null||n.length!==0))return n},fillField:function(t,e){const i=m(t,"set");let a=t.data("trim");if(a=a!=="false"&&+a!=0,i!=null)return i.call(u,t,e,a);e instanceof Array&&(e=e.join(t.data("split")||(a?", ":","))),a&&e&&typeof e.trim=="function"?(e=e.trim(),typeof e.toString=="function"&&(e=e.toString())):e!=null?(typeof e.toString=="function"&&(e=e.toString()),a&&(e=e.trim())):e="",e!==void 0&&t.val(e)},initFields:function(t){$("[data-key]",t).each(function(e,i){i=$(i);const a=m(i,"init"),o=i.data("key").split(".");let n=u.get();a?.call(u,i);for(let s=0;s<o.length;s+=1){const r=o[s];r&&n!=null&&(n=n[r])}f.fillField(i,n)})},registerReadyJobs:function(t){return h+=t,h},beforeReadyJobsDecreased:function(t){if(t==null&&(t=1),h>0&&(h-=t,h<=0)){for(let e=0;e<p.length;e+=1)p[e]();p=[]}},whenReady:function(t){h<=0?t():p.push(t)},serializeForm:function(t){const e=t.serializeObject();return t.find('input[type="checkbox"]').each(function(i,a){a=$(a),a.is(":checked")||(e[a.attr("name")]="off")}),t.find("select[multiple]").each(function(i,a){a=$(a),e[a.attr("name")]=JSON.stringify(a.val())}),e},persistSettings:function(t,e,i,a){e!=null&&e._!=null&&typeof e._!="string"&&(e=f.deepClone(e),e._=JSON.stringify(e._)),socket.emit("admin.settings.set",{hash:t,values:e},function(o){i&&(o?D.alert({title:"[[admin/admin:changes-not-saved]]",type:"danger",message:`[[admin/admin/changes-not-saved-message, ${o.message}]]`,timeout:5e3}):D.alert({title:"[[admin/admin:changes-saved]]",type:"success",message:"[[admin/admin:changes-saved-message]]",timeout:2500})),typeof a=="function"&&a(o)})},use:function(t){try{t._=JSON.parse(t._)}catch(e){console.error(e)}u.cfg=t}},u={helper:f,plugins:{},cfg:{},get:function(){return u.cfg!=null&&u.cfg._!==void 0?u.cfg._:u.cfg},registerPlugin:function(t,e){e==null?e=t.types:t.types=e,typeof t.use=="function"&&t.use.call(u);for(let i=0;i<e.length;i+=1){const a=e[i].toLowerCase();u.plugins[a]==null&&(u.plugins[a]=t)}},set:function(t,e,i,a,o){o==null&&(o=!0),f.whenReady(function(){f.use(e),f.initFields(i||"form"),f.persistSettings(t,e,o,a)})},sync:function(t,e,i){socket.emit("admin.settings.get",{hash:t},function(a,o){a?typeof i=="function"&&i(a):f.whenReady(function(){f.use(o),f.initFields(e||"form"),typeof i=="function"&&i()})})},persist:function(t,e,i,a){const o=[],n=$("[data-key]",e||"form").toArray();a==null&&(a=!0);for(let s=0;s<n.length;s+=1){const r=$(n[s]),d=f.readValue(r);let l=u.get();const g=r.data("key").split("."),R=g[g.length-1];if(g.length>1)for(let O=0;O<g.length-1;O+=1){const A=g[O];A&&l!=null&&(l=l[A])}l!=null?d!=null?l[R]=d:delete l[R]:o.push(r.data("key"))}o.length&&D.alert({title:"Attributes Not Saved",message:"'"+o.join(", ")+"' could not be saved. Please contact the plugin-author!",type:"danger",timeout:5e3}),f.persistSettings(t,u.cfg,a,i)},load:function(t,e,i){i=i||function(){};const a=e.attr("data-socket-get");socket.emit(a||"admin.settings.get",{hash:t},function(o,n){if(o)return i(o);$(e).find("select[multiple]").each(function(r,d){const l=$(d).attr("name");if(l&&n.hasOwnProperty(l))try{n[l]=JSON.parse(n[l])}catch(g){console.error(g)}}),ajaxify.data[a?t:"settings"]=n,f.whenReady(function(){$(e).find("[data-sorted-list]").each(function(r,d){m(d,"get").call(u,$(d),t)})}),$(e).deserialize(n),E.fire("action:admin.settingsLoaded"),$(e).on("change","input, select, textarea",function(){app.flags=app.flags||{},app.flags._unsaved=!0});const s=document.getElementById("save");s&&c.e(6411).then(function(){var r=[c(6411)];(function(d){d.bind("ctrl+s",function(l){s.click(),l.preventDefault()})}).apply(null,r)}).catch(c.oe),i(null,n)})},save:function(t,e,i){e=$(e);const a=e.get(0).elements;if(u.check(a)&&e.length){const n=f.serializeForm(e);f.whenReady(function(){const r=e.find("[data-sorted-list]");r.length&&r.each((d,l)=>{m(l,"set").call(u,$(l),n)})});const s=e.attr("data-socket-set");socket.emit(s||"admin.settings.set",{hash:t,values:n},function(r){if(app.flags._unsaved=!1,ajaxify.data[s?t:"settings"]=n,typeof i=="function")i(r);else if(r)D.alert({title:"[[admin/admin:changes-not-saved]]",message:`[[admin/admin:changes-not-saved-message, ${r.message}]]`,type:"error",timeout:2500});else{const d=document.getElementById("save");d.classList.toggle("saved",!0),setTimeout(()=>{d.classList.toggle("saved",!1)},1500)}})}},check:function(t){const e=i=>{const a=i.target.closest(".form-group");a&&a.classList.add("has-error"),i.target.removeEventListener("invalid",e)};return Array.prototype.map.call(t,i=>{const a=i.closest(".form-group");return a&&a.classList.remove("has-error"),i.addEventListener("invalid",e),i.reportValidity()}).every(Boolean)}};return f.registerReadyJobs(1),Promise.all([c.e(23662),c.e(65285),c.e(19308)]).then(function(){var t=[c(75210),c(474),c(50397),c(71575),c(40054),c(17708),c(46700),c(59175)];(function(){for(let e=0;e<arguments.length;e+=1)u.registerPlugin(arguments[e]);f.beforeReadyJobsDecreased()}).apply(null,t)}).catch(c.oe),u}.apply(P,y),k!==void 0&&(S.exports=k)}}]);
