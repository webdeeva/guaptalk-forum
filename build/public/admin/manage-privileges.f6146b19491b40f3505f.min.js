"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,11295,13417,34271,34405,49047,49897,69185,86198,99127],{2627:(j,k,u)=>{var E;E=function(){const y={};let S;y.toggling=!1,y.init=function(g){S=$(g),S.on("change","input.checkbox-helper",D)},y.updateAll=function(){S.find("input.checkbox-helper").each((g,f)=>{y.updateState($(f))})},y.updateState=function(g){if(y.toggling)return;const f=g.closest("tr").find("input:not([disabled]):visible").toArray(),i=$(f.shift()),p=f.length&&f.every(v=>v.checked);i.prop("checked",p)};function D(g){const f=$(g.target);T(f)}function T(g){y.toggling=!0;const f=g.prop("checked");g.closest("tr").find("input:not(.checkbox-helper):visible").each((i,p)=>{const v=$(p);v.prop("checked")!==f&&v.click()}),y.toggling=!1}return y}.call(k,u,k,j),E!==void 0&&(j.exports=E)},34405:(j,k,u)=>{var E,y;E=[u(49897),u(29930),u(36e3),u(9787),u(35786)],y=function(S,D,{Textcomplete:T},{TextareaEditor:g},{ContenteditableEditor:f}){const i={},p={delay:200,appendTo:null};i.init=d=>{const t={...p,...d},{input:c,onSelect:a}=t;app.loadJQueryUI(function(){c.autocomplete({...t,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(s,o){v(c,a,s,o)}})})},i.user=function(d,t,c){typeof t=="function"&&(c=t,t={}),t=t||{},i.init({input:d,onSelect:c,source:(a,s)=>{t.query=a.term,S.get("/api/users",t,function(o,b){if(o)return D.error(o);if(b&&b.users){const C=b.users.map(function(P){const x=$("<div></div>").html(P.username).text();return P&&{label:x,value:x,user:{uid:P.uid,name:P.username,slug:P.userslug,username:P.username,userslug:P.userslug,displayname:P.displayname,picture:P.picture,banned:P.banned,"icon:text":P["icon:text"],"icon:bgColor":P["icon:bgColor"]}}});s(C)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},i.group=function(d,t){i.init({input:d,onSelect:t,source:(c,a)=>{socket.emit("groups.search",{query:c.term},function(s,o){if(s)return D.error(s);if(o&&o.length){const b=o.map(function(C){return C&&{label:C.name,value:C.name,group:C}});a(b)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},i.tag=function(d,t){i.init({input:d,onSelect:t,delay:100,source:(c,a)=>{socket.emit("topics.autocompleteTags",{query:c.term,cid:ajaxify.data.cid||0},function(s,o){if(s)return D.error(s);o&&a(o),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function v(d,t,c,a){t=t||function(){};const s=jQuery.Event("keypress");s.which=13,s.keyCode=13,setTimeout(function(){d.trigger(s)},100),t(c,a)}return i.setup=function({element:d,strategies:t,options:c}){const a=d.get(0);if(a){var s;if(a.nodeName==="TEXTAREA"||a.nodeName==="INPUT"?s=new g(a):a.nodeName==="DIV"&&a.getAttribute("contenteditable")==="true"&&(s=new f(a)),!s)throw new Error("unknown target element type");a.setAttribute("dir",document.querySelector("html").getAttribute("data-dir"));var o=new T(s,t,{dropdown:c});return o.on("rendered",function(){o.dropdown.items.length&&o.dropdown.items[0].activate()}),o}},i}.apply(k,E),y!==void 0&&(j.exports=y)},49897:(j,k,u)=>{u.r(k),u.d(k,{del:()=>c,get:()=>i,head:()=>p,patch:()=>d,post:()=>v,put:()=>t});var E=u(91749),y=u.n(E),S=u(33530),D=u.n(S);const T=config.relative_path+"/api/v3";async function g(a,s){if(a.url=a.url.startsWith("/api")?config.relative_path+a.url:T+a.url,typeof s=="function"){f(a).then(o=>s(null,o),o=>s(o));return}try{return await f(a)}catch(o){if(o.message==="A valid login session was not found. Please log in and try again."){const{url:b}=await(0,E.fire)("filter:admin.reauth",{url:"login"});return(0,S.confirm)("[[error:api.reauth-required]]",C=>{C&&ajaxify.go(b)})}throw o}}async function f(a){const{url:s}=a;delete a.url,a.data&&!(a.data instanceof FormData)&&(a.data=JSON.stringify(a.data||{}),a.headers["content-type"]="application/json; charset=utf-8"),{options:a}=await(0,E.fire)("filter:api.options",{options:a}),a.data&&(a.body=a.data,delete a.data);const o=await fetch(s,a),{headers:b}=o;if(b.get("x-redirect"))return f({url:b.get("x-redirect"),...a});const C=b.get("content-type"),P=C&&C.startsWith("application/json");let x;if(a.method!=="HEAD"&&(P?x=await o.json():x=await o.text()),!o.ok)throw x?new Error(P?x.status.message:x):new Error(o.statusText);return P&&x&&x.hasOwnProperty("status")&&x.hasOwnProperty("response")?x.response:x}function i(a,s,o){return g({url:a+(s&&Object.keys(s).length?"?"+$.param(s):"")},o)}function p(a,s,o){return g({url:a+(s&&Object.keys(s).length?"?"+$.param(s):""),method:"HEAD"},o)}function v(a,s,o){return g({url:a,method:"POST",data:s,headers:{"x-csrf-token":config.csrf_token}},o)}function d(a,s,o){return g({url:a,method:"PATCH",data:s,headers:{"x-csrf-token":config.csrf_token}},o)}function t(a,s,o){return g({url:a,method:"PUT",data:s,headers:{"x-csrf-token":config.csrf_token}},o)}function c(a,s,o){return g({url:a,method:"DELETE",data:s,headers:{"x-csrf-token":config.csrf_token}},o)}},63431:(j,k,u)=>{var E,y;E=[u(49897),u(34405),u(33530),u(29930),u(17459),u(65348),u(6411),u(2627),u(54222)],y=function(S,D,T,g,f,i,p,v,d){const t={};let c;t.init=function(){c=isNaN(parseInt(ajaxify.data.selectedCategory.cid,10))?"admin":ajaxify.data.selectedCategory.cid,v.init(".privilege-table-container"),i.init($('[component="category-selector"]'),{onSelect:function(n){c=parseInt(n.cid,10),c=isNaN(c)?"admin":c,t.refreshPrivilegeTable(),ajaxify.updateHistory("admin/manage/privileges/"+(c||""))},localCategories:ajaxify.data.categories,privilege:"find",showLinks:!0}),t.setupPrivilegeTable(),P(),$(".privilege-filters button:first-child").click()},t.setupPrivilegeTable=function(){$(".privilege-table-container").on("change",'input[type="checkbox"]:not(.checkbox-helper)',function(){const n=this,e=$(this),r=e.parents("[data-privilege]"),l=r.index()+1,m=r.attr("data-privilege"),h=e.prop("checked"),A=e.parents("tr"),w=A.attr("data-group-name")||A.attr("data-uid"),I=parseInt(A.attr("data-private")||0,10),N=A.attr("data-group-name")!==void 0,R=N&&A.attr("data-group-name")==="banned-users"||A.attr("data-banned")!==void 0?"banned-users":"registered-users",L=e.prop("checked")===(r.attr("data-value")==="true")?null:h;w?(N&&m==="groups:moderate"&&!I&&h?T.confirm("[[admin/manage/privileges:alert.confirm-moderate]]",function(U){U?(r.attr("data-delta",L),t.applyDeltaState(n,L),t.exposeSingleAssumedPriv(l,R)):e.prop("checked",!e.prop("checked"))}):m.endsWith("admin:admins-mods")&&h?T.confirm("[[admin/manage/privileges:alert.confirm-admins-mods]]",function(U){U?(r.attr("data-delta",L),t.applyDeltaState(n,L),t.exposeSingleAssumedPriv(l,R)):e.prop("checked",!e.prop("checked"))}):(r.attr("data-delta",L),t.applyDeltaState(n,L),t.exposeSingleAssumedPriv(l,R)),v.updateState(e)):g.error("[[error:invalid-data]]")}),t.exposeAssumedPrivileges(),v.updateAll(),t.addEvents()},t.applyDeltaState=(n,e)=>{["bg-success","bg-opacity-75","border-success"].forEach(r=>{n.classList.toggle(r,e===!0)}),["bg-danger","bg-opacity-50","border-danger"].forEach(r=>{n.classList.toggle(r,e===!1)})},t.addEvents=function(){document.getElementById("save").addEventListener("click",function(){r("save",t.commit)}),document.getElementById("discard").addEventListener("click",function(){r("discard",t.discard)});const n=document.querySelector(".privilege-table-container");n.addEventListener("change",l=>{l.target.closest("td[data-privilege] input")&&(document.getElementById("discard").style.display=n.querySelectorAll("td[data-delta]").length?"unset":"none")});const e=$(".privilege-table-container");e.on("click",'[data-action="search.user"]',t.addUserToPrivilegeTable),e.on("click",'[data-action="search.group"]',t.addGroupToPrivilegeTable),e.on("click",'[data-action="copyToChildren"]',function(){r("copyToChildren",t.copyPrivilegesToChildren.bind(null,c,""))}),e.on("click",'[data-action="copyToChildrenGroup"]',function(){const l=$(this).parents("[data-group-name]").attr("data-group-name");r("copyToChildrenGroup",t.copyPrivilegesToChildren.bind(null,c,l))}),e.on("click",'[data-action="copyPrivilegesFrom"]',function(){t.copyPrivilegesFromCategory(c,"")}),e.on("click",'[data-action="copyPrivilegesFromGroup"]',function(){const l=$(this).parents("[data-group-name]").attr("data-group-name");t.copyPrivilegesFromCategory(c,l)}),e.on("click",'[data-action="copyToAll"]',function(){r("copyToAll",t.copyPrivilegesToAllCategories.bind(null,c,""))}),e.on("click",'[data-action="copyToAllGroup"]',function(){const l=$(this).parents("[data-group-name]").attr("data-group-name");r("copyToAllGroup",t.copyPrivilegesToAllCategories.bind(null,c,l))}),e.on("click",".privilege-filters button",W),p.bind("ctrl+s",function(l){r("save",t.commit),l.preventDefault()});function r(l,m){const h=B();T.confirm(`[[admin/manage/privileges:alert.confirm-${l}, ${h}]]<br /><br />[[admin/manage/privileges:alert.no-undo]]`,function(A){A&&m.call()})}},t.commit=function(){const n=document.querySelector(".privilege-table-container"),e=$.map(n.querySelectorAll("td[data-delta]"),function(r){const l=r.getAttribute("data-privilege"),m=r.parentNode,h=m.getAttribute("data-group-name")||m.getAttribute("data-uid"),A=r.getAttribute("data-delta")==="true"?1:0;return t.setPrivilege(h,l,A)});Promise.allSettled(e).then(r=>{t.refreshPrivilegeTable();const l=r.filter(m=>m.status==="rejected");l.length?l.forEach(m=>{g.error(m.reason)}):d.toggleSaveSuccess($("#save"))})},t.discard=function(){t.refreshPrivilegeTable(),g.success("[[admin/manage/privileges:alert.discarded]]")},t.refreshPrivilegeTable=function(n){S.get(`/categories/${c}/privileges`,{}).then(e=>{ajaxify.data.privileges={...ajaxify.data.privileges,...e};const r=parseInt(c,10)?"admin/partials/privileges/category":"admin/partials/privileges/global",l=ajaxify.currentPage.endsWith("admin/manage/privileges/admin");app.parseAndTranslate(r,{cid:c,privileges:e,isAdminPriv:l}).then(m=>{const h=$(".privilege-filters button.btn-warning").map((A,w)=>$(w).index()).get();$(".privilege-table-container").html(m),t.exposeAssumedPrivileges(),document.querySelectorAll(".privilege-filters").forEach((A,w)=>{const I=h[w]===void 0?0:h[w];A.querySelectorAll("button")[I].click()}),C("data-group-name",n)})}).catch(alert.error)},t.exposeAssumedPrivileges=function(){const n=(m,h)=>`.privilege-table tr[data-banned] td[data-privilege="${m[h]}"] input`,e=a("banned-users");o(e,n);const r=(m,h)=>`.privilege-table tr[data-group-name]:not([data-group-name="registered-users"],[data-group-name="banned-users"],[data-group-name="guests"],[data-group-name="spiders"],[data-group-name="fediverse"]) td[data-privilege="${m[h]}"] input, .privilege-table tr[data-uid]:not([data-banned]) td[data-privilege="${m[h]}"] input`,l=a("registered-users");o(l,r)},t.exposeSingleAssumedPriv=function(n,e){let r;switch(e){case"banned-users":r=()=>`.privilege-table tr[data-banned] td[data-privilege]:nth-child(${n}) input`;break;default:r=()=>`.privilege-table tr[data-group-name]:not([data-group-name="registered-users"],[data-group-name="banned-users"],[data-group-name="guests"],[data-group-name="spiders"],[data-group-name="fediverse"]) td[data-privilege]:nth-child(${n}) input, .privilege-table tr[data-uid]:not([data-banned]) td[data-privilege]:nth-child(${n}) input`}const l=s(e,n);b(r,l)},t.setPrivilege=(n,e,r)=>S[r?"put":"del"](`/categories/${isNaN(c)?0:c}/privileges/${encodeURIComponent(e)}`,{member:n}),t.addUserToPrivilegeTable=function(){const n=T.dialog({title:"[[admin/manage/categories:alert.find-user]]",message:'<input class="form-control input-lg" placeholder="[[admin/manage/categories:alert.user-search]]" />',show:!0});n.on("shown.bs.modal",function(){const e=n.find("input");e.focus(),D.user(e,function(r,l){O(l.item.user,function(){n.modal("hide")})})})},t.addGroupToPrivilegeTable=function(){const n=T.dialog({title:"[[admin/manage/categories:alert.find-group]]",message:'<input class="form-control input-lg" placeholder="[[admin/manage/categories:alert.group-search]]" />',show:!0});n.on("shown.bs.modal",function(){const e=n.find("input");e.focus(),D.group(e,function(r,l){if(l.item.group.name==="administrators")return g.alert({type:"warning",message:"[[admin/manage/privileges:alert.admin-warning]]"});x(l.item.group.name,function(){n.modal("hide")})})})},t.copyPrivilegesToChildren=function(n,e){const r=F();socket.emit("admin.categories.copyPrivilegesToChildren",{cid:n,group:e,filter:r},function(l){if(l)return g.error(l.message);g.success("[[admin/manage/categories:privileges.copy-success]]")})},t.copyPrivilegesFromCategory=function(n,e){const r=B(),l="<br>"+(e?`[[admin/manage/privileges:alert.copyPrivilegesFromGroup-warning, ${r}]]`:`[[admin/manage/privileges:alert.copyPrivilegesFrom-warning, ${r}]]`)+"<br><br>[[admin/manage/privileges:alert.no-undo]]";i.modal({title:"[[admin/manage/privileges:alert.copyPrivilegesFrom-title]]",message:l,localCategories:[],showLinks:!0,onSubmit:function(m){socket.emit("admin.categories.copyPrivilegesFrom",{toCid:n,filter:F(),fromCid:m.cid,group:e},function(h){if(h)return g.error(h);ajaxify.refresh()})}})},t.copyPrivilegesToAllCategories=function(n,e){const r=F();socket.emit("admin.categories.copyPrivilegesToAllCategories",{cid:n,group:e,filter:r},function(l){if(l)return g.error(l);g.success("[[admin/manage/categories:privileges.copy-success]]")})};function a(n){const e=[];return $(`.privilege-table tr[data-group-name="${n}"] td input[type="checkbox"]:not(.checkbox-helper)`).parents("[data-privilege]").each(function(r,l){$(l).find("input").prop("checked")&&e.push(l.getAttribute("data-privilege"))}),e.concat(e.map(function(r){return r.startsWith("groups:")?r.slice(7):!1})).filter(Boolean)}function s(n,e){return $(`.privilege-table tr[data-group-name="${n}"] td:nth-child(${e}) input[type="checkbox"]`)[0].checked}function o(n,e){for(let r=0,l=n.length;r<l;r+=1)$(e(n,r)).each(function(h,A){A.checked||(A.indeterminate=!0)})}function b(n,e){$(n()).each((l,m)=>{m.indeterminate=m.checked?!1:e})}function C(n,e){if(e){const r=$("["+n+"]").filter(function(){return $(this).attr(n)===String(e)});if(r.length)return r.addClass("selected"),!0}return!1}function P(){if(ajaxify.data.group){if(C("data-group-name",ajaxify.data.group))return;x(ajaxify.data.group)}}function x(n,e){if(e=e||function(){},document.querySelector('.privilege-table [data-group-name="'+n+'"]'))return C("data-group-name",n),e();const l={},m=ajaxify.data.privileges.keys.groups.reduce(function(h,A,w){return h[A]=!1,l[A]=ajaxify.data.privileges.labelData[w].type,h},{});app.parseAndTranslate("admin/partials/privileges/"+(isNaN(c)||c===0?"global":"category"),"privileges.groups",{privileges:{groups:[{name:n,nameEscaped:f.escape(n),privileges:m,types:l}]}},function(h){const A=document.querySelector(".privilege-table tbody"),w=$(".privilege-filters").first().find("button.btn-warning").index();A.append(h.get(0)),t.exposeAssumedPrivileges(),C("data-group-name",n),w>=0&&document.querySelector(".privilege-filters").querySelectorAll("button")[w].click(),e()})}async function O(n,e){if(e=e||function(){},document.querySelector('.privilege-table [data-uid="'+n.uid+'"]'))return C("data-uid",n.uid),e();const l={},m=ajaxify.data.privileges.keys.users.reduce(function(I,N,M){return I[N]=!1,l[N]=ajaxify.data.privileges.labelData[M].type,I},{}),h=await app.parseAndTranslate("admin/partials/privileges/"+(isNaN(c)?"global":"category"),"privileges.users",{privileges:{users:[{picture:n.picture,username:n.username,banned:n.banned,uid:n.uid,"icon:text":n["icon:text"],"icon:bgColor":n["icon:bgColor"],privileges:m,types:l}]}}),A=document.querySelectorAll(".privilege-table tbody"),w=$(".privilege-filters").last().find("button.btn-warning").index();A[1].append(h.get(0)),t.exposeAssumedPrivileges(),C("data-uid",n.uid),w>=0&&document.querySelectorAll(".privilege-filters")[1].querySelectorAll("button")[w].click(),e()}function W(n){const e=$(n.target),r=e.attr("data-filter");e.closest("table").find("thead tr:last-child, tbody tr").each((m,h)=>{$(h).find("[data-type]").addClass("hidden"),$(h).find(`[data-type="${r}"]`).removeClass("hidden")}),v.updateAll(),e.siblings("button").removeClass("btn-warning"),e.addClass("btn-warning")}function F(){return $('[component="privileges/groups/filters"] .btn-warning').attr("data-filter")}function B(){const n=document.querySelector(".privilege-filters .btn-warning"),e=n?n.textContent.toLocaleLowerCase():"";return e.indexOf("privileges")>-1?e:`${e} privileges`.trim()}return t}.apply(k,E),y!==void 0&&(j.exports=y)},65348:(j,k,u)=>{var E,y;E=[u(96349),u(33530),u(91749),u(17459)],y=function(S,D,T,g){const f={};return f.init=function(i,p){if(!i||!i.length)return;p=p||{};const v=p.onSelect||function(){};p.states=p.states||["watching","tracking","notwatching","ignoring"],p.template=p.template||"partials/category/selector-dropdown-left",T.fire("action:category.selector.options",{el:i,options:p}),S.init(i,p);const d={el:i,selectedCategory:null};i.on("click","[data-cid]",function(){const c=$(this);return c.hasClass("disabled")?!1:(d.selectCategory(c.attr("data-cid")),v(d.selectedCategory))});let t=d.el.find('[component="category-selector-selected"]').html();return g.translate(t,c=>{t=c}),d.selectCategory=function(c){const a=d.el.find('[data-cid="'+c+'"]');d.selectedCategory={cid:c,name:a.attr("data-name")},a.length?d.el.find('[component="category-selector-selected"]').html(a.find('[component="category-markup"]').html()):d.el.find('[component="category-selector-selected"]').html(t)},d.getSelectedCategory=function(){return d.selectedCategory},d.getSelectedCid=function(){return d.selectedCategory?d.selectedCategory.cid:0},p.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(p.template,{selectedCategory:p.selectedCategory},function(c){d.el.find('[component="category-selector-selected"]').html(c.find('[component="category-selector-selected"]').html())}),d},f.modal=function(i){i=i||{},i.onSelect=i.onSelect||function(){},i.onSubmit=i.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:i.message},function(p){const v=D.dialog({title:i.title||"[[modules:composer.select-category]]",message:p,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:t}}}),d=f.init(v.find('[component="category-selector"]'),i);function t(c){return c.preventDefault(),d.selectedCategory&&(i.onSubmit(d.selectedCategory),v.modal("hide")),!1}i.openOnLoad&&v.on("shown.bs.modal",function(){v.find(".dropdown-toggle").dropdown("toggle")}),v.find("form").on("submit",t)})},f}.apply(k,E),y!==void 0&&(j.exports=y)},96349:(j,k,u)=>{var E,y;E=[u(29930),u(89336),u(49897)],y=function(S,D,T){const g={};return g.init=function(f,i){let p=i.defaultCategories||null;i=i||{},i.privilege=i.privilege||"topics:read",i.states=i.states||["watching","tracking","notwatching","ignoring"],i.cacheList=i.hasOwnProperty("cacheList")?i.cacheList:!0;let v=[];Array.isArray(i.localCategories)&&(v=i.localCategories.map(s=>({...s})),p&&(p=[...v,...p])),i.selectedCids=i.selectedCids||ajaxify.data.selectedCids||[];const d=f.find('[component="category-selector-search"]');if(!d.length)return;const t=d.parents('[component="category/dropdown"]').length>0||d.parents('[component="category-selector"]').length>0;f.on("show.bs.dropdown",function(){t&&d.removeClass("hidden");function s(){const o=d.find("input").val();o.length>1||!o&&!p?c(o,function(b){p=i.cacheList&&(p||b),a(b)}):!o&&p&&a(p)}d.on("click",function(o){o.preventDefault(),o.stopPropagation()}),d.find("input").val("").on("keyup",utils.debounce(s,300)),s()}),f.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||d.find("input").focus()}),f.on("hide.bs.dropdown",function(){t&&d.addClass("hidden"),d.off("click"),d.find("input").off("keyup")});function c(s,o){T.get("/search/categories",{search:s,query:utils.params(),parentCid:i.parentCid||0,selectedCids:i.selectedCids,privilege:i.privilege,states:i.states,showLinks:i.showLinks},function(b,{categories:C}){if(b)return S.error(b);o(v.concat(C))})}function a(s){const o=i.selectedCids.map(String);s.forEach(function(b){b.selected=o.includes(String(b.cid))}),app.parseAndTranslate(i.template,{categoryItems:s.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(b){f.find('[component="category/list"]').html(b.find('[component="category/list"]').html()),f.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!s.length);const C=D.Dropdown.getInstance(f.find(".dropdown-toggle").get(0));C&&C.update()})}},g}.apply(k,E),y!==void 0&&(j.exports=y)}}]);
