"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[94368],{53360:(E,x,s)=>{var h,p;h=[s(17459),s(81335),s(33530),s(29930),s(65285)],p=function(f,R,g,r){const u={};u.init=function(){const o=$(".plugins");let n;window.location.hash&&$(`.nav-pills button[data-bs-target="${window.location.hash}"]`).trigger("click");const d=$("#plugin-search");o.on("click",'button[data-action="toggleActive"]',function(){const e=$(this).parents("li");n=e.attr("data-plugin-id");const l=$(this),i=ajaxify.data.installed.find(a=>a.id===n);if(!i)return;function t(){socket.emit("admin.plugins.toggleActive",n,function(a,c){if(a)return r.error(a);l.siblings('[data-action="toggleActive"]').removeClass("hidden"),l.addClass("hidden"),c.active&&!$('#active [id="'+n+'"]').length&&$("#active ul").prepend(e.clone(!0)),i.active=!i.active,r.alert({alert_id:"plugin_toggled",title:"[[admin/extend/plugins:alert."+(c.active?"enabled":"disabled")+"]]",message:"[[admin/extend/plugins:alert."+(c.active?"activate-success":"deactivate-success")+"]]",type:c.active?"warning":"success",timeout:5e3,clickfn:function(){s.e(32050).then(function(){var m=[s(27270)];(function(v){v.rebuildAndRestart()}).apply(null,m)}).catch(s.oe)}})})}i.license&&i.active!==!0?R.render("admin/partials/plugins/license",i).then(function(a){g.dialog({title:"[[admin/extend/plugins:license.title]]",message:a,size:"large",buttons:{cancel:{label:"[[modules:bootbox.cancel]]",className:"btn-link"},save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:t}},onShown:function(){const c=this.querySelector("button.btn-primary");c&&c.focus()}})}):t(n)}),o.on("click",'button[data-action="toggleInstall"]',function(){const e=$(this);if(e.attr("disabled",!0),n=$(this).parents("li").attr("data-plugin-id"),$(this).attr("data-installed")==="1")return u.toggleInstall(n,$(this).parents("li").attr("data-version"));u.suggest(n,function(l,i){if(l){g.confirm(f.compile("admin/extend/plugins:alert.suggest-error",l.status,l.responseText),function(t){t?u.toggleInstall(n,"latest"):e.removeAttr("disabled")});return}i.version!=="latest"?u.toggleInstall(n,i.version):i.version==="latest"?b(n,function(t){t?u.toggleInstall(n,"latest"):e.removeAttr("disabled")}):e.removeAttr("disabled")})}),o.on("click",'button[data-action="upgrade"]',function(){const e=$(this),l=e.parents("li");n=l.attr("data-plugin-id"),u.suggest(n,function(i,t){if(i)return g.alert("[[admin/extend/plugins:alert.package-manager-unreachable]]");s.e(38385).then(function(){var a=[s(38385)];(function(c){const m=l.find(".currentVersion").text();t.version&&t.version!=="latest"&&c.compare(t.version,m,">")?A(n,e,t.version):t.version==="latest"||t.version===null?b(n,function(v){v&&A(n,e,t.version)}):g.alert(f.compile("admin/extend/plugins:alert.incompatible",app.config.version,t.version))}).apply(null,a)}).catch(s.oe)})}),$(d).on("input propertychange",utils.debounce(function(){const e=$(this).val();$(".plugins li").each(function(){const t=$(this).attr("data-plugin-id");$(this).toggleClass("hide",t&&!t.includes(e))}),$("#plugin-tabs [data-bs-target].active").attr("data-bs-target")==="#download"&&y(e),document.querySelectorAll(".plugins .tab-pane").forEach(t=>{const a=t.querySelectorAll("li:not(.hide)").length,c=t.querySelector(".no-plugins");c&&c.classList.toggle("hide",a!==0)})},250)),$("#plugin-submit-usage").on("click",function(){socket.emit("admin.config.setMultiple",{submitPluginUsage:$(this).prop("checked")?"1":"0"},function(e){if(e)return r.error(e)})}),$("#plugin-order").on("click",function(){$("#order-active-plugins-modal").modal("show"),socket.emit("admin.plugins.getActive",function(e,l){if(e)return r.error(e);let i="";if(l.forEach(function(a){i+=`
						<li class="d-flex justify-content-between gap-1 pointer border-bottom pb-2" data-plugin="${a}">
							${a}
							<div class="d-flex gap-1">
								<div class="btn btn-ghost btn-sm move-up">
									<i class="fa fa-chevron-up"></i>
								</div>
								<div class="btn btn-ghost btn-sm move-down">
									<i class="fa fa-chevron-down"></i>
								</div>
							</div>
						</li>
					`}),!l.length){f.translate("[[admin/extend/plugins:none-active]]",function(a){$("#order-active-plugins-modal .plugin-list").html(a).sortable()});return}const t=$("#order-active-plugins-modal .plugin-list");t.html(i).sortable(),t.find(".move-up").on("click",function(){const a=$(this).parents("li");a.prev().before(a)}),t.find(".move-down").on("click",function(){const a=$(this).parents("li");a.next().after(a)})})}),$("#save-plugin-order").on("click",function(){const e=$("#order-active-plugins-modal .plugin-list").children(),l=[];e.each(function(i,t){l.push({name:$(t).attr("data-plugin"),order:i})}),socket.emit("admin.plugins.orderActivePlugins",l,function(i){if(i)return r.error(i);$("#order-active-plugins-modal").modal("hide"),r.alert({alert_id:"plugin_reordered",title:"[[admin/extend/plugins:alert.reorder]]",message:"[[admin/extend/plugins:alert.reorder-success]]",type:"success",timeout:5e3,clickfn:function(){s.e(32050).then(function(){var t=[s(27270)];(function(a){a.rebuildAndRestart()}).apply(null,t)}).catch(s.oe)}})})})};async function y(o){const{download:n,incompatible:d}=ajaxify.data,l=(o?n.concat(d):n).filter(t=>t&&t.name.includes(o)).slice(0,100),i=await app.parseAndTranslate("admin/extend/plugins","download",{download:l});$("#download ul").html(i)}function b(o,n){g.confirm(f.compile("admin/extend/plugins:alert.possibly-incompatible",o),function(d){n(d)})}function A(o,n,d){n.attr("disabled",!0).find("i").attr("class","fa fa-refresh fa-spin"),socket.emit("admin.plugins.upgrade",{id:o,version:d},function(e,l){if(e)return r.error(e);const i=n.parents("li");i.find(".fa-exclamation-triangle").remove(),i.find(".currentVersion").text(d),n.remove(),l&&r.alert({alert_id:"plugin_upgraded",title:"[[admin/extend/plugins:alert.upgraded]]",message:"[[admin/extend/plugins:alert.upgrade-success]]",type:"warning",timeout:5e3,clickfn:function(){s.e(32050).then(function(){var t=[s(27270)];(function(a){a.rebuildAndRestart()}).apply(null,t)}).catch(s.oe)}})})}return u.toggleInstall=function(o,n,d){const e=$('li[data-plugin-id="'+o+'"] button[data-action="toggleInstall"]');e.find("i").attr("class","fa fa-refresh fa-spin"),socket.emit("admin.plugins.toggleInstall",{id:o,version:n},function(l,i){if(l)return e.removeAttr("disabled"),r.error(l);function t(a){$(`${a} [data-plugin-id="${o}"]`).remove();const c=$(`${a} [data-plugin-id]`).length;$(`[data-bs-target="${a}"] .badge`).text(c)}i.installed?ajaxify.refresh():["#installed","#active","#deactive","#upgrade"].forEach(t),r.alert({alert_id:"plugin_toggled",title:"[[admin/extend/plugins:alert."+(i.installed?"installed":"uninstalled")+"]]",message:"[[admin/extend/plugins:alert."+(i.installed?"install-success":"uninstall-success")+"]]",type:"info",timeout:5e3}),typeof d=="function"&&d.apply(this,arguments)})},u.suggest=function(o,n){const d=app.config.version.match(/^\d+\.\d+\.\d+/);$.ajax((app.config.registry||"https://packages.nodebb.org")+"/api/v1/suggest",{type:"GET",data:{package:o,version:d[0]},dataType:"json"}).done(function(e){n(void 0,e)}).fail(n)},u}.apply(x,h),p!==void 0&&(E.exports=p)}}]);
