"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,13417,15794,25432,26174,34271,34405,49897,53020,78289,95737,99127],{13230:(M,A,u)=>{var h,v,E;(function(x){v=[u(53050)],h=x,E=typeof h=="function"?h.apply(A,v):h,E!==void 0&&(M.exports=E)})(function(x){const T=x("[^\\p{L}\\s\\d\\-_@.]","g"),b=/[^\w\s\d\-_@.]/g,C=/^\s+|\s+$/g,f=/\s+/g,i=/-+/g,L=/-$/g,y=/^-/g,p=/^[\w\d\s.,\-@]+$/;return function(t,o){return t?(t=String(t).replace(C,""),p.test(t)?t=t.replace(b,"-"):t=x.replace(t,T,"-"),t=o?t:t.toLocaleLowerCase(),t=t.replace(f,"-"),t=t.replace(i,"-"),t=t.replace(L,""),t=t.replace(y,""),t):""}})},29869:M=>{M.exports=function(A,u,h){u.setGlobal("true",!0),u.setGlobal("false",!1);const v=24*60*60*1e3,E={displayMenuItem:T,buildMetaTag:b,buildLinkTag:C,stringify:f,escape:i,stripTags:L,buildCategoryIcon:y,buildCategoryLabel:p,generateCategoryBackground:w,generateChildrenCategories:t,generateTopicClass:o,membershipBtn:l,spawnPrivilegeStates:D,localeToHTML:N,renderTopicImage:k,renderDigestAvatar:I,userAgentIcons:c,buildAvatar:d,increment:S,generateWroteReplied:R,generateRepliedTo:U,generateWrote:_,encodeURIComponent:Y,isoTimeToLocaleString:J,shouldHideReplyContainer:z,humanReadableNumber:G,formattedNumber:V,txEscape:a,generatePlaceholderWave:r,register:m,__escape:x};function x(e){return e}function T(e,n){const s=e.navigation[n];return!(!s||s.route.match("/users")&&e.user&&!e.user.privileges["view:users"]||s.route.match("/tags")&&e.user&&!e.user.privileges["view:tags"]||s.route.match("/groups")&&e.user&&!e.user.privileges["view:groups"])}function b(e){const n=e.name?'name="'+e.name+'" ':"",s=e.property?'property="'+e.property+'" ':"",g=e.content?'content="'+e.content.replace(/\n/g," ")+'" ':"";return"<meta "+n+s+g+`/>
	`}function C(e){const n=["link","rel","as","type","href","sizes","title","crossorigin"],[s,g,B,P,F,H,j,K]=n.map(W=>e[W]?`${W}="${e[W]}" `:"");return"<link "+s+g+B+P+H+j+F+K+`/>
	`}function f(e){return JSON.stringify(e).replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/g,"&quot;")}function i(e){return A.escapeHTML(e)}function L(e){return A.stripHTMLTags(e)}function y(e,n,s){return e?`<span class="icon d-inline-flex justify-content-center align-items-center align-middle ${s}" style="${w(e)} width:${n}; height: ${n}; font-size: ${parseInt(n,10)/2}px;">${e.icon?`<i class="fa fa-fw ${e.icon}"></i>`:""}</span>`:""}function p(e,n="a",s=""){if(!e)return"";const g=n==="a"?`href="${h}/category/${e.slug}"`:"";return`<${n} ${g} class="badge px-1 text-truncate text-decoration-none ${s}" style="color: ${e.color};background-color: ${e.bgColor};border-color: ${e.bgColor}!important; max-width: 70vw;">
			${e.icon&&e.icon!=="fa-nbb-none"?`<i class="fa fa-fw ${e.icon}"></i>`:""}
			${e.name}
		</${n}>`}function w(e){if(!e)return"";const n=[];return e.bgColor&&(n.push("background-color: "+e.bgColor),n.push(`border-color: ${e.bgColor}!important`)),e.color&&n.push("color: "+e.color),e.backgroundImage&&(n.push("background-image: url("+e.backgroundImage+")"),e.imageClass&&n.push("background-size: "+e.imageClass)),n.join("; ")+";"}function t(e){let n="";return!e||!e.children||!e.children.length||(e.children.forEach(function(s){if(s&&!s.isSection){const g=s.link?s.link:h+"/category/"+s.slug;n+='<span class="category-children-item float-start"><div role="presentation" class="icon float-start" style="'+w(s)+'"><i class="fa fa-fw '+s.icon+'"></i></div><a href="'+g+'"><small>'+s.name+"</small></a></span>"}}),n=n&&'<span class="category-children">'+n+"</span>"),n}function o(e){return["locked","pinned","deleted","unread","scheduled"].filter(s=>!!e[s]).join(" ")}function l(e,n=""){return e.isMember&&e.name!=="administrators"?`<button class="btn btn-danger ${n}" data-action="leave" data-group="${e.displayName}" ${e.disableLeave?" disabled":""}><i class="fa fa-times"></i> [[groups:membership.leave-group]]</button>`:e.isPending&&e.name!=="administrators"?`<button class="btn btn-warning disabled ${n}"><i class="fa fa-clock-o"></i> [[groups:membership.invitation-pending]]</button>`:e.isInvited?`<button class="btn btn-warning" data-action="rejectInvite" data-group="${e.displayName}">[[groups:membership.reject]]</button><button class="btn btn-success" data-action="acceptInvite" data-group="${e.name}"><i class="fa fa-plus"></i> [[groups:membership.accept-invitation]]</button>`:!e.disableJoinRequests&&e.name!=="administrators"?`<button class="btn btn-success ${n}" data-action="join" data-group="${e.displayName}"><i class="fa fa-plus"></i> [[groups:membership.join-group]]</button>`:""}function D(e,n,s,g){const B=[];for(const[P,F]of Object.entries(s))B.push({name:P,state:F,type:g[P]});return B.map(function(P){const F=["groups:moderate","groups:posts:upvote","groups:posts:downvote","groups:local:login","groups:group:create"],H=["groups:find","groups:read","groups:topics:read","groups:view:users","groups:view:tags","groups:view:groups"],j=["groups:moderate"];let K=["groups:view:users","groups:find","groups:read","groups:topics:read","groups:topics:create","groups:topics:reply","groups:topics:tag","groups:posts:edit","groups:posts:history","groups:posts:delete","groups:posts:upvote","groups:posts:downvote","groups:topics:delete"];e===-1&&(K=K.slice(3));const W=n==="guests"&&(F.includes(P.name)||P.name.startsWith("groups:admin:"))||n==="spiders"&&!H.includes(P.name)||n==="fediverse"&&!K.includes(P.name)||n==="Global Moderators"&&j.includes(P.name);return`
				<td data-privilege="${P.name}" data-value="${P.state}" data-type="${P.type}">
					<div class="form-check text-center">
						<input class="form-check-input float-none${W?' d-none"':""}" autocomplete="off" type="checkbox"${P.state?" checked":""}${W?' disabled="disabled" aria-diabled="true"':""} />
					</div>
				</td>
			`}).join("")}function N(e,n){return e=e||n||"en-GB",e.replace("_","-")}function k(e){return e.thumb?'<img src="'+e.thumb+'" class="img-circle user-img" title="'+e.user.displayname+'" />':'<img component="user/picture" data-uid="'+e.user.uid+'" src="'+e.user.picture+'" class="user-img" title="'+e.user.displayname+'" />'}function I(e){return e.teaser?e.teaser.user.picture?'<img style="vertical-align: middle; width: 32px; height: 32px; border-radius: 50%;" src="'+e.teaser.user.picture+'" title="'+e.teaser.user.username+'" />':'<div style="vertical-align: middle; width: 32px; height: 32px; line-height: 32px; font-size: 16px; background-color: '+e.teaser.user["icon:bgColor"]+'; color: white; text-align: center; display: inline-block; border-radius: 50%;">'+e.teaser.user["icon:text"]+"</div>":e.user.picture?'<img style="vertical-align: middle; width: 32px; height: 32px; border-radius: 50%;" src="'+e.user.picture+'" title="'+e.user.username+'" />':'<div style="vertical-align: middle; width: 32px; height: 32px; line-height: 32px; font-size: 16px; background-color: '+e.user["icon:bgColor"]+'; color: white; text-align: center; display: inline-block; border-radius: 50%;">'+e.user["icon:text"]+"</div>"}function c(e){let n="";switch(e.platform){case"Linux":n+='<i class="fa fa-fw fa-linux"></i>';break;case"Microsoft Windows":n+='<i class="fa fa-fw fa-windows"></i>';break;case"Apple Mac":n+='<i class="fa fa-fw fa-apple"></i>';break;case"Android":n+='<i class="fa fa-fw fa-android"></i>';break;case"iPad":n+='<i class="fa fa-fw fa-tablet"></i>';break;case"iPod":case"iPhone":n+='<i class="fa fa-fw fa-mobile"></i>';break;default:n+='<i class="fa fa-fw fa-question-circle"></i>';break}switch(e.browser){case"Chrome":n+='<i class="fa fa-fw fa-chrome"></i>';break;case"Firefox":n+='<i class="fa fa-fw fa-firefox"></i>';break;case"Safari":n+='<i class="fa fa-fw fa-safari"></i>';break;case"IE":n+='<i class="fa fa-fw fa-internet-explorer"></i>';break;case"Edge":n+='<i class="fa fa-fw fa-edge"></i>';break;default:n+='<i class="fa fa-fw fa-question-circle"></i>';break}return n}function d(e,n,s,g,B){e||(e=this),g=g||"";const P=new Map([["title",e.displayname],["data-uid",e.uid],["class",`avatar ${g}${s?" avatar-rounded":""}`]]),F=[`--avatar-size: ${n};`],H=K=>Array.from(K).reduce((W,[Q,O])=>(W+=` ${Q}="${O}"`,W),"");let j="";return e.picture&&(j+=`<img${H(P)} alt="${e.displayname}" loading="lazy" component="${B||"avatar/picture"}" src="${e.picture}" style="${F.join(" ")}" onError="this.remove()" itemprop="image" />`),j+=`<span${H(P)} component="${B||"avatar/icon"}" style="${F.join(" ")} background-color: ${e["icon:bgColor"]}">${e["icon:text"]}</span>`,j}function S(e,n){return String(e+parseInt(n,10))}function R(e,n){return e.toPid?U(e,n):_(e,n)}function U(e,n){const s=e.parent&&e.parent.displayname?e.parent.displayname:"[[global:guest]]";return`[[topic:replied-to-user-${e.timestamp<Date.now()-n*v?"on":"ago"}, ${e.toPid}, ${h}/post/${encodeURIComponent(e.toPid)}, ${s}, ${h}/post/${encodeURIComponent(e.pid)}, ${e.timestampISO}]]`}function _(e,n){return`[[topic:wrote-${e.timestamp<Date.now()-n*v?"on":"ago"}, ${h}/post/${encodeURIComponent(e.pid)}, ${e.timestampISO}]]`}function Y(e){return encodeURIComponent(e)}function J(e,n="en-GB"){return new Date(e).toLocaleString([n],{dateStyle:"short",timeStyle:"short"}).replace(/,/g,"&#44;")}function z(e){return!!(e.replies.count<=0||e.replies.hasSingleImmediateReply)}function G(e,n=1){return A.makeNumberHumanReadable(e,n)}function V(e){return A.addCommas(e)}function a(e){return String(e).replace(/%/g,"&#37;").replace(/,/g,"&#44;")}function r(e){return e.map(s=>s==="divider"?'<li class="dropdown-divider"></li>':`
			<li class="dropdown-item placeholder-wave">
				<div class="placeholder" style="width: 20px;"></div>
				<div class="placeholder col-${s}"></div>
			</li>`).join("")}function m(){Object.keys(E).forEach(function(e){u.registerHelper(e,E[e])})}return E}},30076:(M,A,u)=>{var h,v;const E=u(29869);h=[u(77918),u(81335)],v=function(x,T){return E(x,T,config.relative_path)}.apply(A,h),v!==void 0&&(M.exports=v)},30637:(M,A,u)=>{var h,v;h=[u(49897),u(81335),u(33530),u(29930)],v=function(E,x,T,b){const C={};function f(){return ajaxify.data.template.name.startsWith("admin/")}return C.handle=function(){$('[component="user/invite"]').on("click",function(i){i.preventDefault(),E.get(`/api/v3/users/${app.user.uid}/invites/groups`,{}).then(L=>{x.parse("modals/invite",{groups:L},function(y){T.dialog({message:y,title:`[[${f()?"admin/manage/users:invite":"users:invite"}]]`,onEscape:!0,buttons:{cancel:{label:`[[${f()?"admin/manage/users:alerts.button-cancel":"modules:bootbox.cancel"}]]`,className:"btn-default"},invite:{label:`[[${f()?"admin/manage/users:invite":"users:invite"}]]`,className:"btn-primary",callback:C.send}}})})}).catch(b.error)})},C.send=function(){const i=$("#invite-modal-emails"),L=$("#invite-modal-groups"),y={emails:i.val().split(",").map(p=>p.trim()).filter(Boolean).filter((p,w,t)=>w===t.indexOf(p)).join(","),groupsToJoin:L.val()};y.emails&&E.post(`/users/${app.user.uid}/invites`,y).then(()=>{b.success(`[[${f()?"admin/manage/users:alerts.email-sent-to":"users:invitation-email-sent"}, ${y.emails.replace(/,/g,"&#44; ")}]]`)}).catch(b.error)},C}.apply(A,h),v!==void 0&&(M.exports=v)},34405:(M,A,u)=>{var h,v;h=[u(49897),u(29930),u(36e3),u(9787),u(35786)],v=function(E,x,{Textcomplete:T},{TextareaEditor:b},{ContenteditableEditor:C}){const f={},i={delay:200,appendTo:null};f.init=y=>{const p={...i,...y},{input:w,onSelect:t}=p;app.loadJQueryUI(function(){w.autocomplete({...p,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(o,l){L(w,t,o,l)}})})},f.user=function(y,p,w){typeof p=="function"&&(w=p,p={}),p=p||{},f.init({input:y,onSelect:w,source:(t,o)=>{p.query=t.term,E.get("/api/users",p,function(l,D){if(l)return x.error(l);if(D&&D.users){const N=D.users.map(function(k){const I=$("<div></div>").html(k.username).text();return k&&{label:I,value:I,user:{uid:k.uid,name:k.username,slug:k.userslug,username:k.username,userslug:k.userslug,displayname:k.displayname,picture:k.picture,banned:k.banned,"icon:text":k["icon:text"],"icon:bgColor":k["icon:bgColor"]}}});o(N)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},f.group=function(y,p){f.init({input:y,onSelect:p,source:(w,t)=>{socket.emit("groups.search",{query:w.term},function(o,l){if(o)return x.error(o);if(l&&l.length){const D=l.map(function(N){return N&&{label:N.name,value:N.name,group:N}});t(D)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},f.tag=function(y,p){f.init({input:y,onSelect:p,delay:100,source:(w,t)=>{socket.emit("topics.autocompleteTags",{query:w.term,cid:ajaxify.data.cid||0},function(o,l){if(o)return x.error(o);l&&t(l),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function L(y,p,w,t){p=p||function(){};const o=jQuery.Event("keypress");o.which=13,o.keyCode=13,setTimeout(function(){y.trigger(o)},100),p(w,t)}return f.setup=function({element:y,strategies:p,options:w}){const t=y.get(0);if(t){var o;if(t.nodeName==="TEXTAREA"||t.nodeName==="INPUT"?o=new b(t):t.nodeName==="DIV"&&t.getAttribute("contenteditable")==="true"&&(o=new C(t)),!o)throw new Error("unknown target element type");t.setAttribute("dir",document.querySelector("html").getAttribute("data-dir"));var l=new T(o,p,{dropdown:w});return l.on("rendered",function(){l.dropdown.items.length&&l.dropdown.items[0].activate()}),l}},f}.apply(A,h),v!==void 0&&(M.exports=v)},49897:(M,A,u)=>{u.r(A),u.d(A,{del:()=>w,get:()=>f,head:()=>i,patch:()=>y,post:()=>L,put:()=>p});var h=u(91749),v=u.n(h),E=u(33530),x=u.n(E);const T=config.relative_path+"/api/v3";async function b(t,o){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:T+t.url,typeof o=="function"){C(t).then(l=>o(null,l),l=>o(l));return}try{return await C(t)}catch(l){if(l.message==="A valid login session was not found. Please log in and try again."){const{url:D}=await(0,h.fire)("filter:admin.reauth",{url:"login"});return(0,E.confirm)("[[error:api.reauth-required]]",N=>{N&&ajaxify.go(D)})}throw l}}async function C(t){const{url:o}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,h.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const l=await fetch(o,t),{headers:D}=l;if(D.get("x-redirect"))return C({url:D.get("x-redirect"),...t});const N=D.get("content-type"),k=N&&N.startsWith("application/json");let I;if(t.method!=="HEAD"&&(k?I=await l.json():I=await l.text()),!l.ok)throw I?new Error(k?I.status.message:I):new Error(l.statusText);return k&&I&&I.hasOwnProperty("status")&&I.hasOwnProperty("response")?I.response:I}function f(t,o,l){return b({url:t+(o&&Object.keys(o).length?"?"+$.param(o):"")},l)}function i(t,o,l){return b({url:t+(o&&Object.keys(o).length?"?"+$.param(o):""),method:"HEAD"},l)}function L(t,o,l){return b({url:t,method:"POST",data:o,headers:{"x-csrf-token":config.csrf_token}},l)}function y(t,o,l){return b({url:t,method:"PATCH",data:o,headers:{"x-csrf-token":config.csrf_token}},l)}function p(t,o,l){return b({url:t,method:"PUT",data:o,headers:{"x-csrf-token":config.csrf_token}},l)}function w(t,o,l){return b({url:t,method:"DELETE",data:o,headers:{"x-csrf-token":config.csrf_token}},l)}},86296:(M,A,u)=>{var h,v;h=[u(49897),u(33530),u(29930)],v=function(E,x,T){const b={};return b.init=function(C){const f=x.dialog({message:`
				<label class="form-label">[[admin/manage/users:new-email]]</label>
				<input id="newEmail" class="form-control" type="text" value="${utils.escapeHTML(C.email||"")}">
			`,title:"[[admin/manage/users:change-email]]",onEscape:!0,buttons:{cancel:{label:"[[admin/manage/users:alerts.button-cancel]]",className:"btn-link"},change:{label:"[[admin/manage/users:alerts.button-change]]",className:"btn-primary",callback:function(){const i=f.find("#newEmail").val();return E.post("/users/"+C.uid+"/emails",{skipConfirmation:!0,email:i}).then(()=>{f.modal("hide"),C.onSuccess(i)}).catch(T.error),!1}}}})},b}.apply(A,h),v!==void 0&&(M.exports=v)},91847:(M,A,u)=>{var h,v;h=[u(17459),u(81335),u(34405),u(49897),u(13230),u(33530),u(29930),u(30637),u(30076),u(86296)],v=function(E,x,T,b,C,f,i,L,y,p){const w={};w.init=function(){$("#results-per-page").val(ajaxify.data.resultsPerPage).on("change",function(){const a=utils.params();a.resultsPerPage=$("#results-per-page").val();const r=D(a);ajaxify.go(window.location.pathname+"?"+r)}),$(".export-csv").on("click",function(){socket.once("event:export-users-csv",function(){i.remove("export-users-start"),i.alert({alert_id:"export-users",type:"success",title:"[[global:alert.success]]",message:"[[admin/manage/users:export-users-completed]]",clickfn:function(){window.location.href=config.relative_path+"/api/admin/users/csv"},timeout:0})});const r=[{label:"[[admin/manage/users:export-field-email]]",field:"email",selected:!0},{label:"[[admin/manage/users:export-field-username]]",field:"username",selected:!0},{label:"[[admin/manage/users:export-field-uid]]",field:"uid",selected:!0},{label:"[[admin/manage/users:export-field-ip]]",field:"ip",selected:!0},{label:"[[admin/manage/users:export-field-joindate]]",field:"joindate",selected:!1},{label:"[[admin/manage/users:export-field-lastonline]]",field:"lastonline",selected:!1},{label:"[[admin/manage/users:export-field-lastposttime]]",field:"lastposttime",selected:!1},{label:"[[admin/manage/users:export-field-reputation]]",field:"reputation",selected:!1},{label:"[[admin/manage/users:export-field-postcount]]",field:"postcount",selected:!1},{label:"[[admin/manage/users:export-field-topiccount]]",field:"topiccount",selected:!1},{label:"[[admin/manage/users:export-field-profileviews]]",field:"profileviews",selected:!1},{label:"[[admin/manage/users:export-field-followercount]]",field:"followerCount",selected:!1},{label:"[[admin/manage/users:export-field-followingcount]]",field:"followingCount",selected:!1},{label:"[[admin/manage/users:export-field-fullname]]",field:"fullname",selected:!1},{label:"[[admin/manage/users:export-field-birthday]]",field:"birthday",selected:!1},{label:"[[admin/manage/users:export-field-signature]]",field:"signature",selected:!1},{label:"[[admin/manage/users:export-field-aboutme]]",field:"aboutme",selected:!1}].concat(ajaxify.data.customUserFields.map(e=>({label:e.name,field:e.key,selected:!1}))).map((e,n)=>`
				<div class="form-check mb-2">
					<input data-field="${e.field}" class="form-check-input" type="checkbox" id="option-${n}" ${e.selected?"checked":""}>
					<label class="form-check-label" for="option-${n}">
						${e.label}
					</label>
				</div>`).join(""),m=f.dialog({message:r,title:"[[admin/manage/users:export-users-fields-title]]",buttons:{submit:{label:"[[admin/manage/users:export]]",callback:function(){const e=m.find("[data-field]").filter((n,s)=>$(s).is(":checked")).map((n,s)=>$(s).attr("data-field")).get();socket.emit("admin.user.exportUsersCSV",{fields:e},function(n){if(n)return i.error(n);i.alert({alert_id:"export-users-start",message:"[[admin/manage/users:export-users-started]]",timeout:Math.max(5e3,ajaxify.data.userCount/5e3*500)})})}}}});return!1});function c(){const a=[];return $('.users-table [component="user/select/single"]').each(function(){$(this).is(":checked")&&a.push($(this).attr("data-uid"))}),a}function d(a,r){$('.users-table [component="user/select/single"]:checked').parents(".user-row").find(a).each(function(){$(this).toggleClass("hidden",!r)})}function S(){$('.users-table [component="user/select/single"]').prop("checked",!1),$('.users-table [component="user/select/all"]').prop("checked",!1)}function R(a){const r=document.querySelector(`.users-table [component="user/select/single"][data-uid="${a}"]`);if(r){const m=r.closest(".user-row");m.parentNode.removeChild(m)}}function U(a,r,m){return function(e){if(e)return i.error(e);i.success(a),r&&d(r,m),S()}}function _(a,r,m){i.success(a),r&&d(r,m),S()}$('[component="user/select/all"]').on("click",function(){$('.users-table [component="user/select/single"]').prop("checked",$(this).is(":checked"))}),$(".manage-groups").on("click",function(){const a=c();if(!a.length)return i.error("[[error:no-users-selected]]"),!1;socket.emit("admin.user.loadGroups",a,function(r,m){if(r)return i.error(r);x.render("admin/partials/manage_user_groups",m).then(function(e){const n=f.dialog({message:e,title:"[[admin/manage/users:manage-groups]]",onEscape:!0});n.on("shown.bs.modal",function(){T.group(n.find(".group-search"),function(s,g){const B=$(s.target).attr("data-uid");b.put("/groups/"+g.item.group.slug+"/membership/"+B,void 0).then(()=>{g.item.group.nameEscaped=E.escape(g.item.group.displayName),app.parseAndTranslate("admin/partials/manage_user_groups",{users:[{groups:[g.item.group]}]},function(P){$("[data-uid="+B+"] .group-area").append(P.find(".group-area").html())})}).catch(i.error)})}),n.on("click",".group-area a",function(){n.modal("hide")}),n.on("click",".remove-group-icon",function(){const s=$(this).parents("[data-group-name]"),g=s.attr("data-group-name"),B=$(this).parents("[data-uid]").attr("data-uid");return b.del("/groups/"+C(g)+"/membership/"+B).then(()=>{s.remove()}).catch(i.error),!1})})})}),$(".set-reputation").on("click",function(){const a=c();if(!a.length)return i.error("[[error:no-users-selected]]"),!1;let r="";if(a.length===1){const e=ajaxify.data.users.find(n=>n&&n.uid===parseInt(a[0],10));e&&(r=String(e.reputation))}const m=f.dialog({message:`<input id="new-reputation" type="text" class="form-control" value="${r}">`,title:"[[admin/manage/users:set-reputation]]",onEscape:!0,buttons:{submit:{label:"[[global:save]]",callback:function(){const e=m.find("#new-reputation").val();if(!utils.isNumber(e))return i.error("[[error:invalid-data]]"),!1;socket.emit("admin.user.setReputation",{value:e,uids:a}).then(()=>{a.forEach(n=>{$(`[component="user/reputation"][data-uid="${n}"]`).text(y.formattedNumber(e));const s=ajaxify.data.users.find(g=>g&&g.uid===parseInt(n,10));s&&(s.reputation=e)})}).catch(i.error)}}}});m.on("shown.bs.modal",()=>{m.find("#new-reputation").selectRange(0,m.find("#new-reputation").val().length)})}),$(".ban-user").on("click",function(){const a=c();if(!a.length)return i.error("[[error:no-users-selected]]"),!1;f.confirm(a.length>1?"[[admin/manage/users:alerts.confirm-ban-multi]]":"[[admin/manage/users:alerts.confirm-ban]]",function(r){r&&Promise.all(a.map(function(m){return b.put("/users/"+m+"/ban")})).then(()=>{_("[[admin/manage/users:alerts.ban-success]]",".ban",!0)}).catch(i.error)})}),$(".ban-user-temporary").on("click",function(){const a=c();if(!a.length)return i.error("[[error:no-users-selected]]"),!1;x.render("modals/temporary-ban",{}).then(function(r){const m=f.dialog({title:"[[user:ban-account]]",message:r,show:!0,onEscape:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:"[[admin/manage/users:alerts.button-ban-x, "+a.length+"]]",callback:function(){const e=m.find("form").serializeArray().reduce(function(s,g){return s[g.name]=g.value,s},{}),n=e.length>0?Date.now()+e.length*1e3*60*60*(parseInt(e.unit,10)?24:1):0;Promise.all(a.map(function(s){return b.put("/users/"+s+"/ban",{until:n,reason:e.reason})})).then(()=>{_("[[admin/manage/users:alerts.ban-success]]",".ban",!0)}).catch(i.error)}}}})})}),$(".unban-user").on("click",function(){const a=c();if(!a.length)return i.error("[[error:no-users-selected]]"),!1;x.render("modals/unban",{}).then(function(r){const m=f.dialog({title:"[[user:unban-account]]",message:r,show:!0,onEscape:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:"[[user:unban-account]]",callback:function(){const e=m.find("form").serializeArray().reduce(function(n,s){return n[s.name]=s.value,n},{});Promise.all(a.map(function(n){return b.del("/users/"+n+"/ban",{reason:e.reason||""})})).then(()=>{_("[[admin/manage/users:alerts.unban-success]]",".ban",!1)}).catch(i.error)}}}})})}),$(".reset-lockout").on("click",function(){const a=c();a.length&&socket.emit("admin.user.resetLockouts",a,U("[[admin/manage/users:alerts.lockout-reset-success]]"))}),$(".change-email").on("click",function(){const a=c();if(a.length!==1)return i.error("[[admin/manage/users:alerts.select-a-single-user-to-change-email]]");p.init({uid:a[0],onSuccess:function(r){d(".notvalidated",!1),d(".pending",!1),d(".expired",!1),d(".validated",!1),d(".validated-by-admin",!!r),d(".no-email",!r),$('.users-table [component="user/select/single"]:checked').parents(".user-row").find(".validated-by-admin .email").text(r)}})}),$(".validate-email").on("click",function(){const a=c();a.length&&f.confirm("[[admin/manage/users:alerts.confirm-validate-email]]",function(r){r&&socket.emit("admin.user.validateEmail",a,function(m){if(m)return i.error(m);i.success("[[admin/manage/users:alerts.validate-email-success]]"),d(".notvalidated",!1),d(".pending",!1),d(".expired",!1),d(".validated",!1),d(".validated-by-admin",!0),S()})})}),$(".send-validation-email").on("click",function(){const a=c();a.length&&socket.emit("admin.user.sendValidationEmail",a,function(r){if(r)return i.error(r);i.success("[[notifications:email-confirm-sent]]")})}),$(".change-password").on("click",async function(){const a=c();if(!a.length)return;async function r(e){const n=e.find("#newPassword").val(),s=e.find("#confirmPassword").val();if(n!==s)throw new Error("[[[user:change-password-error-match]]");await Promise.all(a.map(g=>b.put("/users/"+g+"/password",{currentPassword:"",newPassword:n})))}const m=f.dialog({message:`<div class="d-flex flex-column gap-2">
					<label class="form-label">[[user:new-password]]</label>
					<input id="newPassword" class="form-control" type="text">
					<label class="form-label">[[user:confirm-password]]</label>
					<input id="confirmPassword" class="form-control" type="text">
				</div>`,title:"[[admin/manage/users:change-password]]",onEscape:!0,buttons:{cancel:{label:"[[admin/manage/users:alerts.button-cancel]]",className:"btn-link"},change:{label:"[[admin/manage/users:alerts.button-change]]",className:"btn-primary",callback:function(){return r(m).then(()=>{m.modal("hide")}).catch(i.error),!1}}}})}),$(".password-reset-email").on("click",function(){const a=c();a.length&&f.confirm("[[admin/manage/users:alerts.password-reset-confirm]]",function(r){r&&socket.emit("admin.user.sendPasswordResetEmail",a,U("[[admin/manage/users:alerts.password-reset-email-sent]]"))})}),$(".force-password-reset").on("click",function(){const a=c();a.length&&f.confirm("[[admin/manage/users:alerts.confirm-force-password-reset]]",function(r){r&&socket.emit("admin.user.forcePasswordReset",a,U("[[admin/manage/users:alerts.validate-force-password-reset-success]]"))})}),$(".delete-user").on("click",()=>{z("[[admin/manage/users:alerts.confirm-delete]]","/account")}),$(".delete-user-content").on("click",()=>{z("[[admin/manage/users:alerts.confirm-delete-content]]","/content")}),$(".delete-user-and-content").on("click",()=>{z("[[admin/manage/users:alerts.confirm-purge]]","")});const Y=document.querySelector(".users-table"),J=document.getElementById("action-dropdown");Y.addEventListener("change",a=>{(a.target.closest('[component="user/select/single"]')||a.target.closest('[component="user/select/all"]'))&&(c().length?J.removeAttribute("disabled"):J.setAttribute("disabled","disabled"))});function z(a,r){const m=c();m.length&&f.confirm(a,function(e){e&&Promise.all(m.map(n=>b.del(`/users/${encodeURIComponent(n)}${r}`,{}).then(()=>{r!=="/content"&&R(n)}))).then(()=>{r!=="/content"?i.success("[[admin/manage/users:alerts.delete-success]]"):i.success("[[admin/manage/users:alerts.delete-content-success]]"),S(),$('.users-table [component="user/select/single"]').length||ajaxify.refresh()}).catch(i.error)})}function G(){$('[data-action="create"]').on("click",function(){return x.render("admin/partials/create_user_modal",{}).then(function(a){const r=f.dialog({message:a,title:"[[admin/manage/users:alerts.create]]",onEscape:!0,buttons:{cancel:{label:"[[admin/manage/users:alerts.button-cancel]]",className:"btn-link"},create:{label:"[[admin/manage/users:alerts.button-create]]",className:"btn-primary",callback:function(){return V.call(this),!1}}}});r.on("shown.bs.modal",function(){r.find("#create-user-name").focus()})}),!1})}function V(){const a=this,r=document.getElementById("create-user-name").value,m=document.getElementById("create-user-email").value,e=document.getElementById("create-user-password").value,n=document.getElementById("create-user-password-again").value,s=$("#create-modal-error");if(e!==n)return s.translateHtml("[[admin/manage/users:alerts.error-x, [[admin/manage/users:alerts.error-passwords-different]]]]").removeClass("hide");const g={username:r,email:m,password:e};b.post("/users",g).then(()=>{a.modal("hide"),a.on("hidden.bs.modal",function(){ajaxify.refresh()}),i.success("[[admin/manage/users:alerts.create-success]]")}).catch(B=>s.translateHtml("[[admin/manage/users:alerts.error-x, "+B.message+"]]").removeClass("hidden"))}t(),G(),N(),I(),L.handle()};function t(){function c(){$(".fa-spinner").removeClass("hidden"),o({searchBy:$("#user-search-by").val(),query:$("#user-search").val(),page:1})}$("#user-search").on("keyup",utils.debounce(c,250)),$("#user-search-by").on("change",c)}function o(c){const d=utils.params();d.searchBy=c.searchBy,d.query=c.query,d.page=c.page,d.sortBy=d.sortBy||"lastonline";const S=$.param(d);$.get(config.relative_path+"/api/admin/manage/users?"+S,function(R){l(R);const U=config.relative_path+"/admin/manage/users?"+S;history.pushState&&history.pushState({url:U},null,window.location.protocol+"//"+window.location.host+U)}).fail(function(R){R&&R.responseJSON&&R.responseJSON.error&&i.error(R.responseJSON.error)})}function l(c){x.render("partials/paginator",{pagination:c.pagination}).then(function(d){$(".pagination-container").replaceWith(d)}),app.parseAndTranslate("admin/manage/users","users",c,function(d){if($(".users-table tbody tr").remove(),$(".users-table tbody").append(d),d.find(".timeago").timeago(),$(".fa-spinner").addClass("hidden"),!$("#user-search").val()){$("#user-found-notify").addClass("hidden"),$("#user-notfound-notify").addClass("hidden");return}c&&c.users.length===0?($("#user-notfound-notify").translateHtml("[[admin/manage/users:search.not-found]]").removeClass("hidden"),$("#user-found-notify").addClass("hidden")):($("#user-found-notify").translateHtml(E.compile("admin/manage/users:alerts.x-users-found",c.matchCount,c.timing)).removeClass("hidden"),$("#user-notfound-notify").addClass("hidden"))})}function D(c){return $("#user-search").val()?(c.query=$("#user-search").val(),c.searchBy=$("#user-search-by").val()):(delete c.query,delete c.searchBy),$.param(c)}function N(){$(".users-table thead th").on("click",function(){const d=$(this).attr("data-sort");if(!d)return;const S=utils.params();S.sortBy=d,ajaxify.data.sortBy===d?S.sortDirection=ajaxify.data.reverse?"asc":"desc":S.sortDirection="desc";const R=D(S);ajaxify.go("admin/manage/users?"+R)})}function k(){const c=[];return $("#filter-by").find("[data-filter-by]").each(function(){$(this).find(".fa-check").length&&c.push($(this).attr("data-filter-by"))}),c}function I(){let c=k();$("#filter-by").on("click","li",function(){const d=$(this);return d.find("i").toggleClass("fa-check",!d.find("i").hasClass("fa-check")),!1}),$("#filter-by").on("hidden.bs.dropdown",function(){const d=k();let S=d.length!==c.length;if(d.length===c.length&&d.forEach(function(R,U){R!==c[U]&&(S=!0)}),c=k(),S){const R=utils.params();R.filters=d;const U=D(R);ajaxify.go("admin/manage/users?"+U)}})}return w}.apply(A,h),v!==void 0&&(M.exports=v)}}]);
