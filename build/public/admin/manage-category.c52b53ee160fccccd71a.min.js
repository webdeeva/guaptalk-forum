"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,69185,83931,86198,99127],{49897:(w,E,d)=>{d.r(E),d.d(E,{del:()=>s,get:()=>a,head:()=>i,patch:()=>r,post:()=>m,put:()=>u});var y=d(91749),p=d.n(y),b=d(33530),x=d.n(b);const v=config.relative_path+"/api/v3";async function h(o,n){if(o.url=o.url.startsWith("/api")?config.relative_path+o.url:v+o.url,typeof n=="function"){g(o).then(e=>n(null,e),e=>n(e));return}try{return await g(o)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again."){const{url:t}=await(0,y.fire)("filter:admin.reauth",{url:"login"});return(0,b.confirm)("[[error:api.reauth-required]]",c=>{c&&ajaxify.go(t)})}throw e}}async function g(o){const{url:n}=o;delete o.url,o.data&&!(o.data instanceof FormData)&&(o.data=JSON.stringify(o.data||{}),o.headers["content-type"]="application/json; charset=utf-8"),{options:o}=await(0,y.fire)("filter:api.options",{options:o}),o.data&&(o.body=o.data,delete o.data);const e=await fetch(n,o),{headers:t}=e;if(t.get("x-redirect"))return g({url:t.get("x-redirect"),...o});const c=t.get("content-type"),f=c&&c.startsWith("application/json");let l;if(o.method!=="HEAD"&&(f?l=await e.json():l=await e.text()),!e.ok)throw l?new Error(f?l.status.message:l):new Error(e.statusText);return f&&l&&l.hasOwnProperty("status")&&l.hasOwnProperty("response")?l.response:l}function a(o,n,e){return h({url:o+(n&&Object.keys(n).length?"?"+$.param(n):"")},e)}function i(o,n,e){return h({url:o+(n&&Object.keys(n).length?"?"+$.param(n):""),method:"HEAD"},e)}function m(o,n,e){return h({url:o,method:"POST",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function r(o,n,e){return h({url:o,method:"PATCH",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function u(o,n,e){return h({url:o,method:"PUT",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function s(o,n,e){return h({url:o,method:"DELETE",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}},65348:(w,E,d)=>{var y,p;y=[d(96349),d(33530),d(91749),d(17459)],p=function(b,x,v,h){const g={};return g.init=function(a,i){if(!a||!a.length)return;i=i||{};const m=i.onSelect||function(){};i.states=i.states||["watching","tracking","notwatching","ignoring"],i.template=i.template||"partials/category/selector-dropdown-left",v.fire("action:category.selector.options",{el:a,options:i}),b.init(a,i);const r={el:a,selectedCategory:null};a.on("click","[data-cid]",function(){const s=$(this);return s.hasClass("disabled")?!1:(r.selectCategory(s.attr("data-cid")),m(r.selectedCategory))});let u=r.el.find('[component="category-selector-selected"]').html();return h.translate(u,s=>{u=s}),r.selectCategory=function(s){const o=r.el.find('[data-cid="'+s+'"]');r.selectedCategory={cid:s,name:o.attr("data-name")},o.length?r.el.find('[component="category-selector-selected"]').html(o.find('[component="category-markup"]').html()):r.el.find('[component="category-selector-selected"]').html(u)},r.getSelectedCategory=function(){return r.selectedCategory},r.getSelectedCid=function(){return r.selectedCategory?r.selectedCategory.cid:0},i.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(i.template,{selectedCategory:i.selectedCategory},function(s){r.el.find('[component="category-selector-selected"]').html(s.find('[component="category-selector-selected"]').html())}),r},g.modal=function(a){a=a||{},a.onSelect=a.onSelect||function(){},a.onSubmit=a.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:a.message},function(i){const m=x.dialog({title:a.title||"[[modules:composer.select-category]]",message:i,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:u}}}),r=g.init(m.find('[component="category-selector"]'),a);function u(s){return s.preventDefault(),r.selectedCategory&&(a.onSubmit(r.selectedCategory),m.modal("hide")),!1}a.openOnLoad&&m.on("shown.bs.modal",function(){m.find(".dropdown-toggle").dropdown("toggle")}),m.find("form").on("submit",u)})},g}.apply(E,y),p!==void 0&&(w.exports=p)},86871:(w,E,d)=>{var y,p;y=[d(24187),d(67308),d(65348),d(81335),d(49897),d(33530),d(29930),d(54222)],p=function(b,x,v,h,g,a,i,m){const r={};let u={};r.init=function(){const n=$("#category-settings"),e=$('[component="category/preview"]');n.find("select").each(function(){const t=$(this);t.val(t.attr("data-value"))}),v.init($('[component="settings/main/header"] [component="category-selector"]'),{onSelect:function(t){ajaxify.go("admin/manage/categories/"+t.cid)},cacheList:!1,showLinks:!0,template:"admin/partials/category/selector-dropdown-right"}),v.init($('#parent-category-selector [component="category-selector"]'),{onSelect:function(t){const c=$("#parent-cid");c.val(t.cid),s(c[0])},selectedCategory:ajaxify.data.category.parent,localCategories:[{cid:0,name:"[[admin/manage/categories:parent-category-none]]",icon:"fa-list"}],cacheList:!1,showLinks:!0,template:"admin/partials/category/selector-dropdown-right"}),o(),n.find("input, select, textarea").on("change",function(t){s(t.target)}),$('[type="checkbox"]').on("change",function(){s($(this))}),$('[data-name="imageClass"]').on("change",function(){$(".category-preview").css("background-size",$(this).val())}),$('[data-name="bgColor"], [data-name="color"]').on("input",function(){const t=$(this);t.attr("data-name")==="bgColor"?e.css("background-color",t.val()):t.attr("data-name")==="color"&&e.css("color",t.val()),s(t[0])}),$("#save").on("click",function(){const t=$("#tag-whitelist").val()?$("#tag-whitelist").val().split(","):[];if(t.length&&t.length<parseInt($("#cid-min-tags").val(),10))return i.error("[[admin/manage/categories:alert.not-enough-whitelisted-tags]]");const c=ajaxify.data.category.cid;return g.put("/categories/"+c,u).then(()=>{app.flags._unsaved=!1,m.toggleSaveSuccess($("#save")),u={}}).catch(i.error),!1}),$(".purge").on("click",function(t){t.preventDefault(),h.render("admin/partials/categories/purge",{name:ajaxify.data.category.name,topic_count:ajaxify.data.category.topic_count}).then(function(c){const f=a.dialog({title:"[[admin/manage/categories:purge]]",message:c,size:"large",buttons:{save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:function(){f.find(".modal-footer button").prop("disabled",!0);const l=setInterval(async()=>{if(ajaxify.data.category)try{const{count:C}=await g.get(`/categories/${ajaxify.data.category.cid}/count`);let k=0;ajaxify.data.category.topic_count>0&&(k=Math.max(0,1-C/ajaxify.data.category.topic_count)*100),f.find(".progress-bar").css({width:k+"%"})}catch(C){clearInterval(l),i.error(C)}},1e3);return g.del("/categories/"+ajaxify.data.category.cid).then(()=>{l&&clearInterval(l),f.modal("hide"),i.success("[[admin/manage/categories:alert.purge-success]]"),setTimeout(()=>{ajaxify.go("admin/manage/categories")},2500)}).catch(i.error),!1}}}})})}),$(".copy-settings").on("click",function(){return h.render("admin/partials/categories/copy-settings",{}).then(function(t){let c;const f=a.dialog({title:"[[modules:composer.select-category]]",message:t,buttons:{save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:function(){if(!(!c||parseInt(c,10)===parseInt(ajaxify.data.category.cid,10)))return socket.emit("admin.categories.copySettingsFrom",{fromCid:c,toCid:ajaxify.data.category.cid,copyParent:f.find("#copyParent").prop("checked")},function(l){if(l)return i.error(l);f.modal("hide"),alert.success("[[admin/manage/categories:alert.copy-success]]"),ajaxify.refresh()}),!1}}}});f.find(".modal-footer button").prop("disabled",!0),v.init(f.find('[component="category-selector"]'),{onSelect:function(l){c=l&&l.cid,c&&f.find(".modal-footer button").prop("disabled",!1)},showLinks:!0})}),!1}),$(".upload-button").on("click",function(){const c=$(this).attr("data-cid");b.show({title:"[[admin/manage/categories:alert.upload-image]]",route:config.relative_path+"/api/admin/category/uploadpicture",params:{cid:c}},function(f){$("#category-image").val(f),e.css("background-image","url("+f+"?"+new Date().getTime()+")"),s($("#category-image"))})}),$("#category-image").on("change",function(){e.css("background-image",$(this).val()?'url("'+$(this).val()+'")':""),s($("#category-image"))}),$(".delete-image").on("click",function(t){t.preventDefault();const c=$("#category-image");c.val(""),e.css("background-image",""),s(c[0])}),e.on("click",function(){x.init($(this).find("i"),s)}),$('button[data-action="toggle"]').on("click",function(){const t=$(this),c=t.attr("data-disabled")==="1";g.put("/categories/"+ajaxify.data.category.cid,{disabled:c?0:1}).then(()=>{t.find(".label").translateText(c?"[[admin/manage/categories:disable]]":"[[admin/manage/categories:enable]]"),t.find("i").toggleClass(["fa-check","text-success"],!c).toggleClass(["fa-ban","text-danger"],c),t.attr("data-disabled",c?0:1)}).catch(i.error)})};function s(n){let e;$(n).is(":checkbox")?e=$(n).is(":checked")?1:0:e=$(n).val();const c=$(n).attr("data-name").match(/[^\][.]+/g);function f(l,C){C!==c.length&&(l[c[C]]=l[c[C]]||{},C===c.length-1&&(l[c[C]]=e),f(l[c[C]],C+1))}c&&c.length&&(c.length===1?u[c[0]]=e:c.length>1&&f(u,0)),app.flags=app.flags||{},app.flags._unsaved=!0}function o(){const n=$("#tag-whitelist");n.tagsinput({tagClass:"badge bg-info",confirmKeys:[13,44],trimValue:!0}),ajaxify.data.category.tagWhitelist.forEach(function(e){n.tagsinput("add",e)}),n.on("itemAdded itemRemoved",function(){s(n)})}return r}.apply(E,y),p!==void 0&&(w.exports=p)},96349:(w,E,d)=>{var y,p;y=[d(29930),d(89336),d(49897)],p=function(b,x,v){const h={};return h.init=function(g,a){let i=a.defaultCategories||null;a=a||{},a.privilege=a.privilege||"topics:read",a.states=a.states||["watching","tracking","notwatching","ignoring"],a.cacheList=a.hasOwnProperty("cacheList")?a.cacheList:!0;let m=[];Array.isArray(a.localCategories)&&(m=a.localCategories.map(n=>({...n})),i&&(i=[...m,...i])),a.selectedCids=a.selectedCids||ajaxify.data.selectedCids||[];const r=g.find('[component="category-selector-search"]');if(!r.length)return;const u=r.parents('[component="category/dropdown"]').length>0||r.parents('[component="category-selector"]').length>0;g.on("show.bs.dropdown",function(){u&&r.removeClass("hidden");function n(){const e=r.find("input").val();e.length>1||!e&&!i?s(e,function(t){i=a.cacheList&&(i||t),o(t)}):!e&&i&&o(i)}r.on("click",function(e){e.preventDefault(),e.stopPropagation()}),r.find("input").val("").on("keyup",utils.debounce(n,300)),n()}),g.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||r.find("input").focus()}),g.on("hide.bs.dropdown",function(){u&&r.addClass("hidden"),r.off("click"),r.find("input").off("keyup")});function s(n,e){v.get("/search/categories",{search:n,query:utils.params(),parentCid:a.parentCid||0,selectedCids:a.selectedCids,privilege:a.privilege,states:a.states,showLinks:a.showLinks},function(t,{categories:c}){if(t)return b.error(t);e(m.concat(c))})}function o(n){const e=a.selectedCids.map(String);n.forEach(function(t){t.selected=e.includes(String(t.cid))}),app.parseAndTranslate(a.template,{categoryItems:n.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(t){g.find('[component="category/list"]').html(t.find('[component="category/list"]').html()),g.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!n.length);const c=x.Dropdown.getInstance(g.find(".dropdown-toggle").get(0));c&&c.update()})}},h}.apply(E,y),p!==void 0&&(w.exports=p)}}]);
