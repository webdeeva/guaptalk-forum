"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,6282,34271,49897,57843,99127],{49897:(R,g,n)=>{n.r(g),n.d(g,{del:()=>A,get:()=>v,head:()=>y,patch:()=>u,post:()=>x,put:()=>O});var i=n(91749),m=n.n(i),_=n(33530),D=n.n(_);const E=config.relative_path+"/api/v3";async function f(t,e){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:E+t.url,typeof e=="function"){p(t).then(a=>e(null,a),a=>e(a));return}try{return await p(t)}catch(a){if(a.message==="A valid login session was not found. Please log in and try again."){const{url:r}=await(0,i.fire)("filter:admin.reauth",{url:"login"});return(0,_.confirm)("[[error:api.reauth-required]]",d=>{d&&ajaxify.go(r)})}throw a}}async function p(t){const{url:e}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,i.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const a=await fetch(e,t),{headers:r}=a;if(r.get("x-redirect"))return p({url:r.get("x-redirect"),...t});const d=r.get("content-type"),l=d&&d.startsWith("application/json");let o;if(t.method!=="HEAD"&&(l?o=await a.json():o=await a.text()),!a.ok)throw o?new Error(l?o.status.message:o):new Error(a.statusText);return l&&o&&o.hasOwnProperty("status")&&o.hasOwnProperty("response")?o.response:o}function v(t,e,a){return f({url:t+(e&&Object.keys(e).length?"?"+$.param(e):"")},a)}function y(t,e,a){return f({url:t+(e&&Object.keys(e).length?"?"+$.param(e):""),method:"HEAD"},a)}function x(t,e,a){return f({url:t,method:"POST",data:e,headers:{"x-csrf-token":config.csrf_token}},a)}function u(t,e,a){return f({url:t,method:"PATCH",data:e,headers:{"x-csrf-token":config.csrf_token}},a)}function O(t,e,a){return f({url:t,method:"PUT",data:e,headers:{"x-csrf-token":config.csrf_token}},a)}function A(t,e,a){return f({url:t,method:"DELETE",data:e,headers:{"x-csrf-token":config.csrf_token}},a)}},62866:(R,g,n)=>{var i,m;i=[n(98569),n(91749)],m=((_,D)=>{const E={};return E.init=()=>{_.init({set:"topics",dataset:ajaxify.data.dataset}).then(()=>{D.onPage("action:admin.dashboard.updateGraph",E.updateTable)})},E.updateTable=()=>{window.fetch&&fetch(`${config.relative_path}/api${ajaxify.data.url}${window.location.search}`,{credentials:"include"}).then(f=>{f.ok&&f.json().then(function(p){app.parseAndTranslate(ajaxify.data.template.name,"topics",p,function(v){const y=document.querySelector(".topics-list tbody");y.innerHTML="",y.append(...v.map((x,u)=>u))})})})},E}).apply(g,i),m!==void 0&&(R.exports=m)},98569:(R,g,n)=>{n.r(g),n.d(g,{init:()=>A});var i=n(70106),m=n(81335),_=n.n(m),D=n(33530),E=n.n(D),f=n(17459),p=n.n(f),v=n(49897),y=n(91749),x=n.n(y);i.t1.register(i.ZT,i.PP,i.kc,i.No,i.FN,i.m_,i.dN);let u=null,O=!1;function A({set:a,dataset:r}){const d=document.getElementById("analytics-traffic"),l=d.getContext("2d"),o=utils.getHoursArray();O=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),O&&(i.t1.defaults.plugins.tooltip.enabled=!1),t({set:a});const s=f.Translator.create();return new Promise(h=>{s.translateKey(`admin/menu:${ajaxify.data.template.name.replace("admin/","")}`,[]).then(c=>{const P={labels:o,datasets:[{label:c,fill:!0,tension:.25,backgroundColor:"rgba(151,187,205,0.2)",borderColor:"rgba(151,187,205,1)",pointBackgroundColor:"rgba(151,187,205,1)",pointHoverBackgroundColor:"rgba(151,187,205,1)",pointBorderColor:"#fff",pointHoverBorderColor:"rgba(151,187,205,1)",data:r||[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]};d.width=$(d).parent().width(),P.datasets[0].yAxisID="left-y-axis",u=new i.t1(l,{type:"line",data:P,options:{responsive:!0,scales:{"left-y-axis":{type:"linear",position:"left",beginAtZero:!0,title:{display:!0,text:c}}},interaction:{intersect:!1,mode:"index"}}}),r?h(u):e(a).then(h)})})}function t({set:a}){$('[data-action="updateGraph"]:not([data-units="custom"])').on("click",function(){let r=new Date;const d=$(this).attr("data-amount");$(this).attr("data-units")==="days"&&r.setHours(0,0,0,0),r=r.getTime(),e(a,$(this).attr("data-units"),r,d),Promise.resolve().then(function(){var l=[n(17459)];(function(o){o.translate("[[admin/dashboard:page-views-custom]]",function(s){$('[data-action="updateGraph"][data-units="custom"]').text(s)})}).apply(null,l)}).catch(n.oe)}),$('[data-action="updateGraph"][data-units="custom"]').on("click",function(){const r=$(this);m.render("admin/partials/pageviews-range-select",{}).then(function(d){const l=D.dialog({title:"[[admin/dashboard:page-views-custom]]",message:d,buttons:{submit:{label:"[[global:search]]",className:"btn-primary",callback:o}}}).on("shown.bs.modal",function(){const s=new Date,h=s.toISOString().slice(0,10);s.setDate(s.getDate()-1);const c=s.toISOString().slice(0,10);l.find("#startRange").val(r.attr("data-startRange")||c),l.find("#endRange").val(r.attr("data-endRange")||h)});function o(){const s=l.find("form").serializeObject(),h=/\d{4}-\d{2}-\d{2}/;if(!s.startRange&&!s.endRange){e(a,"days");return}else if(!h.test(s.startRange)||!h.test(s.endRange))return l.find(".alert-danger").removeClass("hidden"),!1;let c=new Date(s.endRange);c.setDate(c.getDate()+1),c=c.getTime();const P=(c-new Date(s.startRange).getTime())/(1e3*60*60*24);e(a,"days",c,P),r.attr("data-startRange",s.startRange),r.attr("data-endRange",s.endRange),r.html(s.startRange+" &ndash; "+s.endRange)}})})}function e(a,r=ajaxify.data.query.units||"hours",d=ajaxify.data.query.until,l=ajaxify.data.query.count){return u?new Promise(o=>{v.get(`/admin/analytics/${a}`,{units:r,until:d,amount:l}).then(s=>{r==="days"?u.data.xLabels=utils.getDaysArray(d,l):u.data.xLabels=utils.getHoursArray(),u.data.datasets[0].data=s,u.data.labels=u.data.xLabels,u.update();const h=$("#view-as-json"),c=$.param({units:r||"hours",until:d,count:l});h.attr("href",`${config.relative_path}/api/v3/admin/analytics/${ajaxify.data.set}?${c}`);const P=ajaxify.removeRelativePath(ajaxify.data.url.slice(1));ajaxify.updateHistory(`${P}?${c}`,!0),y.fire("action:admin.dashboard.updateGraph",{graph:u}),o(u)})}):Promise.reject(new Error("[[error:invalid-data]]"))}}}]);
