"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,69185,79587,86198,99127],{49897:(D,y,o)=>{o.r(y),o.d(y,{del:()=>i,get:()=>e,head:()=>c,patch:()=>n,post:()=>f,put:()=>h});var u=o(91749),g=o.n(u),C=o(33530),w=o.n(C);const p=config.relative_path+"/api/v3";async function d(t,r){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:p+t.url,typeof r=="function"){l(t).then(a=>r(null,a),a=>r(a));return}try{return await l(t)}catch(a){if(a.message==="A valid login session was not found. Please log in and try again."){const{url:s}=await(0,u.fire)("filter:admin.reauth",{url:"login"});return(0,C.confirm)("[[error:api.reauth-required]]",E=>{E&&ajaxify.go(s)})}throw a}}async function l(t){const{url:r}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,u.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const a=await fetch(r,t),{headers:s}=a;if(s.get("x-redirect"))return l({url:s.get("x-redirect"),...t});const E=s.get("content-type"),A=E&&E.startsWith("application/json");let m;if(t.method!=="HEAD"&&(A?m=await a.json():m=await a.text()),!a.ok)throw m?new Error(A?m.status.message:m):new Error(a.statusText);return A&&m&&m.hasOwnProperty("status")&&m.hasOwnProperty("response")?m.response:m}function e(t,r,a){return d({url:t+(r&&Object.keys(r).length?"?"+$.param(r):"")},a)}function c(t,r,a){return d({url:t+(r&&Object.keys(r).length?"?"+$.param(r):""),method:"HEAD"},a)}function f(t,r,a){return d({url:t,method:"POST",data:r,headers:{"x-csrf-token":config.csrf_token}},a)}function n(t,r,a){return d({url:t,method:"PATCH",data:r,headers:{"x-csrf-token":config.csrf_token}},a)}function h(t,r,a){return d({url:t,method:"PUT",data:r,headers:{"x-csrf-token":config.csrf_token}},a)}function i(t,r,a){return d({url:t,method:"DELETE",data:r,headers:{"x-csrf-token":config.csrf_token}},a)}},65348:(D,y,o)=>{var u,g;u=[o(96349),o(33530),o(91749),o(17459)],g=function(C,w,p,d){const l={};return l.init=function(e,c){if(!e||!e.length)return;c=c||{};const f=c.onSelect||function(){};c.states=c.states||["watching","tracking","notwatching","ignoring"],c.template=c.template||"partials/category/selector-dropdown-left",p.fire("action:category.selector.options",{el:e,options:c}),C.init(e,c);const n={el:e,selectedCategory:null};e.on("click","[data-cid]",function(){const i=$(this);return i.hasClass("disabled")?!1:(n.selectCategory(i.attr("data-cid")),f(n.selectedCategory))});let h=n.el.find('[component="category-selector-selected"]').html();return d.translate(h,i=>{h=i}),n.selectCategory=function(i){const t=n.el.find('[data-cid="'+i+'"]');n.selectedCategory={cid:i,name:t.attr("data-name")},t.length?n.el.find('[component="category-selector-selected"]').html(t.find('[component="category-markup"]').html()):n.el.find('[component="category-selector-selected"]').html(h)},n.getSelectedCategory=function(){return n.selectedCategory},n.getSelectedCid=function(){return n.selectedCategory?n.selectedCategory.cid:0},c.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(c.template,{selectedCategory:c.selectedCategory},function(i){n.el.find('[component="category-selector-selected"]').html(i.find('[component="category-selector-selected"]').html())}),n},l.modal=function(e){e=e||{},e.onSelect=e.onSelect||function(){},e.onSubmit=e.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:e.message},function(c){const f=w.dialog({title:e.title||"[[modules:composer.select-category]]",message:c,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:h}}}),n=l.init(f.find('[component="category-selector"]'),e);function h(i){return i.preventDefault(),n.selectedCategory&&(e.onSubmit(n.selectedCategory),f.modal("hide")),!1}e.openOnLoad&&f.on("shown.bs.modal",function(){f.find(".dropdown-toggle").dropdown("toggle")}),f.find("form").on("submit",h)})},l}.apply(y,u),g!==void 0&&(D.exports=g)},78489:(D,y,o)=>{o.r(y),o.d(y,{init:()=>p});var u=o(49897),g=o(29930),C=o(65348),w=o.n(C);function p(){C.init($('[component="category-selector"]'),{onSelect:function(d){ajaxify.go("admin/manage/categories/"+d.cid+"/federation")},showLinks:!0,template:"admin/partials/category/selector-dropdown-right"}),$("#site-settings").on("click","[data-action]",function(){switch($(this).attr("data-action")){case"follow":{const l=$("#syncing-add").val();(0,u.put)(`/categories/${ajaxify.data.cid}/follow`,{actor:l}).then(ajaxify.refresh).catch(g.error);break}case"unfollow":{const l=$(this).attr("data-actor");(0,u.del)(`/categories/${ajaxify.data.cid}/follow`,{actor:l}).then(ajaxify.refresh).catch(g.error);break}case"autofill":{const l=$(this).parents("[data-uid]").attr("data-uid");$("#syncing-add").val(l)}}})}},96349:(D,y,o)=>{var u,g;u=[o(29930),o(89336),o(49897)],g=function(C,w,p){const d={};return d.init=function(l,e){let c=e.defaultCategories||null;e=e||{},e.privilege=e.privilege||"topics:read",e.states=e.states||["watching","tracking","notwatching","ignoring"],e.cacheList=e.hasOwnProperty("cacheList")?e.cacheList:!0;let f=[];Array.isArray(e.localCategories)&&(f=e.localCategories.map(r=>({...r})),c&&(c=[...f,...c])),e.selectedCids=e.selectedCids||ajaxify.data.selectedCids||[];const n=l.find('[component="category-selector-search"]');if(!n.length)return;const h=n.parents('[component="category/dropdown"]').length>0||n.parents('[component="category-selector"]').length>0;l.on("show.bs.dropdown",function(){h&&n.removeClass("hidden");function r(){const a=n.find("input").val();a.length>1||!a&&!c?i(a,function(s){c=e.cacheList&&(c||s),t(s)}):!a&&c&&t(c)}n.on("click",function(a){a.preventDefault(),a.stopPropagation()}),n.find("input").val("").on("keyup",utils.debounce(r,300)),r()}),l.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||n.find("input").focus()}),l.on("hide.bs.dropdown",function(){h&&n.addClass("hidden"),n.off("click"),n.find("input").off("keyup")});function i(r,a){p.get("/search/categories",{search:r,query:utils.params(),parentCid:e.parentCid||0,selectedCids:e.selectedCids,privilege:e.privilege,states:e.states,showLinks:e.showLinks},function(s,{categories:E}){if(s)return C.error(s);a(f.concat(E))})}function t(r){const a=e.selectedCids.map(String);r.forEach(function(s){s.selected=a.includes(String(s.cid))}),app.parseAndTranslate(e.template,{categoryItems:r.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(s){l.find('[component="category/list"]').html(s.find('[component="category/list"]').html()),l.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!r.length);const E=w.Dropdown.getInstance(l.find(".dropdown-toggle").get(0));E&&E.update()})}},d}.apply(y,u),g!==void 0&&(D.exports=g)}}]);
