"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,69185,86198,90479,99127],{29195:(w,x,d)=>{var E,b;E=[d(17459),d(81335),d(65348),d(49897),d(10246),d(33530),d(29930)],b=function(A,D,v,h,u,a,i){u=u.default;const s={};let o=-1,p;s.init=function(){v.init($('[component="category-selector"]'),{parentCid:ajaxify.data.selectedCategory?ajaxify.data.selectedCategory.cid:0,onSelect:function(t){ajaxify.go("/admin/manage/categories"+(t.cid?"?cid="+t.cid:""))},cacheList:!1,localCategories:[],template:"admin/partials/category/selector-dropdown-right"}),s.render(ajaxify.data.categoriesTree),$('button[data-action="create"]').on("click",s.throwCreateModal),$(".categories").on("click",'.category-tools [data-action="toggle"]',function(){const t=$(this),c=t.attr("data-disable-cid"),g=t.parents('li[data-cid="'+c+'"]'),l=g.hasClass("disabled"),f=g.find("li[data-cid]").map(function(){return $(this).attr("data-cid")}).get();s.toggle([c].concat(f),!l)}),$(".categories").on("click",".toggle",function(){const t=$(this);t.find("i").toggleClass("fa-chevron-down").toggleClass("fa-chevron-right"),t.closest("[data-cid]").find("> ul[data-cid]").toggleClass("hidden");const c=t.closest("[data-cid]").find("> ul.has-more-categories");parseInt(c.attr("data-hasmore"),10)===1&&c.toggleClass("hidden")}),$(".categories").on("click",".set-order",function(){const t=$(this).attr("data-cid"),c=$(this).attr("data-order"),g=a.dialog({title:"[[admin/manage/categories:set-order]]",message:'<input type="number" min="1" class="form-control input-lg" value='+c+' /><p class="form-text">[[admin/manage/categories:set-order-help]]</p>',show:!0,buttons:{save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:function(){const l=g.find("input").val();if(l&&t){const y={};y[t]={order:Math.max(1,parseInt(l,10))},h.put("/categories/"+t,y[t]).then(function(){ajaxify.refresh()}).catch(i.error)}else return!1}}}})}),$("#toggle-collapse-all").on("click",function(){const t=$(this),c=parseInt(t.attr("data-collapsed"),10)===1;e(c),t.attr("data-collapsed",c?0:1).translateText(c?"[[admin/manage/categories:collapse-all]]":"[[admin/manage/categories:expand-all]]")});function e(t){const c=$(".categories .toggle");c.find("i").toggleClass("fa-chevron-down",t).toggleClass("fa-chevron-right",!t),c.closest("[data-cid]").find("> ul[data-cid]").toggleClass("hidden",!t)}},s.throwCreateModal=function(){D.render("admin/partials/categories/create",{}).then(function(e){const t=a.dialog({title:"[[admin/manage/categories:alert.create]]",message:e,buttons:{save:{label:"[[global:create]]",className:"btn-primary",callback:y}}}),c={localCategories:[{cid:0,name:"[[admin/manage/categories:parent-category-none]]",icon:"fa-none"}],template:"admin/partials/category/selector-dropdown-left"},g=v.init(t.find('#parentCidGroup [component="category-selector"]'),c),l=v.init(t.find('#cloneFromCidGroup [component="category-selector"]'),c);function y(){const f=t.find("form").serializeObject();return f.description="",f.icon="fa-comments",f.uid=app.user.uid,f.parentCid=g.getSelectedCid(),f.cloneFromCid=l.getSelectedCid(),s.create(f),t.modal("hide"),!1}$("#cloneChildren").on("change",function(){const f=$(this),C=t.find('#parentCidGroup [component="category-selector"] .dropdown-toggle');f.prop("checked")?(C.attr("disabled","disabled"),g.selectCategory(0)):C.removeAttr("disabled")}),t.find("form").on("submit",y)})},s.create=function(e){h.post("/categories",e,function(t,c){if(t)return i.error(t);i.alert({alert_id:"category_created",title:"[[admin/manage/categories:alert.created]]",message:"[[admin/manage/categories:alert.create-success]]",type:"success",timeout:2e3}),ajaxify.go("admin/manage/categories/"+c.cid)})},s.render=function(e){const t=$(".categories");!e||!e.length?A.translate("[[admin/manage/categories:alert.none-active]]",function(c){$("<div></div>").addClass("alert alert-info text-center").text(c).appendTo(t)}):(p={},r(e,t,{cid:0}))},s.toggle=function(e,t){const c=document.querySelector('.categories [data-cid="0"]');Promise.all(e.map(g=>h.put("/categories/"+g,{disabled:t?1:0}).then(()=>{const l=c.querySelector(`li[data-cid="${g}"]`);l.classList[t?"add":"remove"]("disabled"),$(l).find('li a[data-action="toggle"]').first().translateText(t?"[[admin/manage/categories:enable]]":"[[admin/manage/categories:disable]]")}).catch(i.error)))};function m(e){o=e.to.dataset.cid}function n(e){const t=parseInt(o,10)!==-1;if(e.newIndex!=null&&parseInt(e.oldIndex,10)!==parseInt(e.newIndex,10)||t){const c=e.item.dataset.cid,g={},l=(ajaxify.data.pagination.currentPage-1)*ajaxify.data.categoriesPerPage;if(g[c]={order:l+e.newIndex+1},t){g[c].parentCid=o;const y=parseInt(e.from.getAttribute("data-cid"),10),f=parseInt(e.to.getAttribute("data-cid"),10);if(y!==f){const C=document.querySelector(`.categories li[data-cid="${f}"] .toggle`);if(C&&C.classList.toggle("invisible",!1),!document.querySelectorAll(`.categories li[data-cid="${y}"] ul[data-cid] li[data-cid]`).length){const P=document.querySelector(`.categories li[data-cid="${y}"] .toggle`);P&&P.classList.toggle("invisible",!0)}e.item.dataset.parentCid=f}}o=-1,h.put("/categories/"+c,g[c]).catch(i.error)}}function r(e,t,c){let g=0;const l=c.cid;e.forEach(function(f,C,S){A.translate(f.name,function(P){f.name!==P&&(f.name=P),g+=1,g===S.length&&y()})}),e.length||y();function y(){app.parseAndTranslate("admin/partials/categories/category-rows",{cid:c.cid,categories:e,parentCategory:c},function(f){t.find(".category-row").length?t.find(".category-row").after(f):t.append(f),e.length||t.get(0).querySelector(".toggle").classList.toggle("invisible",!0);for(let C=0,S=e.length;C<S;C+=1)r(e[C].children,$('li[data-cid="'+e[C].cid+'"]'),e[C]);p[l]=u.create($('ul[data-cid="'+l+'"]')[0],{group:"cross-categories",animation:150,handle:".information",dataIdAttr:"data-cid",ghostClass:"placeholder",onAdd:m,onEnd:n})})}}return s}.apply(x,E),b!==void 0&&(w.exports=b)},49897:(w,x,d)=>{d.r(x),d.d(x,{del:()=>m,get:()=>a,head:()=>i,patch:()=>o,post:()=>s,put:()=>p});var E=d(91749),b=d.n(E),A=d(33530),D=d.n(A);const v=config.relative_path+"/api/v3";async function h(n,r){if(n.url=n.url.startsWith("/api")?config.relative_path+n.url:v+n.url,typeof r=="function"){u(n).then(e=>r(null,e),e=>r(e));return}try{return await u(n)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again."){const{url:t}=await(0,E.fire)("filter:admin.reauth",{url:"login"});return(0,A.confirm)("[[error:api.reauth-required]]",c=>{c&&ajaxify.go(t)})}throw e}}async function u(n){const{url:r}=n;delete n.url,n.data&&!(n.data instanceof FormData)&&(n.data=JSON.stringify(n.data||{}),n.headers["content-type"]="application/json; charset=utf-8"),{options:n}=await(0,E.fire)("filter:api.options",{options:n}),n.data&&(n.body=n.data,delete n.data);const e=await fetch(r,n),{headers:t}=e;if(t.get("x-redirect"))return u({url:t.get("x-redirect"),...n});const c=t.get("content-type"),g=c&&c.startsWith("application/json");let l;if(n.method!=="HEAD"&&(g?l=await e.json():l=await e.text()),!e.ok)throw l?new Error(g?l.status.message:l):new Error(e.statusText);return g&&l&&l.hasOwnProperty("status")&&l.hasOwnProperty("response")?l.response:l}function a(n,r,e){return h({url:n+(r&&Object.keys(r).length?"?"+$.param(r):"")},e)}function i(n,r,e){return h({url:n+(r&&Object.keys(r).length?"?"+$.param(r):""),method:"HEAD"},e)}function s(n,r,e){return h({url:n,method:"POST",data:r,headers:{"x-csrf-token":config.csrf_token}},e)}function o(n,r,e){return h({url:n,method:"PATCH",data:r,headers:{"x-csrf-token":config.csrf_token}},e)}function p(n,r,e){return h({url:n,method:"PUT",data:r,headers:{"x-csrf-token":config.csrf_token}},e)}function m(n,r,e){return h({url:n,method:"DELETE",data:r,headers:{"x-csrf-token":config.csrf_token}},e)}},65348:(w,x,d)=>{var E,b;E=[d(96349),d(33530),d(91749),d(17459)],b=function(A,D,v,h){const u={};return u.init=function(a,i){if(!a||!a.length)return;i=i||{};const s=i.onSelect||function(){};i.states=i.states||["watching","tracking","notwatching","ignoring"],i.template=i.template||"partials/category/selector-dropdown-left",v.fire("action:category.selector.options",{el:a,options:i}),A.init(a,i);const o={el:a,selectedCategory:null};a.on("click","[data-cid]",function(){const m=$(this);return m.hasClass("disabled")?!1:(o.selectCategory(m.attr("data-cid")),s(o.selectedCategory))});let p=o.el.find('[component="category-selector-selected"]').html();return h.translate(p,m=>{p=m}),o.selectCategory=function(m){const n=o.el.find('[data-cid="'+m+'"]');o.selectedCategory={cid:m,name:n.attr("data-name")},n.length?o.el.find('[component="category-selector-selected"]').html(n.find('[component="category-markup"]').html()):o.el.find('[component="category-selector-selected"]').html(p)},o.getSelectedCategory=function(){return o.selectedCategory},o.getSelectedCid=function(){return o.selectedCategory?o.selectedCategory.cid:0},i.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(i.template,{selectedCategory:i.selectedCategory},function(m){o.el.find('[component="category-selector-selected"]').html(m.find('[component="category-selector-selected"]').html())}),o},u.modal=function(a){a=a||{},a.onSelect=a.onSelect||function(){},a.onSubmit=a.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:a.message},function(i){const s=D.dialog({title:a.title||"[[modules:composer.select-category]]",message:i,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:p}}}),o=u.init(s.find('[component="category-selector"]'),a);function p(m){return m.preventDefault(),o.selectedCategory&&(a.onSubmit(o.selectedCategory),s.modal("hide")),!1}a.openOnLoad&&s.on("shown.bs.modal",function(){s.find(".dropdown-toggle").dropdown("toggle")}),s.find("form").on("submit",p)})},u}.apply(x,E),b!==void 0&&(w.exports=b)},96349:(w,x,d)=>{var E,b;E=[d(29930),d(89336),d(49897)],b=function(A,D,v){const h={};return h.init=function(u,a){let i=a.defaultCategories||null;a=a||{},a.privilege=a.privilege||"topics:read",a.states=a.states||["watching","tracking","notwatching","ignoring"],a.cacheList=a.hasOwnProperty("cacheList")?a.cacheList:!0;let s=[];Array.isArray(a.localCategories)&&(s=a.localCategories.map(r=>({...r})),i&&(i=[...s,...i])),a.selectedCids=a.selectedCids||ajaxify.data.selectedCids||[];const o=u.find('[component="category-selector-search"]');if(!o.length)return;const p=o.parents('[component="category/dropdown"]').length>0||o.parents('[component="category-selector"]').length>0;u.on("show.bs.dropdown",function(){p&&o.removeClass("hidden");function r(){const e=o.find("input").val();e.length>1||!e&&!i?m(e,function(t){i=a.cacheList&&(i||t),n(t)}):!e&&i&&n(i)}o.on("click",function(e){e.preventDefault(),e.stopPropagation()}),o.find("input").val("").on("keyup",utils.debounce(r,300)),r()}),u.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||o.find("input").focus()}),u.on("hide.bs.dropdown",function(){p&&o.addClass("hidden"),o.off("click"),o.find("input").off("keyup")});function m(r,e){v.get("/search/categories",{search:r,query:utils.params(),parentCid:a.parentCid||0,selectedCids:a.selectedCids,privilege:a.privilege,states:a.states,showLinks:a.showLinks},function(t,{categories:c}){if(t)return A.error(t);e(s.concat(c))})}function n(r){const e=a.selectedCids.map(String);r.forEach(function(t){t.selected=e.includes(String(t.cid))}),app.parseAndTranslate(a.template,{categoryItems:r.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(t){u.find('[component="category/list"]').html(t.find('[component="category/list"]').html()),u.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!r.length);const c=D.Dropdown.getInstance(u.find(".dropdown-toggle").get(0));c&&c.update()})}},h}.apply(x,E),b!==void 0&&(w.exports=b)}}]);
