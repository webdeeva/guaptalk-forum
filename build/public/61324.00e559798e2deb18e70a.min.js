(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[61324],{61324:(m,L,v)=>{"use strict";v.r(L),v.d(L,{buildAliasMap:()=>E,capturePaste:()=>I,enhanceCheckbox:()=>B,highlight:()=>w,markExternalLinks:()=>M,prepareFormattingTools:()=>A});function I(s){s.on("paste",function(a){var c=[/^>\s*/,/^\s*\*\s+/,/^\s*\d+\.\s+/,/^\s{4,}/],l=a.target.selectionStart,g=d(s.val(),l),n=c.reduce(function(f,N){return f||(N.test(g)?N:!1)},!1),i=g.match(n);if(i){i=i.shift();var r=a.originalEvent.clipboardData.getData("text"),o=r.replace(/^/gm,i).slice(i.length);setTimeout(function(){var f=s.val().slice(0,l)+o+s.val().slice(l+r.length);s.val(f)},0)}});function d(a,c){var l=a.split(`
`);return l.reduce(function(g,n){return typeof g!="number"?g:c>g+n.length?g+n.length+1:n},0)}}function A(){Promise.all([v.e(23662),v.e(65285),v.e(449),v.e(34670)]).then(function(){var s=[v(449),v(26940),v(17459)];(function(d,a,c){d&&a&&c.getTranslations(window.config.userLang||window.config.defaultLang,"markdown",function(l){function g(n,i,r,o){if(r===o)a.insertIntoTextarea(i,`${n} ${l.heading}`),a.updateTextareaSelection(i,r+n.length+1,r+l.heading.length+n.length+1);else{const f=$(i).val().substring(r,o),N=`${n} ${f}`;a.replaceSelectionInTextareaWith(i,N),a.updateTextareaSelection(i,r+(n.length+1),o+(N.length-f.length))}}d.addButtonDispatch("bold",function(n,i,r){if(i===r){var o=a.getBlockData(n,"**",i);o.in&&o.atEnd?a.updateTextareaSelection(n,i+2,i+2):(a.insertIntoTextarea(n,"**"+l.bold+"**"),a.updateTextareaSelection(n,i+2,i+l.bold.length+2))}else{var f=a.wrapSelectionInTextareaWith(n,"**");a.updateTextareaSelection(n,i+2+f[0],r+2-f[1])}}),d.addButtonDispatch("italic",function(n,i,r){if(i===r){var o=a.getBlockData(n,"*",i);o.in&&o.atEnd?a.updateTextareaSelection(n,i+1,i+1):(a.insertIntoTextarea(n,"*"+l.italic+"*"),a.updateTextareaSelection(n,i+1,i+l.italic.length+1))}else{var f=a.wrapSelectionInTextareaWith(n,"*");a.updateTextareaSelection(n,i+1+f[0],r+1-f[1])}}),[1,2,3,4,5,6].forEach(n=>{d.addButtonDispatch(`heading${n}`,function(i,r,o){g(new Array(n).fill("#").join(""),i,r,o)})}),d.addButtonDispatch("list",function(n,i,r){if(i===r)a.insertIntoTextarea(n,`
* `+l["list-item"]),a.updateTextareaSelection(n,i+3,i+l["list-item"].length+3);else{const o=$(n).val().substring(i,r),f="* "+o.split(`
`).join(`
* `);a.replaceSelectionInTextareaWith(n,f),a.updateTextareaSelection(n,i+2,r+(f.length-o.length))}}),d.addButtonDispatch("strikethrough",function(n,i,r){if(i===r){var o=a.getBlockData(n,"~~",i);o.in&&o.atEnd?a.updateTextareaSelection(n,i+2,i+2):(a.insertIntoTextarea(n,"~~"+l["strikethrough-text"]+"~~"),a.updateTextareaSelection(n,i+2,r+l["strikethrough-text"].length+2))}else{var f=a.wrapSelectionInTextareaWith(n,"~~","~~");a.updateTextareaSelection(n,i+2+f[0],r+2-f[1])}}),d.addButtonDispatch("code",function(n,i,r){if(i===r)a.insertIntoTextarea(n,"```\n"+l["code-text"]+"\n```"),a.updateTextareaSelection(n,i+4,r+l["code-text"].length+4);else{var o=a.wrapSelectionInTextareaWith(n,"```\n","\n```");a.updateTextareaSelection(n,i+4+o[0],r+4-o[1])}}),d.addButtonDispatch("link",function(n,i,r){if(i===r)a.insertIntoTextarea(n,"["+l["link-text"]+"]("+l["link-url"]+")"),a.updateTextareaSelection(n,i+l["link-text"].length+3,r+l["link-text"].length+l["link-url"].length+3);else{var o=a.wrapSelectionInTextareaWith(n,"[","]("+l["link-url"]+")");a.updateTextareaSelection(n,r+3-o[1],r+l["link-url"].length+3-o[1])}}),d.addButtonDispatch("picture-o",function(n,i,r){if(i===r)a.insertIntoTextarea(n,"!["+l["picture-text"]+"]("+l["picture-url"]+")"),a.updateTextareaSelection(n,i+l["picture-text"].length+4,r+l["picture-text"].length+l["picture-url"].length+4);else{var o=a.wrapSelectionInTextareaWith(n,"![","]("+l["picture-url"]+")");a.updateTextareaSelection(n,r+4-o[1],r+l["picture-url"].length+4-o[1])}})})}).apply(null,s)}).catch(v.oe)}function M(){if(!config.markdown.externalMark)return;document.querySelectorAll('[component="post/content"] a').forEach(d=>{if(d.childElementCount===1&&d.querySelector("img")&&!d.text)return;if(new URL(d.href,document.location.href).host!=document.location.host){const c=document.createElement("i");c.classList.add("fa","fa-external-link","small"),d.append(" ",c)}})}function B(s,d){if(!(!d.posts&&!d.post)){d.hasOwnProperty("post")&&(d.posts=[d.post]);var a,c;d.posts.forEach(function(l){a=!l.display_edit_tools,c=$('.posts li[data-pid="'+l.pid+'"] .content div.plugin-markdown input[type="checkbox"]'),c.on("click",function(g){a&&g.preventDefault();var n=this,i=$(this).parents("li[data-pid]").attr("data-pid"),r=$(this).parents(".content").find('input[type="checkbox"]').toArray().reduce(function(o,f,N){return f===n&&(o=N),o},null);socket.emit("plugins.markdown.checkbox.edit",{pid:i,index:r,state:$(n).prop("checked")})})})}}function w(s){s instanceof jQuery.Event?x($(s.data.selector)):x(s)}const b=new Map;function E(){if(window.hljs){const s=window.hljs;s.listLanguages().forEach(d=>{const{aliases:a}=s.getLanguage(d);a&&Array.isArray(a)&&a.forEach(c=>{b.set(c,d)}),b.set(d,d)})}}async function x(s){if(parseInt(config.markdown.highlight,10)){if(!window.hljs){console.debug("[plugins/markdown] Tryin to highlight without initializing hljs");return}console.debug("[plugins/markdown] Loading support for line numbers"),v(85079),s.each(function(a,c){const l=$(c.parentNode);if(l.hasClass("markdown-highlight"))return;l.addClass("markdown-highlight"),!Array.prototype.some.call(c.classList,n=>n.startsWith("language-"))&&config.markdown.defaultHighlightLanguage&&c.classList.add(`language-${config.markdown.defaultHighlightLanguage}`),window.hljs.highlightElement(c);const g=c.classList.values();for(const n of g)if(n.startsWith("language-")){const i=n.split("-")[1],r=config.markdown.highlightLinesLanguageList;b.has(i)&&r&&r.includes(b.get(i))&&($(c).attr("data-lines",1),window.hljs.lineNumbersBlock(c));break}})}}},85079:()=>{(function(m,L){"use strict";var v="hljs-ln",I="hljs-ln-line",A="hljs-ln-code",M="hljs-ln-numbers",B="hljs-ln-n",w="data-line-number",b=/\r\n|\r|\n/g;m.hljs?(m.hljs.initLineNumbersOnLoad=a,m.hljs.lineNumbersBlock=g,m.hljs.lineNumbersBlockSync=n,m.hljs.lineNumbersValue=i,d()):m.console.error("highlight.js not detected!");function E(e){for(var t=e;t;){if(t.className&&t.className.indexOf("hljs-ln-code")!==-1)return!0;t=t.parentNode}return!1}function x(e){for(var t=e;t.nodeName!=="TABLE";)t=t.parentNode;return t}function s(e){for(var t=e.toString(),u=e.anchorNode;u.nodeName!=="TD";)u=u.parentNode;for(var h=e.focusNode;h.nodeName!=="TD";)h=h.parentNode;var p=parseInt(u.dataset.lineNumber),T=parseInt(h.dataset.lineNumber);if(p!=T){var y=u.textContent,j=h.textContent;if(p>T){var C=p;p=T,T=C,C=y,y=j,j=C}for(;t.indexOf(y)!==0;)y=y.slice(1);for(;t.lastIndexOf(j)===-1;)j=j.slice(0,-1);for(var D=y,V=x(u),O=p+1;O<T;++O){var G=k('.{0}[{1}="{2}"]',[A,w,O]),Q=V.querySelector(G);D+=`
`+Q.textContent}return D+=`
`+j,D}else return t}document.addEventListener("copy",function(e){var t=window.getSelection();if(E(t.anchorNode)){var u;window.navigator.userAgent.indexOf("Edge")!==-1?u=s(t):u=t.toString(),e.clipboardData.setData("text/plain",u),e.preventDefault()}});function d(){var e=L.createElement("style");e.type="text/css",e.innerHTML=k(".{0}{border-collapse:collapse}.{0} td{padding:0}.{1}:before{content:attr({2})}",[v,B,w]),L.getElementsByTagName("head")[0].appendChild(e)}function a(e){L.readyState==="interactive"||L.readyState==="complete"?c(e):m.addEventListener("DOMContentLoaded",function(){c(e)})}function c(e){try{var t=L.querySelectorAll("code.hljs,code.nohighlight");for(var u in t)t.hasOwnProperty(u)&&(l(t[u])||g(t[u],e))}catch(h){m.console.error("LineNumbers error: ",h)}}function l(e){return e.classList.contains("nohljsln")}function g(e,t){typeof e=="object"&&P(function(){e.innerHTML=r(e,t)})}function n(e,t){typeof e=="object"&&(e.innerHTML=r(e,t))}function i(e,t){if(typeof e=="string"){var u=document.createElement("code");return u.innerHTML=e,r(u,t)}}function r(e,t){var u=f(e,t);return S(e),o(e.innerHTML,u)}function o(e,t){var u=F(e);if(u[u.length-1].trim()===""&&u.pop(),u.length>1||t.singleLine){for(var h="",p=0,T=u.length;p<T;p++)h+=k('<tr><td class="{0} {1}" {3}="{5}"><div class="{2}" {3}="{5}"></div></td><td class="{0} {4}" {3}="{5}">{6}</td></tr>',[I,M,B,w,A,p+t.startFrom,u[p].length>0?u[p]:" "]);return k('<table class="{0}">{1}</table>',[v,h])}return e}function f(e,t){return t=t||{},{singleLine:N(t),startFrom:H(e,t)}}function N(e){var t=!1;return e.singleLine?e.singleLine:t}function H(e,t){var u=1,h=u;isFinite(t.startFrom)&&(h=t.startFrom);var p=K(e,"data-ln-start-from");return p!==null&&(h=U(p,u)),h}function S(e){var t=e.childNodes;for(var u in t)if(t.hasOwnProperty(u)){var h=t[u];W(h.textContent)>0&&(h.childNodes.length>0?S(h):R(h.parentNode))}}function R(e){var t=e.className;if(/hljs-/.test(t)){for(var u=F(e.innerHTML),h=0,p="";h<u.length;h++){var T=u[h].length>0?u[h]:" ";p+=k(`<span class="{0}">{1}</span>
`,[t,T])}e.innerHTML=p.trim()}}function F(e){return e.length===0?[]:e.split(b)}function W(e){return(e.trim().match(b)||[]).length}function P(e){m.setTimeout(e,0)}function k(e,t){return e.replace(/\{(\d+)\}/g,function(u,h){return t[h]!==void 0?t[h]:u})}function K(e,t){return e.hasAttribute(t)?e.getAttribute(t):null}function U(e,t){if(!e)return t;var u=Number(e);return isFinite(u)?u:t}})(window,document)}}]);
