(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[4347,56382,68783,98772],{28721:(T,b,u)=>{"use strict";var w,h;w=[u(29930)],h=function(d){var g={},x,y;g.init=function(n,r){var e=n.find(".tags");if(e.length){x=ajaxify.data.hasOwnProperty("minTags")?ajaxify.data.minTags:config.minimumTagsPerTopic,y=ajaxify.data.hasOwnProperty("maxTags")?ajaxify.data.maxTags:config.maximumTagsPerTopic,e.tagsinput({tagClass:"badge bg-info rounded-1",confirmKeys:[13,44],trimValue:!0});var a=n.find(".bootstrap-tagsinput input");p(n,r,ajaxify.data),app.loadJQueryUI(function(){a.autocomplete({delay:100,position:{my:"left bottom",at:"left top",collision:"flip"},appendTo:n.find(".bootstrap-tagsinput"),open:function(){$(this).autocomplete("widget").css("z-index",2e4)},source:function(t,o){socket.emit("topics.autocompleteTags",{query:t.term,cid:r.cid},function(c,f){if(c)return d.error(c);f&&o(f),$(".ui-autocomplete a").attr("data-ajaxify","false")})},select:function(){s(a)}}),A(r.tags,e),e.on("beforeItemAdd",function(t){var o=y&&y<=g.getTags(n.attr("data-uuid")).length,c=utils.cleanUpTag(t.item,config.maximumTagLength),f=c!==t.item;if(t.cancel=f||t.item.length<config.minimumTagLength||t.item.length>config.maximumTagLength||o,t.item.length<config.minimumTagLength)return d.error("[[error:tag-too-short, "+config.minimumTagLength+"]]");if(t.item.length>config.maximumTagLength)return d.error("[[error:tag-too-long, "+config.maximumTagLength+"]]");if(o)return d.error("[[error:too-many-tags, "+y+"]]");var v=r.hasOwnProperty("cid")?r.cid:ajaxify.data.cid;$(window).trigger("action:tag.beforeAdd",{cid:v,tagEl:e,tag:t.item,event:t,inputAutocomplete:a}),f&&e.tagsinput("add",c),t.cancel&&a.length&&a.autocomplete("close")}),e.on("itemRemoved",function(t){!t.item||t.options&&t.options.skipRemoveCheck||socket.emit("topics.canRemoveTag",{tag:t.item},function(o,c){if(o)return d.error(o);c||(d.error("[[error:cant-remove-system-tag]]"),e.tagsinput("add",t.item,{skipAddCheck:!0}))})}),e.on("itemAdded",function(t){if(!(t.options&&t.options.skipAddCheck)){var o=r.hasOwnProperty("cid")?r.cid:ajaxify.data.cid;socket.emit("topics.isTagAllowed",{tag:t.item,cid:o||0},function(c,f){if(c)return d.error(c);if(!f)return e.tagsinput("remove",t.item,{skipRemoveCheck:!0});$(window).trigger("action:tag.added",{cid:o,tagEl:e,tag:t.item,inputAutocomplete:a}),a.length&&a.autocomplete("close")})}})}),a.attr("tabIndex",e.attr("tabIndex")),a.on("blur",function(){s(a)}),$('[component="composer/tag/dropdown"]').on("click","li",function(){var t=$(this).attr("data-tag");return t&&A([t],e),!1})}},g.isEnoughTags=function(n){return g.getTags(n).length>=x},g.minTagCount=function(){return x},g.onChangeCategory=function(n,r,e,a){var t=n.find('[component="composer/tag/dropdown"]');t.length&&(p(n,r,a),t.toggleClass("hidden",!a.tagWhitelist||!a.tagWhitelist.length),a.tagWhitelist&&app.parseAndTranslate("composer","tagWhitelist",{tagWhitelist:a.tagWhitelist},function(o){t.find(".dropdown-menu").html(o)}))};function p(n,r,e){var a=n.find(".tags"),t=n.find(".bootstrap-tagsinput input");t.length&&(e.hasOwnProperty("minTags")&&(x=e.minTags),e.hasOwnProperty("maxTags")&&(y=e.maxTags),e.tagWhitelist&&e.tagWhitelist.length?(t.attr("readonly",""),t.attr("placeholder",""),a.tagsinput("items").slice().forEach(function(o){e.tagWhitelist.indexOf(o)===-1&&a.tagsinput("remove",o)})):(t.removeAttr("readonly"),t.attr("placeholder",n.find("input.tags").attr("placeholder"))),n.find(".tags-container").toggleClass("haswhitelist",!!(e.tagWhitelist&&e.tagWhitelist.length)),n.find(".tags-container").toggleClass("hidden",e.privileges&&e.privileges.hasOwnProperty("topics:tag")&&!e.privileges["topics:tag"]||y===0&&!r&&!r.tags&&!r.tags.length),e.privileges&&e.privileges.hasOwnProperty("topics:tag")&&!e.privileges["topics:tag"]&&a.tagsinput("removeAll"),$(window).trigger("action:tag.toggleInput",{postContainer:n,tagWhitelist:e.tagWhitelist,tagsInput:t}))}function s(n){var r=jQuery.Event("keypress");r.which=13,r.keyCode=13,setTimeout(function(){n.trigger(r)},100)}function A(n,r){if(n&&n.length)for(var e=0;e<n.length;++e)r.tagsinput("add",n[e])}return g.getTags=function(n){return $('.composer[data-uuid="'+n+'"] .tags').tagsinput("items")},g}.apply(b,w),h!==void 0&&(T.exports=h)},52543:(T,b,u)=>{T.exports=u(28721)},59367:(T,b,u)=>{"use strict";var w,h;w=[u(81335),u(33530),u(29930),u(17459)],h=function(d,g,x,y){const p={},s={timestamp:0,open:!1,edit:!1,posts:{}};let A=[],n,r,e,a;const t={el:null,defaultText:"",activeText:""},o={el:null,icon:null,defaultText:"",activeText:""};let c,f;$(window).on("action:composer.activate",W),p.init=function(i,l){s.timestamp=0,s.posts=l,y.translateKeys(["[[topic:composer.post-later]]","[[modules:composer.change-schedule-date]]"]).then(m=>{t.defaultText=m[0],t.activeText=m[1]}),A=i[0].querySelectorAll(".display-scheduler"),n=i[0].querySelectorAll(".display-scheduler i"),t.el=i[0].querySelector(".dropdown-item.display-scheduler"),r=i[0].querySelector(".dropdown-item.cancel-scheduling"),e=i.find('[component="composer/submit/container"]'),a=i.find('[component="composer/submit/options/container"]'),o.el=i[0].querySelector(".composer-submit:not(.btn-sm)"),o.icon=o.el.querySelector("i"),o.defaultText=o.el.lastChild.textContent,o.activeText=o.el.getAttribute("data-text-variant"),r.addEventListener("click",E),A.forEach(m=>m.addEventListener("click",v))},p.getTimestamp=function(){return!p.isActive()||isNaN(s.timestamp)?0:s.timestamp},p.isActive=function(){return s.timestamp>0},p.isOpen=function(){return s.open},p.reset=function(){s.timestamp=0},p.onChangeCategory=function(i){O(i.privileges["topics:schedule"]),_(!1);const l=i.privileges["topics:schedule"]||a.attr("data-submit-options")>0;e.find(".composer-submit").toggleClass("rounded-1",!l),a.toggleClass("hidden",!l),p.reset()};async function v(){const i=await d.render("modals/topic-scheduler");g.dialog({message:i,title:"[[modules:composer.schedule-for]]",className:"topic-scheduler",onShown:k,onHidden:C,onEscape:!0,buttons:{cancel:{label:s.timestamp?"[[modules:composer.cancel-scheduling]]":"[[modules:bootbox.cancel]]",className:(s.timestamp?"btn-warning":"btn-outline-secondary")+(s.edit?" hidden":""),callback:E},set:{label:"[[modules:composer.set-schedule-date]]",className:"btn-primary",callback:L}}})}function k(i){s.open=!0;const l=i.target.querySelector(".datetime-picker");c=l.querySelector('input[type="date"]'),f=l.querySelector('input[type="time"]'),I()}function C(){s.open=!1}function W(i,{post_uuid:l}){s.edit=!1;const m=s.posts[l];m&&m.isMain&&m.timestamp>Date.now()&&(s.timestamp=m.timestamp,s.edit=!0,_())}function I(){const i=new Date,l=new Date(i.getTime()-i.getTimezoneOffset()*6e4).toJSON();if(c.setAttribute("min",l.slice(0,10)),f.setAttribute("min",l.slice(11,-8)),p.isActive()){const m=new Date(s.timestamp-i.getTimezoneOffset()*6e4).toJSON();c.value=m.slice(0,10),f.value=m.slice(11,-8)}}function L(){const i=c.value&&f.value,l=new Date(`${c.value} ${f.value}`).getTime();if(!i||isNaN(l)||l<Date.now()){s.timestamp=0;const m=l<Date.now()?"[[error:scheduling-to-past]]":"[[error:invalid-schedule-date]]";return x.alert({type:"danger",timeout:3e3,title:"",alert_id:"post_error",message:m}),!1}s.timestamp||_(!0),s.timestamp=l}function E(){s.timestamp&&(_(!1),s.timestamp=0)}function _(i=!0){n.forEach(l=>l.classList.toggle("active",i)),o.icon&&(o.icon.classList.toggle("fa-check",!i),o.icon.classList.toggle("fa-clock-o",i)),t.el&&(t.el.textContent=i?t.activeText:t.defaultText,r.classList.toggle("hidden",!i)),o.el.lastChild.textContent=i?o.activeText:o.defaultText}function O(i){A.forEach(l=>l.classList.toggle("hidden",!i))}return p}.apply(b,w),h!==void 0&&(T.exports=h)},72573:(T,b,u)=>{T.exports=u(59367)},92762:(T,b,u)=>{T.exports=u(94252)},94252:(T,b)=>{"use strict";var u,w;u=[],w=function(){const h={};return h.showAlert=async function(d,g){const x=d.find('[component="composer/post-queue/alert"]');if(!config.postQueue||app.user.isAdmin||app.user.isGlobalMod||app.user.isMod){x.remove();return}const y=await socket.emit("plugins.composer.shouldQueue",{postData:g});x.toggleClass("show",y),x.toggleClass("pe-none",!y)},h.onChangeCategory=async function(d,g){config.postQueue&&h.showAlert(d,g)},h}.apply(b,u),w!==void 0&&(T.exports=w)}}]);
