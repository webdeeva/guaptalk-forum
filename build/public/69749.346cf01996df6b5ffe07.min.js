"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[69749],{69749:(q,k,g)=>{var E,x;E=[g(17459),g(68636),g(91749),g(29930),g(89336)],x=function(O,b,d,w,j){const r={current:{}};r.init=function(e){if(!config.searchEnabled)return;e=e||{in:config.searchDefaultInQuick||"titles"},$('[component="search/form"]').each((t,n)=>{S($(n),e)})};function S(e,s){const t=e.find('[component="search/button"]'),n=e.find('[component="search/fields"]'),i=n.find('input[name="query"]'),u=n.find("#quick-search-container"),h=n.hasClass("hidden"),o=/^(@|acct:)?[\w-]+@.+$/;h&&n.off("focusout").on("focusout",function(){setTimeout(function(){n.find(":focus").length||(n.addClass("hidden"),t.removeClass("hidden"))},200)}),i.off("focus");const p={inputEl:i,resultEl:u};r.enableQuickSearch({searchOptions:s,searchElements:p}),t.off("click").on("click",function(f){return!config.loggedIn&&!app.user.privileges["search:content"]?(w.alert({message:"[[error:search-requires-login]]",timeout:3e3}),ajaxify.go("login"),!1):(f.stopPropagation(),r.showAndFocusInput(e),!1)}),e.off("submit").on("submit",function(){const f=$(this).find('input[name="query"]'),l=r.getSearchPreferences();return l.term=f.val(),l.in=s.in,o.test(l.term)&&(l.in="users"),d.fire("action:search.submit",{searchOptions:l,searchElements:p}),r.query(l,function(){f.val(""),i.trigger("blur")}),!1})}r.enableQuickSearch=function(e){if(!config.searchEnabled||!app.user.privileges["search:content"])return;const s=Object.assign({in:config.searchDefaultInQuick||"titles"},e.searchOptions),t=e.searchElements.resultEl,n=e.searchElements.inputEl;let i=n.val();const u=t.find(".filter-category");function h(){ajaxify.data.template.category&&ajaxify.data.cid&&O.translate("[[search:search-in-category, "+ajaxify.data.name+"]]",function(c){const a=$("<div></div>").html(c).text();u.find(".name").text(a)}),u.toggleClass("hidden",!(ajaxify.data.template.category&&ajaxify.data.cid))}function o(){e.searchOptions=Object.assign({},s),e.searchOptions.term=n.val(),h(),ajaxify.data.template.category&&ajaxify.data.cid&&u.find('input[type="checkbox"]').is(":checked")&&(e.searchOptions.categories=[ajaxify.data.cid],e.searchOptions.searchChildren=!0),e.hideDuringSearch||(t.removeClass("hidden").find(".quick-search-results-container").html(""),t.find(".loading-indicator").removeClass("hidden")),d.fire("action:search.quick.start",e),e.searchOptions.searchOnly=1,r.api(e.searchOptions,function(c){if(t.find(".loading-indicator").addClass("hidden"),e.searchOptions.in==="categories"){if(!c.categories||e.hideOnNoMatches&&!c.categories.length)return t.addClass("hidden").find(".quick-search-results-container").html("");c.dropdown={maxWidth:"400px",maxHeight:"500px",...e.dropdown},app.parseAndTranslate("partials/quick-category-search-results",c,a=>{a.length&&a.find(".timeago").timeago(),t.toggleClass("hidden",!a.length||!n.is(":focus")).find(".quick-search-results-container").html(a.length?a:""),d.fire("action:search.quick.complete",{data:c,options:e})})}else{if(!c.posts||e.hideOnNoMatches&&!c.posts.length)return t.addClass("hidden").find(".quick-search-results-container").html("");c.posts.forEach(function(a){const m=$("<div>"+a.content+"</div>").text(),I=n.val().toLowerCase().replace(/^in:topic-\d+/,""),y=Math.max(0,m.toLowerCase().indexOf(I)-40);a.snippet=utils.escapeHTML((y>0?"...":"")+m.slice(y,y+80)+(m.length-y>80?"...":""))}),c.dropdown={maxWidth:"400px",maxHeight:"500px",...e.dropdown},app.parseAndTranslate("partials/quick-search-results",c,function(a){a.length&&a.find(".timeago").timeago(),t.toggleClass("hidden",!a.length||!n.is(":focus")).find(".quick-search-results-container").html(a.length?a:"");const m=t.find(".quick-search-results .quick-search-title, .quick-search-results .snippet");r.highlightMatches(e.searchOptions.term,m),d.fire("action:search.quick.complete",{data:c,options:e})})}})}t.find('.filter-category input[type="checkbox"]').on("change",function(){n.focus(),o()}),n.off("keyup").on("keyup",utils.debounce(function(){if(n.val().length<3){t.addClass("hidden"),i=n.val();return}if(n.val()!==i){if(i=n.val(),!n.is(":focus"))return t.addClass("hidden");o()}},500)),t.on("mousedown",".quick-search-results > *",function(){$(window).one("mouseup",function(){t.addClass("hidden")})});const p=n.parent(),f=t.parent();p.on("focusout",l),f.on("focusout",l);function l(){setTimeout(function(){!p.find(":focus").length&&!f.find(":focus").length&&!t.hasClass("hidden")&&t.addClass("hidden")},200)}let v=!1;d.on("action:ajaxify.end",function(){ajaxify.isCold()||(v=!0),t.addClass("hidden")}),n.on("focus",function(){const c=n.val();i=c,c&&t.find("#quick-search-results").children().length&&(h(),v?(o(),v=!1):t.removeClass("hidden"),n[0].setSelectionRange(c.startsWith("in:topic")?c.indexOf(" ")+1:0,c.length))}),n.off("refresh").on("refresh",function(){o()})},r.showAndFocusInput=function(e){const s=e.parents(".dropdown-menu");if(s.length){const t=s.siblings("[data-bs-toggle]"),n=j.Dropdown.getOrCreateInstance(t[0]);n&&n.show()}else e.find('[component="search/fields"]').removeClass("hidden"),e.find('[component="search/button"]').addClass("hidden"),e.find('[component="search/fields"] input[name="query"]').trigger("focus")},r.query=function(e,s){s=s||function(){},ajaxify.go("search?"+C(e),s)},r.api=function(e,s){const t=config.relative_path+"/api/search?"+C(e);e.hasOwnProperty("searchOnly")&&delete e.searchOnly;const n=config.relative_path+"/search?"+C(e);$.get(t,function(i){i.url=n,s(i)})};function C(e){const s=e.in||"titles",t=e.term.replace(/^[ ?#]*/,""),n={...e,term:t,in:s};return d.fire("action:search.createQueryString",{query:n,data:e}),$.param(n)}return r.getSearchPreferences=function(){try{return JSON.parse(b.getItem("search-preferences")||"{}")}catch(e){return console.error(e),{}}},r.highlightMatches=function(e,s){if(!e||!s.length)return;e=utils.escapeHTML(e.replace(/^"/,"").replace(/"$/,"").trim());const t=e.split(" ").filter(i=>i.length>1).map(function(i){return utils.escapeRegexChars(i)}).join("|"),n=new RegExp("("+t+")","gi");s.each(function(){const i=$(this),u=[];i.find("*").each(function(){$(this).after("<!-- "+u.length+" -->"),u.push($("<div></div>").append($(this)))}),i.html(i.html().replace(n,function(h,o){return'<strong class="search-match fw-bold text-decoration-underline">'+o+"</strong>"})),u.forEach(function(h,o){i.html(i.html().replace("<!-- "+o+" -->",function(){return h.html()}))})}),$(".search-results .content").find("img:not(.not-responsive)").addClass("img-fluid")},r}.apply(k,E),x!==void 0&&(q.exports=x)}}]);
