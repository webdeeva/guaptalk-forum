"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[2403,69749],{2403:(b,q,p)=>{var E,x;E=[p(69749),p(29930),p(49897)],x=function(w,O,m){const u={};let s,a,h={};u.init=function(t){t=t||function(){},!s&&app.parseAndTranslate("modals/merge-topic",{},function(r){s=r,$("body").append(s),a=s.find("#merge_topics_confirm"),s.find("#merge_topics_cancel").on("click",n),$("#content").on("click",'[component="topic/select"]',C),o(),a.on("click",function(){e(a)}),w.enableQuickSearch({searchElements:{inputEl:s.find(".topic-search-input"),resultEl:s.find(".quick-search-container")},searchOptions:{in:"titles"},dropdown:{maxWidth:"400px",maxHeight:"350px"}}),s.on("click","[data-tid]",function(){const c=$(this).attr("data-tid");return c&&u.addTopic(c),!1}),s.on("click","[data-remove-tid]",function(){const c=$(this).attr("data-remove-tid");return c&&u.removeTopic(c),!1}),t()})},u.addTopic=function(t,r){r=r||function(){},m.get(`/topics/${t}`,{}).then(function(c){const l=c?c.title:"No title";h[t]=l,i(),o(),r()}).catch(O.error)},u.removeTopic=function(t){h[t]&&delete h[t],i(),o()};function C(t){if(!s)return;const r=$(this).parents('[component="category/topic"]'),c=r.hasClass("selected"),l=r.attr("data-tid");return c?u.addTopic(l):u.removeTopic(l),t.preventDefault(),t.stopPropagation(),!1}function e(t){t.attr("disabled",!0);const r=Object.keys(h),c={};s.find(".merge-main-topic-radio").is(":checked")?c.mainTid=s.find(".merge-main-topic-select").val():s.find(".merge-new-title-radio").is(":checked")&&(c.newTopicTitle=s.find(".merge-new-title-input").val()),socket.emit("topics.merge",{tids:r,options:c},function(l,v){if(t.removeAttr("disabled"),l)return O.error(l);ajaxify.go("/topic/"+v),n()})}function o(){if(!s)return;const t=Object.keys(h);t.sort(function(c,l){return c-l});const r=t.map(function(c){return{tid:c,title:h[c]}});t.length?app.parseAndTranslate("modals/merge-topic",{config,topics:r},function(c){s.find(".topics-section").html(c.find(".topics-section").html()),s.find(".merge-main-topic-select").html(c.find(".merge-main-topic-select").html())}):(s.find(".topics-section").translateHtml("[[error:no-topics-selected]]"),s.find(".merge-main-topic-select").html(""))}function i(){Object.keys(h).length?a.removeAttr("disabled"):a.attr("disabled",!0)}function n(){s&&(s.remove(),s=null),h={},$("#content").off("click",'[component="topic/select"]',C)}return u}.apply(q,E),x!==void 0&&(b.exports=x)},69749:(b,q,p)=>{var E,x;E=[p(17459),p(68636),p(91749),p(29930),p(89336)],x=function(w,O,m,u,s){const a={current:{}};a.init=function(e){if(!config.searchEnabled)return;e=e||{in:config.searchDefaultInQuick||"titles"},$('[component="search/form"]').each((i,n)=>{h($(n),e)})};function h(e,o){const i=e.find('[component="search/button"]'),n=e.find('[component="search/fields"]'),t=n.find('input[name="query"]'),r=n.find("#quick-search-container"),c=n.hasClass("hidden"),l=/^(@|acct:)?[\w-]+@.+$/;c&&n.off("focusout").on("focusout",function(){setTimeout(function(){n.find(":focus").length||(n.addClass("hidden"),i.removeClass("hidden"))},200)}),t.off("focus");const v={inputEl:t,resultEl:r};a.enableQuickSearch({searchOptions:o,searchElements:v}),i.off("click").on("click",function(y){return!config.loggedIn&&!app.user.privileges["search:content"]?(u.alert({message:"[[error:search-requires-login]]",timeout:3e3}),ajaxify.go("login"),!1):(y.stopPropagation(),a.showAndFocusInput(e),!1)}),e.off("submit").on("submit",function(){const y=$(this).find('input[name="query"]'),g=a.getSearchPreferences();return g.term=y.val(),g.in=o.in,l.test(g.term)&&(g.in="users"),m.fire("action:search.submit",{searchOptions:g,searchElements:v}),a.query(g,function(){y.val(""),t.trigger("blur")}),!1})}a.enableQuickSearch=function(e){if(!config.searchEnabled||!app.user.privileges["search:content"])return;const o=Object.assign({in:config.searchDefaultInQuick||"titles"},e.searchOptions),i=e.searchElements.resultEl,n=e.searchElements.inputEl;let t=n.val();const r=i.find(".filter-category");function c(){ajaxify.data.template.category&&ajaxify.data.cid&&w.translate("[[search:search-in-category, "+ajaxify.data.name+"]]",function(d){const f=$("<div></div>").html(d).text();r.find(".name").text(f)}),r.toggleClass("hidden",!(ajaxify.data.template.category&&ajaxify.data.cid))}function l(){e.searchOptions=Object.assign({},o),e.searchOptions.term=n.val(),c(),ajaxify.data.template.category&&ajaxify.data.cid&&r.find('input[type="checkbox"]').is(":checked")&&(e.searchOptions.categories=[ajaxify.data.cid],e.searchOptions.searchChildren=!0),e.hideDuringSearch||(i.removeClass("hidden").find(".quick-search-results-container").html(""),i.find(".loading-indicator").removeClass("hidden")),m.fire("action:search.quick.start",e),e.searchOptions.searchOnly=1,a.api(e.searchOptions,function(d){if(i.find(".loading-indicator").addClass("hidden"),e.searchOptions.in==="categories"){if(!d.categories||e.hideOnNoMatches&&!d.categories.length)return i.addClass("hidden").find(".quick-search-results-container").html("");d.dropdown={maxWidth:"400px",maxHeight:"500px",...e.dropdown},app.parseAndTranslate("partials/quick-category-search-results",d,f=>{f.length&&f.find(".timeago").timeago(),i.toggleClass("hidden",!f.length||!n.is(":focus")).find(".quick-search-results-container").html(f.length?f:""),m.fire("action:search.quick.complete",{data:d,options:e})})}else{if(!d.posts||e.hideOnNoMatches&&!d.posts.length)return i.addClass("hidden").find(".quick-search-results-container").html("");d.posts.forEach(function(f){const k=$("<div>"+f.content+"</div>").text(),A=n.val().toLowerCase().replace(/^in:topic-\d+/,""),T=Math.max(0,k.toLowerCase().indexOf(A)-40);f.snippet=utils.escapeHTML((T>0?"...":"")+k.slice(T,T+80)+(k.length-T>80?"...":""))}),d.dropdown={maxWidth:"400px",maxHeight:"500px",...e.dropdown},app.parseAndTranslate("partials/quick-search-results",d,function(f){f.length&&f.find(".timeago").timeago(),i.toggleClass("hidden",!f.length||!n.is(":focus")).find(".quick-search-results-container").html(f.length?f:"");const k=i.find(".quick-search-results .quick-search-title, .quick-search-results .snippet");a.highlightMatches(e.searchOptions.term,k),m.fire("action:search.quick.complete",{data:d,options:e})})}})}i.find('.filter-category input[type="checkbox"]').on("change",function(){n.focus(),l()}),n.off("keyup").on("keyup",utils.debounce(function(){if(n.val().length<3){i.addClass("hidden"),t=n.val();return}if(n.val()!==t){if(t=n.val(),!n.is(":focus"))return i.addClass("hidden");l()}},500)),i.on("mousedown",".quick-search-results > *",function(){$(window).one("mouseup",function(){i.addClass("hidden")})});const v=n.parent(),y=i.parent();v.on("focusout",g),y.on("focusout",g);function g(){setTimeout(function(){!v.find(":focus").length&&!y.find(":focus").length&&!i.hasClass("hidden")&&i.addClass("hidden")},200)}let j=!1;m.on("action:ajaxify.end",function(){ajaxify.isCold()||(j=!0),i.addClass("hidden")}),n.on("focus",function(){const d=n.val();t=d,d&&i.find("#quick-search-results").children().length&&(c(),j?(l(),j=!1):i.removeClass("hidden"),n[0].setSelectionRange(d.startsWith("in:topic")?d.indexOf(" ")+1:0,d.length))}),n.off("refresh").on("refresh",function(){l()})},a.showAndFocusInput=function(e){const o=e.parents(".dropdown-menu");if(o.length){const i=o.siblings("[data-bs-toggle]"),n=s.Dropdown.getOrCreateInstance(i[0]);n&&n.show()}else e.find('[component="search/fields"]').removeClass("hidden"),e.find('[component="search/button"]').addClass("hidden"),e.find('[component="search/fields"] input[name="query"]').trigger("focus")},a.query=function(e,o){o=o||function(){},ajaxify.go("search?"+C(e),o)},a.api=function(e,o){const i=config.relative_path+"/api/search?"+C(e);e.hasOwnProperty("searchOnly")&&delete e.searchOnly;const n=config.relative_path+"/search?"+C(e);$.get(i,function(t){t.url=n,o(t)})};function C(e){const o=e.in||"titles",i=e.term.replace(/^[ ?#]*/,""),n={...e,term:i,in:o};return m.fire("action:search.createQueryString",{query:n,data:e}),$.param(n)}return a.getSearchPreferences=function(){try{return JSON.parse(O.getItem("search-preferences")||"{}")}catch(e){return console.error(e),{}}},a.highlightMatches=function(e,o){if(!e||!o.length)return;e=utils.escapeHTML(e.replace(/^"/,"").replace(/"$/,"").trim());const i=e.split(" ").filter(t=>t.length>1).map(function(t){return utils.escapeRegexChars(t)}).join("|"),n=new RegExp("("+i+")","gi");o.each(function(){const t=$(this),r=[];t.find("*").each(function(){$(this).after("<!-- "+r.length+" -->"),r.push($("<div></div>").append($(this)))}),t.html(t.html().replace(n,function(c,l){return'<strong class="search-match fw-bold text-decoration-underline">'+l+"</strong>"})),r.forEach(function(c,l){t.html(t.html().replace("<!-- "+l+" -->",function(){return c.html()}))})}),$(".search-results .content").find("img:not(.not-responsive)").addClass("img-fluid")},a}.apply(q,E),x!==void 0&&(b.exports=x)}}]);
