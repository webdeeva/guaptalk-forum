"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[22765,92747],{2269:(h,g)=>{var p,d;p=[],d=function(){const c={},l=/-resized(\.[\w]+)?$/;return c.wrapImagesInLinks=function(a){a.find('[component="post/content"] img:not(.emoji)').each(function(){c.wrapImageInLink($(this))})},c.wrapImageInLink=function(a){let n=a.attr("src")||"";if(n!=="about:blank"&&!a.parent().is("a")){utils.isRelativeUrl(n)&&l.test(n)&&(n=n.replace(l,"$1"));const r=a.attr("alt")||"",b=n.split(".").slice(1).pop(),u=r.split("/").pop(),t=u.split(".").slice(1).pop();a.wrap('<a href="'+n+'" '+(!b&&t?' download="'+utils.escapeHTML(u)+'" ':"")+' target="_blank" rel="noopener">')}},c}.apply(g,p),d!==void 0&&(h.exports=d)},92747:(h,g,p)=>{var d,c;d=[p(49897),p(33530),p(29930),p(2269)],c=function(l,a,n){const r={},b={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"};r.open=function(t){config.enablePostHistory&&l.get(`/posts/${encodeURIComponent(t)}/diffs`,{}).then(s=>{u(s).then(i=>{const e=a.dialog({title:"[[topic:diffs.title]]",message:i,size:"large",onEscape:!0,backdrop:!0});if(!s.timestamps.length)return;const o=e.find("select"),f=e.find('button[data-action="restore"]'),m=e.find('button[data-action="delete"]'),I=e.find("ul.posts-list"),_=e.find(".number-of-diffs strong");o.on("change",function(){r.load(t,this.value,I),f.prop("disabled",s.timestamps.indexOf(this.value)===0),m.prop("disabled",s.timestamps.indexOf(this.value)===0)}),f.on("click",function(){r.restore(t,o.val(),e)}),m.on("click",function(){r.delete(t,o.val(),o,_)}),e.on("shown.bs.modal",function(){r.load(t,o.val(),I),f.prop("disabled",!0),m.prop("disabled",!0)})})}).catch(n.error)},r.load=function(t,s,i){config.enablePostHistory&&l.get(`/posts/${encodeURIComponent(t)}/diffs/${s}`,{}).then(e=>{e.deleted=!!parseInt(e.deleted,10),app.parseAndTranslate("partials/posts_list","posts",{posts:[e]},function(o){i.empty().append(o),i.find(".timeago").timeago()})}).catch(n.error)},r.restore=function(t,s,i){config.enablePostHistory&&l.put(`/posts/${encodeURIComponent(t)}/diffs/${s}`,{}).then(()=>{i.modal("hide"),n.success("[[topic:diffs.post-restored]]")}).catch(n.error)},r.delete=function(t,s,i,e){l.del(`/posts/${encodeURIComponent(t)}/diffs/${s}`).then(o=>{u(o,"diffs").then(f=>{i.empty().append(f),i.trigger("change");const m=i.find("option").length;e.text(m),n.success("[[topic:diffs.deleted]]")})}).catch(n.error)};function u(t,s){return new Promise(i=>{const e=[{diffs:t.revisions.map(function(o){const f=parseInt(o.timestamp,10);return{username:o.username,timestamp:f,pretty:new Date(f).toLocaleString(config.userLang.replace("_","-"),b)}}),numDiffs:t.timestamps.length,editable:t.editable,deletable:t.deletable},function(o){i(o)}];s&&e.unshift(s),app.parseAndTranslate("modals/post-history",...e)})}return r}.apply(g,d),c!==void 0&&(h.exports=c)}}]);
