"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[36159,98463],{24187:(A,E,n)=>{var h,c;h=[n(64061)],c=function(){const l={};l.show=function(t,o){const s=t.hasOwnProperty("fileSize")&&t.fileSize!==void 0?parseInt(t.fileSize,10):!1;app.parseAndTranslate("modals/upload-file",{showHelp:t.hasOwnProperty("showHelp")&&t.showHelp!==void 0?t.showHelp:!0,fileSize:s,title:t.title||"[[global:upload-file]]",description:t.description||"",button:t.button||"[[global:upload]]",accept:t.accept?t.accept.replace(/,/g,"&#44; "):""},function(e){e.modal("show"),e.on("hidden.bs.modal",function(){e.remove()});const r=e.find("#uploadForm");r.attr("action",t.route),r.find("#params").val(JSON.stringify(t.params)),e.find("#fileUploadSubmitBtn").on("click",function(){$(this).addClass("disabled"),r.submit()}),r.submit(function(){return g(e,s,o),!1})})},l.hideAlerts=function(t){$(t).find("#alert-status, #alert-success, #alert-error, #upload-progress-box").addClass("hide")};function g(t,o,s){d(t,"status","[[uploads:uploading-file]]"),t.find("#upload-progress-bar").css("width","0%"),t.find("#upload-progress-box").show().removeClass("hide");const e=t.find("#fileInput");if(!e.val())return d(t,"error","[[uploads:select-file-to-upload]]");if(!S(e[0],o))return d(t,"error","[[error:file-too-big, "+o+"]]");l.ajaxSubmit(t,s)}function d(t,o,s){l.hideAlerts(t),o==="error"&&t.find("#fileUploadSubmitBtn").removeClass("disabled"),s=s.replace(/&amp;#44/g,"&#44"),t.find("#alert-"+o).translateText(s).removeClass("hide")}l.ajaxSubmit=function(t,o){t.find("#uploadForm").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},error:function(e){e=b(e),d(t,"error",e.responseJSON?.status?.message||e.responseJSON?.error||`[[error:upload-error-fallback, ${e.status} ${e.statusText}]]`)},uploadProgress:function(e,r,i,u){t.find("#upload-progress-bar").css("width",u+"%")},success:function(e){let r=b(e);e.hasOwnProperty("response")&&e.hasOwnProperty("status")&&e.status.code==="ok"&&(r=e.response.images),o(r[0].url),d(t,"success","[[uploads:upload-success]]"),setTimeout(function(){l.hideAlerts(t),t.modal("hide")},750)}})};function b(t){if(typeof t=="string")try{return JSON.parse(t)}catch(o){return console.error(o),{error:"[[error:parse-error]]"}}return t}function S(t,o){return window.FileReader&&o?t.files[0].size<=o*1e3:!0}return l}.apply(E,h),c!==void 0&&(A.exports=c)},36159:(A,E,n)=>{var h,c;h=[n(49897),n(33530),n(29930),n(24187),n(81335),n(17459),n(65285)],c=function(l,g,d,b,S,t){const o={};return o.get=s=>l.get(`/topics/${s}/thumbs`,{thumbsOnly:1}),o.getByPid=s=>l.get(`/posts/${encodeURIComponent(s)}`,{}).then(e=>o.get(e.tid)),o.delete=(s,e)=>l.del(`/topics/${s}/thumbs`,{path:e}),o.deleteAll=s=>{o.get(s).then(e=>{Promise.all(e.map(r=>o.delete(s,r.url)))})},o.upload=s=>new Promise(e=>{b.show({title:"[[topic:composer.thumb-title]]",method:"put",route:config.relative_path+`/api/v3/topics/${s}/thumbs`},function(r){e(r)})}),o.modal={},o.modal.open=function(s){const{id:e,pid:r}=s;let{modal:i}=s,u;return new Promise(p=>{Promise.all([o.get(e),r?o.getByPid(r):[]]).then(a=>new Promise(m=>{const f=a.reduce((P,C)=>P.concat(C));u=f.length,m(f)})).then(a=>S.render("modals/topic-thumbs",{thumbs:a})).then(a=>{i?t.translate(a,function(m){i.find(".bootbox-body").html(m),o.modal.handleSort({modal:i,numThumbs:u})}):(i=g.dialog({title:"[[modules:thumbs.modal.title]]",message:a,onEscape:!0,backdrop:!0,buttons:{add:{label:'<i class="fa fa-plus"></i> [[modules:thumbs.modal.add]]',className:"btn-success",callback:()=>(o.upload(e).then(()=>{o.modal.open({...s,modal:i}),Promise.all([n.e(20056),n.e(40559),n.e(449),n.e(5785),n.e(52185)]).then(function(){var m=[n(71431)];(f=>{f.updateThumbCount(e,$(`[component="composer"][data-uuid="${e}"]`)),p()}).apply(null,m)}).catch(n.oe)}),!1)},close:{label:"[[global:close]]",className:"btn-primary"}}}),o.modal.handleDelete({...s,modal:i}),o.modal.handleSort({modal:i,numThumbs:u}))})})},o.modal.handleDelete=s=>{const e=s.modal.get(0),{id:r}=s;e.addEventListener("click",i=>{i.target.closest('button[data-action="remove"]')&&g.confirm("[[modules:thumbs.modal.confirm-remove]]",u=>{if(!u)return;const p=i.target.closest("[data-id]").getAttribute("data-id"),a=i.target.closest("[data-path]").getAttribute("data-path");l.del(`/topics/${p}/thumbs`,{path:a}).then(()=>{o.modal.open(s),Promise.all([n.e(20056),n.e(40559),n.e(449),n.e(5785),n.e(52185)]).then(function(){var m=[n(71431)];(f=>{f.updateThumbCount(r,$(`[component="composer"][data-uuid="${r}"]`))}).apply(null,m)}).catch(n.oe)}).catch(d.error)})})},o.modal.handleSort=({modal:s,numThumbs:e})=>{if(e>1){const r=s.find(".topic-thumbs-modal");r.sortable({items:"[data-id]"}),r.on("sortupdate",o.modal.handleSortChange)}},o.modal.handleSortChange=(s,e)=>{const r=e.item.get(0).parentNode.querySelectorAll("[data-id]");Array.from(r).forEach((i,u)=>{const p=i.getAttribute("data-id");let a=i.getAttribute("data-path");a=a.replace(new RegExp(`^${config.upload_url}`),""),l.put(`/topics/${p}/thumbs/order`,{path:a,order:u}).catch(d.error)})},o}.apply(E,h),c!==void 0&&(A.exports=c)}}]);
