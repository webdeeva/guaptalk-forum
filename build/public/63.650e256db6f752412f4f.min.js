"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[63,34405],{63:(b,v,d)=>{var g,r;g=[d(29930),d(34405),d(49897),d(81335)],r=function(y,m,x,C){const f={};let a,h,p,c;f.init=function(t,n,u){a||(p=t,c=n||[],app.parseAndTranslate("modals/tag-topic",{topics:p,tagWhitelist:c},function(l){a=l,h=a.find("#tag-topic-commit"),$("body").append(a),a.find("#tag-topic-cancel").on("click",i),h.on("click",async()=>{await s(),u&&u()}),a.find(".tags").each((o,E)=>{const A=$(E),D=A.tagsinput({tagClass:"badge bg-info",confirmKeys:[13,44],trimValue:!0}),w=D[0].$input;p[o].tags.forEach(T=>A.tagsinput("add",T.value)),A.on("itemAdded",function(T){c.length&&!c.includes(T.item)&&(A.tagsinput("remove",T.item),y.error("[[error:tag-not-allowed]]")),w.length&&w.autocomplete("close")}),e({input:w,container:D[0].$container})})}))};function e(t){m.init({input:t.input,position:{my:"left bottom",at:"left top",collision:"flip"},appendTo:t.container,source:async(n,u)=>{socket.emit("topics.autocompleteTags",{query:n.term},function(l,o){if(l)return y.error(l);o&&u(o)})}})}async function s(){await Promise.all(a.find(".tags").map(async(t,n)=>{const u=p[t],l=$(n);u.tags=await x.put(`/topics/${u.tid}/tags`,{tags:l.tagsinput("items")}),f.updateTopicTags([u])})),i()}f.updateTopicTags=function(t){t.forEach(n=>{const u=ajaxify.data.template.topic?"partials/topic/tags":"partials/category/tags";C.render(u,{tags:n.tags}).then(function(l){const o=$(`[data-tid="${n.tid}"][component="topic/tags"]`);o.fadeOut(250,function(){o.toggleClass("hidden",n.tags.length===0),o.html(l).fadeIn(250)})})})};function i(){a&&(a.remove(),a=null)}return f}.apply(v,g),r!==void 0&&(b.exports=r)},34405:(b,v,d)=>{var g,r;g=[d(49897),d(29930),d(36e3),d(9787),d(35786)],r=function(y,m,{Textcomplete:x},{TextareaEditor:C},{ContenteditableEditor:f}){const a={},h={delay:200,appendTo:null};a.init=c=>{const e={...h,...c},{input:s,onSelect:i}=e;app.loadJQueryUI(function(){s.autocomplete({...e,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(t,n){p(s,i,t,n)}})})},a.user=function(c,e,s){typeof e=="function"&&(s=e,e={}),e=e||{},a.init({input:c,onSelect:s,source:(i,t)=>{e.query=i.term,y.get("/api/users",e,function(n,u){if(n)return m.error(n);if(u&&u.users){const l=u.users.map(function(o){const E=$("<div></div>").html(o.username).text();return o&&{label:E,value:E,user:{uid:o.uid,name:o.username,slug:o.userslug,username:o.username,userslug:o.userslug,displayname:o.displayname,picture:o.picture,banned:o.banned,"icon:text":o["icon:text"],"icon:bgColor":o["icon:bgColor"]}}});t(l)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},a.group=function(c,e){a.init({input:c,onSelect:e,source:(s,i)=>{socket.emit("groups.search",{query:s.term},function(t,n){if(t)return m.error(t);if(n&&n.length){const u=n.map(function(l){return l&&{label:l.name,value:l.name,group:l}});i(u)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},a.tag=function(c,e){a.init({input:c,onSelect:e,delay:100,source:(s,i)=>{socket.emit("topics.autocompleteTags",{query:s.term,cid:ajaxify.data.cid||0},function(t,n){if(t)return m.error(t);n&&i(n),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function p(c,e,s,i){e=e||function(){};const t=jQuery.Event("keypress");t.which=13,t.keyCode=13,setTimeout(function(){c.trigger(t)},100),e(s,i)}return a.setup=function({element:c,strategies:e,options:s}){const i=c.get(0);if(i){var t;if(i.nodeName==="TEXTAREA"||i.nodeName==="INPUT"?t=new C(i):i.nodeName==="DIV"&&i.getAttribute("contenteditable")==="true"&&(t=new f(i)),!t)throw new Error("unknown target element type");i.setAttribute("dir",document.querySelector("html").getAttribute("data-dir"));var n=new x(t,e,{dropdown:s});return n.on("rendered",function(){n.dropdown.items.length&&n.dropdown.items[0].activate()}),n}},a}.apply(v,g),r!==void 0&&(b.exports=r)}}]);
