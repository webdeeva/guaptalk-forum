(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,34670,36159,49897,62441,88189,98463,99127],{24187:(x,b,s)=>{"use strict";var p,g;p=[s(64061)],g=function(){const h={};h.show=function(t,r){const a=t.hasOwnProperty("fileSize")&&t.fileSize!==void 0?parseInt(t.fileSize,10):!1;app.parseAndTranslate("modals/upload-file",{showHelp:t.hasOwnProperty("showHelp")&&t.showHelp!==void 0?t.showHelp:!0,fileSize:a,title:t.title||"[[global:upload-file]]",description:t.description||"",button:t.button||"[[global:upload]]",accept:t.accept?t.accept.replace(/,/g,"&#44; "):""},function(e){e.modal("show"),e.on("hidden.bs.modal",function(){e.remove()});const i=e.find("#uploadForm");i.attr("action",t.route),i.find("#params").val(JSON.stringify(t.params)),e.find("#fileUploadSubmitBtn").on("click",function(){$(this).addClass("disabled"),i.submit()}),i.submit(function(){return v(e,a,r),!1})})},h.hideAlerts=function(t){$(t).find("#alert-status, #alert-success, #alert-error, #upload-progress-box").addClass("hide")};function v(t,r,a){u(t,"status","[[uploads:uploading-file]]"),t.find("#upload-progress-bar").css("width","0%"),t.find("#upload-progress-box").show().removeClass("hide");const e=t.find("#fileInput");if(!e.val())return u(t,"error","[[uploads:select-file-to-upload]]");if(!l(e[0],r))return u(t,"error","[[error:file-too-big, "+r+"]]");h.ajaxSubmit(t,a)}function u(t,r,a){h.hideAlerts(t),r==="error"&&t.find("#fileUploadSubmitBtn").removeClass("disabled"),a=a.replace(/&amp;#44/g,"&#44"),t.find("#alert-"+r).translateText(a).removeClass("hide")}h.ajaxSubmit=function(t,r){t.find("#uploadForm").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},error:function(e){e=f(e),u(t,"error",e.responseJSON?.status?.message||e.responseJSON?.error||`[[error:upload-error-fallback, ${e.status} ${e.statusText}]]`)},uploadProgress:function(e,i,c,n){t.find("#upload-progress-bar").css("width",n+"%")},success:function(e){let i=f(e);e.hasOwnProperty("response")&&e.hasOwnProperty("status")&&e.status.code==="ok"&&(i=e.response.images),r(i[0].url),u(t,"success","[[uploads:upload-success]]"),setTimeout(function(){h.hideAlerts(t),t.modal("hide")},750)}})};function f(t){if(typeof t=="string")try{return JSON.parse(t)}catch(r){return console.error(r),{error:"[[error:parse-error]]"}}return t}function l(t,r){return window.FileReader&&r?t.files[0].size<=r*1e3:!0}return h}.apply(b,p),g!==void 0&&(x.exports=g)},26940:(x,b,s)=>{x.exports=s(94510)},36159:(x,b,s)=>{"use strict";var p,g;p=[s(49897),s(33530),s(29930),s(24187),s(81335),s(17459),s(65285)],g=function(h,v,u,f,l,t){const r={};return r.get=a=>h.get(`/topics/${a}/thumbs`,{thumbsOnly:1}),r.getByPid=a=>h.get(`/posts/${encodeURIComponent(a)}`,{}).then(e=>r.get(e.tid)),r.delete=(a,e)=>h.del(`/topics/${a}/thumbs`,{path:e}),r.deleteAll=a=>{r.get(a).then(e=>{Promise.all(e.map(i=>r.delete(a,i.url)))})},r.upload=a=>new Promise(e=>{f.show({title:"[[topic:composer.thumb-title]]",method:"put",route:config.relative_path+`/api/v3/topics/${a}/thumbs`},function(i){e(i)})}),r.modal={},r.modal.open=function(a){const{id:e,pid:i}=a;let{modal:c}=a,n;return new Promise(d=>{Promise.all([r.get(e),i?r.getByPid(i):[]]).then(o=>new Promise(m=>{const A=o.reduce((D,E)=>D.concat(E));n=A.length,m(A)})).then(o=>l.render("modals/topic-thumbs",{thumbs:o})).then(o=>{c?t.translate(o,function(m){c.find(".bootbox-body").html(m),r.modal.handleSort({modal:c,numThumbs:n})}):(c=v.dialog({title:"[[modules:thumbs.modal.title]]",message:o,onEscape:!0,backdrop:!0,buttons:{add:{label:'<i class="fa fa-plus"></i> [[modules:thumbs.modal.add]]',className:"btn-success",callback:()=>(r.upload(e).then(()=>{r.modal.open({...a,modal:c}),Promise.all([s.e(20056),s.e(40559),s.e(449),s.e(5785),s.e(52185)]).then(function(){var m=[s(71431)];(A=>{A.updateThumbCount(e,$(`[component="composer"][data-uuid="${e}"]`)),d()}).apply(null,m)}).catch(s.oe)}),!1)},close:{label:"[[global:close]]",className:"btn-primary"}}}),r.modal.handleDelete({...a,modal:c}),r.modal.handleSort({modal:c,numThumbs:n}))})})},r.modal.handleDelete=a=>{const e=a.modal.get(0),{id:i}=a;e.addEventListener("click",c=>{c.target.closest('button[data-action="remove"]')&&v.confirm("[[modules:thumbs.modal.confirm-remove]]",n=>{if(!n)return;const d=c.target.closest("[data-id]").getAttribute("data-id"),o=c.target.closest("[data-path]").getAttribute("data-path");h.del(`/topics/${d}/thumbs`,{path:o}).then(()=>{r.modal.open(a),Promise.all([s.e(20056),s.e(40559),s.e(449),s.e(5785),s.e(52185)]).then(function(){var m=[s(71431)];(A=>{A.updateThumbCount(i,$(`[component="composer"][data-uuid="${i}"]`))}).apply(null,m)}).catch(s.oe)}).catch(u.error)})})},r.modal.handleSort=({modal:a,numThumbs:e})=>{if(e>1){const i=a.find(".topic-thumbs-modal");i.sortable({items:"[data-id]"}),i.on("sortupdate",r.modal.handleSortChange)}},r.modal.handleSortChange=(a,e)=>{const i=e.item.get(0).parentNode.querySelectorAll("[data-id]");Array.from(i).forEach((c,n)=>{const d=c.getAttribute("data-id");let o=c.getAttribute("data-path");o=o.replace(new RegExp(`^${config.upload_url}`),""),h.put(`/topics/${d}/thumbs/order`,{path:o,order:n}).catch(u.error)})},r}.apply(b,p),g!==void 0&&(x.exports=g)},49897:(x,b,s)=>{"use strict";s.r(b),s.d(b,{del:()=>c,get:()=>t,head:()=>r,patch:()=>e,post:()=>a,put:()=>i});var p=s(91749),g=s.n(p),h=s(33530),v=s.n(h);const u=config.relative_path+"/api/v3";async function f(n,d){if(n.url=n.url.startsWith("/api")?config.relative_path+n.url:u+n.url,typeof d=="function"){l(n).then(o=>d(null,o),o=>d(o));return}try{return await l(n)}catch(o){if(o.message==="A valid login session was not found. Please log in and try again."){const{url:m}=await(0,p.fire)("filter:admin.reauth",{url:"login"});return(0,h.confirm)("[[error:api.reauth-required]]",A=>{A&&ajaxify.go(m)})}throw o}}async function l(n){const{url:d}=n;delete n.url,n.data&&!(n.data instanceof FormData)&&(n.data=JSON.stringify(n.data||{}),n.headers["content-type"]="application/json; charset=utf-8"),{options:n}=await(0,p.fire)("filter:api.options",{options:n}),n.data&&(n.body=n.data,delete n.data);const o=await fetch(d,n),{headers:m}=o;if(m.get("x-redirect"))return l({url:m.get("x-redirect"),...n});const A=m.get("content-type"),D=A&&A.startsWith("application/json");let E;if(n.method!=="HEAD"&&(D?E=await o.json():E=await o.text()),!o.ok)throw E?new Error(D?E.status.message:E):new Error(o.statusText);return D&&E&&E.hasOwnProperty("status")&&E.hasOwnProperty("response")?E.response:E}function t(n,d,o){return f({url:n+(d&&Object.keys(d).length?"?"+$.param(d):"")},o)}function r(n,d,o){return f({url:n+(d&&Object.keys(d).length?"?"+$.param(d):""),method:"HEAD"},o)}function a(n,d,o){return f({url:n,method:"POST",data:d,headers:{"x-csrf-token":config.csrf_token}},o)}function e(n,d,o){return f({url:n,method:"PATCH",data:d,headers:{"x-csrf-token":config.csrf_token}},o)}function i(n,d,o){return f({url:n,method:"PUT",data:d,headers:{"x-csrf-token":config.csrf_token}},o)}function c(n,d,o){return f({url:n,method:"DELETE",data:d,headers:{"x-csrf-token":config.csrf_token}},o)}},94510:(x,b,s)=>{"use strict";var p,g;p=[s(89596)],g=function(h){var v={};return v.insertIntoTextarea=function(u,f){var l={context:this,textarea:u,value:f,preventDefault:!1};if($(window).trigger("action:composer.insertIntoTextarea",l),!l.preventDefault){var t=$(l.textarea),r=t.val(),a=t.parents('[component="composer"]');t.val(r.slice(0,l.textarea.selectionStart)+l.value+r.slice(l.textarea.selectionStart)),h.render(a)}},v.replaceSelectionInTextareaWith=function(u,f){var l={context:this,textarea:u,value:f,preventDefault:!1};if($(window).trigger("action:composer.replaceSelectionInTextareaWith",l),!l.preventDefault){var t=$(l.textarea),r=t.val(),a=t.parents('[component="composer"]');t.val(r.slice(0,l.textarea.selectionStart)+l.value+r.slice(l.textarea.selectionEnd)),h.render(a)}},v.wrapSelectionInTextareaWith=function(u,f,l){var t={context:this,textarea:u,leading:f,trailing:l,preventDefault:!1};if($(window).trigger("action:composer.wrapSelectionInTextareaWith",t),!t.preventDefault){l===void 0&&(l=f);var r=$(u),a=r.val(),e=/^(\s*)([\s\S]*?)(\s*)$/.exec(a.slice(u.selectionStart,u.selectionEnd));return e[2]||(e=[null,"",a.slice(u.selectionStart,u.selectionEnd),""]),r.val(a.slice(0,u.selectionStart)+e[1]+f+e[2]+l+e[3]+a.slice(u.selectionEnd)),[e[1].length,e[3].length]}},v.updateTextareaSelection=function(u,f,l){var t={context:this,textarea:u,start:f,end:l,preventDefault:!1};$(window).trigger("action:composer.updateTextareaSelection",t),!t.preventDefault&&(u.setSelectionRange(t.start,t.end),$(t.textarea).focus())},v.getBlockData=function(u,f,l){var t=u.value;f=f.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&");var r=new RegExp(f,"g"),a,e=[],i;for(t=t.split(`
`).reduce(function(c,n){return c!==null||(c=l<=n.length?n:null,c===null&&(l-=n.length+1)),c},null);(a=r.exec(t))!==null;)e.push(a.index);return i={in:!!(e.reduce(function(c,n){return l>=n+2&&(c+=1),c},0)%2),atEnd:e.reduce(function(c,n){return c||l===n},!1)},i.atEnd=i.in?i.atEnd:!1,i},v}.apply(b,p),g!==void 0&&(x.exports=g)}}]);
