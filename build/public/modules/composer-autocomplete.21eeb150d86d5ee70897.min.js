(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,6232,13417,34271,34405,49897,73848,99127],{34405:(E,x,u)=>{"use strict";var h,v;h=[u(49897),u(29930),u(36e3),u(9787),u(35786)],v=function(_,f,{Textcomplete:s},{TextareaEditor:o},{ContenteditableEditor:c}){const a={},g={delay:200,appendTo:null};a.init=d=>{const r={...g,...d},{input:l,onSelect:e}=r;app.loadJQueryUI(function(){l.autocomplete({...r,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(t,n){w(l,e,t,n)}})})},a.user=function(d,r,l){typeof r=="function"&&(l=r,r={}),r=r||{},a.init({input:d,onSelect:l,source:(e,t)=>{r.query=e.term,_.get("/api/users",r,function(n,i){if(n)return f.error(n);if(i&&i.users){const y=i.users.map(function(m){const p=$("<div></div>").html(m.username).text();return m&&{label:p,value:p,user:{uid:m.uid,name:m.username,slug:m.userslug,username:m.username,userslug:m.userslug,displayname:m.displayname,picture:m.picture,banned:m.banned,"icon:text":m["icon:text"],"icon:bgColor":m["icon:bgColor"]}}});t(y)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},a.group=function(d,r){a.init({input:d,onSelect:r,source:(l,e)=>{socket.emit("groups.search",{query:l.term},function(t,n){if(t)return f.error(t);if(n&&n.length){const i=n.map(function(y){return y&&{label:y.name,value:y.name,group:y}});e(i)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},a.tag=function(d,r){a.init({input:d,onSelect:r,delay:100,source:(l,e)=>{socket.emit("topics.autocompleteTags",{query:l.term,cid:ajaxify.data.cid||0},function(t,n){if(t)return f.error(t);n&&e(n),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function w(d,r,l,e){r=r||function(){};const t=jQuery.Event("keypress");t.which=13,t.keyCode=13,setTimeout(function(){d.trigger(t)},100),r(l,e)}return a.setup=function({element:d,strategies:r,options:l}){const e=d.get(0);if(e){var t;if(e.nodeName==="TEXTAREA"||e.nodeName==="INPUT"?t=new o(e):e.nodeName==="DIV"&&e.getAttribute("contenteditable")==="true"&&(t=new c(e)),!t)throw new Error("unknown target element type");e.setAttribute("dir",document.querySelector("html").getAttribute("data-dir"));var n=new s(t,r,{dropdown:l});return n.on("rendered",function(){n.dropdown.items.length&&n.dropdown.items[0].activate()}),n}},a}.apply(x,h),v!==void 0&&(E.exports=v)},49897:(E,x,u)=>{"use strict";u.r(x),u.d(x,{del:()=>l,get:()=>a,head:()=>g,patch:()=>d,post:()=>w,put:()=>r});var h=u(91749),v=u.n(h),_=u(33530),f=u.n(_);const s=config.relative_path+"/api/v3";async function o(e,t){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:s+e.url,typeof t=="function"){c(e).then(n=>t(null,n),n=>t(n));return}try{return await c(e)}catch(n){if(n.message==="A valid login session was not found. Please log in and try again."){const{url:i}=await(0,h.fire)("filter:admin.reauth",{url:"login"});return(0,_.confirm)("[[error:api.reauth-required]]",y=>{y&&ajaxify.go(i)})}throw n}}async function c(e){const{url:t}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,h.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const n=await fetch(t,e),{headers:i}=n;if(i.get("x-redirect"))return c({url:i.get("x-redirect"),...e});const y=i.get("content-type"),m=y&&y.startsWith("application/json");let p;if(e.method!=="HEAD"&&(m?p=await n.json():p=await n.text()),!n.ok)throw p?new Error(m?p.status.message:p):new Error(n.statusText);return m&&p&&p.hasOwnProperty("status")&&p.hasOwnProperty("response")?p.response:p}function a(e,t,n){return o({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},n)}function g(e,t,n){return o({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"HEAD"},n)}function w(e,t,n){return o({url:e,method:"POST",data:t,headers:{"x-csrf-token":config.csrf_token}},n)}function d(e,t,n){return o({url:e,method:"PATCH",data:t,headers:{"x-csrf-token":config.csrf_token}},n)}function r(e,t,n){return o({url:e,method:"PUT",data:t,headers:{"x-csrf-token":config.csrf_token}},n)}function l(e,t,n){return o({url:e,method:"DELETE",data:t,headers:{"x-csrf-token":config.csrf_token}},n)}},54516:(E,x,u)=>{"use strict";var h,v;h=[u(89596),u(34405)],v=function(_,f){var s={_active:{}};return $(window).on("action:composer.discard",function(o,c){s._active.hasOwnProperty(c.post_uuid)&&(s._active[c.post_uuid].destroy(),delete s._active[c.post_uuid])}),s.init=function(o,c){var a=o.find(".write"),g="composer-autocomplete-dropdown-"+c,w;if(a.length){var d={element:a,strategies:[],options:{style:{"z-index":2e4},className:g+" dropdown-menu textcomplete-dropdown"}};a.on("keyup",function(){clearTimeout(w),w=setTimeout(function(){var r=document.querySelector("."+g);if(r){var l=r.getBoundingClientRect(),e=parseFloat(r.style.marginTop,10)||0,t=window.innerHeight+e-10-l.bottom;r.style.marginTop=Math.min(t,0)+"px"}},0)}),$(window).trigger("composer:autocomplete:init",d),s._active[c]=f.setup(d),d.element.on("textComplete:select",function(){_.render(o)})}},s}.apply(x,h),v!==void 0&&(E.exports=v)},62590:(E,x,u)=>{"use strict";var h,v;h=[u(91749)],v=function(_){var f={};return f.render=function(s,o){if(o=o||function(){},!s.find(".preview-container").is(":visible"))return o();var c=s.find("textarea");socket.emit("plugins.composer.renderPreview",c.val(),function(a,g){a||(g=$("<div>"+g+"</div>"),g.find("img:not(.not-responsive)").addClass("img-fluid"),s.find(".preview").html(g),_.fire("action:composer.preview",{postContainer:s,preview:g}),o())})},f.matchScroll=function(s){if(s.find(".preview-container").is(":visible")){var o=s.find("textarea"),c=s.find(".preview");if(o.length&&c.length){var a=o[0].scrollHeight-o.height();if(a===0)return;var g=o.scrollTop()/a;c.scrollTop(Math.max(c[0].scrollHeight-c.height(),0)*g)}}},f.handleToggler=function(s){const o=s.get(0);f.env=utils.findBootstrapEnvironment();const c=["xs","sm"].includes(f.env),a=o.querySelector('.formatting-bar [data-action="preview"]'),g=a.querySelector(".show-text"),w=a.querySelector(".hide-text"),d=localStorage.getItem("composer:previewToggled"),r=config["composer-default"]&&config["composer-default"].hidePreviewOnOpen==="on";let l=!c&&(d===null&&!r||d==="true");const e=o.querySelector(".preview-container"),t=o.querySelector(".write-container");if(!a)return;function n(i){c?(e.classList.toggle("hide",!1),t.classList.toggle("maximized",!1),e.classList.toggle("d-none",!i),e.classList.toggle("d-flex",i),e.classList.toggle("w-100",i),t.classList.toggle("d-flex",!i),t.classList.toggle("d-none",i),t.classList.toggle("w-100",!i)):(e.classList.toggle("hide",!i),t.classList.toggle("w-50",i),t.classList.toggle("w-100",!i),localStorage.setItem("composer:previewToggled",i)),g.classList.toggle("hide",i),w.classList.toggle("hide",!i),i&&f.render(s),f.matchScroll(s)}f.toggle=n,a.addEventListener("click",i=>{i.button===0&&(l=!l,n(l))}),n(l)},f}.apply(x,h),v!==void 0&&(E.exports=v)},88518:(E,x,u)=>{E.exports=u(54516)},89596:(E,x,u)=>{E.exports=u(62590)}}]);
