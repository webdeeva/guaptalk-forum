(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[68783],{28721:(l,p,m)=>{"use strict";var h,d;h=[m(29930)],d=function(s){var g={},f,c;g.init=function(e,a){var i=e.find(".tags");if(i.length){f=ajaxify.data.hasOwnProperty("minTags")?ajaxify.data.minTags:config.minimumTagsPerTopic,c=ajaxify.data.hasOwnProperty("maxTags")?ajaxify.data.maxTags:config.maximumTagsPerTopic,i.tagsinput({tagClass:"badge bg-info rounded-1",confirmKeys:[13,44],trimValue:!0});var n=e.find(".bootstrap-tagsinput input");T(e,a,ajaxify.data),app.loadJQueryUI(function(){n.autocomplete({delay:100,position:{my:"left bottom",at:"left top",collision:"flip"},appendTo:e.find(".bootstrap-tagsinput"),open:function(){$(this).autocomplete("widget").css("z-index",2e4)},source:function(t,o){socket.emit("topics.autocompleteTags",{query:t.term,cid:a.cid},function(r,u){if(r)return s.error(r);u&&o(u),$(".ui-autocomplete a").attr("data-ajaxify","false")})},select:function(){x(n)}}),y(a.tags,i),i.on("beforeItemAdd",function(t){var o=c&&c<=g.getTags(e.attr("data-uuid")).length,r=utils.cleanUpTag(t.item,config.maximumTagLength),u=r!==t.item;if(t.cancel=u||t.item.length<config.minimumTagLength||t.item.length>config.maximumTagLength||o,t.item.length<config.minimumTagLength)return s.error("[[error:tag-too-short, "+config.minimumTagLength+"]]");if(t.item.length>config.maximumTagLength)return s.error("[[error:tag-too-long, "+config.maximumTagLength+"]]");if(o)return s.error("[[error:too-many-tags, "+c+"]]");var w=a.hasOwnProperty("cid")?a.cid:ajaxify.data.cid;$(window).trigger("action:tag.beforeAdd",{cid:w,tagEl:i,tag:t.item,event:t,inputAutocomplete:n}),u&&i.tagsinput("add",r),t.cancel&&n.length&&n.autocomplete("close")}),i.on("itemRemoved",function(t){!t.item||t.options&&t.options.skipRemoveCheck||socket.emit("topics.canRemoveTag",{tag:t.item},function(o,r){if(o)return s.error(o);r||(s.error("[[error:cant-remove-system-tag]]"),i.tagsinput("add",t.item,{skipAddCheck:!0}))})}),i.on("itemAdded",function(t){if(!(t.options&&t.options.skipAddCheck)){var o=a.hasOwnProperty("cid")?a.cid:ajaxify.data.cid;socket.emit("topics.isTagAllowed",{tag:t.item,cid:o||0},function(r,u){if(r)return s.error(r);if(!u)return i.tagsinput("remove",t.item,{skipRemoveCheck:!0});$(window).trigger("action:tag.added",{cid:o,tagEl:i,tag:t.item,inputAutocomplete:n}),n.length&&n.autocomplete("close")})}})}),n.attr("tabIndex",i.attr("tabIndex")),n.on("blur",function(){x(n)}),$('[component="composer/tag/dropdown"]').on("click","li",function(){var t=$(this).attr("data-tag");return t&&y([t],i),!1})}},g.isEnoughTags=function(e){return g.getTags(e).length>=f},g.minTagCount=function(){return f},g.onChangeCategory=function(e,a,i,n){var t=e.find('[component="composer/tag/dropdown"]');t.length&&(T(e,a,n),t.toggleClass("hidden",!n.tagWhitelist||!n.tagWhitelist.length),n.tagWhitelist&&app.parseAndTranslate("composer","tagWhitelist",{tagWhitelist:n.tagWhitelist},function(o){t.find(".dropdown-menu").html(o)}))};function T(e,a,i){var n=e.find(".tags"),t=e.find(".bootstrap-tagsinput input");t.length&&(i.hasOwnProperty("minTags")&&(f=i.minTags),i.hasOwnProperty("maxTags")&&(c=i.maxTags),i.tagWhitelist&&i.tagWhitelist.length?(t.attr("readonly",""),t.attr("placeholder",""),n.tagsinput("items").slice().forEach(function(o){i.tagWhitelist.indexOf(o)===-1&&n.tagsinput("remove",o)})):(t.removeAttr("readonly"),t.attr("placeholder",e.find("input.tags").attr("placeholder"))),e.find(".tags-container").toggleClass("haswhitelist",!!(i.tagWhitelist&&i.tagWhitelist.length)),e.find(".tags-container").toggleClass("hidden",i.privileges&&i.privileges.hasOwnProperty("topics:tag")&&!i.privileges["topics:tag"]||c===0&&!a&&!a.tags&&!a.tags.length),i.privileges&&i.privileges.hasOwnProperty("topics:tag")&&!i.privileges["topics:tag"]&&n.tagsinput("removeAll"),$(window).trigger("action:tag.toggleInput",{postContainer:e,tagWhitelist:i.tagWhitelist,tagsInput:t}))}function x(e){var a=jQuery.Event("keypress");a.which=13,a.keyCode=13,setTimeout(function(){e.trigger(a)},100)}function y(e,a){if(e&&e.length)for(var i=0;i<e.length;++i)a.tagsinput("add",e[i])}return g.getTags=function(e){return $('.composer[data-uuid="'+e+'"] .tags').tagsinput("items")},g}.apply(p,h),d!==void 0&&(l.exports=d)},52543:(l,p,m)=>{l.exports=m(28721)}}]);
