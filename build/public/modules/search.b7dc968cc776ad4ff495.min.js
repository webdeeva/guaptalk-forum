"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[69749,87212,92717],{68636:(E,S,m)=>{var C;C=function(){function l(){this._store={},this._keys=[]}l.prototype.isMock=!0,l.prototype.setItem=function(i,y){i=String(i),this._keys.indexOf(i)===-1&&this._keys.push(i),this._store[i]=y},l.prototype.getItem=function(i){return i=String(i),this._keys.indexOf(i)===-1?null:this._store[i]},l.prototype.removeItem=function(i){i=String(i),this._keys=this._keys.filter(function(y){return y!==i}),this._store[i]=null},l.prototype.clear=function(){this._keys=[],this._store={}},l.prototype.key=function(i){return i=parseInt(i,10)||0,this._keys[i]},Object.defineProperty&&Object.defineProperty(l.prototype,"length",{get:function(){return this._keys.length}});let u;const f=Date.now().toString();try{if(u=window.localStorage,u.setItem(f,f),u.getItem(f)!==f)throw Error("localStorage behaved unexpectedly");return u.removeItem(f),u}catch(i){console.warn(i),console.warn("localStorage failed, falling back on sessionStorage");try{if(u=window.sessionStorage,u.setItem(f,f),u.getItem(f)!==f)throw Error("sessionStorage behaved unexpectedly");return u.removeItem(f),u}catch(y){return console.warn(y),console.warn("sessionStorage failed, falling back on memory storage"),new l}}}.call(S,m,S,E),C!==void 0&&(E.exports=C)},69749:(E,S,m)=>{var C,l;C=[m(17459),m(68636),m(91749),m(29930),m(89336)],l=function(u,f,i,y,q){const o={current:{}};o.init=function(e){if(!config.searchEnabled)return;e=e||{in:config.searchDefaultInQuick||"titles"},$('[component="search/form"]').each((n,t)=>{I($(t),e)})};function I(e,r){const n=e.find('[component="search/button"]'),t=e.find('[component="search/fields"]'),s=t.find('input[name="query"]'),d=t.find("#quick-search-container"),x=t.hasClass("hidden"),h=/^(@|acct:)?[\w-]+@.+$/;x&&t.off("focusout").on("focusout",function(){setTimeout(function(){t.find(":focus").length||(t.addClass("hidden"),n.removeClass("hidden"))},200)}),s.off("focus");const v={inputEl:s,resultEl:d};o.enableQuickSearch({searchOptions:r,searchElements:v}),n.off("click").on("click",function(p){return!config.loggedIn&&!app.user.privileges["search:content"]?(y.alert({message:"[[error:search-requires-login]]",timeout:3e3}),ajaxify.go("login"),!1):(p.stopPropagation(),o.showAndFocusInput(e),!1)}),e.off("submit").on("submit",function(){const p=$(this).find('input[name="query"]'),g=o.getSearchPreferences();return g.term=p.val(),g.in=r.in,h.test(g.term)&&(g.in="users"),i.fire("action:search.submit",{searchOptions:g,searchElements:v}),o.query(g,function(){p.val(""),s.trigger("blur")}),!1})}o.enableQuickSearch=function(e){if(!config.searchEnabled||!app.user.privileges["search:content"])return;const r=Object.assign({in:config.searchDefaultInQuick||"titles"},e.searchOptions),n=e.searchElements.resultEl,t=e.searchElements.inputEl;let s=t.val();const d=n.find(".filter-category");function x(){ajaxify.data.template.category&&ajaxify.data.cid&&u.translate("[[search:search-in-category, "+ajaxify.data.name+"]]",function(c){const a=$("<div></div>").html(c).text();d.find(".name").text(a)}),d.toggleClass("hidden",!(ajaxify.data.template.category&&ajaxify.data.cid))}function h(){e.searchOptions=Object.assign({},r),e.searchOptions.term=t.val(),x(),ajaxify.data.template.category&&ajaxify.data.cid&&d.find('input[type="checkbox"]').is(":checked")&&(e.searchOptions.categories=[ajaxify.data.cid],e.searchOptions.searchChildren=!0),e.hideDuringSearch||(n.removeClass("hidden").find(".quick-search-results-container").html(""),n.find(".loading-indicator").removeClass("hidden")),i.fire("action:search.quick.start",e),e.searchOptions.searchOnly=1,o.api(e.searchOptions,function(c){if(n.find(".loading-indicator").addClass("hidden"),e.searchOptions.in==="categories"){if(!c.categories||e.hideOnNoMatches&&!c.categories.length)return n.addClass("hidden").find(".quick-search-results-container").html("");c.dropdown={maxWidth:"400px",maxHeight:"500px",...e.dropdown},app.parseAndTranslate("partials/quick-category-search-results",c,a=>{a.length&&a.find(".timeago").timeago(),n.toggleClass("hidden",!a.length||!t.is(":focus")).find(".quick-search-results-container").html(a.length?a:""),i.fire("action:search.quick.complete",{data:c,options:e})})}else{if(!c.posts||e.hideOnNoMatches&&!c.posts.length)return n.addClass("hidden").find(".quick-search-results-container").html("");c.posts.forEach(function(a){const w=$("<div>"+a.content+"</div>").text(),j=t.val().toLowerCase().replace(/^in:topic-\d+/,""),b=Math.max(0,w.toLowerCase().indexOf(j)-40);a.snippet=utils.escapeHTML((b>0?"...":"")+w.slice(b,b+80)+(w.length-b>80?"...":""))}),c.dropdown={maxWidth:"400px",maxHeight:"500px",...e.dropdown},app.parseAndTranslate("partials/quick-search-results",c,function(a){a.length&&a.find(".timeago").timeago(),n.toggleClass("hidden",!a.length||!t.is(":focus")).find(".quick-search-results-container").html(a.length?a:"");const w=n.find(".quick-search-results .quick-search-title, .quick-search-results .snippet");o.highlightMatches(e.searchOptions.term,w),i.fire("action:search.quick.complete",{data:c,options:e})})}})}n.find('.filter-category input[type="checkbox"]').on("change",function(){t.focus(),h()}),t.off("keyup").on("keyup",utils.debounce(function(){if(t.val().length<3){n.addClass("hidden"),s=t.val();return}if(t.val()!==s){if(s=t.val(),!t.is(":focus"))return n.addClass("hidden");h()}},500)),n.on("mousedown",".quick-search-results > *",function(){$(window).one("mouseup",function(){n.addClass("hidden")})});const v=t.parent(),p=n.parent();v.on("focusout",g),p.on("focusout",g);function g(){setTimeout(function(){!v.find(":focus").length&&!p.find(":focus").length&&!n.hasClass("hidden")&&n.addClass("hidden")},200)}let O=!1;i.on("action:ajaxify.end",function(){ajaxify.isCold()||(O=!0),n.addClass("hidden")}),t.on("focus",function(){const c=t.val();s=c,c&&n.find("#quick-search-results").children().length&&(x(),O?(h(),O=!1):n.removeClass("hidden"),t[0].setSelectionRange(c.startsWith("in:topic")?c.indexOf(" ")+1:0,c.length))}),t.off("refresh").on("refresh",function(){h()})},o.showAndFocusInput=function(e){const r=e.parents(".dropdown-menu");if(r.length){const n=r.siblings("[data-bs-toggle]"),t=q.Dropdown.getOrCreateInstance(n[0]);t&&t.show()}else e.find('[component="search/fields"]').removeClass("hidden"),e.find('[component="search/button"]').addClass("hidden"),e.find('[component="search/fields"] input[name="query"]').trigger("focus")},o.query=function(e,r){r=r||function(){},ajaxify.go("search?"+k(e),r)},o.api=function(e,r){const n=config.relative_path+"/api/search?"+k(e);e.hasOwnProperty("searchOnly")&&delete e.searchOnly;const t=config.relative_path+"/search?"+k(e);$.get(n,function(s){s.url=t,r(s)})};function k(e){const r=e.in||"titles",n=e.term.replace(/^[ ?#]*/,""),t={...e,term:n,in:r};return i.fire("action:search.createQueryString",{query:t,data:e}),$.param(t)}return o.getSearchPreferences=function(){try{return JSON.parse(f.getItem("search-preferences")||"{}")}catch(e){return console.error(e),{}}},o.highlightMatches=function(e,r){if(!e||!r.length)return;e=utils.escapeHTML(e.replace(/^"/,"").replace(/"$/,"").trim());const n=e.split(" ").filter(s=>s.length>1).map(function(s){return utils.escapeRegexChars(s)}).join("|"),t=new RegExp("("+n+")","gi");r.each(function(){const s=$(this),d=[];s.find("*").each(function(){$(this).after("<!-- "+d.length+" -->"),d.push($("<div></div>").append($(this)))}),s.html(s.html().replace(t,function(x,h){return'<strong class="search-match fw-bold text-decoration-underline">'+h+"</strong>"})),d.forEach(function(x,h){s.html(s.html().replace("<!-- "+h+" -->",function(){return x.html()}))})}),$(".search-results .content").find("img:not(.not-responsive)").addClass("img-fluid")},o}.apply(S,C),l!==void 0&&(E.exports=l)}}]);
