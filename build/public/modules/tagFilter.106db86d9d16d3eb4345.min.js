"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[8981],{25955:(y,T,o)=>{var u,r;u=[o(91749),o(29930),o(89336)],r=function(b,x,A){const p={};p.init=function(i,n){if(!i||!i.length)return;n=n||{},n.template="partials/tags/filter-dropdown-left",b.fire("action:tag.filter.options",{el:i,options:n});const l=i.find('[component="tag/filter/search"]');n.selectedTags=n.selectedTags||ajaxify.data.selectedTags||[];let c=null,e=[],f=[];Array.isArray(n.selectedTags)?e=n.selectedTags.map(String):Array.isArray(ajaxify.data.selectedTags)&&(e=ajaxify.data.selectedTags.map(String)),f=e.slice();const h=l.parents('[component="tag/filter"]').length&&app.user.privileges["search:tags"];i.on("show.bs.dropdown",function(){h&&l.removeClass("hidden");function s(){const a=l.find("input").val();a.length>1||!a&&!c?w(a,function(t){c=c||t,m(t)}):!a&&c&&m(c)}l.on("click",function(a){a.preventDefault(),a.stopPropagation()}),l.find("input").val("").on("keyup",utils.debounce(s,300)),s()}),i.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||l.find("input").focus()}),i.on("hidden.bs.dropdown",function(){h&&l.addClass("hidden"),l.off("click"),l.find("input").off("keyup");let s=f.length!==e.length;if(f.forEach(function(a,t){a!==e[t]&&(s=!0)}),f=e.slice(),s&&(n.updateButton?n.updateButton({el:i,changed:s,selectedTags:e.slice()}):n.updateButton!==!1&&j(i,e)),n.onHidden){n.onHidden({changed:s,selectedTags:e.slice()});return}if(s){let a=window.location.pathname;const t=utils.params();e.length?t.tag=e.length?e:void 0:delete t.tag,delete t.page,Object.keys(t).length&&(a+="?"+$.param(t)),ajaxify.go(a)}}),i.on("click",'[component="tag/filter/list"] [data-tag]',function(){const s=i.find('[component="tag/filter/list"]'),a=$(this),t=a.find("a").attr("href");if(t&&t!=="#"&&t.length)return;const d=a.attr("data-tag"),g=a.find('[component="tag/select/icon"]');return d!==""?(e.includes(d)?e.splice(e.indexOf(d),1):e.push(d),e.sort(function(E,v){return E-v}),g.toggleClass("invisible")):(i.find('[component="tag/select/icon"]').addClass("invisible"),e=[]),s.find('[data-tag=""] i').toggleClass("invisible",!!e.length),n.selectedTags=e,n.onSelect&&n.onSelect({tag:d,selectedTags:e.slice()}),!1});function w(s,a){let t=null;ajaxify.data.template.category||ajaxify.data.template.world?t=[ajaxify.data.cid]:Array.isArray(ajaxify.data.selectedCids)&&ajaxify.data.selectedCids.length&&(t=ajaxify.data.selectedCids),socket.emit("topics.tagFilterSearch",{query:s,cids:t},function(d,g){if(d)return x.error(d);a(g)})}function m(s){const a=n.selectedTags;s.forEach(function(t){t.selected=a.includes(t.value)}),app.parseAndTranslate(n.template,{tagItems:s.slice(0,200),selectedTag:ajaxify.data.selectedTag},function(t){i.find('[component="tag/filter/list"]').html(t.find('[component="tag/filter/list"]').html());const d=A.Dropdown.getInstance(i.find(".dropdown-toggle").get(0));d&&d.update()})}};function j(i,n){n.length>0?l({label:n.join(", ")}):l();function l(c){app.parseAndTranslate("partials/tags/filter-dropdown-content",{selectedTag:c},function(e){i.find("button").replaceWith($("<div/>").html(e).find("button"))})}}return p}.apply(T,u),r!==void 0&&(y.exports=r)}}]);
