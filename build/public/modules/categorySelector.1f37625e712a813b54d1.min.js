"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,69185,86198,99127],{49897:(w,C,o)=>{o.r(C),o.d(C,{del:()=>i,get:()=>e,head:()=>c,patch:()=>a,post:()=>d,put:()=>u});var h=o(91749),y=o.n(h),E=o(33530),A=o.n(E);const p=config.relative_path+"/api/v3";async function f(t,r){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:p+t.url,typeof r=="function"){l(t).then(n=>r(null,n),n=>r(n));return}try{return await l(t)}catch(n){if(n.message==="A valid login session was not found. Please log in and try again."){const{url:s}=await(0,h.fire)("filter:admin.reauth",{url:"login"});return(0,E.confirm)("[[error:api.reauth-required]]",m=>{m&&ajaxify.go(s)})}throw n}}async function l(t){const{url:r}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,h.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const n=await fetch(r,t),{headers:s}=n;if(s.get("x-redirect"))return l({url:s.get("x-redirect"),...t});const m=s.get("content-type"),D=m&&m.startsWith("application/json");let g;if(t.method!=="HEAD"&&(D?g=await n.json():g=await n.text()),!n.ok)throw g?new Error(D?g.status.message:g):new Error(n.statusText);return D&&g&&g.hasOwnProperty("status")&&g.hasOwnProperty("response")?g.response:g}function e(t,r,n){return f({url:t+(r&&Object.keys(r).length?"?"+$.param(r):"")},n)}function c(t,r,n){return f({url:t+(r&&Object.keys(r).length?"?"+$.param(r):""),method:"HEAD"},n)}function d(t,r,n){return f({url:t,method:"POST",data:r,headers:{"x-csrf-token":config.csrf_token}},n)}function a(t,r,n){return f({url:t,method:"PATCH",data:r,headers:{"x-csrf-token":config.csrf_token}},n)}function u(t,r,n){return f({url:t,method:"PUT",data:r,headers:{"x-csrf-token":config.csrf_token}},n)}function i(t,r,n){return f({url:t,method:"DELETE",data:r,headers:{"x-csrf-token":config.csrf_token}},n)}},65348:(w,C,o)=>{var h,y;h=[o(96349),o(33530),o(91749),o(17459)],y=function(E,A,p,f){const l={};return l.init=function(e,c){if(!e||!e.length)return;c=c||{};const d=c.onSelect||function(){};c.states=c.states||["watching","tracking","notwatching","ignoring"],c.template=c.template||"partials/category/selector-dropdown-left",p.fire("action:category.selector.options",{el:e,options:c}),E.init(e,c);const a={el:e,selectedCategory:null};e.on("click","[data-cid]",function(){const i=$(this);return i.hasClass("disabled")?!1:(a.selectCategory(i.attr("data-cid")),d(a.selectedCategory))});let u=a.el.find('[component="category-selector-selected"]').html();return f.translate(u,i=>{u=i}),a.selectCategory=function(i){const t=a.el.find('[data-cid="'+i+'"]');a.selectedCategory={cid:i,name:t.attr("data-name")},t.length?a.el.find('[component="category-selector-selected"]').html(t.find('[component="category-markup"]').html()):a.el.find('[component="category-selector-selected"]').html(u)},a.getSelectedCategory=function(){return a.selectedCategory},a.getSelectedCid=function(){return a.selectedCategory?a.selectedCategory.cid:0},c.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(c.template,{selectedCategory:c.selectedCategory},function(i){a.el.find('[component="category-selector-selected"]').html(i.find('[component="category-selector-selected"]').html())}),a},l.modal=function(e){e=e||{},e.onSelect=e.onSelect||function(){},e.onSubmit=e.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:e.message},function(c){const d=A.dialog({title:e.title||"[[modules:composer.select-category]]",message:c,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:u}}}),a=l.init(d.find('[component="category-selector"]'),e);function u(i){return i.preventDefault(),a.selectedCategory&&(e.onSubmit(a.selectedCategory),d.modal("hide")),!1}e.openOnLoad&&d.on("shown.bs.modal",function(){d.find(".dropdown-toggle").dropdown("toggle")}),d.find("form").on("submit",u)})},l}.apply(C,h),y!==void 0&&(w.exports=y)},96349:(w,C,o)=>{var h,y;h=[o(29930),o(89336),o(49897)],y=function(E,A,p){const f={};return f.init=function(l,e){let c=e.defaultCategories||null;e=e||{},e.privilege=e.privilege||"topics:read",e.states=e.states||["watching","tracking","notwatching","ignoring"],e.cacheList=e.hasOwnProperty("cacheList")?e.cacheList:!0;let d=[];Array.isArray(e.localCategories)&&(d=e.localCategories.map(r=>({...r})),c&&(c=[...d,...c])),e.selectedCids=e.selectedCids||ajaxify.data.selectedCids||[];const a=l.find('[component="category-selector-search"]');if(!a.length)return;const u=a.parents('[component="category/dropdown"]').length>0||a.parents('[component="category-selector"]').length>0;l.on("show.bs.dropdown",function(){u&&a.removeClass("hidden");function r(){const n=a.find("input").val();n.length>1||!n&&!c?i(n,function(s){c=e.cacheList&&(c||s),t(s)}):!n&&c&&t(c)}a.on("click",function(n){n.preventDefault(),n.stopPropagation()}),a.find("input").val("").on("keyup",utils.debounce(r,300)),r()}),l.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||a.find("input").focus()}),l.on("hide.bs.dropdown",function(){u&&a.addClass("hidden"),a.off("click"),a.find("input").off("keyup")});function i(r,n){p.get("/search/categories",{search:r,query:utils.params(),parentCid:e.parentCid||0,selectedCids:e.selectedCids,privilege:e.privilege,states:e.states,showLinks:e.showLinks},function(s,{categories:m}){if(s)return E.error(s);n(d.concat(m))})}function t(r){const n=e.selectedCids.map(String);r.forEach(function(s){s.selected=n.includes(String(s.cid))}),app.parseAndTranslate(e.template,{categoryItems:r.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(s){l.find('[component="category/list"]').html(s.find('[component="category/list"]').html()),l.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!r.length);const m=A.Dropdown.getInstance(l.find(".dropdown-toggle").get(0));m&&m.update()})}},f}.apply(C,h),y!==void 0&&(w.exports=y)}}]);
