"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[8981,14526,42619,90954],{25955:(S,F,r)=>{var P,A;P=[r(91749),r(29930),r(89336)],A=function(x,L,g){const E={};E.init=function(t,i){if(!t||!t.length)return;i=i||{},i.template="partials/tags/filter-dropdown-left",x.fire("action:tag.filter.options",{el:t,options:i});const o=t.find('[component="tag/filter/search"]');i.selectedTags=i.selectedTags||ajaxify.data.selectedTags||[];let f=null,e=[],d=[];Array.isArray(i.selectedTags)?e=i.selectedTags.map(String):Array.isArray(ajaxify.data.selectedTags)&&(e=ajaxify.data.selectedTags.map(String)),d=e.slice();const y=o.parents('[component="tag/filter"]').length&&app.user.privileges["search:tags"];t.on("show.bs.dropdown",function(){y&&o.removeClass("hidden");function p(){const h=o.find("input").val();h.length>1||!h&&!f?s(h,function(C){f=f||C,m(C)}):!h&&f&&m(f)}o.on("click",function(h){h.preventDefault(),h.stopPropagation()}),o.find("input").val("").on("keyup",utils.debounce(p,300)),p()}),t.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||o.find("input").focus()}),t.on("hidden.bs.dropdown",function(){y&&o.addClass("hidden"),o.off("click"),o.find("input").off("keyup");let p=d.length!==e.length;if(d.forEach(function(h,C){h!==e[C]&&(p=!0)}),d=e.slice(),p&&(i.updateButton?i.updateButton({el:t,changed:p,selectedTags:e.slice()}):i.updateButton!==!1&&w(t,e)),i.onHidden){i.onHidden({changed:p,selectedTags:e.slice()});return}if(p){let h=window.location.pathname;const C=utils.params();e.length?C.tag=e.length?e:void 0:delete C.tag,delete C.page,Object.keys(C).length&&(h+="?"+$.param(C)),ajaxify.go(h)}}),t.on("click",'[component="tag/filter/list"] [data-tag]',function(){const p=t.find('[component="tag/filter/list"]'),h=$(this),C=h.find("a").attr("href");if(C&&C!=="#"&&C.length)return;const D=h.attr("data-tag"),M=h.find('[component="tag/select/icon"]');return D!==""?(e.includes(D)?e.splice(e.indexOf(D),1):e.push(D),e.sort(function(j,b){return j-b}),M.toggleClass("invisible")):(t.find('[component="tag/select/icon"]').addClass("invisible"),e=[]),p.find('[data-tag=""] i').toggleClass("invisible",!!e.length),i.selectedTags=e,i.onSelect&&i.onSelect({tag:D,selectedTags:e.slice()}),!1});function s(p,h){let C=null;ajaxify.data.template.category||ajaxify.data.template.world?C=[ajaxify.data.cid]:Array.isArray(ajaxify.data.selectedCids)&&ajaxify.data.selectedCids.length&&(C=ajaxify.data.selectedCids),socket.emit("topics.tagFilterSearch",{query:p,cids:C},function(D,M){if(D)return L.error(D);h(M)})}function m(p){const h=i.selectedTags;p.forEach(function(C){C.selected=h.includes(C.value)}),app.parseAndTranslate(i.template,{tagItems:p.slice(0,200),selectedTag:ajaxify.data.selectedTag},function(C){t.find('[component="tag/filter/list"]').html(C.find('[component="tag/filter/list"]').html());const D=g.Dropdown.getInstance(t.find(".dropdown-toggle").get(0));D&&D.update()})}};function w(t,i){i.length>0?o({label:i.join(", ")}):o();function o(f){app.parseAndTranslate("partials/tags/filter-dropdown-content",{selectedTag:f},function(e){t.find("button").replaceWith($("<div/>").html(e).find("button"))})}}return E}.apply(F,P),A!==void 0&&(S.exports=A)},39259:(S,F,r)=>{var P,A;P=[r(96349),r(49897),r(91749)],A=function(x,L,g){const E={};E.init=function(t,i){if(!t||!t.length)return;i=i||{},i.states=i.states||["watching","tracking","notwatching","ignoring"],i.template=i.template||"partials/category/filter-dropdown-left",g.fire("action:category.filter.options",{el:t,options:i}),x.init(t,i);let o=[],f=[];Array.isArray(i.selectedCids)?o=i.selectedCids.map(String):Array.isArray(ajaxify.data.selectedCids)&&(o=ajaxify.data.selectedCids.map(String)),f=o.slice(),t.on("hidden.bs.dropdown",function(){let e=f.length!==o.length;if(f.forEach(function(d,y){d!==o[y]&&(e=!0)}),f=o.slice(),e&&(i.updateButton?i.updateButton({el:t,changed:e,selectedCids:o.slice()}):i.updateButton!==!1&&w(t,o)),i.onHidden){i.onHidden({changed:e,selectedCids:o.slice()});return}if(e){let d=window.location.pathname;const y=utils.params();o.length?y.cid=o:delete y.cid,delete y.page,Object.keys(y).length&&(d+="?"+$.param(y)),ajaxify.go(d)}}),t.on("click",'[component="category/list"] [data-cid]',function(e){const d=t.find('[component="category/list"]'),y=$(this),s=y.find("a").attr("href");if(s&&s!=="#"&&s.length){e.stopPropagation();return}const m=y.attr("data-cid"),p=y.find('[component="category/select/icon"]');return m!=="all"?(o.includes(m)?o.splice(o.indexOf(m),1):o.push(m),o.sort(function(h,C){return h-C}),p.toggleClass("invisible"),d.find('[data-cid="all"] i').toggleClass("invisible",!!o.length)):(t.find('[component="category/select/icon"]').addClass("invisible"),d.find('[data-cid="all"] i').removeClass("invisible"),o=[]),i.selectedCids=o,i.onSelect&&i.onSelect({cid:m,selectedCids:o.slice()}),!1})};function w(t,i){i.length>1?o({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):i.length===1?L.get(`/categories/${i[0]}`,{}).then(o):o();function o(f){app.parseAndTranslate("partials/category/filter-dropdown-content",{selectedCategory:f},function(e){t.find("button").replaceWith($("<div/>").html(e).find("button"))})}}return E}.apply(F,P),A!==void 0&&(S.exports=A)},47682:(S,F,r)=>{var P,A;P=[r(22410),r(60644),r(70550),r(39259),r(25955),r(71131),r(91749)],A=function(x,L,g,E,w,t,i){const o={};let f="",e=0,d=0,y,s;const m=[];$(window).on("action:ajaxify.start",function(){o.removeListeners(),t.removeListeners()}),o.init=function(u,a){s=p(),f=u,y=a||j,t.init(),o.watchForNewPosts();const v=["watching","tracking"];ajaxify.data.selectedFilter&&ajaxify.data.selectedFilter.filter==="watched"?v.push("notwatching","ignoring"):u!=="unread"&&v.push("notwatching"),E.init($('[component="category/dropdown"]'),{states:v}),w.init($('[component="tag/filter"]')),config.usePagination||x.init(o.loadMoreTopics),L.init(function(k,n){y(k,1,function(c,l){W(f,c.topics,ajaxify.data.showSelect,1,function(){n(),l()})})}),$("body").height()<=$(window).height()&&s.children().length>=20&&$("#load-more-btn").show(),$("#load-more-btn").on("click",function(){o.loadMoreTopics(1)}),i.fire("action:topics.loaded",{topics:ajaxify.data.topics})};function p(){return $('[component="category"]').filter(function(u,a){return!$(a).parents("[widget-area],[data-widget-area]").length})}o.watchForNewPosts=function(){d=0,e=0,o.removeListeners(),socket.on("event:new_topic",h),socket.on("event:new_post",C)},o.removeListeners=function(){socket.removeListener("event:new_topic",h),socket.removeListener("event:new_post",C)};function h(u){const a=ajaxify.data,v=a.selectedCids&&a.selectedCids.length&&a.selectedCids.indexOf(parseInt(u.cid,10))===-1,k=a.selectedFilter&&a.selectedFilter.filter==="watched",n=a.template.category&&parseInt(a.cid,10)!==parseInt(u.cid,10),c=!!(v||k||n||m.includes(u.tid));i.fire("filter:topicList.onNewTopic",{topic:u,preventAlert:c}).then(l=>{l.preventAlert||(u.scheduled&&u.tid&&m.push(u.tid),e+=1,D())})}function C(u){const a=u.posts[0];if(!a||!a.topic||a.topic.isFollowing)return;const v=ajaxify.data,k=parseInt(a.topic.mainPid,10)===parseInt(a.pid,10),n=v.selectedCids&&v.selectedCids.length&&v.selectedCids.indexOf(parseInt(a.topic.cid,10))===-1,c=v.selectedFilter&&v.selectedFilter.filter==="new",l=v.selectedFilter&&v.selectedFilter.filter==="watched"&&!a.topic.isFollowing,T=v.template.category&&parseInt(v.cid,10)!==parseInt(a.topic.cid,10),R=!!(k||n||c||l||T);i.fire("filter:topicList.onNewPost",{post:a,preventAlert:R}).then(I=>{I.preventAlert||(d+=1,D())})}function D(){(e>0||d>0)&&($("#new-topics-alert").removeClass("hide").fadeIn("slow"),$("#category-no-topics").addClass("hide"))}o.loadMoreTopics=function(u){if(!s.length||!s.children().length)return;const a=s.find('[component="category/topic"]'),v=u>0?a.last():a.first(),k=(parseInt(v.attr("data-index"),10)||0)+(u>0?1:0);!utils.isNumber(k)||k===0&&s.find('[component="category/topic"][data-index="0"]').length||y(k,u,function(n,c){W(f,n.topics,ajaxify.data.showSelect,u,c)})};function M(u,a){return Math.floor(u/config.topicsPerPage)+(a>0?1:0)}function j(u,a,v){v=v||function(){};const k=utils.params();k.page=M(u,a),x.loadMoreXhr(k,v)}function b(u){return u.filter(function(a){return!s.find('[component="category/topic"][data-tid="'+a.tid+'"]').length})}function W(u,a,v,k,n){if(!a||!a.length||(a=b(a),!a.length))return $("#load-more-btn").hide(),n();let c,l;const T=s.find('[component="category/topic"]');k>0&&a.length?c=T.last():k<0&&a.length&&(l=T.first());const R={topics:a,showSelect:v,template:{name:u}};R.template[u]=!0,i.fire("action:topics.loading",{topics:a,after:c,before:l}),app.parseAndTranslate(u,"topics",R,function(I){if(s.removeClass("hidden"),$("#category-no-topics").remove(),c&&c.length)I.insertAfter(c);else if(l&&l.length){const B=$(document).height(),N=$(window).scrollTop();I.insertBefore(l),$(window).scrollTop(N+($(document).height()-B))}else s.append(I);g.getSelectedTids().length||x.removeExtra(s.find('[component="category/topic"]'),k,Math.max(60,config.topicsPerPage*3)),I.find(".timeago").timeago(),i.fire("action:topics.loaded",{topics:a,template:u}),n()})}return o}.apply(F,P),A!==void 0&&(S.exports=A)},70550:(S,F,r)=>{var P,A;P=[r(52473)],A=function(x){const L={};let g,E;L.init=function(e){E=$('[component="category"]'),E.on("selectstart",'[component="topic/select"]',function(d){d.preventDefault()}),E.on("click",'[component="topic/select"]',function(d){const s=$(this).parents('[component="category/topic"]');if(d.shiftKey)return i(s.attr("data-tid")),g=s,!1;const m=s.hasClass("selected");w(s,!m),g=s,typeof e=="function"&&e()})};function w(e,d){const y=e.find('[component="topic/select"]');y.toggleClass("fa-check-square-o",d),y.toggleClass("fa-square-o",!d),y.parents('[component="category/topic"]').toggleClass("selected",d),t()}function t(){const e=$('[component="topic/selected/badge"]');if(e.length){const d=E.find('[component="category/topic"].selected').length;e.text(d>0?d:"")}}L.getSelectedTids=function(){const e=[];return E&&E.find('[component="category/topic"].selected').each(function(){e.push($(this).attr("data-tid"))}),e},L.unselectAll=function(){E&&(E.find('[component="category/topic"].selected').removeClass("selected"),E.find('[component="topic/select"]').toggleClass("fa-check-square-o",!1).toggleClass("fa-square-o",!0),t())};function i(e){g||(g=$('[component="category/topic"]').first());const d=x.get("category/topic","tid",e).hasClass("selected"),y=f(e),s=f(g.attr("data-tid"));o(y,s,!d)}function o(e,d,y){if(e>d){const s=e;e=d,d=s}for(let s=e;s<=d;s+=1){const m=$('[component="category/topic"]').eq(s);w(m,y)}}function f(e){return x.get("category/topic","tid",e).index('[component="category/topic"]')}return L}.apply(F,P),A!==void 0&&(S.exports=A)},71131:(S,F,r)=>{var P,A;P=[r(70550),r(60984),r(52473),r(49897),r(33530),r(29930)],A=function(x,L,g,E,w,t){const i={};i.init=function(){x.init(s),k(),$('[component="category/topic"]').each((n,c)=>{L.observeTopicLabels($(c).find('[component="topic/labels"]'))}),g.get("topic/delete").on("click",function(){return o("del","/state","delete",d),!1}),g.get("topic/restore").on("click",function(){return o("put","/state","restore",d),!1}),g.get("topic/purge").on("click",function(){return o("del","","purge",y),!1}),g.get("topic/lock").on("click",function(){return o("put","/lock","lock",e),!1}),g.get("topic/unlock").on("click",function(){return o("del","/lock","unlock",e),!1}),g.get("topic/pin").on("click",function(){return o("put","/pin","pin",e),!1}),g.get("topic/unpin").on("click",function(){return o("del","/pin","unpin",e),!1}),g.get("topic/mark-unread-for-all").on("click",function(){const n=x.getSelectedTids();return n.length?(socket.emit("topics.markAsUnreadForAll",n,function(c){if(c)return t.error(c);t.success("[[topic:markAsUnreadForAll.success]]"),n.forEach(function(l){$('[component="category/topic"][data-tid="'+l+'"]').addClass("unread")}),e()}),!1):t.error("[[error:no-topics-selected]]")}),g.get("topic/move").on("click",function(){return r.e(28310).then(function(){var n=[r(28310)];(function(c){const l=x.getSelectedTids();if(!l.length)return t.error("[[error:no-topics-selected]]");c.init(l,null,e)}).apply(null,n)}).catch(r.oe),!1}),g.get("topic/move-all").on("click",function(){const n=ajaxify.data.cid;if(!ajaxify.data.template.category)return t.error("[[error:invalid-data]]");r.e(28310).then(function(){var c=[r(28310)];(function(l){l.init(null,n,function(T){if(T)return t.error(T);ajaxify.refresh()})}).apply(null,c)}).catch(r.oe)}),g.get("topic/merge").on("click",function(){const n=x.getSelectedTids();r.e(2403).then(function(){var c=[r(2403)];(function(l){l.init(function(){n.length&&n.forEach(function(T){l.addTopic(T)})})}).apply(null,c)}).catch(r.oe)}),g.get("topic/tag").on("click",async function(){const n=x.getSelectedTids();if(!n.length)return t.error("[[error:no-topics-selected]]");const c=await Promise.all(n.map(l=>E.get(`/topics/${l}`)));Promise.all([r.e(20056),r.e(63)]).then(function(){var l=[r(63)];(function(T){T.init(c,ajaxify.data.tagWhitelist,e)}).apply(null,l)}).catch(r.oe)}),i.removeListeners(),socket.on("event:topic_deleted",b),socket.on("event:topic_restored",b),socket.on("event:topic_purged",v),socket.on("event:topic_locked",u),socket.on("event:topic_unlocked",u),socket.on("event:topic_pinned",W),socket.on("event:topic_unpinned",W),socket.on("event:topic_moved",a)};function o(n,c,l,T){T||(T=function(){});const R=x.getSelectedTids(),I={},B=function(N){N&&Promise.all(R.map(K=>E[n](`/topics/${K}${c}`,I))).then(T).catch(t.error)};if(!R.length)return t.error("[[error:no-topics-selected]]");switch(l){case"delete":case"restore":case"purge":w.confirm(`[[topic:thread-tools.${l}-confirm]]`,B);break;case"pin":L.requestPinExpiry(I,B.bind(null,!0));break;default:B(!0);break}}i.removeListeners=function(){socket.removeListener("event:topic_deleted",b),socket.removeListener("event:topic_restored",b),socket.removeListener("event:topic_purged",v),socket.removeListener("event:topic_locked",u),socket.removeListener("event:topic_unlocked",u),socket.removeListener("event:topic_pinned",W),socket.removeListener("event:topic_unpinned",W),socket.removeListener("event:topic_moved",a)};function f(){$(".thread-tools .show").removeClass("show")}function e(){f(),x.unselectAll()}function d(){f(),s()}function y(){f(),x.unselectAll(),s()}function s(){const n=x.getSelectedTids(),c=m(h,n),l=p(h,n),T=m(D,n),R=m(C,n),I=m(M,n),B=p(M,n);g.get("topic/delete").toggleClass("hidden",c),g.get("topic/restore").toggleClass("hidden",I||!c),g.get("topic/purge").toggleClass("hidden",!l||!n.length),g.get("topic/lock").toggleClass("hidden",R),g.get("topic/unlock").toggleClass("hidden",!R),g.get("topic/pin").toggleClass("hidden",B||T),g.get("topic/unpin").toggleClass("hidden",B||!T),g.get("topic/merge").toggleClass("hidden",I)}function m(n,c){for(let l=0;l<c.length;l+=1)if(n(c[l]))return!0;return!1}function p(n,c){for(let l=0;l<c.length;l+=1)if(!n(c[l]))return!1;return!0}function h(n){return j(n).hasClass("deleted")}function C(n){return j(n).hasClass("locked")}function D(n){return j(n).hasClass("pinned")}function M(n){return j(n).hasClass("scheduled")}function j(n){return g.get("category/topic","tid",n)}function b(n){const c=j(n.tid);c.toggleClass("deleted",n.isDeleted),c.find('[component="topic/locked"]').toggleClass("hidden",!n.isDeleted)}function W(n){const c=j(n.tid);c.toggleClass("pinned",n.isPinned),c.find('[component="topic/pinned"]').toggleClass("hidden",!n.isPinned),ajaxify.refresh()}function u(n){const c=j(n.tid);c.toggleClass("locked",n.isLocked),c.find('[component="topic/locked"]').toggleClass("hidden",!n.isLocked)}function a(n){j(n.tid).remove()}function v(n){j(n.tid).remove()}function k(){if(!ajaxify.data.topics||!ajaxify.data.template.category)return;const n=ajaxify.data.topics.filter(c=>c.pinned).length;!app.user.isAdmin&&!app.user.isMod||n<2||app.loadJQueryUI(function(){const c=$('[component="category"]').filter(function(T,R){return!$(R).parents("[widget-area],[data-widget-area]").length});let l=0;c.sortable({axis:"y",handle:'[component="topic/pinned"]',items:'[component="category/topic"].pinned',start:function(){l=parseInt(c.find('[component="category/topic"].pinned').first().attr("data-index"),10)},update:function(T,R){const I=R.item.attr("data-tid"),B=c.find('[component="category/topic"].pinned');let N=0;B.each((K,U)=>{if($(U).attr("data-tid")===I)return N=K,!1}),socket.emit("topics.orderPinnedTopics",{tid:I,order:l+N},function(K){if(K)return t.error(K);B.each((U,Y)=>{$(Y).attr("data-index",l+U)})})}})})}return i}.apply(F,P),A!==void 0&&(S.exports=A)},96349:(S,F,r)=>{var P,A;P=[r(29930),r(89336),r(49897)],A=function(x,L,g){const E={};return E.init=function(w,t){let i=t.defaultCategories||null;t=t||{},t.privilege=t.privilege||"topics:read",t.states=t.states||["watching","tracking","notwatching","ignoring"],t.cacheList=t.hasOwnProperty("cacheList")?t.cacheList:!0;let o=[];Array.isArray(t.localCategories)&&(o=t.localCategories.map(s=>({...s})),i&&(i=[...o,...i])),t.selectedCids=t.selectedCids||ajaxify.data.selectedCids||[];const f=w.find('[component="category-selector-search"]');if(!f.length)return;const e=f.parents('[component="category/dropdown"]').length>0||f.parents('[component="category-selector"]').length>0;w.on("show.bs.dropdown",function(){e&&f.removeClass("hidden");function s(){const m=f.find("input").val();m.length>1||!m&&!i?d(m,function(p){i=t.cacheList&&(i||p),y(p)}):!m&&i&&y(i)}f.on("click",function(m){m.preventDefault(),m.stopPropagation()}),f.find("input").val("").on("keyup",utils.debounce(s,300)),s()}),w.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||f.find("input").focus()}),w.on("hide.bs.dropdown",function(){e&&f.addClass("hidden"),f.off("click"),f.find("input").off("keyup")});function d(s,m){g.get("/search/categories",{search:s,query:utils.params(),parentCid:t.parentCid||0,selectedCids:t.selectedCids,privilege:t.privilege,states:t.states,showLinks:t.showLinks},function(p,{categories:h}){if(p)return x.error(p);m(o.concat(h))})}function y(s){const m=t.selectedCids.map(String);s.forEach(function(p){p.selected=m.includes(String(p.cid))}),app.parseAndTranslate(t.template,{categoryItems:s.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(p){w.find('[component="category/list"]').html(p.find('[component="category/list"]').html()),w.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!s.length);const h=L.Dropdown.getInstance(w.find(".dropdown-toggle").get(0));h&&h.update()})}},E}.apply(F,P),A!==void 0&&(S.exports=A)}}]);
