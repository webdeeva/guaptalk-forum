"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,56227,99127],{49897:(A,_,i)=>{i.r(_),i.d(_,{del:()=>f,get:()=>x,head:()=>s,patch:()=>r,post:()=>a,put:()=>u});var h=i(91749),m=i.n(h),g=i(33530),p=i.n(g);const c=config.relative_path+"/api/v3";async function d(t,n){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:c+t.url,typeof n=="function"){l(t).then(e=>n(null,e),e=>n(e));return}try{return await l(t)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again."){const{url:y}=await(0,h.fire)("filter:admin.reauth",{url:"login"});return(0,g.confirm)("[[error:api.reauth-required]]",w=>{w&&ajaxify.go(y)})}throw e}}async function l(t){const{url:n}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,h.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const e=await fetch(n,t),{headers:y}=e;if(y.get("x-redirect"))return l({url:y.get("x-redirect"),...t});const w=y.get("content-type"),E=w&&w.startsWith("application/json");let o;if(t.method!=="HEAD"&&(E?o=await e.json():o=await e.text()),!e.ok)throw o?new Error(E?o.status.message:o):new Error(e.statusText);return E&&o&&o.hasOwnProperty("status")&&o.hasOwnProperty("response")?o.response:o}function x(t,n,e){return d({url:t+(n&&Object.keys(n).length?"?"+$.param(n):"")},e)}function s(t,n,e){return d({url:t+(n&&Object.keys(n).length?"?"+$.param(n):""),method:"HEAD"},e)}function a(t,n,e){return d({url:t,method:"POST",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function r(t,n,e){return d({url:t,method:"PATCH",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function u(t,n,e){return d({url:t,method:"PUT",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function f(t,n,e){return d({url:t,method:"DELETE",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}},72513:(A,_,i)=>{var h,m;h=[i(49897)],m=function(g){const p={};let c=0;p.init=function(s,a){const r=a.find('[component="chat/user/list"]');if(!r.length)return;const u=a.find('[component="chat/messages/pinned/container"]');a.find('[component="chat/user/list/btn"]').on("click",()=>{r.toggleClass("hidden"),r.hasClass("hidden")?l():(u.addClass("hidden"),d(s,r))}),$(window).off("action:ajaxify.start",l).one("action:ajaxify.start",l),p.addInfiniteScrollHandler(s,r,async(f,t)=>{f.append(await app.parseAndTranslate("partials/chats/user-list","users",t))})};function d(s,a){c&&clearInterval(c),c=setInterval(()=>{x(s,a)},5e3)}function l(){c&&(clearInterval(c),c=0)}async function x(s,a){if(ajaxify.data.template.chats&&app.isFocused&&a.scrollTop()===0&&!a.hasClass("hidden")){const r=await g.get(`/chats/${s}/users`,{start:0});a.find('[data-bs-toggle="tooltip"]').tooltip("dispose"),a.html(await app.parseAndTranslate("partials/chats/user-list","users",r)),a.find('[data-bs-toggle="tooltip"]').tooltip()}}return p.addInfiniteScrollHandler=function(s,a,r){a.on("scroll",utils.debounce(async()=>{const u=(a[0].scrollHeight-a.height())*.85;if(a.scrollTop()>u){const f=a.find("[data-index]").last().attr("data-index"),t=await g.get(`/chats/${s}/users`,{start:parseInt(f,10)+1});t&&t.users.length&&r(a,t)}},200))},p.addSearchHandler=function(s,a,r){a.on("keyup",utils.debounce(async()=>{const u=a.val(),f=await g.get(`/search/chats/${s}/users`,{query:u});r(f)},200))},p}.apply(_,h),m!==void 0&&(A.exports=m)}}]);
