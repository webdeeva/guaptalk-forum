"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,38395,49771,49897,69185,86198,95431,99127],{16227:(A,E,s)=>{var h,g;h=[s(52473)],g=function(k){const i={};let C;i.pids=[];let m=!1;i.init=function(t,r){i.pids.length=0,C=t,r=r||{},m=r.allowMainPostSelect||!1,$("#content").on("click",'[component="topic"] [component="post"]',l),c()};function l(t){t.stopPropagation();const r=$(this).attr("data-pid"),d=$('[component="topic"] [data-pid="'+r+'"]');!m&&parseInt($(this).attr("data-index"),10)===0||i.togglePostSelection(d,r)}i.disable=function(){i.pids.forEach(function(t){k.get("post","pid",t).toggleClass("selected",!1)}),$("#content").off("click",'[component="topic"] [component="post"]',l),u()},i.togglePostSelection=function(t,r){if(r){const d=i.pids.indexOf(r);d===-1?(i.pids.push(r),t.toggleClass("selected",!0)):(i.pids.splice(d,1),t.toggleClass("selected",!1)),i.pids.length&&i.pids.sort(function(n,o){return n-o}),typeof C=="function"&&C()}};function e(){return!1}function c(){$("#content").on("click",'[component="post"] button, [component="post"] a',e)}function u(){$("#content").off("click",'[component="post"] button, [component="post"] a',e)}return i}.apply(E,h),g!==void 0&&(A.exports=g)},49771:(A,E,s)=>{var h,g;h=[s(52473),s(16227),s(29930),s(65348)],g=function(k,i,C,m){const l={};let e,c,u,t;l.init=function(){u=ajaxify.data.tid,t=ajaxify.data.category,$(window).off("action:ajaxify.end",r).on("action:ajaxify.end",r),!e&&app.parseAndTranslate("modals/fork-topic",{selectedCategory:t},function(f){e=f,c=e.find("#fork_thread_commit"),$("body").append(e);const p=e.find('[component="category-selector"]');p.addClass("dropup"),m.init(p,{onSelect:function(P){t=P},privilege:"moderate"}),e.find("#fork_thread_cancel").on("click",a),e.find("#fork-title").on("keyup",o),i.init(function(){o(),n()}),n(),c.on("click",d)})};function r(){(ajaxify.data.template.name!=="topic"||ajaxify.data.tid!==u)&&(a(),$(window).off("action:ajaxify.end",r))}function d(){t&&(c.attr("disabled",!0),socket.emit("topics.createTopicFromPosts",{title:e.find("#fork-title").val(),pids:i.pids,fromTid:u,cid:t.cid},function(f,p){function P(y){k.get("post","pid",y).fadeOut(500,function(){$(this).remove()})}if(c.removeAttr("disabled"),f)return C.error(f.message);C.alert({timeout:5e3,title:"[[global:alert.success]]",message:"[[topic:fork-success]]",type:"success",clickfn:function(){ajaxify.go("topic/"+p.slug)}}),i.pids.forEach(function(y){P(y)}),a()}))}function n(){i.pids.length?e.find("#fork-pids").translateHtml("[[topic:fork-pid-count, "+i.pids.length+"]]"):e.find("#fork-pids").translateHtml("[[topic:fork-no-pids]]")}function o(){e.find("#fork-title").val().length&&i.pids.length?c.removeAttr("disabled"):c.attr("disabled",!0)}function a(){e&&(e.remove(),e=null,i.disable())}return l}.apply(E,h),g!==void 0&&(A.exports=g)},49897:(A,E,s)=>{s.r(E),s.d(E,{del:()=>d,get:()=>e,head:()=>c,patch:()=>t,post:()=>u,put:()=>r});var h=s(91749),g=s.n(h),k=s(33530),i=s.n(k);const C=config.relative_path+"/api/v3";async function m(n,o){if(n.url=n.url.startsWith("/api")?config.relative_path+n.url:C+n.url,typeof o=="function"){l(n).then(a=>o(null,a),a=>o(a));return}try{return await l(n)}catch(a){if(a.message==="A valid login session was not found. Please log in and try again."){const{url:f}=await(0,h.fire)("filter:admin.reauth",{url:"login"});return(0,k.confirm)("[[error:api.reauth-required]]",p=>{p&&ajaxify.go(f)})}throw a}}async function l(n){const{url:o}=n;delete n.url,n.data&&!(n.data instanceof FormData)&&(n.data=JSON.stringify(n.data||{}),n.headers["content-type"]="application/json; charset=utf-8"),{options:n}=await(0,h.fire)("filter:api.options",{options:n}),n.data&&(n.body=n.data,delete n.data);const a=await fetch(o,n),{headers:f}=a;if(f.get("x-redirect"))return l({url:f.get("x-redirect"),...n});const p=f.get("content-type"),P=p&&p.startsWith("application/json");let y;if(n.method!=="HEAD"&&(P?y=await a.json():y=await a.text()),!a.ok)throw y?new Error(P?y.status.message:y):new Error(a.statusText);return P&&y&&y.hasOwnProperty("status")&&y.hasOwnProperty("response")?y.response:y}function e(n,o,a){return m({url:n+(o&&Object.keys(o).length?"?"+$.param(o):"")},a)}function c(n,o,a){return m({url:n+(o&&Object.keys(o).length?"?"+$.param(o):""),method:"HEAD"},a)}function u(n,o,a){return m({url:n,method:"POST",data:o,headers:{"x-csrf-token":config.csrf_token}},a)}function t(n,o,a){return m({url:n,method:"PATCH",data:o,headers:{"x-csrf-token":config.csrf_token}},a)}function r(n,o,a){return m({url:n,method:"PUT",data:o,headers:{"x-csrf-token":config.csrf_token}},a)}function d(n,o,a){return m({url:n,method:"DELETE",data:o,headers:{"x-csrf-token":config.csrf_token}},a)}},65348:(A,E,s)=>{var h,g;h=[s(96349),s(33530),s(91749),s(17459)],g=function(k,i,C,m){const l={};return l.init=function(e,c){if(!e||!e.length)return;c=c||{};const u=c.onSelect||function(){};c.states=c.states||["watching","tracking","notwatching","ignoring"],c.template=c.template||"partials/category/selector-dropdown-left",C.fire("action:category.selector.options",{el:e,options:c}),k.init(e,c);const t={el:e,selectedCategory:null};e.on("click","[data-cid]",function(){const d=$(this);return d.hasClass("disabled")?!1:(t.selectCategory(d.attr("data-cid")),u(t.selectedCategory))});let r=t.el.find('[component="category-selector-selected"]').html();return m.translate(r,d=>{r=d}),t.selectCategory=function(d){const n=t.el.find('[data-cid="'+d+'"]');t.selectedCategory={cid:d,name:n.attr("data-name")},n.length?t.el.find('[component="category-selector-selected"]').html(n.find('[component="category-markup"]').html()):t.el.find('[component="category-selector-selected"]').html(r)},t.getSelectedCategory=function(){return t.selectedCategory},t.getSelectedCid=function(){return t.selectedCategory?t.selectedCategory.cid:0},c.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(c.template,{selectedCategory:c.selectedCategory},function(d){t.el.find('[component="category-selector-selected"]').html(d.find('[component="category-selector-selected"]').html())}),t},l.modal=function(e){e=e||{},e.onSelect=e.onSelect||function(){},e.onSubmit=e.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:e.message},function(c){const u=i.dialog({title:e.title||"[[modules:composer.select-category]]",message:c,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:r}}}),t=l.init(u.find('[component="category-selector"]'),e);function r(d){return d.preventDefault(),t.selectedCategory&&(e.onSubmit(t.selectedCategory),u.modal("hide")),!1}e.openOnLoad&&u.on("shown.bs.modal",function(){u.find(".dropdown-toggle").dropdown("toggle")}),u.find("form").on("submit",r)})},l}.apply(E,h),g!==void 0&&(A.exports=g)},96349:(A,E,s)=>{var h,g;h=[s(29930),s(89336),s(49897)],g=function(k,i,C){const m={};return m.init=function(l,e){let c=e.defaultCategories||null;e=e||{},e.privilege=e.privilege||"topics:read",e.states=e.states||["watching","tracking","notwatching","ignoring"],e.cacheList=e.hasOwnProperty("cacheList")?e.cacheList:!0;let u=[];Array.isArray(e.localCategories)&&(u=e.localCategories.map(o=>({...o})),c&&(c=[...u,...c])),e.selectedCids=e.selectedCids||ajaxify.data.selectedCids||[];const t=l.find('[component="category-selector-search"]');if(!t.length)return;const r=t.parents('[component="category/dropdown"]').length>0||t.parents('[component="category-selector"]').length>0;l.on("show.bs.dropdown",function(){r&&t.removeClass("hidden");function o(){const a=t.find("input").val();a.length>1||!a&&!c?d(a,function(f){c=e.cacheList&&(c||f),n(f)}):!a&&c&&n(c)}t.on("click",function(a){a.preventDefault(),a.stopPropagation()}),t.find("input").val("").on("keyup",utils.debounce(o,300)),o()}),l.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||t.find("input").focus()}),l.on("hide.bs.dropdown",function(){r&&t.addClass("hidden"),t.off("click"),t.find("input").off("keyup")});function d(o,a){C.get("/search/categories",{search:o,query:utils.params(),parentCid:e.parentCid||0,selectedCids:e.selectedCids,privilege:e.privilege,states:e.states,showLinks:e.showLinks},function(f,{categories:p}){if(f)return k.error(f);a(u.concat(p))})}function n(o){const a=e.selectedCids.map(String);o.forEach(function(f){f.selected=a.includes(String(f.cid))}),app.parseAndTranslate(e.template,{categoryItems:o.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(f){l.find('[component="category/list"]').html(f.find('[component="category/list"]').html()),l.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!o.length);const p=i.Dropdown.getInstance(l.find(".dropdown-toggle").get(0));p&&p.update()})}},m}.apply(E,h),g!==void 0&&(A.exports=g)}}]);
