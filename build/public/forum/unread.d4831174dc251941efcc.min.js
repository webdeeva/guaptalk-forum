"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[68326,77200],{19046:(C,h,d)=>{var f,l;f=[d(91749)],l=function(w){const p={},g={ignoring:1,notwatching:2,watching:3};p.initUnreadTopics=function(){const e=app.user.unreadData;function t(c){if(c&&c.posts&&c.posts.length&&e){const o=c.posts[0];if(parseInt(o.uid,10)===parseInt(app.user.uid,10)||!o.topic.isFollowing&&o.categoryWatchState!==g.watching)return;const a=o.topic.tid;(!e[""][a]||!e.new[a]||!e.watched[a]||!e.unreplied[a])&&n(a),e[""][a]||(i(""),e[""][a]=!0),o.isMain&&parseInt(o.uid,10)!==parseInt(app.user.uid,10)&&!e.new[a]&&(i("new"),e.new[a]=!0),parseInt(o.topic.postcount,10)<=1&&!e.unreplied[a]&&(i("unreplied"),e.unreplied[a]=!0),o.topic.isFollowing&&!e.watched[a]&&(i("watched"),e.watched[a]=!0)}}function i(c){const o="/unread"+(c?"?filter="+c:""),a=1+parseInt($('a[href="'+config.relative_path+o+'"].navigation-link i').attr("data-content"),10);s(o,a)}function n(c){$('[data-tid="'+c+'"]').addClass("unread")}$(window).on("action:ajaxify.end",function(){ajaxify.data.template.topic&&["","new","watched","unreplied"].forEach(function(c){delete e[c][ajaxify.data.tid]})}),socket.removeListener("event:new_post",t),socket.on("event:new_post",t),socket.removeListener("event:unread.updateCount",m),socket.on("event:unread.updateCount",m)};function m(e){s("/unread",e.unreadTopicCount),s("/unread?filter=new",e.unreadNewTopicCount),s("/unread?filter=watched",e.unreadWatchedTopicCount),s("/unread?filter=unreplied",e.unreadUnrepliedTopicCount)}function s(e,t){if(!utils.isNumber(t))return;t=Math.max(0,t);const i=t>99?"99+":t,n=$('a[href="'+config.relative_path+e+'"].navigation-link');n.find("i").toggleClass("unread-count",t>0).attr("data-content",i),n.find('[component="navigation/count"]').toggleClass("hidden",t<=0).text(t),n.length&&($('#mobile-menu [data-unread-url="'+e+'"]').attr("data-content",i),$('[component="unread/count"][data-unread-url="'+e+'"]').toggleClass("hidden",t<=0).text(i)),w.fire("action:unread.updateCount",{url:e,count:t})}return p.updateUnreadTopicCount=s,p}.apply(h,f),l!==void 0&&(C.exports=l)},45876:(C,h,d)=>{var f,l;f=[d(19046),d(70550),d(52473),d(47682),d(65348),d(29930),d(49897)],l=function(w,p,g,m,s,e,t){const i={};i.init=function(){app.enterRoom("unread_topics"),n(),m.init("unread"),w.updateUnreadTopicCount("/"+ajaxify.data.selectedFilter.url,ajaxify.data.topicCount)};function n(){function a(){socket.emit("topics.markAllRead",function(r){if(r)return e.error(r);e.success("[[unread:topics-marked-as-read.success]]"),$('[component="category"]').empty(),$('[component="pagination"]').addClass("hidden"),$("#category-no-topics").removeClass("hidden"),$(".markread").addClass("hidden")})}function y(){const r=p.getSelectedTids();r.length&&Promise.all(r.map(async E=>t.put(`/topics/${E}/read`))).then(()=>{c(r)})}function T(r){function E(u){const k=[];return g.get("category/topic","cid",u).each(function(){k.push($(this).attr("data-tid"))}),k}const v=E(r);socket.emit("topics.markCategoryTopicsRead",r,function(u){if(u)return e.error(u);c(v)})}let A=ajaxify.data.topics.reduce((r,E)=>{const{category:v}=E;let{cid:u}=v;return u=utils.isNumber(u)?parseInt(u,10):u,r.set(u,v),r},new Map);A=Array.from(A.values());const S=s.init($('[component="category-selector"]'),{onSelect:function(r){S.selectCategory(0),r.cid==="all"?a():r.cid==="selected"?y():r.cid&&T(r.cid)},selectCategoryLabel:ajaxify.data.selectCategoryLabel||"[[unread:mark-as-read]]",localCategories:[{cid:"selected",name:"[[unread:selected]]",icon:""},{cid:"all",name:"[[unread:all]]",icon:""}],defaultCategories:A})}function c(a){o(a),e.success("[[unread:topics-marked-as-read.success]]"),$('[component="category"]').children().length||($("#category-no-topics").removeClass("hidden"),$(".markread").addClass("hidden"))}function o(a){for(let y=0;y<a.length;y+=1)g.get("category/topic","tid",a[y]).remove()}return i}.apply(h,f),l!==void 0&&(C.exports=l)},65348:(C,h,d)=>{var f,l;f=[d(96349),d(33530),d(91749),d(17459)],l=function(w,p,g,m){const s={};return s.init=function(e,t){if(!e||!e.length)return;t=t||{};const i=t.onSelect||function(){};t.states=t.states||["watching","tracking","notwatching","ignoring"],t.template=t.template||"partials/category/selector-dropdown-left",g.fire("action:category.selector.options",{el:e,options:t}),w.init(e,t);const n={el:e,selectedCategory:null};e.on("click","[data-cid]",function(){const o=$(this);return o.hasClass("disabled")?!1:(n.selectCategory(o.attr("data-cid")),i(n.selectedCategory))});let c=n.el.find('[component="category-selector-selected"]').html();return m.translate(c,o=>{c=o}),n.selectCategory=function(o){const a=n.el.find('[data-cid="'+o+'"]');n.selectedCategory={cid:o,name:a.attr("data-name")},a.length?n.el.find('[component="category-selector-selected"]').html(a.find('[component="category-markup"]').html()):n.el.find('[component="category-selector-selected"]').html(c)},n.getSelectedCategory=function(){return n.selectedCategory},n.getSelectedCid=function(){return n.selectedCategory?n.selectedCategory.cid:0},t.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(t.template,{selectedCategory:t.selectedCategory},function(o){n.el.find('[component="category-selector-selected"]').html(o.find('[component="category-selector-selected"]').html())}),n},s.modal=function(e){e=e||{},e.onSelect=e.onSelect||function(){},e.onSubmit=e.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:e.message},function(t){const i=p.dialog({title:e.title||"[[modules:composer.select-category]]",message:t,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:c}}}),n=s.init(i.find('[component="category-selector"]'),e);function c(o){return o.preventDefault(),n.selectedCategory&&(e.onSubmit(n.selectedCategory),i.modal("hide")),!1}e.openOnLoad&&i.on("shown.bs.modal",function(){i.find(".dropdown-toggle").dropdown("toggle")}),i.find("form").on("submit",c)})},s}.apply(h,f),l!==void 0&&(C.exports=l)}}]);
