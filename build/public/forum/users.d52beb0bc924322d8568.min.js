"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,66131,95737,99127],{30637:(P,E,s)=>{var u,h;u=[s(49897),s(81335),s(33530),s(29930)],h=function(g,C,y,a){const r={};function c(){return ajaxify.data.template.name.startsWith("admin/")}return r.handle=function(){$('[component="user/invite"]').on("click",function(v){v.preventDefault(),g.get(`/api/v3/users/${app.user.uid}/invites/groups`,{}).then(p=>{C.parse("modals/invite",{groups:p},function(l){y.dialog({message:l,title:`[[${c()?"admin/manage/users:invite":"users:invite"}]]`,onEscape:!0,buttons:{cancel:{label:`[[${c()?"admin/manage/users:alerts.button-cancel":"modules:bootbox.cancel"}]]`,className:"btn-default"},invite:{label:`[[${c()?"admin/manage/users:invite":"users:invite"}]]`,className:"btn-primary",callback:r.send}}})})}).catch(a.error)})},r.send=function(){const v=$("#invite-modal-emails"),p=$("#invite-modal-groups"),l={emails:v.val().split(",").map(m=>m.trim()).filter(Boolean).filter((m,A,n)=>A===n.indexOf(m)).join(","),groupsToJoin:p.val()};l.emails&&g.post(`/users/${app.user.uid}/invites`,l).then(()=>{a.success(`[[${c()?"admin/manage/users:alerts.email-sent-to":"users:invitation-email-sent"}, ${l.emails.replace(/,/g,"&#44; ")}]]`)}).catch(a.error)},r}.apply(E,u),h!==void 0&&(P.exports=h)},34567:(P,E,s)=>{var u,h;u=[s(49897),s(29930),s(30637)],h=function(g,C,y){const a={};let r=0;a.init=function(){app.enterRoom("user_list");const t=utils.param("section")?"?section="+utils.param("section"):"",e=$('[component="user/list/menu"]');e.find("a").removeClass("active"),e.find('a[href="'+window.location.pathname+t+'"]').addClass("active"),a.handleSearch(),y.handle(),socket.removeListener("event:user_status_change",m),socket.on("event:user_status_change",m)},a.handleSearch=function(t){r=t&&t.resultCount,$("#search-user").on("keyup",utils.debounce(c,250)),$('.search select, .search input[type="checkbox"]').on("change",c);const e=document.getElementById("search-user");if(e){const i=new URLSearchParams(document.location.search).get("query");i&&(e.value=i),utils.isMobile()||e.focus()}};function c(){if(!ajaxify.data.template.users)return;$('[component="user/search/icon"]').removeClass("fa-search").addClass("fa-spinner fa-spin");const t=n(),e={section:t||"users",page:1},f=$("#search-user").val();if(f)e.query=f;else return p(e);const i=v();i&&(e.sortBy=i);const d=[];($(".search .online-only").is(":checked")||t==="online")&&d.push("online"),t==="banned"&&d.push("banned"),t==="flagged"&&d.push("flagged"),d.length&&(e.filters=d),p(e)}function v(){let t;const e=n();return e==="sort-posts"?t="postcount":e==="sort-reputation"?t="reputation":e==="users"&&(t="joindate"),t}function p(t){g.get("/api/users",t).then(l).catch(C.error);const e=new URLSearchParams(t);ajaxify.updateHistory(`users?${e.toString()}`,!0)}function l(t){app.parseAndTranslate("partials/paginator",{pagination:t.pagination}).then(function(e){$(".pagination-container").replaceWith(e)}),r&&(t.users=t.users.slice(0,r)),t.isAdminOrGlobalMod=app.user.isAdmin||app.user.isGlobalMod,app.parseAndTranslate("users","users",t,function(e){$("#users-container").html(e),e.find(".timeago").timeago(),$('[component="user/search/icon"]').addClass("fa-search").removeClass("fa-spinner fa-spin")})}function m(t){const e=n();(e.startsWith("online")||e.startsWith("users"))&&A(t)}function A(t){app.updateUserStatus($('#users-container [data-uid="'+t.uid+'"] [component="user/status"]'),t.status)}function n(){return utils.param("section")||""}return a}.apply(E,u),h!==void 0&&(P.exports=h)},49897:(P,E,s)=>{s.r(E),s.d(E,{del:()=>A,get:()=>c,head:()=>v,patch:()=>l,post:()=>p,put:()=>m});var u=s(91749),h=s.n(u),g=s(33530),C=s.n(g);const y=config.relative_path+"/api/v3";async function a(n,t){if(n.url=n.url.startsWith("/api")?config.relative_path+n.url:y+n.url,typeof t=="function"){r(n).then(e=>t(null,e),e=>t(e));return}try{return await r(n)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again."){const{url:f}=await(0,u.fire)("filter:admin.reauth",{url:"login"});return(0,g.confirm)("[[error:api.reauth-required]]",i=>{i&&ajaxify.go(f)})}throw e}}async function r(n){const{url:t}=n;delete n.url,n.data&&!(n.data instanceof FormData)&&(n.data=JSON.stringify(n.data||{}),n.headers["content-type"]="application/json; charset=utf-8"),{options:n}=await(0,u.fire)("filter:api.options",{options:n}),n.data&&(n.body=n.data,delete n.data);const e=await fetch(t,n),{headers:f}=e;if(f.get("x-redirect"))return r({url:f.get("x-redirect"),...n});const i=f.get("content-type"),d=i&&i.startsWith("application/json");let o;if(n.method!=="HEAD"&&(d?o=await e.json():o=await e.text()),!e.ok)throw o?new Error(d?o.status.message:o):new Error(e.statusText);return d&&o&&o.hasOwnProperty("status")&&o.hasOwnProperty("response")?o.response:o}function c(n,t,e){return a({url:n+(t&&Object.keys(t).length?"?"+$.param(t):"")},e)}function v(n,t,e){return a({url:n+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"HEAD"},e)}function p(n,t,e){return a({url:n,method:"POST",data:t,headers:{"x-csrf-token":config.csrf_token}},e)}function l(n,t,e){return a({url:n,method:"PATCH",data:t,headers:{"x-csrf-token":config.csrf_token}},e)}function m(n,t,e){return a({url:n,method:"PUT",data:t,headers:{"x-csrf-token":config.csrf_token}},e)}function A(n,t,e){return a({url:n,method:"DELETE",data:t,headers:{"x-csrf-token":config.csrf_token}},e)}}}]);
