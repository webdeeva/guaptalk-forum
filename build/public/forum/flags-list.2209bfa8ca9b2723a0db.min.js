"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,13417,26174,26874,34271,34405,37019,49897,51831,69185,99127],{13230:(w,D,l)=>{var u,m,v;(function(_){m=[l(53050)],u=_,v=typeof u=="function"?u.apply(D,m):u,v!==void 0&&(w.exports=v)})(function(_){const k=_("[^\\p{L}\\s\\d\\-_@.]","g"),y=/[^\w\s\d\-_@.]/g,E=/^\s+|\s+$/g,a=/\s+/g,i=/-+/g,c=/-$/g,o=/^-/g,s=/^[\w\d\s.,\-@]+$/;return function(e,t){return e?(e=String(e).replace(E,""),s.test(e)?e=e.replace(y,"-"):e=_.replace(e,k,"-"),e=t?e:e.toLocaleLowerCase(),e=e.replace(a,"-"),e=e.replace(i,"-"),e=e.replace(c,""),e=e.replace(o,""),e):""}})},33491:(w,D,l)=>{l.r(D),l.d(D,{enableCheckboxes:()=>n,enableFilterForm:()=>e,getSelected:()=>p,handleBulkActions:()=>d,handleGraphs:()=>h,init:()=>g});var u=l(70106),m=l(39259),v=l.n(m),_=l(64308),k=l.n(_),y=l(34405),E=l.n(y),a=l(49897),i=l(29930),c=l(52473),o=l.n(c);u.t1.register(u.ZT,u.PP,u.kc,u.No,u.FN,u.m_,u.dN);const s=new Map([["cids",[]],["assignee",[]],["targetUid",[]],["reporterId",[]]]);function g(){e(),n(),d(),ajaxify.data.filters.hasOwnProperty("cid")&&s.set("cids",Array.isArray(ajaxify.data.filters.cid)?ajaxify.data.filters.cid:[ajaxify.data.filters.cid]),m.init($('[component="category/dropdown"]'),{privilege:"moderate",selectedCids:s.get("cids"),updateButton:function({selectedCids:r}){s.set("cids",r),t()}}),["assignee","targetUid","reporterId"].forEach(r=>{ajaxify.data.filters.hasOwnProperty("filter")&&s.set(r,ajaxify.data.selected[r]);const f=$(`[component="flags/filter/${r}"]`);_.init(f,{selectedUsers:s.get(r),template:"partials/flags/filters",selectedBlock:`selected.${r}`,onSelect:function(C){s.set(r,C)},onHidden:function(){t()}})}),c.get("flags/list").on("click","[data-flag-id]",function(r){if(["BUTTON","A"].includes(r.target.nodeName))return;const f=this.getAttribute("data-flag-id");ajaxify.go("flags/"+f)}),$("#flags-daily-wrapper").one("shown.bs.collapse",function(){h()}),y.user($("#filter-assignee, #filter-targetUid, #filter-reporterId"),(r,f)=>{setTimeout(()=>{r.target.value=f.item.user.uid})})}function e(){const r=c.get("flags/filters");if(r&&r.get(0).nodeName!=="FORM"){const f=r.get(0),C=f.querySelector("form");f.addEventListener("click",b=>{const A=b.target.closest("[data-value]");if(!A)return;const P=A.getAttribute("data-name"),x=A.getAttribute("data-value");C[P].value=x,t()})}else{for(const[f,C]of Object.entries(ajaxify.data.filters))r.find('[name="'+f+'"]').val(C);r.find('[name="sort"]').val(ajaxify.data.sort),document.getElementById("apply-filters").addEventListener("click",function(){t()}),r.find('button[data-target="#more-filters"]').click(f=>{const C=f.target.getAttribute("data-text-variant");C&&(f.target.setAttribute("data-text-variant",f.target.textContent),f.target.firstChild.textContent=C)})}}function t(){let r=c.get("flags/filters").get(0);if(!r)return;r.nodeName!=="FORM"&&(r=r.querySelector("form"));const f=new FormData(r);s.get("cids").forEach(function(A){f.append("cid",A)}),["assignee","targetUid","reporterId"].forEach(A=>{s.get(A).forEach(({uid:P})=>{f.append(A,P)})});const C=Array.from(f.values()).filter(Boolean),b=new URLSearchParams(f).toString();ajaxify.go("flags?"+(C?b:"reset=1"))}function n(){const r=document.querySelector('[component="flags/list"]'),f=r.querySelectorAll('[data-flag-id] input[type="checkbox"]'),C=document.querySelector('[component="flags/bulk-actions"] button');let b;document.querySelector('[data-action="toggle-all"]').addEventListener("click",function(){const A=this.checked;f.forEach(function(P){P.checked=A}),C.disabled=!A}),r.addEventListener("click",function(A){const P=A.target.closest('input[type="checkbox"]');if(P){if(A.stopImmediatePropagation(),b&&A.shiftKey&&b!==P){const x=P.checked;let O=!1;f.forEach(function(M){[P,b].some(function(B){return B===M})&&(O=!O),O&&(M.checked=x)})}C.disabled=!Array.prototype.some.call(f,function(x){return x.checked}),b=P}A.target.querySelector('input[type="checkbox"]')&&A.stopImmediatePropagation()})}function d(){document.querySelector('[component="flags/bulk-actions"]').addEventListener("click",function(r){const f=r.target.closest("[data-action]");if(f){const C=f.getAttribute("data-action");let b;C==="bulk-purge"&&(b=new Promise((x,O)=>{bootbox.confirm("[[flags:confirm-purge]]",M=>{M?x():O(new Error("[[flags:purge-cancelled]]"))})}));const P=p().map(async x=>{const O={};switch(C){case"bulk-assign":{O.assignee=app.user.uid;break}case"bulk-mark-resolved":{O.state="resolved";break}case"bulk-purge":return await b,a.del(`/flags/${x}`)}return a.put(`/flags/${x}`,O)});Promise.allSettled(P).then(function(x){const O=x.filter(function(B){return B.status==="fulfilled"}).length,M=x.filter(function(B){return B.status==="rejected"});O&&(i.success("[[flags:bulk-success, "+O+"]]"),ajaxify.refresh()),M.forEach(function(B){i.error(B.reason)})})}})}function p(){const r=document.querySelectorAll('[component="flags/list"] [data-flag-id] input[type="checkbox"]'),f=[];return r.forEach(function(C){C.checked&&f.push(C.closest("[data-flag-id]").getAttribute("data-flag-id"))}),f}function h(){const r=document.getElementById("flags:daily"),f=utils.getDaysArray().map(function(b,A){return A%3?"":b});utils.isMobile()&&(u.t1.defaults.plugins.tooltip.enabled=!1);const C={"flags:daily":{labels:f,datasets:[{label:"",backgroundColor:"rgba(151,187,205,0.2)",borderColor:"rgba(151,187,205,1)",pointBackgroundColor:"rgba(151,187,205,1)",pointHoverBackgroundColor:"#fff",pointBorderColor:"#fff",pointHoverBorderColor:"rgba(151,187,205,1)",data:ajaxify.data.analytics}]}};r.width=$(r).parent().width(),new u.t1(r.getContext("2d"),{type:"line",data:C["flags:daily"],options:{responsive:!0,animation:!1,scales:{y:{beginAtZero:!0}}}})}},34405:(w,D,l)=>{var u,m;u=[l(49897),l(29930),l(36e3),l(9787),l(35786)],m=function(v,_,{Textcomplete:k},{TextareaEditor:y},{ContenteditableEditor:E}){const a={},i={delay:200,appendTo:null};a.init=o=>{const s={...i,...o},{input:g,onSelect:e}=s;app.loadJQueryUI(function(){g.autocomplete({...s,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(t,n){c(g,e,t,n)}})})},a.user=function(o,s,g){typeof s=="function"&&(g=s,s={}),s=s||{},a.init({input:o,onSelect:g,source:(e,t)=>{s.query=e.term,v.get("/api/users",s,function(n,d){if(n)return _.error(n);if(d&&d.users){const p=d.users.map(function(h){const r=$("<div></div>").html(h.username).text();return h&&{label:r,value:r,user:{uid:h.uid,name:h.username,slug:h.userslug,username:h.username,userslug:h.userslug,displayname:h.displayname,picture:h.picture,banned:h.banned,"icon:text":h["icon:text"],"icon:bgColor":h["icon:bgColor"]}}});t(p)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},a.group=function(o,s){a.init({input:o,onSelect:s,source:(g,e)=>{socket.emit("groups.search",{query:g.term},function(t,n){if(t)return _.error(t);if(n&&n.length){const d=n.map(function(p){return p&&{label:p.name,value:p.name,group:p}});e(d)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},a.tag=function(o,s){a.init({input:o,onSelect:s,delay:100,source:(g,e)=>{socket.emit("topics.autocompleteTags",{query:g.term,cid:ajaxify.data.cid||0},function(t,n){if(t)return _.error(t);n&&e(n),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function c(o,s,g,e){s=s||function(){};const t=jQuery.Event("keypress");t.which=13,t.keyCode=13,setTimeout(function(){o.trigger(t)},100),s(g,e)}return a.setup=function({element:o,strategies:s,options:g}){const e=o.get(0);if(e){var t;if(e.nodeName==="TEXTAREA"||e.nodeName==="INPUT"?t=new y(e):e.nodeName==="DIV"&&e.getAttribute("contenteditable")==="true"&&(t=new E(e)),!t)throw new Error("unknown target element type");e.setAttribute("dir",document.querySelector("html").getAttribute("data-dir"));var n=new k(t,s,{dropdown:g});return n.on("rendered",function(){n.dropdown.items.length&&n.dropdown.items[0].activate()}),n}},a}.apply(D,u),m!==void 0&&(w.exports=m)},39259:(w,D,l)=>{var u,m;u=[l(96349),l(49897),l(91749)],m=function(v,_,k){const y={};y.init=function(a,i){if(!a||!a.length)return;i=i||{},i.states=i.states||["watching","tracking","notwatching","ignoring"],i.template=i.template||"partials/category/filter-dropdown-left",k.fire("action:category.filter.options",{el:a,options:i}),v.init(a,i);let c=[],o=[];Array.isArray(i.selectedCids)?c=i.selectedCids.map(String):Array.isArray(ajaxify.data.selectedCids)&&(c=ajaxify.data.selectedCids.map(String)),o=c.slice(),a.on("hidden.bs.dropdown",function(){let s=o.length!==c.length;if(o.forEach(function(g,e){g!==c[e]&&(s=!0)}),o=c.slice(),s&&(i.updateButton?i.updateButton({el:a,changed:s,selectedCids:c.slice()}):i.updateButton!==!1&&E(a,c)),i.onHidden){i.onHidden({changed:s,selectedCids:c.slice()});return}if(s){let g=window.location.pathname;const e=utils.params();c.length?e.cid=c:delete e.cid,delete e.page,Object.keys(e).length&&(g+="?"+$.param(e)),ajaxify.go(g)}}),a.on("click",'[component="category/list"] [data-cid]',function(s){const g=a.find('[component="category/list"]'),e=$(this),t=e.find("a").attr("href");if(t&&t!=="#"&&t.length){s.stopPropagation();return}const n=e.attr("data-cid"),d=e.find('[component="category/select/icon"]');return n!=="all"?(c.includes(n)?c.splice(c.indexOf(n),1):c.push(n),c.sort(function(p,h){return p-h}),d.toggleClass("invisible"),g.find('[data-cid="all"] i').toggleClass("invisible",!!c.length)):(a.find('[component="category/select/icon"]').addClass("invisible"),g.find('[data-cid="all"] i').removeClass("invisible"),c=[]),i.selectedCids=c,i.onSelect&&i.onSelect({cid:n,selectedCids:c.slice()}),!1})};function E(a,i){i.length>1?c({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):i.length===1?_.get(`/categories/${i[0]}`,{}).then(c):c();function c(o){app.parseAndTranslate("partials/category/filter-dropdown-content",{selectedCategory:o},function(s){a.find("button").replaceWith($("<div/>").html(s).find("button"))})}}return y}.apply(D,u),m!==void 0&&(w.exports=m)},49897:(w,D,l)=>{l.r(D),l.d(D,{del:()=>g,get:()=>a,head:()=>i,patch:()=>o,post:()=>c,put:()=>s});var u=l(91749),m=l.n(u),v=l(33530),_=l.n(v);const k=config.relative_path+"/api/v3";async function y(e,t){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:k+e.url,typeof t=="function"){E(e).then(n=>t(null,n),n=>t(n));return}try{return await E(e)}catch(n){if(n.message==="A valid login session was not found. Please log in and try again."){const{url:d}=await(0,u.fire)("filter:admin.reauth",{url:"login"});return(0,v.confirm)("[[error:api.reauth-required]]",p=>{p&&ajaxify.go(d)})}throw n}}async function E(e){const{url:t}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,u.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const n=await fetch(t,e),{headers:d}=n;if(d.get("x-redirect"))return E({url:d.get("x-redirect"),...e});const p=d.get("content-type"),h=p&&p.startsWith("application/json");let r;if(e.method!=="HEAD"&&(h?r=await n.json():r=await n.text()),!n.ok)throw r?new Error(h?r.status.message:r):new Error(n.statusText);return h&&r&&r.hasOwnProperty("status")&&r.hasOwnProperty("response")?r.response:r}function a(e,t,n){return y({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},n)}function i(e,t,n){return y({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"HEAD"},n)}function c(e,t,n){return y({url:e,method:"POST",data:t,headers:{"x-csrf-token":config.csrf_token}},n)}function o(e,t,n){return y({url:e,method:"PATCH",data:t,headers:{"x-csrf-token":config.csrf_token}},n)}function s(e,t,n){return y({url:e,method:"PUT",data:t,headers:{"x-csrf-token":config.csrf_token}},n)}function g(e,t,n){return y({url:e,method:"DELETE",data:t,headers:{"x-csrf-token":config.csrf_token}},n)}},64308:(w,D,l)=>{var u,m;u=[l(49897),l(91749),l(13230),l(81335)],m=function(v,_,k,y){const E={};return E.init=function(a,i){if(!a||!a.length)return;i=i||{};let c,o=[];i.selectedUsers&&(o=i.selectedUsers.map(t=>({...t}))),_.fire("action:user.filter.options",{el:a,options:i});async function s(){const t=i.selectedBlock||"userFilterSelected",n={};if(t.indexOf(".")!==-1){const p=t.split(".");n[p[0]]={},n[p[0]][p[1]]=o}else n[t]=o;const d=await app.parseAndTranslate(i.template,t,n);a.find('[component="user/filter/selected"]').html(d)}async function g(){await s(),i.onSelect&&i.onSelect(o)}async function e(){let t={users:[]};const n=a.find('[component="user/filter/search"]').val();if(n&&n.length>1)if(app.user.privileges["search:users"])t=await v.get("/api/users",{query:n});else try{const h=await v.get(`/api/user/${k(n)}`);t.users.push(h)}catch(h){console.error(h)}if(!t.users.length){a.find('[component="user/filter/results"]').translateHtml("[[users:no-users-found]]");return}t.users=t.users.slice(0,20);const d={};t.users.forEach(h=>{d[h.uid]=h});const p=await app.parseAndTranslate(i.template,"userFilterResults",{userFilterResults:t.users});a.find('[component="user/filter/results"]').html(p),a.find('[component="user/filter/results"] [data-uid]').on("click",async function(){const h=parseInt($(this).attr("data-uid"),10);o.find(r=>r.uid===h)||(o.push(d[h]),await g())})}a.find('[component="user/filter/search"]').on("keyup",()=>{a.find('[component="user/filter/results"]').html(c)}),a.find('[component="user/filter/search"]').on("keyup",utils.debounce(function(){app.user.privileges["search:users"]&&e()},1e3)),a.on("click",'[component="user/filter/delete"]',async function(){const t=$(this).attr("data-uid");o=o.filter(n=>parseInt(n.uid,10)!==parseInt(t,10)),await g()}),a.find('[component="user/filter/search"]').on("keyup",t=>{t.key==="Enter"&&!app.user.privileges["search:users"]&&e()}),a.on("shown.bs.dropdown",function(){a.find('[component="user/filter/search"]').trigger("focus")}),a.on("hidden.bs.dropdown",function(){i.onHidden&&i.onHidden(o)}),y.render(i.placeholderTemplate||"partials/userFilter-placeholders").then(t=>{c=t})},E}.apply(D,u),m!==void 0&&(w.exports=m)},96349:(w,D,l)=>{var u,m;u=[l(29930),l(89336),l(49897)],m=function(v,_,k){const y={};return y.init=function(E,a){let i=a.defaultCategories||null;a=a||{},a.privilege=a.privilege||"topics:read",a.states=a.states||["watching","tracking","notwatching","ignoring"],a.cacheList=a.hasOwnProperty("cacheList")?a.cacheList:!0;let c=[];Array.isArray(a.localCategories)&&(c=a.localCategories.map(t=>({...t})),i&&(i=[...c,...i])),a.selectedCids=a.selectedCids||ajaxify.data.selectedCids||[];const o=E.find('[component="category-selector-search"]');if(!o.length)return;const s=o.parents('[component="category/dropdown"]').length>0||o.parents('[component="category-selector"]').length>0;E.on("show.bs.dropdown",function(){s&&o.removeClass("hidden");function t(){const n=o.find("input").val();n.length>1||!n&&!i?g(n,function(d){i=a.cacheList&&(i||d),e(d)}):!n&&i&&e(i)}o.on("click",function(n){n.preventDefault(),n.stopPropagation()}),o.find("input").val("").on("keyup",utils.debounce(t,300)),t()}),E.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||o.find("input").focus()}),E.on("hide.bs.dropdown",function(){s&&o.addClass("hidden"),o.off("click"),o.find("input").off("keyup")});function g(t,n){k.get("/search/categories",{search:t,query:utils.params(),parentCid:a.parentCid||0,selectedCids:a.selectedCids,privilege:a.privilege,states:a.states,showLinks:a.showLinks},function(d,{categories:p}){if(d)return v.error(d);n(c.concat(p))})}function e(t){const n=a.selectedCids.map(String);t.forEach(function(d){d.selected=n.includes(String(d.cid))}),app.parseAndTranslate(a.template,{categoryItems:t.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(d){E.find('[component="category/list"]').html(d.find('[component="category/list"]').html()),E.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!t.length);const p=_.Dropdown.getInstance(E.find(".dropdown-toggle").get(0));p&&p.update()})}},y}.apply(D,u),m!==void 0&&(w.exports=m)}}]);
