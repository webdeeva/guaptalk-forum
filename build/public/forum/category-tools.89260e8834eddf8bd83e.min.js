"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[14526,42619],{70550:(S,M,c)=>{var x,v;x=[c(52473)],v=function(a){const C={};let i,u;C.init=function(o){u=$('[component="category"]'),u.on("selectstart",'[component="topic/select"]',function(s){s.preventDefault()}),u.on("click",'[component="topic/select"]',function(s){const l=$(this).parents('[component="category/topic"]');if(s.shiftKey)return A(l.attr("data-tid")),i=l,!1;const k=l.hasClass("selected");D(l,!k),i=l,typeof o=="function"&&o()})};function D(o,s){const f=o.find('[component="topic/select"]');f.toggleClass("fa-check-square-o",s),f.toggleClass("fa-square-o",!s),f.parents('[component="category/topic"]').toggleClass("selected",s),d()}function d(){const o=$('[component="topic/selected/badge"]');if(o.length){const s=u.find('[component="category/topic"].selected').length;o.text(s>0?s:"")}}C.getSelectedTids=function(){const o=[];return u&&u.find('[component="category/topic"].selected').each(function(){o.push($(this).attr("data-tid"))}),o},C.unselectAll=function(){u&&(u.find('[component="category/topic"].selected').removeClass("selected"),u.find('[component="topic/select"]').toggleClass("fa-check-square-o",!1).toggleClass("fa-square-o",!0),d())};function A(o){i||(i=$('[component="category/topic"]').first());const s=a.get("category/topic","tid",o).hasClass("selected"),f=E(o),l=E(i.attr("data-tid"));p(f,l,!s)}function p(o,s,f){if(o>s){const l=o;o=s,s=l}for(let l=o;l<=s;l+=1){const k=$('[component="category/topic"]').eq(l);D(k,f)}}function E(o){return a.get("category/topic","tid",o).index('[component="category/topic"]')}return C}.apply(M,x),v!==void 0&&(S.exports=v)},71131:(S,M,c)=>{var x,v;x=[c(70550),c(60984),c(52473),c(49897),c(33530),c(29930)],v=function(a,C,i,u,D,d){const A={};A.init=function(){a.init(l),N(),$('[component="category/topic"]').each((e,t)=>{C.observeTopicLabels($(t).find('[component="topic/labels"]'))}),i.get("topic/delete").on("click",function(){return p("del","/state","delete",s),!1}),i.get("topic/restore").on("click",function(){return p("put","/state","restore",s),!1}),i.get("topic/purge").on("click",function(){return p("del","","purge",f),!1}),i.get("topic/lock").on("click",function(){return p("put","/lock","lock",o),!1}),i.get("topic/unlock").on("click",function(){return p("del","/lock","unlock",o),!1}),i.get("topic/pin").on("click",function(){return p("put","/pin","pin",o),!1}),i.get("topic/unpin").on("click",function(){return p("del","/pin","unpin",o),!1}),i.get("topic/mark-unread-for-all").on("click",function(){const e=a.getSelectedTids();return e.length?(socket.emit("topics.markAsUnreadForAll",e,function(t){if(t)return d.error(t);d.success("[[topic:markAsUnreadForAll.success]]"),e.forEach(function(n){$('[component="category/topic"][data-tid="'+n+'"]').addClass("unread")}),o()}),!1):d.error("[[error:no-topics-selected]]")}),i.get("topic/move").on("click",function(){return c.e(28310).then(function(){var e=[c(28310)];(function(t){const n=a.getSelectedTids();if(!n.length)return d.error("[[error:no-topics-selected]]");t.init(n,null,o)}).apply(null,e)}).catch(c.oe),!1}),i.get("topic/move-all").on("click",function(){const e=ajaxify.data.cid;if(!ajaxify.data.template.category)return d.error("[[error:invalid-data]]");c.e(28310).then(function(){var t=[c(28310)];(function(n){n.init(null,e,function(r){if(r)return d.error(r);ajaxify.refresh()})}).apply(null,t)}).catch(c.oe)}),i.get("topic/merge").on("click",function(){const e=a.getSelectedTids();c.e(2403).then(function(){var t=[c(2403)];(function(n){n.init(function(){e.length&&e.forEach(function(r){n.addTopic(r)})})}).apply(null,t)}).catch(c.oe)}),i.get("topic/tag").on("click",async function(){const e=a.getSelectedTids();if(!e.length)return d.error("[[error:no-topics-selected]]");const t=await Promise.all(e.map(n=>u.get(`/topics/${n}`)));Promise.all([c.e(20056),c.e(63)]).then(function(){var n=[c(63)];(function(r){r.init(t,ajaxify.data.tagWhitelist,o)}).apply(null,n)}).catch(c.oe)}),A.removeListeners(),socket.on("event:topic_deleted",P),socket.on("event:topic_restored",P),socket.on("event:topic_purged",F),socket.on("event:topic_locked",L),socket.on("event:topic_unlocked",L),socket.on("event:topic_pinned",T),socket.on("event:topic_unpinned",T),socket.on("event:topic_moved",j)};function p(e,t,n,r){r||(r=function(){});const h=a.getSelectedTids(),m={},y=function(I){I&&Promise.all(h.map(R=>u[e](`/topics/${R}${t}`,m))).then(r).catch(d.error)};if(!h.length)return d.error("[[error:no-topics-selected]]");switch(n){case"delete":case"restore":case"purge":D.confirm(`[[topic:thread-tools.${n}-confirm]]`,y);break;case"pin":C.requestPinExpiry(m,y.bind(null,!0));break;default:y(!0);break}}A.removeListeners=function(){socket.removeListener("event:topic_deleted",P),socket.removeListener("event:topic_restored",P),socket.removeListener("event:topic_purged",F),socket.removeListener("event:topic_locked",L),socket.removeListener("event:topic_unlocked",L),socket.removeListener("event:topic_pinned",T),socket.removeListener("event:topic_unpinned",T),socket.removeListener("event:topic_moved",j)};function E(){$(".thread-tools .show").removeClass("show")}function o(){E(),a.unselectAll()}function s(){E(),l()}function f(){E(),a.unselectAll(),l()}function l(){const e=a.getSelectedTids(),t=k(U,e),n=K(U,e),r=k(Q,e),h=k(Y,e),m=k(W,e),y=K(W,e);i.get("topic/delete").toggleClass("hidden",t),i.get("topic/restore").toggleClass("hidden",m||!t),i.get("topic/purge").toggleClass("hidden",!n||!e.length),i.get("topic/lock").toggleClass("hidden",h),i.get("topic/unlock").toggleClass("hidden",!h),i.get("topic/pin").toggleClass("hidden",y||r),i.get("topic/unpin").toggleClass("hidden",y||!r),i.get("topic/merge").toggleClass("hidden",m)}function k(e,t){for(let n=0;n<t.length;n+=1)if(e(t[n]))return!0;return!1}function K(e,t){for(let n=0;n<t.length;n+=1)if(!e(t[n]))return!1;return!0}function U(e){return g(e).hasClass("deleted")}function Y(e){return g(e).hasClass("locked")}function Q(e){return g(e).hasClass("pinned")}function W(e){return g(e).hasClass("scheduled")}function g(e){return i.get("category/topic","tid",e)}function P(e){const t=g(e.tid);t.toggleClass("deleted",e.isDeleted),t.find('[component="topic/locked"]').toggleClass("hidden",!e.isDeleted)}function T(e){const t=g(e.tid);t.toggleClass("pinned",e.isPinned),t.find('[component="topic/pinned"]').toggleClass("hidden",!e.isPinned),ajaxify.refresh()}function L(e){const t=g(e.tid);t.toggleClass("locked",e.isLocked),t.find('[component="topic/locked"]').toggleClass("hidden",!e.isLocked)}function j(e){g(e.tid).remove()}function F(e){g(e.tid).remove()}function N(){if(!ajaxify.data.topics||!ajaxify.data.template.category)return;const e=ajaxify.data.topics.filter(t=>t.pinned).length;!app.user.isAdmin&&!app.user.isMod||e<2||app.loadJQueryUI(function(){const t=$('[component="category"]').filter(function(r,h){return!$(h).parents("[widget-area],[data-widget-area]").length});let n=0;t.sortable({axis:"y",handle:'[component="topic/pinned"]',items:'[component="category/topic"].pinned',start:function(){n=parseInt(t.find('[component="category/topic"].pinned').first().attr("data-index"),10)},update:function(r,h){const m=h.item.attr("data-tid"),y=t.find('[component="category/topic"].pinned');let I=0;y.each((R,B)=>{if($(B).attr("data-tid")===m)return I=R,!1}),socket.emit("topics.orderPinnedTopics",{tid:m,order:n+I},function(R){if(R)return d.error(R);y.each((B,J)=>{$(J).attr("data-index",n+B)})})}})})}return A}.apply(M,x),v!==void 0&&(S.exports=v)}}]);
