"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,5719,26477,34271,42289,49897,51831,69185,86198,99127],{28061:(w,v,s)=>{var p,m;p=[s(81335),s(49897),s(33530),s(29930)],m=function(P,x,C,g){const u={};u.banAccount=function(t,a){t=t||ajaxify.data.theirid,e({tpl:"modals/temporary-ban",title:"[[user:ban-account]]",onSubmit:function(c){const d=c.length>0?Date.now()+c.length*1e3*60*60*(parseInt(c.unit,10)?24:1):0;x.put("/users/"+t+"/ban",{until:d,reason:c.reason||""}).then(()=>{if(typeof a=="function")return a();ajaxify.refresh()}).catch(g.error)}})},u.unbanAccount=function(t){e({tpl:"modals/unban",title:"[[user:unban-account]]",onSubmit:function(a){x.del("/users/"+t+"/ban",{reason:a.reason||""}).then(()=>{ajaxify.refresh()}).catch(g.error)}})},u.muteAccount=function(t,a){t=t||ajaxify.data.theirid,e({tpl:"modals/temporary-mute",title:"[[user:mute-account]]",onSubmit:function(c){const d=c.length>0?Date.now()+c.length*1e3*60*60*(parseInt(c.unit,10)?24:1):0;x.put("/users/"+t+"/mute",{until:d,reason:c.reason||""}).then(()=>{if(typeof a=="function")return a();ajaxify.refresh()}).catch(g.error)}})},u.unmuteAccount=function(t){e({tpl:"modals/unmute",title:"[[user:unmute-account]]",onSubmit:function(a){x.del("/users/"+t+"/mute",{reason:a.reason||""}).then(()=>{ajaxify.refresh()}).catch(g.error)}})};function e(t){P.render(t.tpl,{}).then(function(a){const c=C.dialog({title:t.title,message:a,show:!0,onEscape:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:t.title,callback:function(){const d=c.find("form").serializeArray().reduce(function(f,n){return f[n.name]=n.value,f},{});t.onSubmit(d)}}}})})}return u}.apply(v,p),m!==void 0&&(w.exports=m)},39259:(w,v,s)=>{var p,m;p=[s(96349),s(49897),s(91749)],m=function(P,x,C){const g={};g.init=function(e,t){if(!e||!e.length)return;t=t||{},t.states=t.states||["watching","tracking","notwatching","ignoring"],t.template=t.template||"partials/category/filter-dropdown-left",C.fire("action:category.filter.options",{el:e,options:t}),P.init(e,t);let a=[],c=[];Array.isArray(t.selectedCids)?a=t.selectedCids.map(String):Array.isArray(ajaxify.data.selectedCids)&&(a=ajaxify.data.selectedCids.map(String)),c=a.slice(),e.on("hidden.bs.dropdown",function(){let d=c.length!==a.length;if(c.forEach(function(f,n){f!==a[n]&&(d=!0)}),c=a.slice(),d&&(t.updateButton?t.updateButton({el:e,changed:d,selectedCids:a.slice()}):t.updateButton!==!1&&u(e,a)),t.onHidden){t.onHidden({changed:d,selectedCids:a.slice()});return}if(d){let f=window.location.pathname;const n=utils.params();a.length?n.cid=a:delete n.cid,delete n.page,Object.keys(n).length&&(f+="?"+$.param(n)),ajaxify.go(f)}}),e.on("click",'[component="category/list"] [data-cid]',function(d){const f=e.find('[component="category/list"]'),n=$(this),r=n.find("a").attr("href");if(r&&r!=="#"&&r.length){d.stopPropagation();return}const o=n.attr("data-cid"),y=n.find('[component="category/select/icon"]');return o!=="all"?(a.includes(o)?a.splice(a.indexOf(o),1):a.push(o),a.sort(function(j,l){return j-l}),y.toggleClass("invisible"),f.find('[data-cid="all"] i').toggleClass("invisible",!!a.length)):(e.find('[component="category/select/icon"]').addClass("invisible"),f.find('[data-cid="all"] i').removeClass("invisible"),a=[]),t.selectedCids=a,t.onSelect&&t.onSelect({cid:o,selectedCids:a.slice()}),!1})};function u(e,t){t.length>1?a({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):t.length===1?x.get(`/categories/${t[0]}`,{}).then(a):a();function a(c){app.parseAndTranslate("partials/category/filter-dropdown-content",{selectedCategory:c},function(d){e.find("button").replaceWith($("<div/>").html(d).find("button"))})}}return g}.apply(v,p),m!==void 0&&(w.exports=m)},47283:(w,v,s)=>{var p,m;p=[s(49897),s(33530),s(29930)],m=function(P,x,C){const g={};g.account=function(e,t){u(e,"[[user:delete-this-account-confirm]]","/account","[[user:account-deleted]]",t)},g.content=function(e,t){u(e,"[[user:delete-account-content-confirm]]","/content","[[user:account-content-deleted]]",t)},g.purge=function(e,t){u(e,"[[user:delete-all-confirm]]","","[[user:account-deleted]]",t)};function u(e,t,a,c,d){x.confirm(t,function(f){f&&P.del(`/users/${encodeURIComponent(e)}${a}`,{}).then(()=>{if(C.success(c),typeof d=="function")return d()}).catch(C.error)})}return g}.apply(v,p),m!==void 0&&(w.exports=m)},49897:(w,v,s)=>{s.r(v),s.d(v,{del:()=>f,get:()=>e,head:()=>t,patch:()=>c,post:()=>a,put:()=>d});var p=s(91749),m=s.n(p),P=s(33530),x=s.n(P);const C=config.relative_path+"/api/v3";async function g(n,r){if(n.url=n.url.startsWith("/api")?config.relative_path+n.url:C+n.url,typeof r=="function"){u(n).then(o=>r(null,o),o=>r(o));return}try{return await u(n)}catch(o){if(o.message==="A valid login session was not found. Please log in and try again."){const{url:y}=await(0,p.fire)("filter:admin.reauth",{url:"login"});return(0,P.confirm)("[[error:api.reauth-required]]",j=>{j&&ajaxify.go(y)})}throw o}}async function u(n){const{url:r}=n;delete n.url,n.data&&!(n.data instanceof FormData)&&(n.data=JSON.stringify(n.data||{}),n.headers["content-type"]="application/json; charset=utf-8"),{options:n}=await(0,p.fire)("filter:api.options",{options:n}),n.data&&(n.body=n.data,delete n.data);const o=await fetch(r,n),{headers:y}=o;if(y.get("x-redirect"))return u({url:y.get("x-redirect"),...n});const j=y.get("content-type"),l=j&&j.startsWith("application/json");let i;if(n.method!=="HEAD"&&(l?i=await o.json():i=await o.text()),!o.ok)throw i?new Error(l?i.status.message:i):new Error(o.statusText);return l&&i&&i.hasOwnProperty("status")&&i.hasOwnProperty("response")?i.response:i}function e(n,r,o){return g({url:n+(r&&Object.keys(r).length?"?"+$.param(r):"")},o)}function t(n,r,o){return g({url:n+(r&&Object.keys(r).length?"?"+$.param(r):""),method:"HEAD"},o)}function a(n,r,o){return g({url:n,method:"POST",data:r,headers:{"x-csrf-token":config.csrf_token}},o)}function c(n,r,o){return g({url:n,method:"PATCH",data:r,headers:{"x-csrf-token":config.csrf_token}},o)}function d(n,r,o){return g({url:n,method:"PUT",data:r,headers:{"x-csrf-token":config.csrf_token}},o)}function f(n,r,o){return g({url:n,method:"DELETE",data:r,headers:{"x-csrf-token":config.csrf_token}},o)}},65348:(w,v,s)=>{var p,m;p=[s(96349),s(33530),s(91749),s(17459)],m=function(P,x,C,g){const u={};return u.init=function(e,t){if(!e||!e.length)return;t=t||{};const a=t.onSelect||function(){};t.states=t.states||["watching","tracking","notwatching","ignoring"],t.template=t.template||"partials/category/selector-dropdown-left",C.fire("action:category.selector.options",{el:e,options:t}),P.init(e,t);const c={el:e,selectedCategory:null};e.on("click","[data-cid]",function(){const f=$(this);return f.hasClass("disabled")?!1:(c.selectCategory(f.attr("data-cid")),a(c.selectedCategory))});let d=c.el.find('[component="category-selector-selected"]').html();return g.translate(d,f=>{d=f}),c.selectCategory=function(f){const n=c.el.find('[data-cid="'+f+'"]');c.selectedCategory={cid:f,name:n.attr("data-name")},n.length?c.el.find('[component="category-selector-selected"]').html(n.find('[component="category-markup"]').html()):c.el.find('[component="category-selector-selected"]').html(d)},c.getSelectedCategory=function(){return c.selectedCategory},c.getSelectedCid=function(){return c.selectedCategory?c.selectedCategory.cid:0},t.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(t.template,{selectedCategory:t.selectedCategory},function(f){c.el.find('[component="category-selector-selected"]').html(f.find('[component="category-selector-selected"]').html())}),c},u.modal=function(e){e=e||{},e.onSelect=e.onSelect||function(){},e.onSubmit=e.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:e.message},function(t){const a=x.dialog({title:e.title||"[[modules:composer.select-category]]",message:t,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:d}}}),c=u.init(a.find('[component="category-selector"]'),e);function d(f){return f.preventDefault(),c.selectedCategory&&(e.onSubmit(c.selectedCategory),a.modal("hide")),!1}e.openOnLoad&&a.on("shown.bs.modal",function(){a.find(".dropdown-toggle").dropdown("toggle")}),a.find("form").on("submit",d)})},u}.apply(v,p),m!==void 0&&(w.exports=m)},67855:(w,v,s)=>{var p,m;p=[s(39259),s(65348),s(49897),s(29930),s(33530),s(28061),s(47283)],m=function(P,x,C,g,u,e,t){const a={};a.init=function(){$('[data-bs-toggle="tooltip"]').tooltip(),P.init($('[component="category/dropdown"]'),{privilege:"moderate"}),r(),j(),f('[data-action="editContent"]',".post-content-editable","textarea",".post-content"),f('[data-action="editTitle"]',".topic-title-editable","input",".topic-title"),$(".posts-list").on("click",".topic-category[data-editable]",function(l){n(this),l.stopPropagation(),l.preventDefault()}),$('[component="post/content"] img:not(.not-responsive)').addClass("img-fluid"),c()};function c(){$(".posts-list [data-id]").each((l,i)=>{const E=$(i),b=E.find('[component="post-queue/link-container"]'),h=b.find('[component="post-queue/link-container/list"]'),A=E.find(".post-content a");A.each((D,k)=>{const S=$(k).attr("href");h.append(`<li><a href="${S}">${S}</a></li>`)}),b.toggleClass("hidden",!A.length)})}function d(l){return new Promise(i=>{u.confirm(l,i)})}function f(l,i,E,b){$(".posts-list").on("click",l,function(){const h=$(this),A=h.parents("[data-id]").find(i),D=h.parents("[data-id]").find(b);A.length&&(D.addClass("hidden"),A.removeClass("hidden").find(E).focus())}),$(".posts-list").on("blur",i+" "+E,function(){const h=$(this),A=h.parent().parent().find(b),D=h.parents("[data-id]").attr("data-id"),k=l==='[data-action="editTitle"]';C.put(`/posts/queue/${D}`,{title:k?h.val():void 0,content:k?void 0:h.val()}).then(S=>{k?A.find(".title-text").text(S.postData.title):A.html(S.postData.content),h.parent().addClass("hidden"),A.removeClass("hidden")}).catch(g.error)})}function n(l){const i=$(l),E=i.parents("[data-id]").attr("data-id");return x.modal({onSubmit:function(b){Promise.all([C.get(`/categories/${b.cid}`,{}),C.put(`/posts/queue/${E}`,{cid:b.cid})]).then(function(h){const A=h[0];app.parseAndTranslate("post-queue","posts",{posts:[{category:A}]},function(D){i.find(".category-text").length?i.find(".category-text").text(D.find(".topic-category .category-text").text()):i.replaceWith(D.find(".topic-category"))})}).catch(g.error)}}),!1}function r(){const l=document.querySelector(".posts-list");l&&l.addEventListener("click",i=>{const E=i.target.closest("[data-action]");if(E){const b=E.getAttribute("data-action"),h=E.closest("[data-uid]").getAttribute("data-uid");switch(b){case"editCategory":{const A=i.target.closest("[data-id]").querySelector(".topic-category");n(A);break}case"ban":e.banAccount(h,ajaxify.refresh);break;case"unban":e.unbanAccount(h);break;case"mute":e.muteAccount(h,ajaxify.refresh);break;case"unmute":e.unmuteAccount(h);break;case"delete-account":t.account(h,ajaxify.go.bind(null,"post-queue"));break;case"delete-content":t.content(h,ajaxify.go.bind(null,"post-queue"));break;case"delete-all":t.purge(h,ajaxify.go.bind(null,"post-queue"));break;default:o.call(i.target);break}}})}async function o(){const l=$(this).parents("[data-id]"),i=$(this).attr("data-action"),E=l.attr("data-id"),b=l.get(0).parentNode;if(!(!["accept","reject","notify"].includes(i)||i==="reject"&&!await d(ajaxify.data.canAccept?"[[post-queue:confirm-reject]]":"[[post-queue:confirm-remove]]")))return y(i,E).then(function(){(i==="accept"||i==="reject")&&l.remove(),b.childElementCount===0&&(ajaxify.data.singlePost?ajaxify.go("/post-queue"+window.location.search):ajaxify.refresh())}).catch(g.error),!1}async function y(l,i){function E(){return new Promise(h=>{const A=u.dialog({title:"[[post-queue:notify-user]]",message:'<textarea class="form-control"></textarea>',buttons:{OK:{label:"[[modules:bootbox.send]]",callback:function(){const D=A.find("textarea").val();D&&h(D)}}}})})}const b={accept:()=>C.post(`/posts/queue/${i}`,{}),reject:()=>C.del(`/posts/queue/${i}`,{}),notify:async()=>C.post(`/posts/queue/${i}/notify`,{message:await E()})};if(b[l]){const h=b[l]();return h instanceof Promise?h:Promise.resolve(h)}throw new Error(`Unknown action: ${l}`)}function j(){$('[component="post-queue/bulk-actions"]').on("click","[data-action]",async function(){const l=$(this).attr("data-action");let i=$(".posts-list [data-id]");(l==="accept-selected"||l==="reject-selected")&&(i=i.filter((k,S)=>$(S).find('input[type="checkbox"]').is(":checked")));const E=i.map((k,S)=>$(S).attr("data-id")).get(),b=l==="reject-all"||l==="reject-selected",h=ajaxify.data.canAccept?`${l}-confirm`:`${l.replace(/^reject/,"remove")}-confirm`;if(!E.length||b&&!await d(`[[post-queue:${h}, ${E.length}]]`))return;const A=l.split("-")[0],D=E.map(k=>y(A,k));Promise.allSettled(D).then(function(k){const S=k.filter(L=>L.status==="fulfilled").length,R=k.filter(L=>L.status==="rejected");S&&(g.success(`[[post-queue:bulk-${A}-success, ${S}]]`),ajaxify.refresh()),R.forEach(L=>g.error(L.reason))})})}return a}.apply(v,p),m!==void 0&&(w.exports=m)},96349:(w,v,s)=>{var p,m;p=[s(29930),s(89336),s(49897)],m=function(P,x,C){const g={};return g.init=function(u,e){let t=e.defaultCategories||null;e=e||{},e.privilege=e.privilege||"topics:read",e.states=e.states||["watching","tracking","notwatching","ignoring"],e.cacheList=e.hasOwnProperty("cacheList")?e.cacheList:!0;let a=[];Array.isArray(e.localCategories)&&(a=e.localCategories.map(r=>({...r})),t&&(t=[...a,...t])),e.selectedCids=e.selectedCids||ajaxify.data.selectedCids||[];const c=u.find('[component="category-selector-search"]');if(!c.length)return;const d=c.parents('[component="category/dropdown"]').length>0||c.parents('[component="category-selector"]').length>0;u.on("show.bs.dropdown",function(){d&&c.removeClass("hidden");function r(){const o=c.find("input").val();o.length>1||!o&&!t?f(o,function(y){t=e.cacheList&&(t||y),n(y)}):!o&&t&&n(t)}c.on("click",function(o){o.preventDefault(),o.stopPropagation()}),c.find("input").val("").on("keyup",utils.debounce(r,300)),r()}),u.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||c.find("input").focus()}),u.on("hide.bs.dropdown",function(){d&&c.addClass("hidden"),c.off("click"),c.find("input").off("keyup")});function f(r,o){C.get("/search/categories",{search:r,query:utils.params(),parentCid:e.parentCid||0,selectedCids:e.selectedCids,privilege:e.privilege,states:e.states,showLinks:e.showLinks},function(y,{categories:j}){if(y)return P.error(y);o(a.concat(j))})}function n(r){const o=e.selectedCids.map(String);r.forEach(function(y){y.selected=o.includes(String(y.cid))}),app.parseAndTranslate(e.template,{categoryItems:r.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(y){u.find('[component="category/list"]').html(y.find('[component="category/list"]').html()),u.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!r.length);const j=x.Dropdown.getInstance(u.find(".dropdown-toggle").get(0));j&&j.update()})}},g}.apply(v,p),m!==void 0&&(w.exports=m)}}]);
