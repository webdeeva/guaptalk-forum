"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,13201,34271,34590,49897,68326,98813,99127],{11599:(C,m,c)=>{var l,p;l=[c(52473),c(91749),c(49897)],p=function(g,w,h){const f={};f.prepareDOM=function(){const r=$('[component="chat/dropdown"]');r.on("show.bs.dropdown",e=>{d("loadChatsDropdown",$(e.target).parent().find('[component="chat/list"]'))}),r.each((e,o)=>{const t=$(o).parent().find(".dropdown-menu");t.hasClass("show")&&d("loadChatsDropdown",t.find('[component="chat/list"]'))}),socket.removeListener("event:chats.receive",u),socket.on("event:chats.receive",u),socket.removeListener("event:chats.typing",n),socket.on("event:chats.typing",n),socket.removeListener("event:chats.roomRename",s),socket.on("event:chats.roomRename",s),socket.on("event:unread.updateChatCount",async function(e){if(e){const[a,v]=await app.require(["chat","forum/chats"]);if(a.isFromBlockedUser(e.fromUid)||a.isLookingAtRoom(e.roomId)||app.user.uid===parseInt(e.fromUid,10))return;v.markChatPageElUnread(e),v.updateTeaser(e.roomId,e.teaser)}let{count:o}=await h.get("/chats/unread");const t=g.get("chat/icon");o=Math.max(0,o),t.toggleClass("fa-comment",o>0).toggleClass("fa-comment-o",o<=0);const i=o>99?"99+":o;g.get("chat/icon").toggleClass("unread-count",o>0).attr("data-content",i),g.get("chat/count").toggleClass("hidden",o<=0).text(i),w.fire("action:chat.updateCount",{count:o})})};function u(r){d("onChatMessageReceived",r)}function n(r){d("onUserTyping",r)}function s(r){d("onRoomRename",r)}async function d(r,e){(await app.require("chat"))[r](e)}return f}.apply(m,l),p!==void 0&&(C.exports=p)},19046:(C,m,c)=>{var l,p;l=[c(91749)],p=function(g){const w={},h={ignoring:1,notwatching:2,watching:3};w.initUnreadTopics=function(){const n=app.user.unreadData;function s(e){if(e&&e.posts&&e.posts.length&&n){const o=e.posts[0];if(parseInt(o.uid,10)===parseInt(app.user.uid,10)||!o.topic.isFollowing&&o.categoryWatchState!==h.watching)return;const t=o.topic.tid;(!n[""][t]||!n.new[t]||!n.watched[t]||!n.unreplied[t])&&r(t),n[""][t]||(d(""),n[""][t]=!0),o.isMain&&parseInt(o.uid,10)!==parseInt(app.user.uid,10)&&!n.new[t]&&(d("new"),n.new[t]=!0),parseInt(o.topic.postcount,10)<=1&&!n.unreplied[t]&&(d("unreplied"),n.unreplied[t]=!0),o.topic.isFollowing&&!n.watched[t]&&(d("watched"),n.watched[t]=!0)}}function d(e){const o="/unread"+(e?"?filter="+e:""),t=1+parseInt($('a[href="'+config.relative_path+o+'"].navigation-link i').attr("data-content"),10);u(o,t)}function r(e){$('[data-tid="'+e+'"]').addClass("unread")}$(window).on("action:ajaxify.end",function(){ajaxify.data.template.topic&&["","new","watched","unreplied"].forEach(function(e){delete n[e][ajaxify.data.tid]})}),socket.removeListener("event:new_post",s),socket.on("event:new_post",s),socket.removeListener("event:unread.updateCount",f),socket.on("event:unread.updateCount",f)};function f(n){u("/unread",n.unreadTopicCount),u("/unread?filter=new",n.unreadNewTopicCount),u("/unread?filter=watched",n.unreadWatchedTopicCount),u("/unread?filter=unreplied",n.unreadUnrepliedTopicCount)}function u(n,s){if(!utils.isNumber(s))return;s=Math.max(0,s);const d=s>99?"99+":s,r=$('a[href="'+config.relative_path+n+'"].navigation-link');r.find("i").toggleClass("unread-count",s>0).attr("data-content",d),r.find('[component="navigation/count"]').toggleClass("hidden",s<=0).text(s),r.length&&($('#mobile-menu [data-unread-url="'+n+'"]').attr("data-content",d),$('[component="unread/count"][data-unread-url="'+n+'"]').toggleClass("hidden",s<=0).text(d)),g.fire("action:unread.updateCount",{url:n,count:s})}return w.updateUnreadTopicCount=u,w}.apply(m,l),p!==void 0&&(C.exports=p)},49897:(C,m,c)=>{c.r(m),c.d(m,{del:()=>o,get:()=>n,head:()=>s,patch:()=>r,post:()=>d,put:()=>e});var l=c(91749),p=c.n(l),g=c(33530),w=c.n(g);const h=config.relative_path+"/api/v3";async function f(t,i){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:h+t.url,typeof i=="function"){u(t).then(a=>i(null,a),a=>i(a));return}try{return await u(t)}catch(a){if(a.message==="A valid login session was not found. Please log in and try again."){const{url:v}=await(0,l.fire)("filter:admin.reauth",{url:"login"});return(0,g.confirm)("[[error:api.reauth-required]]",D=>{D&&ajaxify.go(v)})}throw a}}async function u(t){const{url:i}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,l.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const a=await fetch(i,t),{headers:v}=a;if(v.get("x-redirect"))return u({url:v.get("x-redirect"),...t});const D=v.get("content-type"),T=D&&D.startsWith("application/json");let E;if(t.method!=="HEAD"&&(T?E=await a.json():E=await a.text()),!a.ok)throw E?new Error(T?E.status.message:E):new Error(a.statusText);return T&&E&&E.hasOwnProperty("status")&&E.hasOwnProperty("response")?E.response:E}function n(t,i,a){return f({url:t+(i&&Object.keys(i).length?"?"+$.param(i):"")},a)}function s(t,i,a){return f({url:t+(i&&Object.keys(i).length?"?"+$.param(i):""),method:"HEAD"},a)}function d(t,i,a){return f({url:t,method:"POST",data:i,headers:{"x-csrf-token":config.csrf_token}},a)}function r(t,i,a){return f({url:t,method:"PATCH",data:i,headers:{"x-csrf-token":config.csrf_token}},a)}function e(t,i,a){return f({url:t,method:"PUT",data:i,headers:{"x-csrf-token":config.csrf_token}},a)}function o(t,i,a){return f({url:t,method:"DELETE",data:i,headers:{"x-csrf-token":config.csrf_token}},a)}},71949:(C,m,c)=>{var l;l=function(){const p={};p.prepareDOM=function(){const h=$('[component="notifications"] [data-bs-toggle="dropdown"]');h.on("show.bs.dropdown",async f=>{const u=await app.require("notifications"),n=$(f.target);u.loadNotifications(n,n.parent().find('[component="notifications/list"]'))}),h.each((f,u)=>{const n=$(u),s=n.parent().find(".dropdown-menu");s.hasClass("show")&&app.require("notifications").then(d=>{d.loadNotifications(n,s.find('[component="notifications/list"]'))})}),socket.removeListener("event:new_notification",g),socket.on("event:new_notification",g),socket.removeListener("event:notifications.updateCount",w),socket.on("event:notifications.updateCount",w)};async function g(h){(await app.require("notifications")).onNewNotification(h)}async function w(h){(await app.require("notifications")).updateNotifCount(h)}return p}.call(m,c,m,C),l!==void 0&&(C.exports=l)},86174:(C,m,c)=>{var l,p;l=[c(19046),c(71949),c(11599),c(29930)],p=function(g,w,h,f){const u={};u.prepareDOM=function(){app.user.uid>0&&g.initUnreadTopics(),w.prepareDOM(),h.prepareDOM(),n(),s(),d()};function n(){$('[component="header/usercontrol"] [data-status]').off("click").on("click",function(r){const e=$(this).attr("data-status");socket.emit("user.setStatus",e,function(o){if(o)return f.error(o);$('[data-uid="'+app.user.uid+'"] [component="user/status"], [component="header/profilelink"] [component="user/status"]').removeClass("away online dnd offline").addClass(e),$('[component="header/usercontrol"] [data-status]').each(function(){$(this).toggleClass("selected",$(this).attr("data-status")===e)}),app.user.status=e}),r.preventDefault()})}function s(){const r=utils.findBootstrapEnvironment();if(r==="xs"||r==="sm"||utils.isTouchDevice())return;const e=$("#header-menu .nav-item[title]");e.tooltip({trigger:"manual",animation:!1,placement:"bottom"}),e.on("mouseenter",function(o){const t=$(o.target);t.hasClass("dropdown-menu")||!!t.parents(".dropdown-menu").length||$(this).tooltip("show")}),e.on("click mouseleave",function(){$(this).tooltip("hide")})}function d(){$("body").on("click",'[component="user/logout"]',function(){return c.e(20739).then(function(){var r=[c(75427)];(function(e){e()}).apply(null,r)}).catch(c.oe),!1})}return u}.apply(m,l),p!==void 0&&(C.exports=p)}}]);
