"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,2403,18593,34271,49897,69749,87212,92717,99127],{2403:(S,O,p)=>{var x,g;x=[p(69749),p(29930),p(49897)],g=function(m,y,c){const f={};let o,u,v={};f.init=function(t){t=t||function(){},!o&&app.parseAndTranslate("modals/merge-topic",{},function(i){o=i,$("body").append(o),u=o.find("#merge_topics_confirm"),o.find("#merge_topics_cancel").on("click",e),$("#content").on("click",'[component="topic/select"]',k),a(),u.on("click",function(){n(u)}),m.enableQuickSearch({searchElements:{inputEl:o.find(".topic-search-input"),resultEl:o.find(".quick-search-container")},searchOptions:{in:"titles"},dropdown:{maxWidth:"400px",maxHeight:"350px"}}),o.on("click","[data-tid]",function(){const s=$(this).attr("data-tid");return s&&f.addTopic(s),!1}),o.on("click","[data-remove-tid]",function(){const s=$(this).attr("data-remove-tid");return s&&f.removeTopic(s),!1}),t()})},f.addTopic=function(t,i){i=i||function(){},c.get(`/topics/${t}`,{}).then(function(s){const l=s?s.title:"No title";v[t]=l,r(),a(),i()}).catch(y.error)},f.removeTopic=function(t){v[t]&&delete v[t],r(),a()};function k(t){if(!o)return;const i=$(this).parents('[component="category/topic"]'),s=i.hasClass("selected"),l=i.attr("data-tid");return s?f.addTopic(l):f.removeTopic(l),t.preventDefault(),t.stopPropagation(),!1}function n(t){t.attr("disabled",!0);const i=Object.keys(v),s={};o.find(".merge-main-topic-radio").is(":checked")?s.mainTid=o.find(".merge-main-topic-select").val():o.find(".merge-new-title-radio").is(":checked")&&(s.newTopicTitle=o.find(".merge-new-title-input").val()),socket.emit("topics.merge",{tids:i,options:s},function(l,C){if(t.removeAttr("disabled"),l)return y.error(l);ajaxify.go("/topic/"+C),e()})}function a(){if(!o)return;const t=Object.keys(v);t.sort(function(s,l){return s-l});const i=t.map(function(s){return{tid:s,title:v[s]}});t.length?app.parseAndTranslate("modals/merge-topic",{config,topics:i},function(s){o.find(".topics-section").html(s.find(".topics-section").html()),o.find(".merge-main-topic-select").html(s.find(".merge-main-topic-select").html())}):(o.find(".topics-section").translateHtml("[[error:no-topics-selected]]"),o.find(".merge-main-topic-select").html(""))}function r(){Object.keys(v).length?u.removeAttr("disabled"):u.attr("disabled",!0)}function e(){o&&(o.remove(),o=null),v={},$("#content").off("click",'[component="topic/select"]',k)}return f}.apply(O,x),g!==void 0&&(S.exports=g)},49897:(S,O,p)=>{p.r(O),p.d(O,{del:()=>r,get:()=>u,head:()=>v,patch:()=>n,post:()=>k,put:()=>a});var x=p(91749),g=p.n(x),m=p(33530),y=p.n(m);const c=config.relative_path+"/api/v3";async function f(e,t){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:c+e.url,typeof t=="function"){o(e).then(i=>t(null,i),i=>t(i));return}try{return await o(e)}catch(i){if(i.message==="A valid login session was not found. Please log in and try again."){const{url:s}=await(0,x.fire)("filter:admin.reauth",{url:"login"});return(0,m.confirm)("[[error:api.reauth-required]]",l=>{l&&ajaxify.go(s)})}throw i}}async function o(e){const{url:t}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,x.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const i=await fetch(t,e),{headers:s}=i;if(s.get("x-redirect"))return o({url:s.get("x-redirect"),...e});const l=s.get("content-type"),C=l&&l.startsWith("application/json");let d;if(e.method!=="HEAD"&&(C?d=await i.json():d=await i.text()),!i.ok)throw d?new Error(C?d.status.message:d):new Error(i.statusText);return C&&d&&d.hasOwnProperty("status")&&d.hasOwnProperty("response")?d.response:d}function u(e,t,i){return f({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},i)}function v(e,t,i){return f({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"HEAD"},i)}function k(e,t,i){return f({url:e,method:"POST",data:t,headers:{"x-csrf-token":config.csrf_token}},i)}function n(e,t,i){return f({url:e,method:"PATCH",data:t,headers:{"x-csrf-token":config.csrf_token}},i)}function a(e,t,i){return f({url:e,method:"PUT",data:t,headers:{"x-csrf-token":config.csrf_token}},i)}function r(e,t,i){return f({url:e,method:"DELETE",data:t,headers:{"x-csrf-token":config.csrf_token}},i)}},68636:(S,O,p)=>{var x;x=function(){function g(){this._store={},this._keys=[]}g.prototype.isMock=!0,g.prototype.setItem=function(c,f){c=String(c),this._keys.indexOf(c)===-1&&this._keys.push(c),this._store[c]=f},g.prototype.getItem=function(c){return c=String(c),this._keys.indexOf(c)===-1?null:this._store[c]},g.prototype.removeItem=function(c){c=String(c),this._keys=this._keys.filter(function(f){return f!==c}),this._store[c]=null},g.prototype.clear=function(){this._keys=[],this._store={}},g.prototype.key=function(c){return c=parseInt(c,10)||0,this._keys[c]},Object.defineProperty&&Object.defineProperty(g.prototype,"length",{get:function(){return this._keys.length}});let m;const y=Date.now().toString();try{if(m=window.localStorage,m.setItem(y,y),m.getItem(y)!==y)throw Error("localStorage behaved unexpectedly");return m.removeItem(y),m}catch(c){console.warn(c),console.warn("localStorage failed, falling back on sessionStorage");try{if(m=window.sessionStorage,m.setItem(y,y),m.getItem(y)!==y)throw Error("sessionStorage behaved unexpectedly");return m.removeItem(y),m}catch(f){return console.warn(f),console.warn("sessionStorage failed, falling back on memory storage"),new g}}}.call(O,p,O,S),x!==void 0&&(S.exports=x)},69749:(S,O,p)=>{var x,g;x=[p(17459),p(68636),p(91749),p(29930),p(89336)],g=function(m,y,c,f,o){const u={current:{}};u.init=function(n){if(!config.searchEnabled)return;n=n||{in:config.searchDefaultInQuick||"titles"},$('[component="search/form"]').each((r,e)=>{v($(e),n)})};function v(n,a){const r=n.find('[component="search/button"]'),e=n.find('[component="search/fields"]'),t=e.find('input[name="query"]'),i=e.find("#quick-search-container"),s=e.hasClass("hidden"),l=/^(@|acct:)?[\w-]+@.+$/;s&&e.off("focusout").on("focusout",function(){setTimeout(function(){e.find(":focus").length||(e.addClass("hidden"),r.removeClass("hidden"))},200)}),t.off("focus");const C={inputEl:t,resultEl:i};u.enableQuickSearch({searchOptions:a,searchElements:C}),r.off("click").on("click",function(d){return!config.loggedIn&&!app.user.privileges["search:content"]?(f.alert({message:"[[error:search-requires-login]]",timeout:3e3}),ajaxify.go("login"),!1):(d.stopPropagation(),u.showAndFocusInput(n),!1)}),n.off("submit").on("submit",function(){const d=$(this).find('input[name="query"]'),w=u.getSearchPreferences();return w.term=d.val(),w.in=a.in,l.test(w.term)&&(w.in="users"),c.fire("action:search.submit",{searchOptions:w,searchElements:C}),u.query(w,function(){d.val(""),t.trigger("blur")}),!1})}u.enableQuickSearch=function(n){if(!config.searchEnabled||!app.user.privileges["search:content"])return;const a=Object.assign({in:config.searchDefaultInQuick||"titles"},n.searchOptions),r=n.searchElements.resultEl,e=n.searchElements.inputEl;let t=e.val();const i=r.find(".filter-category");function s(){ajaxify.data.template.category&&ajaxify.data.cid&&m.translate("[[search:search-in-category, "+ajaxify.data.name+"]]",function(h){const E=$("<div></div>").html(h).text();i.find(".name").text(E)}),i.toggleClass("hidden",!(ajaxify.data.template.category&&ajaxify.data.cid))}function l(){n.searchOptions=Object.assign({},a),n.searchOptions.term=e.val(),s(),ajaxify.data.template.category&&ajaxify.data.cid&&i.find('input[type="checkbox"]').is(":checked")&&(n.searchOptions.categories=[ajaxify.data.cid],n.searchOptions.searchChildren=!0),n.hideDuringSearch||(r.removeClass("hidden").find(".quick-search-results-container").html(""),r.find(".loading-indicator").removeClass("hidden")),c.fire("action:search.quick.start",n),n.searchOptions.searchOnly=1,u.api(n.searchOptions,function(h){if(r.find(".loading-indicator").addClass("hidden"),n.searchOptions.in==="categories"){if(!h.categories||n.hideOnNoMatches&&!h.categories.length)return r.addClass("hidden").find(".quick-search-results-container").html("");h.dropdown={maxWidth:"400px",maxHeight:"500px",...n.dropdown},app.parseAndTranslate("partials/quick-category-search-results",h,E=>{E.length&&E.find(".timeago").timeago(),r.toggleClass("hidden",!E.length||!e.is(":focus")).find(".quick-search-results-container").html(E.length?E:""),c.fire("action:search.quick.complete",{data:h,options:n})})}else{if(!h.posts||n.hideOnNoMatches&&!h.posts.length)return r.addClass("hidden").find(".quick-search-results-container").html("");h.posts.forEach(function(E){const T=$("<div>"+E.content+"</div>").text(),A=e.val().toLowerCase().replace(/^in:topic-\d+/,""),_=Math.max(0,T.toLowerCase().indexOf(A)-40);E.snippet=utils.escapeHTML((_>0?"...":"")+T.slice(_,_+80)+(T.length-_>80?"...":""))}),h.dropdown={maxWidth:"400px",maxHeight:"500px",...n.dropdown},app.parseAndTranslate("partials/quick-search-results",h,function(E){E.length&&E.find(".timeago").timeago(),r.toggleClass("hidden",!E.length||!e.is(":focus")).find(".quick-search-results-container").html(E.length?E:"");const T=r.find(".quick-search-results .quick-search-title, .quick-search-results .snippet");u.highlightMatches(n.searchOptions.term,T),c.fire("action:search.quick.complete",{data:h,options:n})})}})}r.find('.filter-category input[type="checkbox"]').on("change",function(){e.focus(),l()}),e.off("keyup").on("keyup",utils.debounce(function(){if(e.val().length<3){r.addClass("hidden"),t=e.val();return}if(e.val()!==t){if(t=e.val(),!e.is(":focus"))return r.addClass("hidden");l()}},500)),r.on("mousedown",".quick-search-results > *",function(){$(window).one("mouseup",function(){r.addClass("hidden")})});const C=e.parent(),d=r.parent();C.on("focusout",w),d.on("focusout",w);function w(){setTimeout(function(){!C.find(":focus").length&&!d.find(":focus").length&&!r.hasClass("hidden")&&r.addClass("hidden")},200)}let b=!1;c.on("action:ajaxify.end",function(){ajaxify.isCold()||(b=!0),r.addClass("hidden")}),e.on("focus",function(){const h=e.val();t=h,h&&r.find("#quick-search-results").children().length&&(s(),b?(l(),b=!1):r.removeClass("hidden"),e[0].setSelectionRange(h.startsWith("in:topic")?h.indexOf(" ")+1:0,h.length))}),e.off("refresh").on("refresh",function(){l()})},u.showAndFocusInput=function(n){const a=n.parents(".dropdown-menu");if(a.length){const r=a.siblings("[data-bs-toggle]"),e=o.Dropdown.getOrCreateInstance(r[0]);e&&e.show()}else n.find('[component="search/fields"]').removeClass("hidden"),n.find('[component="search/button"]').addClass("hidden"),n.find('[component="search/fields"] input[name="query"]').trigger("focus")},u.query=function(n,a){a=a||function(){},ajaxify.go("search?"+k(n),a)},u.api=function(n,a){const r=config.relative_path+"/api/search?"+k(n);n.hasOwnProperty("searchOnly")&&delete n.searchOnly;const e=config.relative_path+"/search?"+k(n);$.get(r,function(t){t.url=e,a(t)})};function k(n){const a=n.in||"titles",r=n.term.replace(/^[ ?#]*/,""),e={...n,term:r,in:a};return c.fire("action:search.createQueryString",{query:e,data:n}),$.param(e)}return u.getSearchPreferences=function(){try{return JSON.parse(y.getItem("search-preferences")||"{}")}catch(n){return console.error(n),{}}},u.highlightMatches=function(n,a){if(!n||!a.length)return;n=utils.escapeHTML(n.replace(/^"/,"").replace(/"$/,"").trim());const r=n.split(" ").filter(t=>t.length>1).map(function(t){return utils.escapeRegexChars(t)}).join("|"),e=new RegExp("("+r+")","gi");a.each(function(){const t=$(this),i=[];t.find("*").each(function(){$(this).after("<!-- "+i.length+" -->"),i.push($("<div></div>").append($(this)))}),t.html(t.html().replace(e,function(s,l){return'<strong class="search-match fw-bold text-decoration-underline">'+l+"</strong>"})),i.forEach(function(s,l){t.html(t.html().replace("<!-- "+l+" -->",function(){return s.html()}))})}),$(".search-results .content").find("img:not(.not-responsive)").addClass("img-fluid")},u}.apply(O,x),g!==void 0&&(S.exports=g)}}]);
