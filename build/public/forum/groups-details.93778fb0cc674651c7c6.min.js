(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[16852,26174,90408,97082],{13230:(b,D,l)=>{"use strict";var y,m,h;(function(t){m=[l(53050)],y=t,h=typeof y=="function"?y.apply(D,m):y,h!==void 0&&(b.exports=h)})(function(t){const f=t("[^\\p{L}\\s\\d\\-_@.]","g"),n=/[^\w\s\d\-_@.]/g,r=/^\s+|\s+$/g,e=/\s+/g,c=/-+/g,a=/-$/g,i=/^-/g,o=/^[\w\d\s.,\-@]+$/;return function(s,d){return s?(s=String(s).replace(r,""),o.test(s)?s=s.replace(n,"-"):s=t.replace(s,f,"-"),s=d?s:s.toLocaleLowerCase(),s=s.replace(e,"-"),s=s.replace(c,"-"),s=s.replace(a,""),s=s.replace(i,""),s):""}})},18675:()=>{(function(b){var D=b(window),l=function(t,f,n,r){if(arguments.length===3||r){if(n<t)return t;if(n>f)return f}return n},y=function(t){t.clientX=t.originalEvent.touches[0].clientX,t.clientY=t.originalEvent.touches[0].clientY},m=function(t){var f=(t.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1];if(f){var n={width:0,height:0},r=new Image;return r.onload=function(){if(t.css("background-size")=="cover"){var e=t.innerWidth(),c=t.innerHeight(),a=e/c,i=r.width/r.height,o=1;i>=a?o=c/r.height:o=e/r.width,n.width=r.width*o,n.height=r.height*o}else n.width=r.width,n.height=r.height},r.src=f,n}};function h(t,f){this.element=t,this.options=f,this.init()}h.prototype.init=function(){var t=b(this.element),f=(t.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1],n=this.options;if(f){var r={width:0,height:0};(n.bound||n.units=="percent")&&(r=m(t)),b(window).on("keydown.dbg",e=>{var c=t.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],a=parseInt(c[1])||0,i=parseInt(c[2])||0;n.units=="percent"&&(a=Math.round(a/-200*r.width),i=Math.round(i/-200*r.height));var o=0,u=0;return e.which===37?o=-5:e.which===39?o=5:e.which===38?u=-5:e.which===40&&(u=5),n.units==="percent"?(a=n.axis==="y"?a:l(-r.width/2,0,a+o,n.bound),i=n.axis==="x"?i:l(-r.height/2,0,i+u,n.bound),t.css("background-position",a/r.width*-200+"% "+i/r.height*-200+"%")):(a=n.axis==="y"?a:l(t.innerWidth()-r.width,0,a+o,n.bound),i=n.axis==="x"?i:l(t.innerHeight()-r.height,0,i+u,n.bound)),[37,38,39,40].includes(e.which)?!1:void 0}),t.on("mousedown.dbg touchstart.dbg",function(e){if(e.target===t[0]){if(e.preventDefault(),e.originalEvent.touches)y(e);else if(e.which!==1)return;var c=e.clientX,a=e.clientY,i=t.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],o=parseInt(i[1])||0,u=parseInt(i[2])||0;n.units=="percent"&&(o=Math.round(o/-200*r.width),u=Math.round(u/-200*r.height)),D.on("mousemove.dbg touchmove.dbg",function(s){s.preventDefault(),s.originalEvent.touches&&y(s);var d=s.clientX,p=s.clientY;n.units=="percent"?(o=n.axis==="y"?o:l(-r.width/2,0,o+d-c,n.bound),u=n.axis==="x"?u:l(-r.height/2,0,u+p-a,n.bound),t.css("background-position",o/r.width*-200+"% "+u/r.height*-200+"%")):(o=n.axis==="y"?o:l(t.innerWidth()-r.width,0,o+d-c,n.bound),u=n.axis==="x"?u:l(t.innerHeight()-r.height,0,u+p-a,n.bound),t.css("background-position",o+"px "+u+"px")),c=d,a=p}),D.on("mouseup.dbg touchend.dbg mouseleave.dbg",function(){n.done&&n.done(),D.off("mousemove.dbg touchmove.dbg"),D.off("mouseup.dbg touchend.dbg mouseleave.dbg")})}})}},h.prototype.disable=function(){var t=b(this.element);t.off("mousedown.dbg touchstart.dbg"),D.off("mousemove.dbg touchmove.dbg mouseup.dbg touchend.dbg mouseleave.dbg keydown.dbg")},b.fn.backgroundDraggable=function(t){var f=Array.prototype.slice.call(arguments,1);return this.each(function(){var n=b(this),r;typeof t>"u"||typeof t=="object"?(t=b.extend({},b.fn.backgroundDraggable.defaults,t),r=new h(this,t),n.data("dbg",r)):typeof t=="string"&&n.data("dbg")&&(r=n.data("dbg"),h.prototype[t].apply(r,f))})},b.fn.backgroundDraggable.defaults={bound:!0,axis:void 0,units:"pixels"}})(jQuery)},36684:(b,D,l)=>{"use strict";var y,m;y=[l(29930),l(18675)],m=function(h){const t={coverEl:null,saveFn:null};t.init=function(n,r,e,c){t.coverEl=n,t.saveFn=r,n.find(".upload").on("click",e),n.find(".resize").on("click",function(){f(n)}),n.find(".remove").on("click",c),n.on("dragover",t.onDragOver).on("drop",t.onDrop),n.find(".save").on("click",t.save),n.addClass("initialised")},t.onDragOver=function(n){n.stopPropagation(),n.preventDefault(),n.originalEvent.dataTransfer.dropEffect="copy"},t.onDrop=function(n){n.stopPropagation(),n.preventDefault();const r=n.originalEvent.dataTransfer.files,e=new FileReader;r.length&&r[0].type.match("image.*")&&(e.onload=function(c){t.coverEl.css("background-image","url("+c.target.result+")"),t.newCover=c.target.result},e.readAsDataURL(r[0]),f(t.coverEl))};function f(n){n.toggleClass("active",1).backgroundDraggable({axis:"y",units:"percent"}),h.alert({alert_id:"drag_start",title:"[[modules:cover.dragging-title]]",message:"[[modules:cover.dragging-message]]",timeout:5e3})}return t.save=function(){t.coverEl.addClass("saving"),t.saveFn(t.newCover||void 0,t.coverEl.css("background-position"),function(n){n?h.error(n):(t.coverEl.toggleClass("active",0),t.coverEl.backgroundDraggable("disable"),t.coverEl.off("dragover",t.onDragOver),t.coverEl.off("drop",t.onDrop),h.success("[[modules:cover.saved]]")),t.coverEl.removeClass("saving")})},t}.apply(D,y),m!==void 0&&(b.exports=m)},62734:(b,D,l)=>{"use strict";var y,m;y=[l(89664),l(67308),l(52473),l(36684),l(72254),l(49897),l(13230),l(65348),l(33530),l(29930),l(30076)],m=function(h,t,f,n,r,e,c,a,i,o,u){const s={};let d;s.init=function(){const C=f.get("groups/container");d=ajaxify.data.group.name,ajaxify.data.group.isOwner&&(s.prepareSettings(),n.init(f.get("groups/cover"),function(w,g,x){socket.emit("groups.cover.update",{groupName:d,imageData:w,position:g},x)},function(){r.show({title:"[[groups:upload-group-cover]]",socketMethod:"groups.cover.update",aspectRatio:NaN,allowSkippingCrop:!0,restrictImageDimension:!1,paramName:"groupName",paramValue:d},function(w){w=(w.startsWith("http")?"":config.relative_path)+w+"?"+Date.now(),f.get("groups/cover").css("background-image","url("+w+")")})},F)),h.init(),S(),f.get("groups/activity").find(".content img:not(.not-responsive)").addClass("img-fluid"),C.on("click","[data-action]",function(){const w=$(this),g=w.parents("[data-uid]"),x=g.find('[component="groups/owner/icon"]'),v=!!parseInt(g.attr("data-isowner"),10),A=g.attr("data-uid"),j=w.attr("data-action");switch(j){case"toggleOwnership":e[v?"del":"put"](`/groups/${ajaxify.data.group.slug}/ownership/${A}`,{}).then(()=>{x.toggleClass("invisible")}).catch(o.error);break;case"kick":i.confirm("[[groups:details.kick-confirm]]",function(k){k&&e.del(`/groups/${ajaxify.data.group.slug}/membership/${A}`,void 0).then(()=>{g.remove(),$('[component="group/member/count"]').text(u.humanReadableNumber(ajaxify.data.group.memberCount-1))}).catch(o.error)});break;case"update":s.update();break;case"delete":s.deleteGroup();break;case"join":e.put("/groups/"+ajaxify.data.group.slug+"/membership/"+(A||app.user.uid),void 0).then(()=>ajaxify.refresh()).catch(o.error);break;case"leave":e.del("/groups/"+ajaxify.data.group.slug+"/membership/"+(A||app.user.uid),void 0).then(()=>ajaxify.refresh()).catch(o.error);break;case"accept":e.put(`/groups/${ajaxify.data.group.slug}/pending/${A}`).then(()=>{g.remove(),h.refresh(),p()}).catch(o.error);break;case"reject":e.del(`/groups/${ajaxify.data.group.slug}/pending/${A}`).then(()=>{g.remove(),h.refresh(),p()}).catch(o.error);break;case"acceptInvite":e.put(`/groups/${ajaxify.data.group.slug}/invites/${app.user.uid}`).then(()=>{A?(g.remove(),h.refresh()):ajaxify.refresh()}).catch(o.error);break;case"rescindInvite":case"rejectInvite":e.del(`/groups/${ajaxify.data.group.slug}/invites/${A||app.user.uid}`).then(()=>{A?(g.remove(),E(),h.refresh()):ajaxify.refresh()}).catch(o.error);break;case"acceptAll":case"rejectAll":{const k=document.querySelector('[component="groups/pending"]');if(!k)return;const B=j==="acceptAll"?"put":"del";let P=Array.prototype.map.call(k.querySelectorAll("[data-uid]"),I=>parseInt(I.getAttribute("data-uid"),10));P=P.filter((I,R)=>P.indexOf(I)===R),Promise.all(P.map(async I=>e[B](`/groups/${ajaxify.data.group.slug}/pending/${I}`))).then(()=>{ajaxify.refresh()}).catch(o.error);break}}})},s.prepareSettings=function(){const C=f.get("groups/settings"),w=C.find('[name="labelColor"]'),g=C.find('[name="textColor"]'),x=C.find('[data-action="icon-select"]'),v=C.find(".badge"),A=C.find(".badge-text"),j=v.find("i"),k=C.find('[name="userTitle"]'),B=C.find('[name="userTitleEnabled"]'),P=C.find('[name="icon"]');w.on("input",function(){v.css("background-color",w.val())}),g.on("input",function(){v.css("color",g.val())}),x.on("click",function(){t.init(j,function(){P.val(j.val())})}),k.on("keyup",function(){A.translateText(k.val())}),B.on("change",function(){const R=f.get("groups/userTitleOption");this.checked?(R.removeAttr("disabled"),v.removeClass("hide")):(R.attr("disabled","disabled"),v.addClass("hide"))});const I=a.init($('.member-post-cids-selector [component="category-selector"]'),{onSelect:function(R){let T=($("#memberPostCids").val()||"").split(",").map(L=>parseInt(L,10));T.push(R.cid),T=T.filter((L,N,O)=>O.indexOf(L)===N),$("#memberPostCids").val(T.join(",")),I.selectCategory(0)}})},s.update=function(){const C=f.get("groups/settings"),w=C.find('input[type="checkbox"][name]');if(C.length){const g=C.serializeObject();Array.isArray(g.memberPostCids)||(g.memberPostCids=$("#memberPostCids").val()),w.each(function(x,v){v=$(v),v.length&&(g[v.attr("name")]=v.prop("checked"))}),e.put(`/groups/${ajaxify.data.group.slug}`,g).then(()=>{if(g.name!==ajaxify.data.group.name){let x=window.location.pathname;x=x.slice(1,x.lastIndexOf("/")+1),ajaxify.go(x+c(g.name))}o.success("[[groups:event.updated]]")}).catch(o.error)}},s.deleteGroup=function(){i.confirm("Are you sure you want to delete the group: "+utils.escapeHTML(d),function(C){C&&i.prompt("Please enter the name of this group in order to delete it:",function(w){w===d&&e.del(`/groups/${ajaxify.data.group.slug}`,{}).then(()=>{o.success("[[groups:event.deleted, "+utils.escapeHTML(d)+"]]"),ajaxify.go("groups")}).catch(o.error)})})};function p(){$('[component="groups/pending/alert"]').toggleClass("hidden",$('[component="groups/pending"] tbody tr').length>0)}function E(){$('[component="groups/invited/alert"]').toggleClass("hidden",$('[component="groups/invited"] tbody tr').length>0)}function S(){if(!ajaxify.data.group.isOwner)return;async function C(){const g=await e.get(`/api/groups/${ajaxify.data.group.slug}`),x=await app.parseAndTranslate("groups/details","group.invited",{group:g.group});$('[component="groups/invited"] tbody').html(x),E(),h.refresh()}const w=$('[component="groups/members/invite"]');Promise.all([l.e(20056),l.e(34405)]).then(function(){var g=[l(34405)];(function(x){x.user(w,function(v,A){e.post(`/groups/${ajaxify.data.group.slug}/invites/${A.item.user.uid}`).then(()=>C()).catch(o.error)})}).apply(null,g)}).catch(l.oe),$('[component="groups/members/bulk-invite-button"]').on("click",async()=>{let g=$('[component="groups/members/bulk-invite"]').val();if(!g)return!1;g=g.split(",").map(v=>c(v)),g=await Promise.all(g.map(v=>e.head(`/users/bySlug/${v}`).then(()=>v).catch(()=>!1))),g=g.filter(Boolean);const x=await Promise.all(g.map(v=>e.get(`/users/bySlug/${v}`).then(({uid:A})=>A)));await Promise.all(x.map(async v=>e.post(`/groups/${ajaxify.data.group.slug}/invites/${v}`))).then(()=>{C()}).catch(o.error)})}function F(){i.confirm("[[groups:remove-group-cover-confirm]]",function(C){C&&socket.emit("groups.cover.remove",{groupName:ajaxify.data.group.name},function(w){w?o.error(w):ajaxify.refresh()})})}return s}.apply(D,y),m!==void 0&&(b.exports=m)},65348:(b,D,l)=>{"use strict";var y,m;y=[l(96349),l(33530),l(91749),l(17459)],m=function(h,t,f,n){const r={};return r.init=function(e,c){if(!e||!e.length)return;c=c||{};const a=c.onSelect||function(){};c.states=c.states||["watching","tracking","notwatching","ignoring"],c.template=c.template||"partials/category/selector-dropdown-left",f.fire("action:category.selector.options",{el:e,options:c}),h.init(e,c);const i={el:e,selectedCategory:null};e.on("click","[data-cid]",function(){const u=$(this);return u.hasClass("disabled")?!1:(i.selectCategory(u.attr("data-cid")),a(i.selectedCategory))});let o=i.el.find('[component="category-selector-selected"]').html();return n.translate(o,u=>{o=u}),i.selectCategory=function(u){const s=i.el.find('[data-cid="'+u+'"]');i.selectedCategory={cid:u,name:s.attr("data-name")},s.length?i.el.find('[component="category-selector-selected"]').html(s.find('[component="category-markup"]').html()):i.el.find('[component="category-selector-selected"]').html(o)},i.getSelectedCategory=function(){return i.selectedCategory},i.getSelectedCid=function(){return i.selectedCategory?i.selectedCategory.cid:0},c.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(c.template,{selectedCategory:c.selectedCategory},function(u){i.el.find('[component="category-selector-selected"]').html(u.find('[component="category-selector-selected"]').html())}),i},r.modal=function(e){e=e||{},e.onSelect=e.onSelect||function(){},e.onSubmit=e.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:e.message},function(c){const a=t.dialog({title:e.title||"[[modules:composer.select-category]]",message:c,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:o}}}),i=r.init(a.find('[component="category-selector"]'),e);function o(u){return u.preventDefault(),i.selectedCategory&&(e.onSubmit(i.selectedCategory),a.modal("hide")),!1}e.openOnLoad&&a.on("shown.bs.modal",function(){a.find(".dropdown-toggle").dropdown("toggle")}),a.find("form").on("submit",o)})},r}.apply(D,y),m!==void 0&&(b.exports=m)},72254:(b,D,l)=>{"use strict";var y,m;y=[l(29930)],m=function(h){const t={};t.show=function(e,c){const a=e.hasOwnProperty("fileSize")&&e.fileSize!==void 0?parseInt(e.fileSize,10):!1;app.parseAndTranslate("modals/upload-file",{showHelp:e.hasOwnProperty("showHelp")&&e.showHelp!==void 0?e.showHelp:!0,fileSize:a,title:e.title||"[[global:upload-file]]",description:e.description||"",button:e.button||"[[global:upload]]",accept:e.accept?e.accept.replace(/,/g,"&#44; "):""},function(i){i.modal("show"),i.on("hidden.bs.modal",function(){i.remove()});const o=i.find("#uploadForm");e.route&&o.attr("action",e.route),i.find("#fileUploadSubmitBtn").on("click",function(){return $(this).addClass("disabled"),e.uploadModal=i,r(e,c),!1})})},t.handleImageCrop=function(e,c){$("#crop-picture-modal").remove(),app.parseAndTranslate("modals/crop_picture",{url:utils.escapeHTML(e.url)},async function(a){a.modal({backdrop:"static"}).modal("show");const i=parseInt($(window).height()/2,10),o=document.getElementById("cropped-image");$(o).css("max-height",i);const u=(await l.e(60239).then(l.t.bind(l,65643,23))).default;let s=new u(o,{aspectRatio:e.aspectRatio,autoCropArea:1,viewMode:1,checkCrossOrigin:!0,cropmove:function(){e.restrictImageDimension&&(s.cropBoxData.width>e.imageDimension&&s.setCropBoxData({width:e.imageDimension}),s.cropBoxData.height>e.imageDimension&&s.setCropBoxData({height:e.imageDimension}))},ready:function(){if(!n(s,e))return a.modal("hide");if(e.restrictImageDimension){const d=o.width<o.height?o.width:o.height,p=d>e.imageDimension?e.imageDimension:d;s.setCropBoxData({width:p,height:p})}a.find(".rotate").on("click",function(){const d=this.getAttribute("data-degrees");s.rotate(d)}),a.find(".flip").on("click",function(){const d=this.getAttribute("data-option");this.getAttribute("data-method")==="scaleX"?s.scaleX(d):s.scaleY(d),this.setAttribute("data-option",d*-1)}),a.find(".reset").on("click",function(){s.reset()}),a.find(".crop-btn").on("click",function(){$(this).addClass("disabled");const d=n(s,e);d&&(a.find("#upload-progress-bar").css("width","0%"),a.find("#upload-progress-box").show().removeClass("hide"),f({data:e,imageData:d,progressBarEl:a.find("#upload-progress-bar")},function(p,E){if(p)return a.find("#upload-progress-box").hide(),a.find(".upload-btn").removeClass("disabled"),a.find(".crop-btn").removeClass("disabled"),h.error(p);c(E.url),a.modal("hide")}))}),a.find(".upload-btn").on("click",async function(){$(this).addClass("disabled"),s.destroy();const d=(await l.e(60239).then(l.t.bind(l,65643,23))).default;s=new d(o,{viewMode:1,autoCropArea:1,ready:function(){a.find(".crop-btn").trigger("click")}})})}})})};function f(e,c){const a={};a[e.data.paramName]=e.data.paramValue,a.method=e.data.socketMethod,a.size=e.imageData.length,a.progress=0;const i=1e5;function o(){const u=e.imageData.slice(a.progress,a.progress+i);socket.emit("uploads.upload",{chunk:u,params:a},function(s,d){if(s)return h.error(s);if(a.progress+i<a.size)return a.progress+=u.length,e.progressBarEl.css("width",(a.progress/a.size*100).toFixed(2)+"%"),setTimeout(o,100);e.progressBarEl.css("width","100%"),c(null,d)})}o()}function n(e,c){let a;try{a=c.imageType?e.getCroppedCanvas().toDataURL(c.imageType):e.getCroppedCanvas().toDataURL()}catch(i){["The operation is insecure.","Failed to execute 'toDataURL' on 'HTMLCanvasElement': Tainted canvases may not be exported."].indexOf(i.message)!==-1?h.error("[[error:cors-error]]"):h.error(i.message);return}return a}function r(e,c){function a(d,p){d==="error"&&e.uploadModal.find("#fileUploadSubmitBtn").removeClass("disabled"),e.uploadModal.find("#alert-"+d).translateText(p).removeClass("hide")}const i=e.uploadModal.find("#fileInput");if(!i.val())return a("error","[[uploads:select-file-to-upload]]");const o=i[0].files[0],u=e.hasOwnProperty("fileSize")&&e.fileSize!==void 0?parseInt(e.fileSize,10):!1;if(u&&o.size>u*1024)return a("error","[[error:file-too-big, "+u+"]]");if(o.name.endsWith(".gif")){l.e(98463).then(function(){var d=[l(24187)];(function(p){p.ajaxSubmit(e.uploadModal,c)}).apply(null,d)}).catch(l.oe);return}const s=new FileReader;s.addEventListener("load",function(){const d=s.result;e.uploadModal.modal("hide"),t.handleImageCrop({url:d,imageType:o.type,socketMethod:e.socketMethod,aspectRatio:e.aspectRatio,allowSkippingCrop:e.allowSkippingCrop,restrictImageDimension:e.restrictImageDimension,imageDimension:e.imageDimension,paramName:e.paramName,paramValue:e.paramValue},c)},!1),o&&s.readAsDataURL(o)}return t}.apply(D,y),m!==void 0&&(b.exports=m)},96349:(b,D,l)=>{"use strict";var y,m;y=[l(29930),l(89336),l(49897)],m=function(h,t,f){const n={};return n.init=function(r,e){let c=e.defaultCategories||null;e=e||{},e.privilege=e.privilege||"topics:read",e.states=e.states||["watching","tracking","notwatching","ignoring"],e.cacheList=e.hasOwnProperty("cacheList")?e.cacheList:!0;let a=[];Array.isArray(e.localCategories)&&(a=e.localCategories.map(d=>({...d})),c&&(c=[...a,...c])),e.selectedCids=e.selectedCids||ajaxify.data.selectedCids||[];const i=r.find('[component="category-selector-search"]');if(!i.length)return;const o=i.parents('[component="category/dropdown"]').length>0||i.parents('[component="category-selector"]').length>0;r.on("show.bs.dropdown",function(){o&&i.removeClass("hidden");function d(){const p=i.find("input").val();p.length>1||!p&&!c?u(p,function(E){c=e.cacheList&&(c||E),s(E)}):!p&&c&&s(c)}i.on("click",function(p){p.preventDefault(),p.stopPropagation()}),i.find("input").val("").on("keyup",utils.debounce(d,300)),d()}),r.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||i.find("input").focus()}),r.on("hide.bs.dropdown",function(){o&&i.addClass("hidden"),i.off("click"),i.find("input").off("keyup")});function u(d,p){f.get("/search/categories",{search:d,query:utils.params(),parentCid:e.parentCid||0,selectedCids:e.selectedCids,privilege:e.privilege,states:e.states,showLinks:e.showLinks},function(E,{categories:S}){if(E)return h.error(E);p(a.concat(S))})}function s(d){const p=e.selectedCids.map(String);d.forEach(function(E){E.selected=p.includes(String(E.cid))}),app.parseAndTranslate(e.template,{categoryItems:d.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(E){r.find('[component="category/list"]').html(E.find('[component="category/list"]').html()),r.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!d.length);const S=t.Dropdown.getInstance(r.find(".dropdown-toggle").get(0));S&&S.update()})}},n}.apply(D,y),m!==void 0&&(b.exports=m)}}]);
