"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,87358,99127],{49897:(_,u,o)=>{o.r(u),o.d(u,{del:()=>C,get:()=>g,head:()=>p,patch:()=>s,post:()=>a,put:()=>E});var c=o(91749),m=o.n(c),l=o(33530),w=o.n(l);const d=config.relative_path+"/api/v3";async function r(e,n){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:d+e.url,typeof n=="function"){f(e).then(t=>n(null,t),t=>n(t));return}try{return await f(e)}catch(t){if(t.message==="A valid login session was not found. Please log in and try again."){const{url:h}=await(0,c.fire)("filter:admin.reauth",{url:"login"});return(0,l.confirm)("[[error:api.reauth-required]]",y=>{y&&ajaxify.go(h)})}throw t}}async function f(e){const{url:n}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,c.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const t=await fetch(n,e),{headers:h}=t;if(h.get("x-redirect"))return f({url:h.get("x-redirect"),...e});const y=h.get("content-type"),O=y&&y.startsWith("application/json");let i;if(e.method!=="HEAD"&&(O?i=await t.json():i=await t.text()),!t.ok)throw i?new Error(O?i.status.message:i):new Error(t.statusText);return O&&i&&i.hasOwnProperty("status")&&i.hasOwnProperty("response")?i.response:i}function g(e,n,t){return r({url:e+(n&&Object.keys(n).length?"?"+$.param(n):"")},t)}function p(e,n,t){return r({url:e+(n&&Object.keys(n).length?"?"+$.param(n):""),method:"HEAD"},t)}function a(e,n,t){return r({url:e,method:"POST",data:n,headers:{"x-csrf-token":config.csrf_token}},t)}function s(e,n,t){return r({url:e,method:"PATCH",data:n,headers:{"x-csrf-token":config.csrf_token}},t)}function E(e,n,t){return r({url:e,method:"PUT",data:n,headers:{"x-csrf-token":config.csrf_token}},t)}function C(e,n,t){return r({url:e,method:"DELETE",data:n,headers:{"x-csrf-token":config.csrf_token}},t)}},93230:(_,u,o)=>{var c,m;c=[o(49897),o(29930)],m=function(l,w){const d={};let r;d.init=function(a){r=a,$('[component="chat/pinned/messages/btn"]').on("click",async()=>{const s=r.find('[component="chat/messages/pinned/container"]');if(!s.hasClass("hidden"))return s.addClass("hidden");r.find('[component="chat/user/list"]').addClass("hidden"),await d.refreshList(),s.removeClass("hidden")}),f(r)};function f(a){const s=a.find('[component="chat/messages/pinned"]');s.on("scroll",utils.debounce(async()=>{const E=(s[0].scrollHeight-s.height())*.85;if(s.scrollTop()>E){const C=s.find("[data-index]").last().attr("data-index"),e=await p(parseInt(C,10)+1);if(e&&e.length){const n=await g(e);a.find('[component="chat/messages/pinned"]').append(n)}}},200))}d.refreshList=async function(){const a=await p(0);if(!a.length){r.find('[component="chat/messages/pinned/empty"]').removeClass("hidden"),r.find('[component="chat/messages/pinned"]').html("");return}r.find('[component="chat/messages/pinned/empty"]').addClass("hidden");const s=await g(a);r.find('[component="chat/messages/pinned"]').html(s),s.find(".timeago").timeago()};async function g(a){return await app.parseAndTranslate("partials/chats/pinned-messages-list","messages",{isOwner:ajaxify.data.isOwner,isAdminOrGlobalMod:ajaxify.data.isAdminOrGlobalMod,messages:a})}async function p(a){const{messages:s}=await l.get(`/chats/${ajaxify.data.roomId}/messages/pinned`,{start:a});return s}return d.pin=function(a,s){l.put(`/chats/${s}/messages/${a}/pin`,{}).then(()=>{$(`[component="chat/message"][data-mid="${a}"]`).toggleClass("pinned",!0),d.refreshList()}).catch(w.error)},d.unpin=function(a,s){l.del(`/chats/${s}/messages/${a}/pin`,{}).then(()=>{$(`[component="chat/message"][data-mid="${a}"]`).toggleClass("pinned",!1),r.find(`[component="chat/messages/pinned"] [data-mid="${a}"]`).remove(),r.find('[component="chat/messages/pinned"] [data-mid]').length||r.find('[component="chat/messages/pinned/empty"]').removeClass("hidden")}).catch(w.error)},d}.apply(u,c),m!==void 0&&(_.exports=m)}}]);
