"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,13201,34271,49897,99127],{11599:(w,g,s)=>{var f,m;f=[s(52473),s(91749),s(49897)],m=function(d,D,C){const i={};i.prepareDOM=function(){const o=$('[component="chat/dropdown"]');o.on("show.bs.dropdown",r=>{h("loadChatsDropdown",$(r.target).parent().find('[component="chat/list"]'))}),o.each((r,a)=>{const e=$(a).parent().find(".dropdown-menu");e.hasClass("show")&&h("loadChatsDropdown",e.find('[component="chat/list"]'))}),socket.removeListener("event:chats.receive",l),socket.on("event:chats.receive",l),socket.removeListener("event:chats.typing",p),socket.on("event:chats.typing",p),socket.removeListener("event:chats.roomRename",E),socket.on("event:chats.roomRename",E),socket.on("event:unread.updateChatCount",async function(r){if(r){const[t,u]=await app.require(["chat","forum/chats"]);if(t.isFromBlockedUser(r.fromUid)||t.isLookingAtRoom(r.roomId)||app.user.uid===parseInt(r.fromUid,10))return;u.markChatPageElUnread(r),u.updateTeaser(r.roomId,r.teaser)}let{count:a}=await C.get("/chats/unread");const e=d.get("chat/icon");a=Math.max(0,a),e.toggleClass("fa-comment",a>0).toggleClass("fa-comment-o",a<=0);const n=a>99?"99+":a;d.get("chat/icon").toggleClass("unread-count",a>0).attr("data-content",n),d.get("chat/count").toggleClass("hidden",a<=0).text(n),D.fire("action:chat.updateCount",{count:a})})};function l(o){h("onChatMessageReceived",o)}function p(o){h("onUserTyping",o)}function E(o){h("onRoomRename",o)}async function h(o,r){(await app.require("chat"))[o](r)}return i}.apply(g,f),m!==void 0&&(w.exports=m)},49897:(w,g,s)=>{s.r(g),s.d(g,{del:()=>a,get:()=>p,head:()=>E,patch:()=>o,post:()=>h,put:()=>r});var f=s(91749),m=s.n(f),d=s(33530),D=s.n(d);const C=config.relative_path+"/api/v3";async function i(e,n){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:C+e.url,typeof n=="function"){l(e).then(t=>n(null,t),t=>n(t));return}try{return await l(e)}catch(t){if(t.message==="A valid login session was not found. Please log in and try again."){const{url:u}=await(0,f.fire)("filter:admin.reauth",{url:"login"});return(0,d.confirm)("[[error:api.reauth-required]]",v=>{v&&ajaxify.go(u)})}throw t}}async function l(e){const{url:n}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,f.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const t=await fetch(n,e),{headers:u}=t;if(u.get("x-redirect"))return l({url:u.get("x-redirect"),...e});const v=u.get("content-type"),y=v&&v.startsWith("application/json");let c;if(e.method!=="HEAD"&&(y?c=await t.json():c=await t.text()),!t.ok)throw c?new Error(y?c.status.message:c):new Error(t.statusText);return y&&c&&c.hasOwnProperty("status")&&c.hasOwnProperty("response")?c.response:c}function p(e,n,t){return i({url:e+(n&&Object.keys(n).length?"?"+$.param(n):"")},t)}function E(e,n,t){return i({url:e+(n&&Object.keys(n).length?"?"+$.param(n):""),method:"HEAD"},t)}function h(e,n,t){return i({url:e,method:"POST",data:n,headers:{"x-csrf-token":config.csrf_token}},t)}function o(e,n,t){return i({url:e,method:"PATCH",data:n,headers:{"x-csrf-token":config.csrf_token}},t)}function r(e,n,t){return i({url:e,method:"PUT",data:n,headers:{"x-csrf-token":config.csrf_token}},t)}function a(e,n,t){return i({url:e,method:"DELETE",data:n,headers:{"x-csrf-token":config.csrf_token}},t)}}}]);
