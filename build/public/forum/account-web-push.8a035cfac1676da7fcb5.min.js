(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,3452,34271,49897,99127],{4812:(y,l,a)=>{"use strict";a.r(l),a.d(l,{init:()=>p});var c=a(49897),b=a(29930);async function p(){const d=document.querySelector(".account"),s=await navigator.serviceWorker.ready;let r=await s.pushManager.getSubscription();const o=m(config["web-push"].vapidKey);d.addEventListener("click",async h=>{const E=h.target.closest("[data-action]");if(E)switch(h.target.getAttribute("data-action")){case"test":{r?(await(0,c.post)("/plugins/web-push/test",{subscription:r}),(0,b.success)("[[web-push:toast.test_success]]")):(0,b.warning)("[[web-push:toast.test_unavailable]]");break}case"toggle":{const t=document.querySelector("#deviceCount strong");if(r){await r.unsubscribe(),await(0,c.del)("/plugins/web-push/subscription",{subscription:r.toJSON()});let e=parseInt(t.textContent,10);e-=1,t.innerText=e,r=null}else try{r=await s.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:o}),await(0,c.post)("/plugins/web-push/subscription",{subscription:r.toJSON()});let e=parseInt(t.textContent,10);e+=1,t.innerText=e}catch{E.checked=!1}break}}});const f=document.getElementById("enabled");r&&(f.checked=!0),await s.pushManager.permissionState({userVisibleOnly:!0,applicationServerKey:o})==="denied"&&document.getElementById("permission-warning").classList.remove("d-none")}function m(d){for(var s="=".repeat((4-d.length%4)%4),r=(d+s).replace(/-/g,"+").replace(/_/g,"/"),o=window.atob(r),f=new Uint8Array(o.length),u=0;u<o.length;++u)f[u]=o.charCodeAt(u);return f}},43586:(y,l,a)=>{y.exports=a(4812)},49897:(y,l,a)=>{"use strict";a.r(l),a.d(l,{del:()=>O,get:()=>o,head:()=>f,patch:()=>h,post:()=>u,put:()=>E});var c=a(91749),b=a.n(c),p=a(33530),m=a.n(p);const d=config.relative_path+"/api/v3";async function s(t,e){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:d+t.url,typeof e=="function"){r(t).then(n=>e(null,n),n=>e(n));return}try{return await r(t)}catch(n){if(n.message==="A valid login session was not found. Please log in and try again."){const{url:g}=await(0,c.fire)("filter:admin.reauth",{url:"login"});return(0,p.confirm)("[[error:api.reauth-required]]",w=>{w&&ajaxify.go(g)})}throw n}}async function r(t){const{url:e}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,c.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const n=await fetch(e,t),{headers:g}=n;if(g.get("x-redirect"))return r({url:g.get("x-redirect"),...t});const w=g.get("content-type"),v=w&&w.startsWith("application/json");let i;if(t.method!=="HEAD"&&(v?i=await n.json():i=await n.text()),!n.ok)throw i?new Error(v?i.status.message:i):new Error(n.statusText);return v&&i&&i.hasOwnProperty("status")&&i.hasOwnProperty("response")?i.response:i}function o(t,e,n){return s({url:t+(e&&Object.keys(e).length?"?"+$.param(e):"")},n)}function f(t,e,n){return s({url:t+(e&&Object.keys(e).length?"?"+$.param(e):""),method:"HEAD"},n)}function u(t,e,n){return s({url:t,method:"POST",data:e,headers:{"x-csrf-token":config.csrf_token}},n)}function h(t,e,n){return s({url:t,method:"PATCH",data:e,headers:{"x-csrf-token":config.csrf_token}},n)}function E(t,e,n){return s({url:t,method:"PUT",data:e,headers:{"x-csrf-token":config.csrf_token}},n)}function O(t,e,n){return s({url:t,method:"DELETE",data:e,headers:{"x-csrf-token":config.csrf_token}},n)}}}]);
