"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,38395,49897,90677,94747,99127],{16227:(_,P,f)=>{var p,h;p=[f(52473)],h=function(x){const s={};let y;s.pids=[];let c=!1;s.init=function(d,a){s.pids.length=0,y=d,a=a||{},c=a.allowMainPostSelect||!1,$("#content").on("click",'[component="topic"] [component="post"]',g),r()};function g(d){d.stopPropagation();const a=$(this).attr("data-pid"),u=$('[component="topic"] [data-pid="'+a+'"]');!c&&parseInt($(this).attr("data-index"),10)===0||s.togglePostSelection(u,a)}s.disable=function(){s.pids.forEach(function(d){x.get("post","pid",d).toggleClass("selected",!1)}),$("#content").off("click",'[component="topic"] [component="post"]',g),l()},s.togglePostSelection=function(d,a){if(a){const u=s.pids.indexOf(a);u===-1?(s.pids.push(a),d.toggleClass("selected",!0)):(s.pids.splice(u,1),d.toggleClass("selected",!1)),s.pids.length&&s.pids.sort(function(t,n){return t-n}),typeof y=="function"&&y()}};function E(){return!1}function r(){$("#content").on("click",'[component="post"] button, [component="post"] a',E)}function l(){$("#content").off("click",'[component="post"] button, [component="post"] a',E)}return s}.apply(P,p),h!==void 0&&(_.exports=h)},49897:(_,P,f)=>{f.r(P),f.d(P,{del:()=>u,get:()=>E,head:()=>r,patch:()=>d,post:()=>l,put:()=>a});var p=f(91749),h=f.n(p),x=f(33530),s=f.n(x);const y=config.relative_path+"/api/v3";async function c(t,n){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:y+t.url,typeof n=="function"){g(t).then(o=>n(null,o),o=>n(o));return}try{return await g(t)}catch(o){if(o.message==="A valid login session was not found. Please log in and try again."){const{url:m}=await(0,p.fire)("filter:admin.reauth",{url:"login"});return(0,x.confirm)("[[error:api.reauth-required]]",v=>{v&&ajaxify.go(m)})}throw o}}async function g(t){const{url:n}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,p.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const o=await fetch(n,t),{headers:m}=o;if(m.get("x-redirect"))return g({url:m.get("x-redirect"),...t});const v=m.get("content-type"),e=v&&v.startsWith("application/json");let i;if(t.method!=="HEAD"&&(e?i=await o.json():i=await o.text()),!o.ok)throw i?new Error(e?i.status.message:i):new Error(o.statusText);return e&&i&&i.hasOwnProperty("status")&&i.hasOwnProperty("response")?i.response:i}function E(t,n,o){return c({url:t+(n&&Object.keys(n).length?"?"+$.param(n):"")},o)}function r(t,n,o){return c({url:t+(n&&Object.keys(n).length?"?"+$.param(n):""),method:"HEAD"},o)}function l(t,n,o){return c({url:t,method:"POST",data:n,headers:{"x-csrf-token":config.csrf_token}},o)}function d(t,n,o){return c({url:t,method:"PATCH",data:n,headers:{"x-csrf-token":config.csrf_token}},o)}function a(t,n,o){return c({url:t,method:"PUT",data:n,headers:{"x-csrf-token":config.csrf_token}},o)}function u(t,n,o){return c({url:t,method:"DELETE",data:n,headers:{"x-csrf-token":config.csrf_token}},o)}},90677:(_,P,f)=>{var p,h;p=[f(52473),f(16227),f(17459),f(29930),f(49897)],h=function(x,s,y,c,g){const E={};let r,l,d;E.init=function(e){r||(d=ajaxify.data.tid,app.parseAndTranslate("modals/move-post",{},function(i){r=i,l=r.find("#move_posts_confirm"),$("body").append(r),r.find("#move_posts_cancel").on("click",v),r.find("#topicId").on("keyup",utils.debounce(n,200)),s.init(o),t(),e&&s.togglePostSelection(e,e.attr("data-pid")),$(window).off("action:ajaxify.end",a).on("action:ajaxify.end",a),l.on("click",function(){const A=u();if(!A)return;l.attr("disabled",!0);const T={pids:s.pids.slice(),tid:A};if(config.undoTimeout>0)return c.alert({alert_id:"pids_move_"+s.pids.join("-"),title:"[[topic:thread-tools.move-posts]]",message:"[[topic:topic-move-posts-success]]",type:"success",timeout:config.undoTimeout,timeoutfn:function(){m(T)},clickfn:function(C,j){delete j.timeoutfn,c.success("[[topic:topic-move-posts-undone]]"),l.removeAttr("disabled")}});m(T)})}))};function a(){if(!r)return;const e=r.find("#topicId");let i=null;ajaxify.data.template.topic&&ajaxify.data.tid&&String(ajaxify.data.tid)!==String(d)&&(i=ajaxify.data.tid),i&&e.val(i),n()}function u(){const e=r.find("#topicId");return e.length&&e.val()?e.val():ajaxify.data.template.topic&&ajaxify.data.tid}function t(){if(!r)return;const e=u();s.pids.length?e&&String(e)!==String(d)?g.get(`/topics/${e}`,{}).then(function(i){if(!i||!i.tid)return c.error("[[error:no-topic]]");if(i.scheduled)return c.error("[[error:cant-move-posts-to-scheduled]]");const A=y.compile("topic:x-posts-will-be-moved-to-y",s.pids.length,i.title);r.find("#pids").translateHtml(A)}):r.find("#pids").translateHtml("[[topic:x-posts-selected, "+s.pids.length+"]]"):r.find("#pids").translateHtml("[[topic:no-posts-selected]]")}function n(){if(!r)return;const e=u();s.pids.length&&e&&String(e)!==String(d)?l.removeAttr("disabled"):l.attr("disabled",!0),t()}function o(){n()}function m(e){e.tid&&Promise.all(e.pids.map(i=>g.put(`/posts/${encodeURIComponent(i)}/move`,{tid:e.tid}))).then(()=>{e.pids.forEach(function(i){x.get("post","pid",i).fadeOut(500,function(){$(this).remove()})}),e.pids.length&&ajaxify.data.template.topic&&String(e.tid)===String(ajaxify.data.tid)&&ajaxify.go(`/post/${e.pids[0]}`),v()}).catch(c.error)}function v(){r&&(r.remove(),r=null,s.disable(),$(window).off("action:ajaxify.end",a))}return E}.apply(P,p),h!==void 0&&(_.exports=h)}}]);
