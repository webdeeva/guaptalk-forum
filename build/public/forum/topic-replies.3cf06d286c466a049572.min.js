"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[18631,22765,75264,76177],{2269:(R,B)=>{var r,E;r=[],E=function(){const x={},C=/-resized(\.[\w]+)?$/;return x.wrapImagesInLinks=function(A){A.find('[component="post/content"] img:not(.emoji)').each(function(){x.wrapImageInLink($(this))})},x.wrapImageInLink=function(A){let T=A.attr("src")||"";if(T!=="about:blank"&&!A.parent().is("a")){utils.isRelativeUrl(T)&&C.test(T)&&(T=T.replace(C,"$1"));const j=A.attr("alt")||"",m=T.split(".").slice(1).pop(),f=j.split("/").pop(),s=f.split(".").slice(1).pop();A.wrap('<a href="'+T+'" '+(!m&&s?' download="'+utils.escapeHTML(f)+'" ':"")+' target="_blank" rel="noopener">')}},x}.apply(B,r),E!==void 0&&(R.exports=E)},18631:(R,B,r)=>{var E,x;E=[r(47536),r(91749),r(29930),r(49897)],x=function(C,A,T,j){const m={};m.init=function(s){const g=s.closest("[data-pid]"),v=g.data("pid"),e=s.find('[component="post/replies/open"]');e.attr("loading")!=="1"&&e.attr("loaded")!=="1"?(e.attr("loading","1").removeClass("fa-chevron-down").addClass("fa-spin fa-spinner"),j.get(`/posts/${encodeURIComponent(v)}/replies`,{},function(w,{replies:a}){const p=a;if(e.removeAttr("loading").attr("loaded","1").removeClass("fa-spin fa-spinner").addClass("fa-chevron-up"),w)return T.error(w);p.forEach((c,u)=>{c&&(c.index=u)}),C.modifyPostsByPrivileges(p);const l={posts:p,privileges:ajaxify.data.privileges,"downvote:disabled":ajaxify.data["downvote:disabled"],"reputation:disabled":ajaxify.data["reputation:disabled"],loggedIn:!!app.user.uid,hideParent:!0,hideReplies:config.hasOwnProperty("showNestedReplies")?!config.showNestedReplies:!0};app.parseAndTranslate("topic","posts",l,async function(c){const u=$("<ul>",{component:"post/replies",class:"list-unstyled"}).html(c).hide();s.attr("data-target-component")?g.find('[component="'+s.attr("data-target-component")+'"]').html(u):u.insertAfter(s),u.slideDown("fast"),await C.onNewPostsAddedToDom(c),A.fire("action:posts.loaded",{posts:p})})})):e.attr("loaded")==="1"&&(e.removeAttr("loaded").removeAttr("loading").removeClass("fa-spin fa-spinner fa-chevron-up").addClass("fa-chevron-down"),g.find('[component="post/replies"]').slideUp("fast",function(){$(this).remove()}))},m.onNewPost=function(s){const g=s.posts[0];g&&(f(g,1),s.hideReplies=config.hasOwnProperty("showNestedReplies")?!config.showNestedReplies:!0,app.parseAndTranslate("topic","posts",s,async function(v){const e=$('[component="post"][data-pid="'+g.toPid+'"] [component="post/replies"]').first();e.length&&(config.topicPostSort==="newest_to_oldest"?e.prepend(v):e.append(v),await C.onNewPostsAddedToDom(v))}))},m.onPostPurged=function(s){f(s,-1)};function f(s,g){const v=document.querySelector(`[component="post"][data-pid="${s.toPid}"]`);if(!v)return;const e=$('[component="post"][data-pid="'+s.toPid+'"]').find('[component="post/reply-count"]').first(),w=e.find('[component="post/reply-count/text"]'),a=e.find('[component="post/reply-count/avatars"]'),p=Math.max(0,(parseInt(w.attr("data-replies"),10)||0)+g),l=e.find(".timeago").attr("title",s.timestampISO),c=v.getAttribute("data-index"),u=p===1&&Math.abs(s.index-c)===1;w.attr("data-replies",p),e.toggleClass("hidden",p<=0||u),p>1?w.translateText("[[topic:replies-to-this-post, "+p+"]]"):w.translateText("[[topic:one-reply-to-this-post]]"),!a.find('[data-uid="'+s.uid+'"]').length&&p<7&&app.parseAndTranslate("topic","posts",{posts:[{replies:{count:p,hasMore:!1,users:[s.user]}}]},function(M){a.prepend(M.find('[component="post/reply-count/avatars"]').html())}),a.addClass("hasMore"),l.data("timeago",null).timeago()}return m}.apply(B,E),x!==void 0&&(R.exports=x)},22410:(R,B,r)=>{var E,x;E=[r(91749),r(29930),r(49897)],x=function(C,A,T){const j={};let m,f=0,s=!1,g,v=0;j.init=function(a,p){const l=$("body");typeof a=="function"?(m=a,g=l):(m=p,g=a||l),f=$(window).scrollTop(),$(window).off("scroll",e).on("scroll",e),l.height()<=$(window).height()&&(!ajaxify.data.hasOwnProperty("pageCount")||ajaxify.data.pageCount>1)&&m(1)};function e(){v&&clearTimeout(v),v=setTimeout(function(){v=0,w()},60)}function w(){const a=utils.findBootstrapEnvironment(),p=(a==="xs"||a==="sm")&&$("html").hasClass("composing");if(s||p||app.flags._glance)return;const l=$(window).scrollTop(),c=$(window).height(),u=g.height()-c,M=g.offset()?g.offset().top:0,N=100*(l-M)/(u<=0?c:u),O=15,W=85,b=l>f?1:-1;(N<O&&l<f||N>W&&l>f||N<0&&b>0&&u<0)&&m(b),f=l}return j.loadMore=function(a,p,l){if(s)return;s=!0;const c={method:a,data:p};C.fire("action:infinitescroll.loadmore",c),(c.method.startsWith("/")?T.get:socket.emit)(c.method,c.data,function(M,N){if(M)return s=!1,A.error(M);l(N,function(){s=!1})})},j.loadMoreXhr=function(a,p){if(s)return;s=!0;const l=config.relative_path+"/api"+location.pathname.replace(new RegExp("^"+config.relative_path),""),c={url:l,data:a};C.fire("action:infinitescroll.loadmore.xhr",c),$.get(l,a,function(u){p(u,function(){s=!1})}).fail(function(u){s=!1,A.error(String(u.responseJSON||"[[error:no-connection]]"))})},j.removeExtra=function(a,p,l){let c=$();if(a.length<=l)return c;const u=a.length-l;if(p>0){const M=$(document).height(),N=$(window).scrollTop();c=a.slice(0,u).remove(),$(window).scrollTop(N+($(document).height()-M))}else c=a.slice(a.length-u).remove();return c},j}.apply(B,E),x!==void 0&&(R.exports=x)},47536:(R,B,r)=>{var E,x;E=[r(25967),r(22410),r(8454),r(2269),r(96352),r(52473),r(17459),r(91749),r(30076)],x=function(C,A,T,j,m,f,s,g,v){const e={};e.signaturesShown={};const w=$(window);e.onNewPost=function(t){!t||!t.posts||!t.posts.length||String(t.posts[0].tid)!==String(ajaxify.data.tid)||(t.loggedIn=!!app.user.uid,t.privileges=ajaxify.data.privileges,t.posts[0].timestamp=t.posts[0].topic.scheduled?t.posts[0].timestamp:Date.now()-1e3,t.posts[0].timestampISO=utils.toISOString(t.posts[0].timestamp),e.modifyPostsByPrivileges(t.posts),p(t.posts),a(t.posts[0]),l(t.posts),ajaxify.data.postcount+=1,T.updatePostCount(ajaxify.data.postcount),config.usePagination?c(t):M(t),r.e(18631).then(function(){var o=[r(18631)];(function(n){n.onNewPost(t)}).apply(null,o)}).catch(r.oe))};function a(t){$(".pagination-block .pagebottom .timeago").timeago("update",t.timestampISO)}e.modifyPostsByPrivileges=function(t){t.forEach(function(o){o.selfPost=!!app.user.uid&&parseInt(o.uid,10)===parseInt(app.user.uid,10),o.topicOwnerPost=parseInt(o.uid,10)===parseInt(ajaxify.data.uid,10),o.display_edit_tools=ajaxify.data.privileges["posts:edit"]&&o.selfPost||ajaxify.data.privileges.isAdminOrMod,o.display_delete_tools=ajaxify.data.privileges["posts:delete"]&&o.selfPost||ajaxify.data.privileges.isAdminOrMod,o.display_moderator_tools=o.display_edit_tools||o.display_delete_tools,o.display_move_tools=ajaxify.data.privileges.isAdminOrMod,o.display_post_menu=ajaxify.data.privileges.isAdminOrMod||o.selfPost&&!ajaxify.data.locked&&!o.deleted||o.selfPost&&o.deleted&&parseInt(o.deleterUid,10)===parseInt(app.user.uid,10)||(app.user.uid||ajaxify.data.postSharing.length)&&!o.deleted})};function p(t){for(let o=0;o<t.length;o+=1){const n=f.get("user/postcount",t[o].uid);n.html(v.formattedNumber(parseInt(n.attr("data-postcount"),10)+1))}}function l(t){config.topicPostSort==="newest_to_oldest"&&(t[0].index=1,f.get("post").not("[data-index=0]").each(function(){const o=parseInt($(this).attr("data-index"),10)+1;$(this).attr("data-index",o)}))}function c(t){function o(){N(t.posts[0])}const n=t.posts;ajaxify.data.pagination.pageCount=Math.max(1,Math.ceil(n[0].topic.postcount/config.postsPerPage));const i=config.topicPostSort==="oldest_to_newest"||config.topicPostSort==="most_votes"?1:-1;if(ajaxify.data.pagination.currentPage===ajaxify.data.pagination.pageCount&&i===1||ajaxify.data.pagination.currentPage===1&&i===-1){const I=$('[component="post"]:not([data-index=0]), [component="topic/event"]');O(t,I,i,!1,o)}else ajaxify.data.scrollToMyPost&&parseInt(n[0].uid,10)===parseInt(app.user.uid,10)?setTimeout(function(){C.loadPage(ajaxify.data.pagination.pageCount,o)},250):u()}function u(){$.get(config.relative_path+"/api/topic/pagination/"+ajaxify.data.tid,{page:ajaxify.data.pagination.currentPage},function(t){app.parseAndTranslate("partials/paginator",t,function(o){$('[component="pagination"]').after(o).remove()})})}function M(t){const o=config.topicPostSort==="oldest_to_newest"||config.topicPostSort==="most_votes"?1:-1,n=$('[component="post"][data-index="'+(t.posts[0].index-1)+'"]').length;if(!n&&(!t.posts[0].selfPost||!ajaxify.data.scrollToMyPost))return;if(!n&&t.posts[0].selfPost)return ajaxify.go("post/"+t.posts[0].pid);const i=$('[component="topic"]>[component="post"]:not([data-index=0]), [component="topic"]>[component="topic/event"]');O(t,i,o,!1,function(d){d&&d.addClass("new"),N(t.posts[0])})}function N(t){t.selfPost&&ajaxify.data.scrollToMyPost&&m.scrollBottom(t.index)}function O(t,o,n,i,d){if(d=d||function(){},!t||t.posts&&!t.posts.length)return d();function I(){const y=$('[component="post"].new');if(y.length===t.posts.length){let S=!0;if(y.each(function(P,_){parseInt($(_).attr("data-pid"),10)!==parseInt(t.posts[P].pid,10)&&(S=!1)}),S){y.each(function(){$(this).removeClass("new")}),t.posts.length=0;return}}y.length&&t.posts.length>1&&t.posts.forEach(function(S){const P=f.get("post","pid",S.pid);P.hasClass("new")&&P.remove()}),t.posts=t.posts.filter(function(S){return S.allowDupe||$('[component="post"][data-pid="'+S.pid+'"]').length===0})}if(I(),!t.posts.length)return d();let h,D;n>0&&o.length?h=o.last():n<0&&o.length&&(D=o.first()),g.fire("action:posts.loading",{posts:t.posts,after:h,before:D}),app.parseAndTranslate("topic","posts",Object.assign({},ajaxify.data,t),async function(y){y=y.filter(function(){const P=$(this),_=P.attr("data-pid"),K=P.attr("data-allow-dupe");return!P.is('[component="post"]')||K||_&&$('[component="post"][data-pid="'+_+'"]').length===0});const S=A.removeExtra($('[component="post"]'),n,Math.max(20,config.postsPerPage*2));if(h)y.insertAfter(h);else if(D){const P=$(document).height(),_=w.scrollTop();y.insertBefore(D),(i||_>0)&&w.scrollTop(_+($(document).height()-P))}else f.get("topic").append(y);await e.onNewPostsAddedToDom(y),F(S),g.fire("action:posts.loaded",{posts:t.posts}),d(y)})}e.loadMorePosts=function(t){if(!f.get("topic").length||m.scrollActive)return;const o=f.get("topic").find(f.get("post").not("[data-index=0]").not(".new")),n=t>0?o.last():o.first(),i=parseInt(n.attr("data-index"),10)||0,d=ajaxify.data.tid;if(!utils.isNumber(i)||t<0&&f.get("post","index",0).length)return;const I=$(".loading-indicator");I.is(":animated")||I.fadeIn(),A.loadMore("topics.loadMore",{tid:d,after:i+(t>0?1:0),count:config.postsPerPage,direction:t,topicPostSort:utils.params().sort||config.topicPostSort},function(h,D){if(I.fadeOut(),h&&h.posts&&h.posts.length){const y=$('[component="post"]:not([data-index=0]):not(.new), [component="topic/event"]');O(h,y,t,!0,D)}else m.update(),D()})},e.onTopicPageLoad=async function(t){L(t),j.wrapImagesInLinks(t),b(t),e.showBottomPostBar(),t.find('[component="post/content"] img:not(.not-responsive)').addClass("img-fluid"),e.addBlockquoteEllipses(t),U(t),await W()},e.addTopicEvents=async function(t){if(config.topicPostSort==="most_votes")return;const o=await Promise.all(t.map(n=>app.parseAndTranslate("partials/topic/event",{...n,privileges:ajaxify.data.privileges})));if(config.topicPostSort==="oldest_to_newest")$('[component="topic"]').append(o);else if(config.topicPostSort==="newest_to_oldest"){const n=$('[component="topic"] [component="post"][data-index="0"]');n.length?n.after(o.reverse()):$('[component="topic"]').prepend(o.reverse())}$('[component="topic/event"] .timeago').timeago()};async function W(){const t=ajaxify.data.necroThreshold*24*60*60*1e3;if(!t||config.topicPostSort!=="newest_to_oldest"&&config.topicPostSort!=="oldest_to_newest")return;const o=w.scrollTop(),n=$('[component="post"]').toArray();await Promise.all(n.map(async function(i){i=$(i);const d=i.prev('[component="post"]');if(i.is(":has(.necro-post)")||!d.length||config.topicPostSort==="newest_to_oldest"&&parseInt(d.attr("data-index"),10)===0)return;const I=i.attr("data-timestamp")-d.attr("data-timestamp");if(Math.abs(I)>=t){const h=["suffixAgo","prefixAgo","suffixFromNow","prefixFromNow"],D={};h.forEach(P=>{D[P]=$.timeago.settings.strings[P],$.timeago.settings.strings[P]=""});const y=(I>0?"[[topic:timeago-later,":"[[topic:timeago-earlier,")+$.timeago.inWords(I)+"]]";h.forEach(P=>{$.timeago.settings.strings[P]=D[P]});const S=await app.parseAndTranslate("partials/topic/necro-post",{text:y});S.attr("data-necro-post-index",d.attr("data-index")),S.insertBefore(i)}})),o>0&&w.scrollTop()<o&&w.scrollTop(o)}function b(t){ajaxify.data["signatures:hideDuplicates"]&&t.each((o,n)=>{const i=$(n).find('[component="post/signature"]'),d=i.attr("data-uid");e.signaturesShown[d]?i.addClass("hidden"):e.signaturesShown[d]=!0})}function F(t){t.each((o,n)=>{$(`[data-necro-post-index="${$(n).attr("data-index")}"]`).remove()})}function L(t){if(app.user.uid||!ajaxify.data.privateUploads)return;const o=document.createElement("a");o.className="login-required",o.href=config.relative_path+"/login",s.translate("[[topic:login-to-view]]",function(n){o.appendChild(document.createTextNode(n)),t.each(function(i,d){$(d).find('[component="post/content"] img').each(function(I,h){h=$(h),h.attr("src").startsWith(config.relative_path+config.upload_url)&&h.replaceWith(o.cloneNode(!0))})})})}e.onNewPostsAddedToDom=async function(t){await e.onTopicPageLoad(t),t.find(".timeago").timeago()},e.showBottomPostBar=function(){const t=f.get("post","index",0),o=$(".post-bar-placeholder"),n=$('[component="post"]');t.length&&n.length>1&&$(".post-bar").length<2&&o.length?($(".post-bar").clone().insertAfter(o),o.remove()):t.length&&n.length<2&&t.find(".post-bar").remove()};function U(t){t.each(function(){$(this).hasClass("deleted")&&T.toggle($(this).attr("data-pid"),!0)})}return e.addBlockquoteEllipses=function(t){t.find('[component="post/content"] blockquote').filter((i,d)=>!$(d).parent().is("blockquote")).find(">blockquote").each(function(){const i=$(this);i.find(":hidden:not(br)").length&&!i.find(".toggle").length&&i.append('<i class="d-inline-block fa fa-angle-down pointer toggle py-1 px-3 border text-bg-light"></i>')})},e}.apply(B,E),x!==void 0&&(R.exports=x)}}]);
