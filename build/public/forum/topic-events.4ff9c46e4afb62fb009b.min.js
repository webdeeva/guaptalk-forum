"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[98088],{57642:(C,j,o)=>{var h,f;h=[o(8454),o(60984),o(47536),o(2269),o(52473),o(17459),o(91749),o(30076)],f=function(g,r,m,k,c,l,x,A){const u={},y={"event:user_status_change":I,"event:voted":R,"event:bookmarked":b,"event:topic_deleted":r.setDeleteState,"event:topic_restored":r.setDeleteState,"event:topic_purged":B,"event:topic_locked":r.setLockedState,"event:topic_unlocked":r.setLockedState,"event:topic_pinned":r.setPinnedState,"event:topic_unpinned":r.setPinnedState,"event:topic_moved":O,"event:post_edited":L,"event:post_purged":w,"event:post_deleted":E,"event:post_restored":E,"posts.bookmark":P,"posts.unbookmark":P,"posts.upvote":v,"posts.downvote":v,"posts.unvote":v,"event:new_notification":N,"event:new_post":m.onNewPost};u.init=function(){u.removeListeners();for(const[t,e]of Object.entries(y))socket.on(t,e)},u.removeListeners=function(){for(const[t,e]of Object.entries(y))socket.removeListener(t,e)};function I(t){app.updateUserStatus($('[data-uid="'+t.uid+'"] [component="user/status"]'),t.status)}function R(t){const e=$('[data-pid="'+t.post.pid+'"] [component="post/vote-count"]').filter(function(p,d){return $(d).closest("[data-pid]").attr("data-pid")===String(t.post.pid)}),n=$('.reputation[data-uid="'+t.post.uid+'"]');e.html(t.post.votes).attr("data-votes",t.post.votes),n.html(t.user.reputation).attr("data-reputation",t.user.reputation)}function b(t){$('[data-pid="'+t.post.pid+'"] .bookmarkCount').filter(function(e,n){return $(n).closest("[data-pid]").attr("data-pid")===String(t.post.pid)}).html(t.post.bookmarks).attr("data-bookmarks",t.post.bookmarks)}function B(t){ajaxify.data.category&&ajaxify.data.category.slug&&String(t.tid)===String(ajaxify.data.tid)&&ajaxify.go("category/"+ajaxify.data.category.slug,null,!0)}function O(t){t&&t.slug&&String(t.tid)===String(ajaxify.data.tid)&&ajaxify.go("topic/"+t.slug,null,!0)}function L(t){if(!t||!t.post||String(t.post.tid)!==String(ajaxify.data.tid))return;const e=c.get("post/content",t.post.pid).filter(function(i,s){return String($(s).closest("[data-pid]").attr("data-pid"))===String(t.post.pid)}),n=$(`[data-pid="${t.post.pid}"]`),p=n.find('[component="post/editor"]').filter(function(i,s){return String($(s).closest("[data-pid]").attr("data-pid"))===String(t.post.pid)}),d=c.get("topic/title"),a=c.get("navbar/title").find("span"),S=c.get("breadcrumb/current");if(t.topic.rescheduled)return ajaxify.go("topic/"+t.topic.slug,null,!0);if(d.length&&t.topic.title&&t.topic.renamed){ajaxify.data.title=t.topic.title;const i="topic/"+t.topic.slug+(window.location.search?window.location.search:"");history.replaceState({url:i},null,window.location.protocol+"//"+window.location.host+config.relative_path+"/"+i),d.fadeOut(250,function(){d.html(t.topic.title).fadeIn(250)}),S.fadeOut(250,function(){S.html(t.topic.title).fadeIn(250)}),a.fadeOut(250,function(){a.html(t.topic.title).fadeIn(250)})}if(t.post.changed){e.fadeOut(250,function(){if(e.html(l.unescape(t.post.content)),e.find("img:not(.not-responsive)").addClass("img-fluid"),k.wrapImagesInLinks(e.parent()),m.addBlockquoteEllipses(e.parent()),e.fadeIn(250),t.post.edited){const s={editor:t.editor,editedISO:utils.toISOString(t.post.edited)};app.parseAndTranslate("partials/topic/post-editor",s,function(D){p.replaceWith(D),n.find('[component="post/edit-indicator"]').removeClass("hidden").translateAttr("title",`[[global:edited-timestamp, ${A.isoTimeToLocaleString(s.editedISO,config.userLang)}]]`),n.find('[component="post/editor"] .timeago').timeago(),x.fire("action:posts.edited",t)})}});const i=$(`[component="post/parent"][data-parent-pid="${t.post.pid}"]`);i.length&&(i.find('[component="post/parent/content"]').html(l.unescape(t.post.content)),i.find("img:not(.not-responsive)").addClass("img-fluid"),i.find('[component="post/parent/content]" img:not(.emoji)').each(function(){k.wrapImageInLink($(this))}))}else x.fire("action:posts.edited",t);t.topic.tags&&t.topic.tagsupdated&&Promise.all([o.e(20056),o.e(63)]).then(function(){var i=[o(63)];(function(s){s.updateTopicTags([t.topic])}).apply(null,i)}).catch(o.oe),g.removeMenu(c.get("post","pid",t.post.pid))}function w(t){!t||String(t.tid)!==String(ajaxify.data.tid)||(c.get("post","pid",t.pid).fadeOut(500,function(){$(this).remove(),m.showBottomPostBar()}),ajaxify.data.postcount-=1,g.updatePostCount(ajaxify.data.postcount),o.e(18631).then(function(){var e=[o(18631)];(function(n){n.onPostPurged(t)}).apply(null,e)}).catch(o.oe),$(`[component="post/parent"][data-parent-pid="${t.pid}"]`).remove())}function E(t){const e=c.get("post","pid",t.pid),{isAdminOrMod:n}=ajaxify.data.privileges,p=String(t.uid)===String(app.user.uid),d=!!t.deleted;e.length&&(e.toggleClass("deleted"),g.toggle(t.pid,d),!n&&!p&&(e.find('[component="post/tools"]').toggleClass("hidden",d),d?e.find('[component="post/content"]').translateHtml("[[topic:post-is-deleted]]"):e.find('[component="post/content"]').html(l.unescape(t.content))));const a=$(`[component="post/parent"][data-parent-pid="${t.pid}"]`);a.length&&a.each((S,i)=>{const s=$(i);d?s.find('[component="post/parent/content"]').translateHtml("[[topic:post-is-deleted]]"):s.find('[component="post/parent/content"]').html(l.unescape(t.content))})}function P(t){const e=$('[data-pid="'+t.post.pid+'"] [component="post/bookmark"]').filter(function(n,p){return $(p).closest("[data-pid]").attr("data-pid")===String(t.post.pid)});e.length&&(e.attr("data-bookmarked",t.isBookmarked),e.find('[component="post/bookmark/on"]').toggleClass("hidden",!t.isBookmarked),e.find('[component="post/bookmark/off"]').toggleClass("hidden",t.isBookmarked))}function v(t){const e=$('[data-pid="'+t.post.pid+'"]');e.find('[component="post/upvote"]').filter(function(n,p){return $(p).closest("[data-pid]").attr("data-pid")===String(t.post.pid)}).toggleClass("upvoted",t.upvote),e.find('[component="post/downvote"]').filter(function(n,p){return $(p).closest("[data-pid]").attr("data-pid")===String(t.post.pid)}).toggleClass("downvoted",t.downvote)}function N(t){const e=ajaxify.data.tid;t&&t.tid&&String(t.tid)===String(e)&&socket.emit("topics.markTopicNotificationsRead",[e])}return u}.apply(j,h),f!==void 0&&(C.exports=f)}}]);
