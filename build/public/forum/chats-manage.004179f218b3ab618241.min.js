"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,13417,34271,34405,49897,56227,62010,99127],{34405:(D,b,r)=>{var E,A;E=[r(49897),r(29930),r(36e3),r(9787),r(35786)],A=function(f,h,{Textcomplete:m},{TextareaEditor:x},{ContenteditableEditor:w}){const u={},d={delay:200,appendTo:null};u.init=o=>{const a={...d,...o},{input:i,onSelect:t}=a;app.loadJQueryUI(function(){i.autocomplete({...a,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(e,n){s(i,t,e,n)}})})},u.user=function(o,a,i){typeof a=="function"&&(i=a,a={}),a=a||{},u.init({input:o,onSelect:i,source:(t,e)=>{a.query=t.term,f.get("/api/users",a,function(n,p){if(n)return h.error(n);if(p&&p.users){const g=p.users.map(function(c){const l=$("<div></div>").html(c.username).text();return c&&{label:l,value:l,user:{uid:c.uid,name:c.username,slug:c.userslug,username:c.username,userslug:c.userslug,displayname:c.displayname,picture:c.picture,banned:c.banned,"icon:text":c["icon:text"],"icon:bgColor":c["icon:bgColor"]}}});e(g)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},u.group=function(o,a){u.init({input:o,onSelect:a,source:(i,t)=>{socket.emit("groups.search",{query:i.term},function(e,n){if(e)return h.error(e);if(n&&n.length){const p=n.map(function(g){return g&&{label:g.name,value:g.name,group:g}});t(p)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},u.tag=function(o,a){u.init({input:o,onSelect:a,delay:100,source:(i,t)=>{socket.emit("topics.autocompleteTags",{query:i.term,cid:ajaxify.data.cid||0},function(e,n){if(e)return h.error(e);n&&t(n),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function s(o,a,i,t){a=a||function(){};const e=jQuery.Event("keypress");e.which=13,e.keyCode=13,setTimeout(function(){o.trigger(e)},100),a(i,t)}return u.setup=function({element:o,strategies:a,options:i}){const t=o.get(0);if(t){var e;if(t.nodeName==="TEXTAREA"||t.nodeName==="INPUT"?e=new x(t):t.nodeName==="DIV"&&t.getAttribute("contenteditable")==="true"&&(e=new w(t)),!e)throw new Error("unknown target element type");t.setAttribute("dir",document.querySelector("html").getAttribute("data-dir"));var n=new m(e,a,{dropdown:i});return n.on("rendered",function(){n.dropdown.items.length&&n.dropdown.items[0].activate()}),n}},u}.apply(b,E),A!==void 0&&(D.exports=A)},49897:(D,b,r)=>{r.r(b),r.d(b,{del:()=>i,get:()=>u,head:()=>d,patch:()=>o,post:()=>s,put:()=>a});var E=r(91749),A=r.n(E),f=r(33530),h=r.n(f);const m=config.relative_path+"/api/v3";async function x(t,e){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:m+t.url,typeof e=="function"){w(t).then(n=>e(null,n),n=>e(n));return}try{return await w(t)}catch(n){if(n.message==="A valid login session was not found. Please log in and try again."){const{url:p}=await(0,E.fire)("filter:admin.reauth",{url:"login"});return(0,f.confirm)("[[error:api.reauth-required]]",g=>{g&&ajaxify.go(p)})}throw n}}async function w(t){const{url:e}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,E.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const n=await fetch(e,t),{headers:p}=n;if(p.get("x-redirect"))return w({url:p.get("x-redirect"),...t});const g=p.get("content-type"),c=g&&g.startsWith("application/json");let l;if(t.method!=="HEAD"&&(c?l=await n.json():l=await n.text()),!n.ok)throw l?new Error(c?l.status.message:l):new Error(n.statusText);return c&&l&&l.hasOwnProperty("status")&&l.hasOwnProperty("response")?l.response:l}function u(t,e,n){return x({url:t+(e&&Object.keys(e).length?"?"+$.param(e):"")},n)}function d(t,e,n){return x({url:t+(e&&Object.keys(e).length?"?"+$.param(e):""),method:"HEAD"},n)}function s(t,e,n){return x({url:t,method:"POST",data:e,headers:{"x-csrf-token":config.csrf_token}},n)}function o(t,e,n){return x({url:t,method:"PATCH",data:e,headers:{"x-csrf-token":config.csrf_token}},n)}function a(t,e,n){return x({url:t,method:"PUT",data:e,headers:{"x-csrf-token":config.csrf_token}},n)}function i(t,e,n){return x({url:t,method:"DELETE",data:e,headers:{"x-csrf-token":config.csrf_token}},n)}},58836:(D,b,r)=>{var E,A;E=[r(49897),r(29930),r(17459),r(34405),r(72513)],A=function(f,h,m,x,w){const u={};u.init=function(a,i){let t;i.on("click",async function(){let e=[];app.user.isAdmin&&({groups:e}=await f.get("/admin/groups"),e.sort((y,v)=>v.system-y.system).map(y=>{const{name:v,displayName:T}=y;return{name:v,displayName:T}}),Array.isArray(ajaxify.data.groups)&&e.forEach(y=>{y.selected=ajaxify.data.groups.includes(y.name)}));const n=await app.parseAndTranslate("modals/manage-room",{groups:e,user:app.user,room:ajaxify.data});t=bootbox.dialog({title:"[[modules:chat.manage-room]]",size:"large",message:n,onEscape:!0}),t.attr("component","chat/manage-modal"),o(a,t),d(a,t),s(a,t);const p=t.find('[component="chat/manage/user/list"]'),g=t.find('[component="chat/manage/user/list/search"]');w.addSearchHandler(a,g,async y=>{g.val()?p.html(await app.parseAndTranslate("partials/chats/manage-room-users",y)):o(a,t)}),w.addInfiniteScrollHandler(a,p,async(y,v)=>{y.append(await app.parseAndTranslate("partials/chats/manage-room-users",v))});const c=t.find('[component="chat/manage/user/add/search"]'),l=t.find(".text-danger");x.user(c,function(y,v){l.text(""),f.post(`/chats/${a}/users`,{uids:[v.item.user.uid]}).then(T=>{o(a,t,T),c.val("")}).catch(T=>{m.translate(T.message,function(P){l.text(P)})})}),t.find('[component="chat/manage/save"]').on("click",()=>{const y=t.find('[component="chat/room/notification/setting"]');f.put(`/chats/${a}`,{groups:t.find('[component="chat/room/groups"]').val(),notificationSetting:y.val()}).then(v=>{ajaxify.data.groups=v.groups,ajaxify.data.notificationSetting=v.notificationSetting;const T=v.notificationOptions[0];$('[component="chat/notification/setting"] [data-icon]').first().attr("data-icon",T.icon),$('[component="chat/notification/setting/sub-label"]').translateText(T.subLabel),T.selected&&$('[component="chat/notification/setting/icon"]').attr("class",`fa ${T.icon}`),t.modal("hide")}).catch(h.error)})})};function d(a,i){i.on("click",'[data-action="kick"]',function(){const t=encodeURIComponent(this.getAttribute("data-uid"));f.del(`/chats/${a}/users/${t}`,{}).then(e=>{o(a,i,e)}).catch(h.error)})}function s(a,i){i.on("click",'[data-action="toggleOwner"]',async function(){const t=String(this.getAttribute("data-uid")),e=i.get(0).querySelector(`[component="chat/manage/user/list"] > [data-uid="${t}"] [component="chat/manage/user/owner/icon"]`),n=!e.classList.contains("hidden");if(!utils.isNumber(t))return h.error("[[error:invalid-uid]]");await f[n?"del":"put"](`/chats/${a}/owners/${t}`),e.classList.toggle("hidden")})}async function o(a,i,t){const e=i.find('[component="chat/manage/user/list"]');if(!t)try{t=await f.get(`/chats/${a}/users`,{})}catch(n){console.error(n),e.find("li").text(await m.translate("[[error:invalid-data]]"))}e.find('[data-bs-toggle="tooltip"]').tooltip("dispose"),e.html(await app.parseAndTranslate("partials/chats/manage-room-users",t)),e.find('[data-bs-toggle="tooltip"]').tooltip()}return u}.apply(b,E),A!==void 0&&(D.exports=A)},72513:(D,b,r)=>{var E,A;E=[r(49897)],A=function(f){const h={};let m=0;h.init=function(d,s){const o=s.find('[component="chat/user/list"]');if(!o.length)return;const a=s.find('[component="chat/messages/pinned/container"]');s.find('[component="chat/user/list/btn"]').on("click",()=>{o.toggleClass("hidden"),o.hasClass("hidden")?w():(a.addClass("hidden"),x(d,o))}),$(window).off("action:ajaxify.start",w).one("action:ajaxify.start",w),h.addInfiniteScrollHandler(d,o,async(i,t)=>{i.append(await app.parseAndTranslate("partials/chats/user-list","users",t))})};function x(d,s){m&&clearInterval(m),m=setInterval(()=>{u(d,s)},5e3)}function w(){m&&(clearInterval(m),m=0)}async function u(d,s){if(ajaxify.data.template.chats&&app.isFocused&&s.scrollTop()===0&&!s.hasClass("hidden")){const o=await f.get(`/chats/${d}/users`,{start:0});s.find('[data-bs-toggle="tooltip"]').tooltip("dispose"),s.html(await app.parseAndTranslate("partials/chats/user-list","users",o)),s.find('[data-bs-toggle="tooltip"]').tooltip()}}return h.addInfiniteScrollHandler=function(d,s,o){s.on("scroll",utils.debounce(async()=>{const a=(s[0].scrollHeight-s.height())*.85;if(s.scrollTop()>a){const i=s.find("[data-index]").last().attr("data-index"),t=await f.get(`/chats/${d}/users`,{start:parseInt(i,10)+1});t&&t.users.length&&o(s,t)}},200))},h.addSearchHandler=function(d,s,o){s.on("keyup",utils.debounce(async()=>{const a=s.val(),i=await f.get(`/search/chats/${d}/users`,{query:a});o(i)},200))},h}.apply(b,E),A!==void 0&&(D.exports=A)}}]);
