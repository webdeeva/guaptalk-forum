"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,15794,20644,25432,34271,49897,99127],{29869:M=>{M.exports=function(h,u,f){u.setGlobal("true",!0),u.setGlobal("false",!1);const b=24*60*60*1e3,m={displayMenuItem:y,buildMetaTag:g,buildLinkTag:w,stringify:P,escape:D,stripTags:R,buildCategoryIcon:L,buildCategoryLabel:U,generateCategoryBackground:C,generateChildrenCategories:r,generateTopicClass:s,membershipBtn:n,spawnPrivilegeStates:i,localeToHTML:c,renderTopicImage:o,renderDigestAvatar:d,userAgentIcons:x,buildAvatar:N,increment:_,generateWroteReplied:H,generateRepliedTo:W,generateWrote:B,encodeURIComponent:K,isoTimeToLocaleString:z,shouldHideReplyContainer:F,humanReadableNumber:G,formattedNumber:j,txEscape:J,generatePlaceholderWave:Y,register:Q,__escape:T};function T(e){return e}function y(e,t){const a=e.navigation[t];return!(!a||a.route.match("/users")&&e.user&&!e.user.privileges["view:users"]||a.route.match("/tags")&&e.user&&!e.user.privileges["view:tags"]||a.route.match("/groups")&&e.user&&!e.user.privileges["view:groups"])}function g(e){const t=e.name?'name="'+e.name+'" ':"",a=e.property?'property="'+e.property+'" ':"",p=e.content?'content="'+e.content.replace(/\n/g," ")+'" ':"";return"<meta "+t+a+p+`/>
	`}function w(e){const t=["link","rel","as","type","href","sizes","title","crossorigin"],[a,p,E,l,k,S,A,I]=t.map(v=>e[v]?`${v}="${e[v]}" `:"");return"<link "+a+p+E+l+S+A+k+I+`/>
	`}function P(e){return JSON.stringify(e).replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/g,"&quot;")}function D(e){return h.escapeHTML(e)}function R(e){return h.stripHTMLTags(e)}function L(e,t,a){return e?`<span class="icon d-inline-flex justify-content-center align-items-center align-middle ${a}" style="${C(e)} width:${t}; height: ${t}; font-size: ${parseInt(t,10)/2}px;">${e.icon?`<i class="fa fa-fw ${e.icon}"></i>`:""}</span>`:""}function U(e,t="a",a=""){if(!e)return"";const p=t==="a"?`href="${f}/category/${e.slug}"`:"";return`<${t} ${p} class="badge px-1 text-truncate text-decoration-none ${a}" style="color: ${e.color};background-color: ${e.bgColor};border-color: ${e.bgColor}!important; max-width: 70vw;">
			${e.icon&&e.icon!=="fa-nbb-none"?`<i class="fa fa-fw ${e.icon}"></i>`:""}
			${e.name}
		</${t}>`}function C(e){if(!e)return"";const t=[];return e.bgColor&&(t.push("background-color: "+e.bgColor),t.push(`border-color: ${e.bgColor}!important`)),e.color&&t.push("color: "+e.color),e.backgroundImage&&(t.push("background-image: url("+e.backgroundImage+")"),e.imageClass&&t.push("background-size: "+e.imageClass)),t.join("; ")+";"}function r(e){let t="";return!e||!e.children||!e.children.length||(e.children.forEach(function(a){if(a&&!a.isSection){const p=a.link?a.link:f+"/category/"+a.slug;t+='<span class="category-children-item float-start"><div role="presentation" class="icon float-start" style="'+C(a)+'"><i class="fa fa-fw '+a.icon+'"></i></div><a href="'+p+'"><small>'+a.name+"</small></a></span>"}}),t=t&&'<span class="category-children">'+t+"</span>"),t}function s(e){return["locked","pinned","deleted","unread","scheduled"].filter(a=>!!e[a]).join(" ")}function n(e,t=""){return e.isMember&&e.name!=="administrators"?`<button class="btn btn-danger ${t}" data-action="leave" data-group="${e.displayName}" ${e.disableLeave?" disabled":""}><i class="fa fa-times"></i> [[groups:membership.leave-group]]</button>`:e.isPending&&e.name!=="administrators"?`<button class="btn btn-warning disabled ${t}"><i class="fa fa-clock-o"></i> [[groups:membership.invitation-pending]]</button>`:e.isInvited?`<button class="btn btn-warning" data-action="rejectInvite" data-group="${e.displayName}">[[groups:membership.reject]]</button><button class="btn btn-success" data-action="acceptInvite" data-group="${e.name}"><i class="fa fa-plus"></i> [[groups:membership.accept-invitation]]</button>`:!e.disableJoinRequests&&e.name!=="administrators"?`<button class="btn btn-success ${t}" data-action="join" data-group="${e.displayName}"><i class="fa fa-plus"></i> [[groups:membership.join-group]]</button>`:""}function i(e,t,a,p){const E=[];for(const[l,k]of Object.entries(a))E.push({name:l,state:k,type:p[l]});return E.map(function(l){const k=["groups:moderate","groups:posts:upvote","groups:posts:downvote","groups:local:login","groups:group:create"],S=["groups:find","groups:read","groups:topics:read","groups:view:users","groups:view:tags","groups:view:groups"],A=["groups:moderate"];let I=["groups:view:users","groups:find","groups:read","groups:topics:read","groups:topics:create","groups:topics:reply","groups:topics:tag","groups:posts:edit","groups:posts:history","groups:posts:delete","groups:posts:upvote","groups:posts:downvote","groups:topics:delete"];e===-1&&(I=I.slice(3));const v=t==="guests"&&(k.includes(l.name)||l.name.startsWith("groups:admin:"))||t==="spiders"&&!S.includes(l.name)||t==="fediverse"&&!I.includes(l.name)||t==="Global Moderators"&&A.includes(l.name);return`
				<td data-privilege="${l.name}" data-value="${l.state}" data-type="${l.type}">
					<div class="form-check text-center">
						<input class="form-check-input float-none${v?' d-none"':""}" autocomplete="off" type="checkbox"${l.state?" checked":""}${v?' disabled="disabled" aria-diabled="true"':""} />
					</div>
				</td>
			`}).join("")}function c(e,t){return e=e||t||"en-GB",e.replace("_","-")}function o(e){return e.thumb?'<img src="'+e.thumb+'" class="img-circle user-img" title="'+e.user.displayname+'" />':'<img component="user/picture" data-uid="'+e.user.uid+'" src="'+e.user.picture+'" class="user-img" title="'+e.user.displayname+'" />'}function d(e){return e.teaser?e.teaser.user.picture?'<img style="vertical-align: middle; width: 32px; height: 32px; border-radius: 50%;" src="'+e.teaser.user.picture+'" title="'+e.teaser.user.username+'" />':'<div style="vertical-align: middle; width: 32px; height: 32px; line-height: 32px; font-size: 16px; background-color: '+e.teaser.user["icon:bgColor"]+'; color: white; text-align: center; display: inline-block; border-radius: 50%;">'+e.teaser.user["icon:text"]+"</div>":e.user.picture?'<img style="vertical-align: middle; width: 32px; height: 32px; border-radius: 50%;" src="'+e.user.picture+'" title="'+e.user.username+'" />':'<div style="vertical-align: middle; width: 32px; height: 32px; line-height: 32px; font-size: 16px; background-color: '+e.user["icon:bgColor"]+'; color: white; text-align: center; display: inline-block; border-radius: 50%;">'+e.user["icon:text"]+"</div>"}function x(e){let t="";switch(e.platform){case"Linux":t+='<i class="fa fa-fw fa-linux"></i>';break;case"Microsoft Windows":t+='<i class="fa fa-fw fa-windows"></i>';break;case"Apple Mac":t+='<i class="fa fa-fw fa-apple"></i>';break;case"Android":t+='<i class="fa fa-fw fa-android"></i>';break;case"iPad":t+='<i class="fa fa-fw fa-tablet"></i>';break;case"iPod":case"iPhone":t+='<i class="fa fa-fw fa-mobile"></i>';break;default:t+='<i class="fa fa-fw fa-question-circle"></i>';break}switch(e.browser){case"Chrome":t+='<i class="fa fa-fw fa-chrome"></i>';break;case"Firefox":t+='<i class="fa fa-fw fa-firefox"></i>';break;case"Safari":t+='<i class="fa fa-fw fa-safari"></i>';break;case"IE":t+='<i class="fa fa-fw fa-internet-explorer"></i>';break;case"Edge":t+='<i class="fa fa-fw fa-edge"></i>';break;default:t+='<i class="fa fa-fw fa-question-circle"></i>';break}return t}function N(e,t,a,p,E){e||(e=this),p=p||"";const l=new Map([["title",e.displayname],["data-uid",e.uid],["class",`avatar ${p}${a?" avatar-rounded":""}`]]),k=[`--avatar-size: ${t};`],S=I=>Array.from(I).reduce((v,[V,X])=>(v+=` ${V}="${X}"`,v),"");let A="";return e.picture&&(A+=`<img${S(l)} alt="${e.displayname}" loading="lazy" component="${E||"avatar/picture"}" src="${e.picture}" style="${k.join(" ")}" onError="this.remove()" itemprop="image" />`),A+=`<span${S(l)} component="${E||"avatar/icon"}" style="${k.join(" ")} background-color: ${e["icon:bgColor"]}">${e["icon:text"]}</span>`,A}function _(e,t){return String(e+parseInt(t,10))}function H(e,t){return e.toPid?W(e,t):B(e,t)}function W(e,t){const a=e.parent&&e.parent.displayname?e.parent.displayname:"[[global:guest]]";return`[[topic:replied-to-user-${e.timestamp<Date.now()-t*b?"on":"ago"}, ${e.toPid}, ${f}/post/${encodeURIComponent(e.toPid)}, ${a}, ${f}/post/${encodeURIComponent(e.pid)}, ${e.timestampISO}]]`}function B(e,t){return`[[topic:wrote-${e.timestamp<Date.now()-t*b?"on":"ago"}, ${f}/post/${encodeURIComponent(e.pid)}, ${e.timestampISO}]]`}function K(e){return encodeURIComponent(e)}function z(e,t="en-GB"){return new Date(e).toLocaleString([t],{dateStyle:"short",timeStyle:"short"}).replace(/,/g,"&#44;")}function F(e){return!!(e.replies.count<=0||e.replies.hasSingleImmediateReply)}function G(e,t=1){return h.makeNumberHumanReadable(e,t)}function j(e){return h.addCommas(e)}function J(e){return String(e).replace(/%/g,"&#37;").replace(/,/g,"&#44;")}function Y(e){return e.map(a=>a==="divider"?'<li class="dropdown-divider"></li>':`
			<li class="dropdown-item placeholder-wave">
				<div class="placeholder" style="width: 20px;"></div>
				<div class="placeholder col-${a}"></div>
			</li>`).join("")}function Q(){Object.keys(m).forEach(function(e){u.registerHelper(e,m[e])})}return m}},30076:(M,h,u)=>{var f,b;const m=u(29869);f=[u(77918),u(81335)],b=function(T,y){return m(T,y,config.relative_path)}.apply(h,f),b!==void 0&&(M.exports=b)},49897:(M,h,u)=>{u.r(h),u.d(h,{del:()=>C,get:()=>P,head:()=>D,patch:()=>L,post:()=>R,put:()=>U});var f=u(91749),b=u.n(f),m=u(33530),T=u.n(m);const y=config.relative_path+"/api/v3";async function g(r,s){if(r.url=r.url.startsWith("/api")?config.relative_path+r.url:y+r.url,typeof s=="function"){w(r).then(n=>s(null,n),n=>s(n));return}try{return await w(r)}catch(n){if(n.message==="A valid login session was not found. Please log in and try again."){const{url:i}=await(0,f.fire)("filter:admin.reauth",{url:"login"});return(0,m.confirm)("[[error:api.reauth-required]]",c=>{c&&ajaxify.go(i)})}throw n}}async function w(r){const{url:s}=r;delete r.url,r.data&&!(r.data instanceof FormData)&&(r.data=JSON.stringify(r.data||{}),r.headers["content-type"]="application/json; charset=utf-8"),{options:r}=await(0,f.fire)("filter:api.options",{options:r}),r.data&&(r.body=r.data,delete r.data);const n=await fetch(s,r),{headers:i}=n;if(i.get("x-redirect"))return w({url:i.get("x-redirect"),...r});const c=i.get("content-type"),o=c&&c.startsWith("application/json");let d;if(r.method!=="HEAD"&&(o?d=await n.json():d=await n.text()),!n.ok)throw d?new Error(o?d.status.message:d):new Error(n.statusText);return o&&d&&d.hasOwnProperty("status")&&d.hasOwnProperty("response")?d.response:d}function P(r,s,n){return g({url:r+(s&&Object.keys(s).length?"?"+$.param(s):"")},n)}function D(r,s,n){return g({url:r+(s&&Object.keys(s).length?"?"+$.param(s):""),method:"HEAD"},n)}function R(r,s,n){return g({url:r,method:"POST",data:s,headers:{"x-csrf-token":config.csrf_token}},n)}function L(r,s,n){return g({url:r,method:"PATCH",data:s,headers:{"x-csrf-token":config.csrf_token}},n)}function U(r,s,n){return g({url:r,method:"PUT",data:s,headers:{"x-csrf-token":config.csrf_token}},n)}function C(r,s,n){return g({url:r,method:"DELETE",data:s,headers:{"x-csrf-token":config.csrf_token}},n)}},89664:(M,h,u)=>{var f,b;f=[u(49897),u(33530),u(29930),u(30076)],b=function(m,T,y,g){const w={};let P;w.init=function(n){P=n||"groups/details",D(),L(),U()},w.refresh=async function(){const{group:n}=await m.get(`/api/groups/${ajaxify.data.group.slug}`),i=await s(n.members);$('[component="groups/members"] tbody').html(i),$('[component="group/member/count"]').text(g.humanReadableNumber(n.memberCount)),$('[component="group/pending/count"]').text(g.humanReadableNumber(n.pending.length)),$('[component="group/invited/count"]').text(g.humanReadableNumber(n.invited.length)),ajaxify.data.group.members=n.members,ajaxify.data.group.memberCount=n.memberCount,ajaxify.data.group.invited=n.invited,ajaxify.data.group.pending=n.pending};function D(){$('[component="groups/members/add"]').on("click",function(){app.parseAndTranslate("admin/partials/groups/add-members",{},function(n){const i=[],c=T.dialog({title:"[[groups:details.add-member]]",message:n,buttons:{OK:{label:"[[groups:details.add-member]]",callback:function(){const o=[];c.find("[data-uid][data-selected]").each(function(d,x){o.push(i[$(x).attr("data-uid")])}),R(o).then(()=>{c.modal("hide")})}}}});c.on("click","[data-username]",function(){$(this).attr("data-selected")==="1"?$(this).removeAttr("data-selected"):$(this).attr("data-selected",1),$(this).find("i").toggleClass("invisible")}),c.find("input").on("keyup",function(){m.get("/api/users",{query:$(this).val(),paginate:!1},function(o,d){if(o)return y.error(o);d.users.forEach(function(x){i[x.uid]=x}),app.parseAndTranslate("admin/partials/groups/add-members","users",{users:d.users},function(x){c.find("#search-result").html(x)})})})})})}async function R(n){const i=n.map(o=>o.uid);ajaxify.data.group.name==="administrators"?await socket.emit("admin.user.makeAdmins",i).catch(y.error):await Promise.all(i.map(o=>m.put("/groups/"+ajaxify.data.group.slug+"/membership/"+o))).catch(y.error),n=n.filter(o=>!$('[component="groups/members"] [data-uid="'+o.uid+'"]').length);const c=await s(n);$('[component="groups/members"] tbody').prepend(c)}function L(){const n=$('[component="groups/members/search"]');n.on("keyup",utils.debounce(async function(){const i=n.val(),c=await m.get(`/groups/${ajaxify.data.group.slug}/members`,{query:i}),o=await s(c.users);$('[component="groups/members"] tbody').html(o),$('[component="groups/members"]').attr("data-nextstart",20)},250))}function U(){$('[component="groups/members"]').on("scroll",utils.debounce(function(){const n=$(this),i=(n[0].scrollHeight-n.innerHeight())*.9;n.scrollTop()>i&&!$('[component="groups/members/search"]').val()&&C()},250))}async function C(){const n=$('[component="groups/members"]');if(n.attr("loading"))return;n.attr("loading",1);const i=await m.get(`/groups/${ajaxify.data.group.slug}/members`,{after:n.attr("data-nextstart")}).catch(y.error);i&&i.users.length?(await r(i.users),n.removeAttr("loading"),n.attr("data-nextstart",i.nextStart)):n.removeAttr("loading")}async function r(n){n=n.filter(function(c){return!$('[component="groups/members"] [data-uid="'+c.uid+'"]').length});const i=await s(n);$('[component="groups/members"] tbody').append(i)}async function s(n){return await app.parseAndTranslate(P,"group.members",{group:{members:n,isOwner:ajaxify.data.group.isOwner}})}return w}.apply(h,f),b!==void 0&&(M.exports=b)}}]);
